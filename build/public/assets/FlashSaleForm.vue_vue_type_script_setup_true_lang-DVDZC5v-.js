import{_ as M}from"./Badge-DfumusWV.js";import{_ as L}from"./Switch-sBWkdoVy.js";import{_ as q}from"./Card-BjL1m_sW.js";import{_ as W}from"./Textarea-CZyY9J1c.js";import{_ as O}from"./FormField-qFQ_28ZO.js";import{_ as A}from"./ColorModeButton-Bf7Nr8w3.js";import{a as E,_ as Q}from"./Button-CI_-soaG.js";import{d as H,h as k,y as R,c as U,a as g,j as n,b as a,f as r,w as u,k as B,F as T,r as I,t as m,n as G,o as p,u as j,m as N,e as J,D as K,l as z}from"./app-CyjtdGoI.js";import{_ as X}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-D_sdRYGZ.js";const Y={class:"space-y-4"},Z={class:"relative"},ee={class:"flex gap-2"},ae={key:0,class:"absolute z-50 mt-2 w-full max-h-64 overflow-y-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg"},te=["onClick"],le=["src","alt"],se={class:"flex-1 min-w-0"},oe={class:"font-medium text-gray-900 dark:text-white truncate text-sm"},re={class:"text-xs text-gray-500 dark:text-gray-400"},ie={key:0,class:"space-y-3"},de={class:"flex items-center justify-between"},ne={class:"font-medium text-gray-900 dark:text-white"},ue={class:"space-y-3"},ce={class:"flex items-start gap-4"},me=["src","alt"],_e={class:"flex-1 min-w-0"},fe={class:"flex items-start justify-between gap-2"},pe={class:"font-medium text-gray-900 dark:text-white truncate"},ge={class:"text-sm text-gray-500 dark:text-gray-400"},ve={class:"grid grid-cols-1 sm:grid-cols-3 gap-3 mt-3"},he={class:"flex items-end"},ke={class:"text-lg font-bold"},xe={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},ye={class:"text-center py-8 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg"},be=H({__name:"FlashSaleProductSelector",props:{availableProducts:{},modelValue:{}},emits:["update:modelValue"],setup(w,{emit:d}){const b=w,i=d,_=k(""),f=k(!1),l=k([...b.modelValue]);R(()=>b.modelValue,e=>{l.value=[...e]},{deep:!0});const S=U(()=>{const e=l.value.map(c=>c.product_id);let t=b.availableProducts.filter(c=>!e.includes(c.id));return _.value&&(t=t.filter(c=>c.name.toLowerCase().includes(_.value.toLowerCase()))),t}),C=e=>{const t={product_id:e.id,name:e.name,image:e.image,original_price:e.price,flash_price:Math.round(e.price*.8),stock_limit:Math.min(e.stock??100,100)};l.value.push(t),i("update:modelValue",l.value),_.value="",f.value=!1},D=e=>{l.value.splice(e,1),i("update:modelValue",l.value)},V=(e,t,c)=>{l.value[e][t]=c,i("update:modelValue",l.value)},$=(e,t)=>e<=0?0:Math.round((e-t)/e*100),P=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),o=e=>!e||e==="/images/placeholder.png"?"https://placehold.co/100x100/1a1a2e/ffffff?text=No+Image":e;return(e,t)=>{const c=A,h=E,F=Q;return p(),g("div",Y,[n(" Add Product Button "),a("div",Z,[a("div",ee,[r(c,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),placeholder:"Cari produk untuk ditambahkan...",icon:"i-heroicons-magnifying-glass",class:"flex-1",onFocus:t[1]||(t[1]=s=>f.value=!0)},null,8,["modelValue"]),r(h,{type:"button",color:"primary",variant:"soft",icon:"i-heroicons-plus",onClick:t[2]||(t[2]=s=>f.value=!f.value)},{default:u(()=>[...t[4]||(t[4]=[B(" Tambah Produk ",-1)])]),_:1})]),n(" Product Dropdown "),f.value&&S.value.length>0?(p(),g("div",ae,[(p(!0),g(T,null,I(S.value,s=>(p(),g("div",{key:s.id,class:"flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-colors",onClick:x=>C(s)},[a("img",{src:o(s.image),alt:s.name,class:"w-10 h-10 rounded object-cover bg-gray-100 dark:bg-gray-800"},null,8,le),a("div",se,[a("p",oe,m(s.name),1),a("p",re,m(P(s.price))+" â€¢ Stok: "+m(s.stock),1)]),r(F,{name:"i-heroicons-plus-circle",class:"w-5 h-5 text-primary-500"})],8,te))),128))])):n("v-if",!0),n(" Backdrop to close dropdown "),f.value?(p(),g("div",{key:1,class:"fixed inset-0 z-40",onClick:t[3]||(t[3]=s=>f.value=!1)})):n("v-if",!0)]),n(" Selected Products "),l.value.length>0?(p(),g("div",ie,[a("div",de,[a("p",ne,m(l.value.length)+" Produk Flash Sale ",1)]),a("div",ue,[(p(!0),g(T,null,I(l.value,(s,x)=>(p(),g("div",{key:s.product_id,class:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},[a("div",ce,[n(" Product Info "),a("img",{src:o(s.image),alt:s.name,class:"w-16 h-16 rounded-lg object-cover bg-gray-100 dark:bg-gray-700"},null,8,me),a("div",_e,[a("div",fe,[a("div",null,[a("h4",pe,m(s.name),1),a("p",ge," Harga Normal: "+m(P(s.original_price)),1)]),r(h,{type:"button",color:"error",variant:"ghost",size:"xs",icon:"i-heroicons-trash",onClick:y=>D(x)},null,8,["onClick"])]),n(" Price & Stock Inputs "),a("div",ve,[a("div",null,[t[5]||(t[5]=a("label",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1 block"}," Harga Flash Sale ",-1)),r(X,{"model-value":s.flash_price,"onUpdate:modelValue":y=>V(x,"flash_price",y||0),placeholder:"0"},null,8,["model-value","onUpdate:modelValue"])]),a("div",null,[t[6]||(t[6]=a("label",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1 block"}," Batas Stok ",-1)),r(c,{"model-value":s.stock_limit,"onUpdate:modelValue":y=>V(x,"stock_limit",Number(y)||0),type:"number",min:1,placeholder:"100",class:"w-full"},null,8,["model-value","onUpdate:modelValue"])]),a("div",he,[a("div",{class:G(["w-full px-3 py-2 rounded-lg text-center",$(s.original_price,s.flash_price)>=50?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400":"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400"])},[a("span",ke,m($(s.original_price,s.flash_price))+"% ",1),t[7]||(t[7]=a("span",{class:"text-xs block"},"Diskon",-1))],2)])]),n(" Sold count (for edit mode) "),s.sold_count&&s.sold_count>0?(p(),g("p",xe," Terjual: "+m(s.sold_count)+" dari "+m(s.stock_limit),1)):n("v-if",!0)])])]))),128))])])):(p(),g(T,{key:1},[n(" Empty State "),a("div",ye,[r(F,{name:"i-heroicons-shopping-bag",class:"w-12 h-12 mx-auto mb-3 text-gray-300 dark:text-gray-600"}),t[8]||(t[8]=a("p",{class:"font-medium"},"Belum ada produk",-1)),t[9]||(t[9]=a("p",{class:"text-sm"},"Tambahkan produk untuk flash sale",-1))])],2112))])}}}),we={class:"p-6 max-w-7xl mx-auto space-y-6"},Se={class:"flex items-center gap-4"},Ve={class:"text-2xl font-bold text-gray-900 dark:text-white"},$e={class:"text-gray-500 dark:text-gray-400"},Pe={class:"space-y-4"},Fe={class:"space-y-4"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"flex items-center gap-3"},Ce={class:"flex items-center justify-between"},De={key:0,class:"mt-2 text-sm text-red-500"},Te={class:"flex items-center justify-end gap-4"},qe=H({__name:"FlashSaleForm",props:{flashSale:{},products:{},mode:{}},setup(w){const d=w,b={name:"",description:"",start_date:"",end_date:"",is_active:!0,products:[]},i=k(d.mode==="edit"&&d.flashSale?{name:d.flashSale.name,description:d.flashSale.description||"",start_date:d.flashSale.startDate,end_date:d.flashSale.endDate,is_active:d.flashSale.isActive,products:d.flashSale.products.map(o=>({product_id:o.product_id,original_price:o.original_price,flash_price:o.flash_price,stock_limit:o.stock_limit}))}:{...b}),_=k(d.mode==="edit"&&d.flashSale?d.flashSale.products.map(o=>({product_id:o.product_id,name:o.name,image:o.image,original_price:o.original_price,flash_price:o.flash_price,stock_limit:o.stock_limit,sold_count:o.sold_count})):[]),f=k(!1),l=k({}),S=()=>{l.value={},i.value.name.trim()||(l.value.name="Nama flash sale wajib diisi"),i.value.start_date||(l.value.start_date="Tanggal mulai wajib diisi"),i.value.end_date||(l.value.end_date="Tanggal selesai wajib diisi"),i.value.start_date&&i.value.end_date&&i.value.start_date>i.value.end_date&&(l.value.end_date="Tanggal selesai harus setelah tanggal mulai"),_.value.length===0&&(l.value.products="Tambahkan minimal satu produk untuk flash sale");for(const o of _.value){if(o.flash_price<=0){l.value.products="Harga flash sale harus lebih dari 0";break}if(o.flash_price>=o.original_price){l.value.products="Harga flash sale harus lebih rendah dari harga normal";break}if(o.stock_limit<=0){l.value.products="Batas stok harus lebih dari 0";break}}return Object.keys(l.value).length===0},C=o=>{_.value=o,i.value.products=o.map(e=>({product_id:e.product_id,original_price:e.original_price,flash_price:e.flash_price,stock_limit:e.stock_limit}))},D=()=>{if(!S())return;f.value=!0;const o={...i.value,products:_.value.map(e=>({product_id:e.product_id,original_price:e.original_price,flash_price:e.flash_price,stock_limit:e.stock_limit,sold_count:e.sold_count||0}))};d.mode==="edit"&&d.flashSale?z.put(`/admin/promotions/flash-sale/${d.flashSale.id}`,o,{onFinish:()=>{f.value=!1},onError:e=>{l.value=e}}):z.post("/admin/promotions/flash-sale",o,{onFinish:()=>{f.value=!1},onError:e=>{l.value=e}})},V=U(()=>d.mode==="edit"?"Edit Flash Sale":"Buat Flash Sale Baru"),$=U(()=>d.mode==="edit"?d.flashSale?.name||"":"Buat event flash sale dengan harga spesial"),P=U(()=>d.mode==="edit"?"Simpan Perubahan":"Simpan Flash Sale");return(o,e)=>{const t=E,c=A,h=O,F=W,s=q,x=L,y=M;return p(),g("div",we,[n(" Header "),a("div",Se,[r(j(N),{href:"/admin/promotions/flash-sale"},{default:u(()=>[r(t,{icon:"i-heroicons-arrow-left",color:"neutral",variant:"ghost",size:"sm"})]),_:1}),a("div",null,[a("h1",Ve,m(V.value),1),a("p",$e,m($.value),1)])]),n(" Form "),a("form",{onSubmit:K(D,["prevent"]),class:"space-y-6"},[n(" Basic Info "),r(s,null,{header:u(()=>[...e[5]||(e[5]=[a("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Informasi Dasar",-1)])]),default:u(()=>[a("div",Pe,[r(h,{label:"Nama Flash Sale",error:l.value.name,required:""},{default:u(()=>[r(c,{modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=v=>i.value.name=v),placeholder:"Contoh: Flash Sale Akhir Tahun",color:l.value.name?"error":void 0,class:"w-full"},null,8,["modelValue","color"])]),_:1},8,["error"]),r(h,{label:"Deskripsi"},{default:u(()=>[r(F,{modelValue:i.value.description,"onUpdate:modelValue":e[1]||(e[1]=v=>i.value.description=v),placeholder:"Deskripsi singkat tentang flash sale ini",rows:3,class:"w-full"},null,8,["modelValue"])]),_:1})])]),_:1}),n(" Period "),r(s,null,{header:u(()=>[...e[6]||(e[6]=[a("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Periode Flash Sale",-1)])]),default:u(()=>[a("div",Fe,[a("div",Ue,[r(h,{label:"Tanggal & Waktu Mulai",error:l.value.start_date,required:""},{default:u(()=>[r(c,{modelValue:i.value.start_date,"onUpdate:modelValue":e[2]||(e[2]=v=>i.value.start_date=v),type:"datetime-local",color:l.value.start_date?"error":void 0,class:"w-full"},null,8,["modelValue","color"])]),_:1},8,["error"]),r(h,{label:"Tanggal & Waktu Selesai",error:l.value.end_date,required:""},{default:u(()=>[r(c,{modelValue:i.value.end_date,"onUpdate:modelValue":e[3]||(e[3]=v=>i.value.end_date=v),type:"datetime-local",color:l.value.end_date?"error":void 0,class:"w-full"},null,8,["modelValue","color"])]),_:1},8,["error"])]),a("div",Be,[r(x,{modelValue:i.value.is_active,"onUpdate:modelValue":e[4]||(e[4]=v=>i.value.is_active=v)},null,8,["modelValue"]),e[7]||(e[7]=a("div",null,[a("p",{class:"font-medium text-gray-900 dark:text-white"},"Aktifkan Flash Sale"),a("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Flash sale akan aktif sesuai periode yang ditentukan ")],-1))])])]),_:1}),n(" Products "),r(s,null,{header:u(()=>[a("div",Ce,[e[8]||(e[8]=a("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Produk Flash Sale",-1)),_.value.length>0?(p(),J(y,{key:0,color:"primary",variant:"soft"},{default:u(()=>[B(m(_.value.length)+" produk ",1)]),_:1})):n("v-if",!0)])]),default:u(()=>[r(be,{"available-products":w.products,"model-value":_.value,"onUpdate:modelValue":C},null,8,["available-products","model-value"]),l.value.products?(p(),g("p",De,m(l.value.products),1)):n("v-if",!0)]),_:1}),n(" Actions "),a("div",Te,[r(j(N),{href:"/admin/promotions/flash-sale"},{default:u(()=>[r(t,{color:"neutral",variant:"ghost",disabled:f.value},{default:u(()=>[...e[9]||(e[9]=[B(" Batal ",-1)])]),_:1},8,["disabled"])]),_:1}),r(t,{type:"submit",color:"primary",loading:f.value},{default:u(()=>[B(m(P.value),1)]),_:1},8,["loading"])])],32)])}}});export{qe as _};
