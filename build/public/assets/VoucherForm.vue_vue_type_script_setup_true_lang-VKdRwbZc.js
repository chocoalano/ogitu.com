import{_ as q}from"./Switch-sBWkdoVy.js";import{a as G,_ as R}from"./Button-CI_-soaG.js";import{_ as L}from"./SelectMenu-DKAhKU-v.js";import{_ as H}from"./Card-BjL1m_sW.js";import{_ as z}from"./Textarea-CZyY9J1c.js";import{_ as J}from"./FormField-qFQ_28ZO.js";import{_ as Q}from"./ColorModeButton-Bf7Nr8w3.js";import{d as W,h as k,c as x,a as y,j as d,b as l,f as t,w as r,u as P,m as T,t as v,e as g,o as m,k as b,D as X,l as B}from"./app-CyjtdGoI.js";import{_ as Y}from"./ProductSelector.vue_vue_type_script_setup_true_lang-BL_enzOX.js";import{_ as V}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-D_sdRYGZ.js";const Z={class:"p-6 max-w-7xl mx-auto space-y-6"},ee={class:"flex items-center gap-4"},ae={class:"text-2xl font-bold text-gray-900 dark:text-white"},le={class:"text-gray-500 dark:text-gray-400"},te={class:"space-y-4"},oe={class:"flex gap-2"},re={class:"space-y-4"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue={class:"p-4 rounded-lg bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800"},de={class:"flex items-center gap-3"},ne={class:"p-2 rounded-full bg-primary-100 dark:bg-primary-800"},me={class:"flex items-center gap-2"},ce={class:"px-2 py-1 rounded bg-primary-100 dark:bg-primary-800 text-sm font-mono text-primary-700 dark:text-primary-300"},pe={class:"text-xl font-bold text-primary-700 dark:text-primary-300"},ve={class:"space-y-4"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={key:0,class:"text-xs text-gray-500"},he={key:1,class:"text-xs text-gray-500"},xe={class:"flex flex-wrap items-center gap-6"},ye={class:"flex items-center gap-3"},ke={class:"flex items-center gap-3"},be={key:0,class:"mt-2 text-sm text-red-500"},Ve={class:"flex items-center justify-end gap-4"},Se=W({__name:"VoucherForm",props:{voucher:{},products:{},mode:{}},setup(f){const i=f,w=u=>u?new Date(u).toISOString().slice(0,16):"",D={code:"",name:"",description:"",type:"percentage",value:0,min_purchase:0,max_discount:null,start_date:"",end_date:"",usage_limit:null,usage_limit_per_customer:1,is_active:!0,is_public:!1,applies_to_all:!1,product_ids:[]},a=k(i.mode==="edit"&&i.voucher?{code:i.voucher.code,name:i.voucher.name,description:i.voucher.description||"",type:i.voucher.type,value:i.voucher.value,min_purchase:i.voucher.minPurchase,max_discount:i.voucher.maxDiscount,start_date:w(i.voucher.startDate),end_date:w(i.voucher.endDate),usage_limit:i.voucher.usageLimit,usage_limit_per_customer:i.voucher.usageLimitPerCustomer,is_active:i.voucher.isActive,is_public:i.voucher.isPublic,applies_to_all:i.voucher.appliesToAll,product_ids:i.voucher.productIds||[]}:{...D}),_=k(!1),s=k({}),N=[{label:"Persentase (%)",value:"percentage"},{label:"Nominal (Rp)",value:"fixed"},{label:"Gratis Ongkir",value:"free_shipping"}],C=async()=>{try{const e=await(await fetch("/admin/promotions/vouchers/generate-code")).json();a.value.code=e.code}catch{const u="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let e="OGITU";for(let c=0;c<6;c++)e+=u.charAt(Math.floor(Math.random()*u.length));a.value.code=e}},I=()=>(s.value={},a.value.code.trim()?a.value.code.length<4&&(s.value.code="Kode voucher minimal 4 karakter"):s.value.code="Kode voucher wajib diisi",a.value.name.trim()||(s.value.name="Nama voucher wajib diisi"),a.value.type!=="free_shipping"&&(a.value.value<=0&&(s.value.value="Nilai voucher harus lebih dari 0"),a.value.type==="percentage"&&a.value.value>100&&(s.value.value="Nilai persentase maksimal 100%")),a.value.start_date||(s.value.start_date="Tanggal mulai wajib diisi"),a.value.end_date||(s.value.end_date="Tanggal selesai wajib diisi"),a.value.start_date&&a.value.end_date&&a.value.start_date>a.value.end_date&&(s.value.end_date="Tanggal selesai harus setelah tanggal mulai"),!a.value.applies_to_all&&a.value.product_ids.length===0&&(s.value.products='Pilih minimal satu produk atau aktifkan "Berlaku untuk semua produk"'),Object.keys(s.value).length===0),M=()=>{I()&&(_.value=!0,i.mode==="edit"&&i.voucher?B.put(`/admin/promotions/vouchers/${i.voucher.id}`,a.value,{onFinish:()=>{_.value=!1},onError:u=>{s.value=u}}):B.post("/admin/promotions/vouchers",a.value,{onFinish:()=>{_.value=!1},onError:u=>{s.value=u}}))},S=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(u),$=x(()=>a.value.type==="free_shipping"?"Gratis Ongkir":a.value.type==="percentage"?`${a.value.value}%`:S(a.value.value)),j=x(()=>i.mode==="edit"?"Edit Voucher":"Buat Voucher Baru"),F=x(()=>i.mode==="edit"?i.voucher?.name||"":"Buat voucher untuk customer di platform"),O=x(()=>i.mode==="edit"?"Simpan Perubahan":"Simpan Voucher");return(u,e)=>{const c=G,p=Q,n=J,K=z,h=H,A=L,E=R,U=q;return m(),y("div",Z,[d(" Header "),l("div",ee,[t(P(T),{href:"/admin/promotions/vouchers"},{default:r(()=>[t(c,{icon:"i-heroicons-arrow-left",color:"neutral",variant:"ghost",size:"sm"})]),_:1}),l("div",null,[l("h1",ae,v(j.value),1),l("p",le,v(F.value),1)])]),d(" Form "),l("form",{onSubmit:X(M,["prevent"]),class:"space-y-6"},[d(" Basic Info "),t(h,null,{header:r(()=>[...e[16]||(e[16]=[l("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Informasi Dasar",-1)])]),default:r(()=>[l("div",te,[t(n,{label:"Kode Voucher",error:s.value.code,required:""},{default:r(()=>[l("div",oe,[t(p,{modelValue:a.value.code,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.code=o),placeholder:"VOUCHER2024",class:"flex-1 font-mono uppercase w-full",color:s.value.code?"error":void 0},null,8,["modelValue","color"]),f.mode==="create"?(m(),g(c,{key:0,type:"button",color:"neutral",variant:"soft",icon:"i-heroicons-arrow-path",onClick:C},{default:r(()=>[...e[17]||(e[17]=[b(" Generate ",-1)])]),_:1})):d("v-if",!0)])]),_:1},8,["error"]),t(n,{label:"Nama Voucher",error:s.value.name,required:""},{default:r(()=>[t(p,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.name=o),placeholder:"Contoh: Voucher Pelanggan Baru",color:s.value.name?"error":void 0,class:"w-full"},null,8,["modelValue","color"])]),_:1},8,["error"]),t(n,{label:"Deskripsi"},{default:r(()=>[t(K,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.description=o),placeholder:"Deskripsi singkat tentang voucher ini",rows:3,class:"w-full"},null,8,["modelValue"])]),_:1})])]),_:1}),d(" Voucher Value "),t(h,null,{header:r(()=>[...e[18]||(e[18]=[l("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Nilai Voucher",-1)])]),default:r(()=>[l("div",re,[l("div",se,[t(n,{label:"Tipe Voucher",required:""},{default:r(()=>[t(A,{modelValue:a.value.type,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.type=o),items:N,"value-key":"value",class:"w-full"},null,8,["modelValue"])]),_:1}),a.value.type!=="free_shipping"?(m(),g(n,{key:0,label:a.value.type==="percentage"?"Nilai (%)":"Nilai (Rp)",error:s.value.value,required:""},{default:r(()=>[a.value.type==="percentage"?(m(),g(p,{key:0,modelValue:a.value.value,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.value=o),modelModifiers:{number:!0},type:"number",min:0,max:100,placeholder:"10",color:s.value.value?"error":void 0,class:"w-full"},null,8,["modelValue","color"])):(m(),g(V,{key:1,modelValue:a.value.value,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.value=o),placeholder:"50.000",color:s.value.value?"error":void 0},null,8,["modelValue","color"]))]),_:1},8,["label","error"])):d("v-if",!0)]),l("div",ie,[t(n,{label:"Minimal Pembelian"},{hint:r(()=>[...e[19]||(e[19]=[l("span",{class:"text-xs text-gray-500"},"Kosongkan jika tidak ada minimal",-1)])]),default:r(()=>[t(V,{modelValue:a.value.min_purchase,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.min_purchase=o),placeholder:"0"},null,8,["modelValue"])]),_:1}),a.value.type==="percentage"?(m(),g(n,{key:0,label:"Maksimal Diskon"},{hint:r(()=>[...e[20]||(e[20]=[l("span",{class:"text-xs text-gray-500"},"Kosongkan jika tidak ada batasan",-1)])]),default:r(()=>[t(V,{modelValue:a.value.max_discount,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.max_discount=o),placeholder:"Tidak ada batasan"},null,8,["modelValue"])]),_:1})):d("v-if",!0)]),d(" Preview "),l("div",ue,[l("div",de,[l("div",ne,[t(E,{name:"i-heroicons-ticket",class:"w-5 h-5 text-primary-600 dark:text-primary-400"})]),l("div",null,[e[21]||(e[21]=l("p",{class:"text-sm text-primary-600 dark:text-primary-400"},"Preview Voucher",-1)),l("div",me,[l("code",ce,v(a.value.code||"KODE"),1),l("span",pe,v($.value),1)])])])])])]),_:1}),d(" Period & Usage "),t(h,null,{header:r(()=>[...e[22]||(e[22]=[l("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Periode & Penggunaan",-1)])]),default:r(()=>[l("div",ve,[l("div",fe,[t(n,{label:"Tanggal Mulai",error:s.value.start_date,required:""},{default:r(()=>[t(p,{modelValue:a.value.start_date,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.start_date=o),type:"datetime-local",color:s.value.start_date?"error":void 0,class:"w-full"},null,8,["modelValue","color"])]),_:1},8,["error"]),t(n,{label:"Tanggal Selesai",error:s.value.end_date,required:""},{default:r(()=>[t(p,{modelValue:a.value.end_date,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.end_date=o),type:"datetime-local",color:s.value.end_date?"error":void 0,class:"w-full"},null,8,["modelValue","color"])]),_:1},8,["error"])]),l("div",_e,[t(n,{label:"Batas Penggunaan Total"},{hint:r(()=>[f.mode==="edit"&&f.voucher?.usageCount?(m(),y("span",ge," Sudah digunakan: "+v(f.voucher.usageCount)+" kali ",1)):(m(),y("span",he," Kosongkan jika tidak ada batasan "))]),default:r(()=>[t(p,{modelValue:a.value.usage_limit,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.usage_limit=o),modelModifiers:{number:!0},type:"number",min:0,placeholder:"Tidak ada batasan",class:"w-full"},null,8,["modelValue"])]),_:1}),t(n,{label:"Batas per Pelanggan"},{hint:r(()=>[...e[23]||(e[23]=[l("span",{class:"text-xs text-gray-500"}," Maksimal penggunaan per pelanggan ",-1)])]),default:r(()=>[t(p,{modelValue:a.value.usage_limit_per_customer,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.usage_limit_per_customer=o),modelModifiers:{number:!0},type:"number",min:1,placeholder:"1",class:"w-full"},null,8,["modelValue"])]),_:1})]),l("div",xe,[l("div",ye,[t(U,{modelValue:a.value.is_active,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.is_active=o)},null,8,["modelValue"]),e[24]||(e[24]=l("div",null,[l("p",{class:"font-medium text-gray-900 dark:text-white"},"Aktifkan Voucher"),l("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," Voucher akan aktif sesuai periode ")],-1))]),l("div",ke,[t(U,{modelValue:a.value.is_public,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.is_public=o)},null,8,["modelValue"]),e[25]||(e[25]=l("div",null,[l("p",{class:"font-medium text-gray-900 dark:text-white"},"Voucher Publik"),l("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," Tampilkan di halaman promosi ")],-1))])])])]),_:1}),d(" Products "),t(h,null,{header:r(()=>[...e[26]||(e[26]=[l("h3",{class:"font-semibold text-gray-900 dark:text-white"},"Produk",-1)])]),default:r(()=>[t(Y,{products:f.products,"selected-ids":a.value.product_ids,"onUpdate:selectedIds":e[14]||(e[14]=o=>a.value.product_ids=o),"applies-to-all":a.value.applies_to_all,"onUpdate:appliesToAll":e[15]||(e[15]=o=>a.value.applies_to_all=o)},null,8,["products","selected-ids","applies-to-all"]),s.value.products?(m(),y("p",be,v(s.value.products),1)):d("v-if",!0)]),_:1}),d(" Actions "),l("div",Ve,[t(P(T),{href:"/admin/promotions/vouchers"},{default:r(()=>[t(c,{color:"neutral",variant:"ghost",disabled:_.value},{default:r(()=>[...e[27]||(e[27]=[b(" Batal ",-1)])]),_:1},8,["disabled"])]),_:1}),t(c,{type:"submit",color:"primary",loading:_.value},{default:r(()=>[b(v(O.value),1)]),_:1},8,["loading"])])],32)])}}});export{Se as _};
