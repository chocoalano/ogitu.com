/**
 * @license GoJS
 * GoJS v3.1.3 JavaScript Library for Interactive Diagrams, https://gojs.net
 * GoJS and Northwoods Software are registered trademarks of Northwoods Software Corporation, https://nwoods.com.
 * Copyright 1998-2025 by Northwoods Software Corporation.  All Rights Reserved.
 * THIS SOFTWARE IS LICENSED.  THE LICENSE AGREEMENT IS AT: https://gojs.net/3.1.3/license.html.
 * DO NOT MODIFY THIS FILE.  DO NOT DISTRIBUTE A MODIFIED COPY OF THE CONTENTS OF THIS FILE.
 */(function(){const H=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};H.requestAnimationFrame===void 0&&(H.setImmediate===void 0?H.requestAnimationFrame=x=>H.setTimeout(x,0):H.requestAnimationFrame=H.setImmediate);class y{static ur=H.navigator!==void 0&&H.navigator.platform!==void 0&&H.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null;static CP(t,e,i){let s=-1;return function(){const n=this,o=arguments;s!==-1&&y.wc(s),s=y.dn(()=>{s=-1,i||t.apply(n,o)},e),i&&!s&&t.apply(n,o)}}static dn(t,e){return H.setTimeout(t,e)}static wc(t){H.clearTimeout(t)}static Ni(t){return H.document.createElement(t)}static o(t){throw new Error(t)}static L(t,e){let i="The object is frozen, so its properties cannot be set: "+t.toString();e!==void 0&&(i+="  to value: "+e),y.o(i)}static se(t,e,i,s){}static s(t,e,i,s){}static CU(t,e,i){}static xc(t,e,i){(t===null||typeof t!="object")&&y.LL(e)}static S(t,e,i){}static LU(t,e,i){}static si(t,e,i,s){}static J(t,e,i,s){let n=y.LL(i);s!==void 0&&(n+="."+s),y.o(n+" is not in the range "+e+": "+t)}static Gi(t){}static dr(t,e){}static ne(t){H.console&&H.console.log(t)}static $(t){return t!==null&&typeof t=="object"}static st(t){return typeof t=="function"}static LP=[];static nt(){const t=y.LP.pop();return t===void 0?[]:t}static Z(t){t.length=0,y.LP.push(t)}static AU=Object.freeze([]);static LL(t){return t===null?"*":typeof t=="string"?t:y.st(t)?t.name:""}static Hn(t){return y.st(t)?t.className?t.className:t.name:y.$(t)&&t.constructor?y.Hn(t.constructor):typeof t}static $a(t,e){return e==null||e===""?null:y.$(t)&&e in t||t[e]?t[e]:null}static toString(t){let e=t;return y.$(t)&&(t.text?e=t.text:t.name?e=t.name:t.key!==void 0?e=t.key:t.id!==void 0?e=t.id:t.constructor===Object&&(t.Text?e=t.Text:t.Name?e=t.Name:t.Key!==void 0?e=t.Key:t.Id!==void 0?e=t.Id:t.ID!==void 0&&(e=t.ID))),e===void 0?"undefined":e===null?"null":e.toString()}static jw(t,e){if(t.hasOwnProperty(e))return!0;let i=Object.getPrototypeOf(t);for(;i&&i!==Function;){if(i.hasOwnProperty(e))return!0;const s=i.TU;if(s&&s[e])return!0;i=Object.getPrototypeOf(i)}return!1}static zF(t){const e=[];let i=0;for(i=0;i<256;i++)e[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+e[i]+119)%256,n=e[i],e[i]=e[s],e[s]=n;i=0,s=0;let o="";for(let r=0;r<t.length;r++)i=(i+1)%256,s=(s+e[i])%256,n=e[i],e[i]=e[s],e[s]=n,o+=String.fromCharCode(t.charCodeAt(r)^e[(e[i]+e[s])%256]);return o}static XF(t){const e="0123456789abcdef",i=[];for(let r=0;r<256;r++)i[e.charAt(r>>4)+e.charAt(r&15)]=String.fromCharCode(r);t.length%2&&(t="0"+t);const s=[];let n=0;for(let r=0;r<t.length;r+=2)s[n++]=i[t.substring(r,r+2)];const o=s.join("");return o===""?"0":o}static We(t){return y.zF(y.XF(t))}static color1="@COLOR1";static color2="@COLOR2";static qw="32ab5ff3b26f42dc0ed90f21412913b5"}y.vfo="29e647fdb0";class Ts{AP;constructor(){this.AP=[]}toString(){return this.AP.join("")}add(t){t!==""&&this.AP.push(t)}}class Zt{}class Ut{g;constructor(){this.g=[]}[Symbol.iterator](){return this.g.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(t){return this}filter(){return this}get count(){return 0}Ml(){}toString(){return"EmptyIterator"}static instance=new Ut}class Pe{constructor(t){this.key=-1,this.value=t}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(t){return this.key=-1,t(this.value)}all(t){return this.key=-1,t(this.value)}each(t){return this.key=-1,t(this.value),this}map(t){return new Pe(t(this.value))}filter(t){return t(this.value)?new Pe(this.value):Ut.instance}get count(){return 1}Ml(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class Se{jt;Xs;Gt;Tt;constructor(t){this.jt=t,this.Xs=null,t.gr=null,this.Gt=t.rt,this.Tt=-1}[Symbol.iterator](){return this.Xs===null?this.jt.r.values():this.jt.r.filter(this.Xs).values()}key;value;get iterator(){return this}get predicate(){return this.Xs}set predicate(t){this.Xs=t}reset(){const t=this.jt;t.gr=null,this.Gt=t.rt,this.Tt=-1}next(){const t=this.jt;if(t.rt!==this.Gt&&this.key<0)return!1;const e=t.r,i=e.length;let s=++this.Tt;const n=this.Xs;if(n!==null)for(;s<i;){const o=e[s];if(n(o))return this.Tt=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=e[s],!0;this.Ml()}return!1}hasNext(){return this.next()}first(){const t=this.jt;this.Gt=t.rt,this.Tt=0;const e=t.r,i=e.length,s=this.Xs;if(s!==null){let n=0;for(;n<i;){const o=e[n];if(s(o))return this.Tt=n,this.key=n,this.value=o,o;n++}return null}else if(i>0){const n=e[0];return this.key=0,this.value=n,n}else return null}any(t){const e=this.jt;e.gr=null;const i=e.rt;this.Tt=-1;const s=e.r,n=s.length,o=this.Xs;for(let r=0;r<n;r++){const a=s[r];if(!(o!==null&&!o(a))){if(t(a))return!0;e.rt!==i&&y.Gi(e)}}return!1}all(t){const e=this.jt;e.gr=null;const i=e.rt;this.Tt=-1;const s=e.r,n=s.length,o=this.Xs;for(let r=0;r<n;r++){const a=s[r];if(!(o!==null&&!o(a))){if(!t(a))return!1;e.rt!==i&&y.Gi(e)}}return!0}each(t){const e=this.jt;e.gr=null;const i=e.rt;this.Tt=-1;const s=e.r,n=s.length,o=this.Xs;for(let r=0;r<n;r++){const a=s[r];o!==null&&!o(a)||(t(a),e.rt!==i&&y.Gi(e))}return this}map(t){const e=this.jt;e.gr=null;const i=e.rt;this.Tt=-1;const s=[],n=e.r,o=n.length,r=this.Xs;for(let l=0;l<o;l++){const h=n[l];r!==null&&!r(h)||(s.push(t(h)),e.rt!==i&&y.Gi(e))}const a=new J;return a.r=s,a.Yi(),a.iterator}filter(t){const e=this.jt;e.gr=null;const i=e.rt;this.Tt=-1;const s=[],n=e.r,o=n.length,r=this.Xs;for(let l=0;l<o;l++){const h=n[l];r!==null&&!r(h)||(t(h)&&s.push(h),e.rt!==i&&y.Gi(e))}const a=new J;return a.r=s,a.Yi(),a.iterator}get count(){const t=this.Xs;if(t!==null){let e=0;const i=this.jt.r,s=i.length;for(let n=0;n<s;n++)t(i[n])&&e++;return e}else return this.jt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.Xs=null,this.jt.gr=this}toString(){return"ListIterator@"+this.Tt+"/"+this.jt.count}}class Ls{jt;Gt;Tt;constructor(t){this.jt=t,t.pr=null,this.Gt=t.rt,this.Tt=t.r.length}[Symbol.iterator](){return this.jt.r.reverse().values()}key;value;get iterator(){return this}reset(){const t=this.jt;t.pr=null,this.Gt=t.rt,this.Tt=t.r.length}next(){const t=this.jt;if(t.rt!==this.Gt&&this.key<0)return!1;const e=--this.Tt;return e>=0?(this.key=e,this.value=t.r[e],!0):(this.Ml(),!1)}hasNext(){return this.next()}first(){const t=this.jt;this.Gt=t.rt;const e=t.r,i=e.length-1;if(this.Tt=i,i>=0){const s=e[i];return this.key=i,this.value=s,s}else return null}any(t){const e=this.jt;e.pr=null;const i=e.rt,s=e.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(t(r))return!0;e.rt!==i&&y.Gi(e)}return!1}all(t){const e=this.jt;e.pr=null;const i=e.rt,s=e.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(!t(r))return!1;e.rt!==i&&y.Gi(e)}return!0}each(t){const e=this.jt;e.pr=null;const i=e.rt,s=e.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const r=s[o];t(r),e.rt!==i&&y.Gi(e)}return this}map(t){const e=this.jt;e.pr=null;const i=e.rt,s=[],n=e.r,o=n.length;this.Tt=o;for(let a=o-1;a>=0;a--){const l=n[a];s.push(t(l)),e.rt!==i&&y.Gi(e)}const r=new J;return r.r=s,r.Yi(),r.iterator}filter(t){const e=this.jt;e.pr=null;const i=e.rt,s=[],n=e.r,o=n.length;this.Tt=o;for(let a=o-1;a>=0;a--){const l=n[a];t(l)&&s.push(l),e.rt!==i&&y.Gi(e)}const r=new J;return r.r=s,r.Yi(),r.iterator}get count(){return this.jt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.jt.pr=this}toString(){return"ListIteratorBackwards("+this.Tt+"/"+this.jt.count+")"}}class J{f;r;rt;gr;pr;constructor(t){K.Je(this),this.f=!1,this.r=[],this.rt=0,this.gr=null,this.pr=null,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.r.values()}Yi(){let t=this.rt;t++,t>999999999&&(t=0),this.rt=t}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"List()#"+K.xs(this)}add(t){return this.f&&y.L(this,t),this.r.push(t),this.Yi(),this}push(t){this.add(t)}addAll(t){if(t===null)return this;this.f&&y.L(this);const e=this.r;if(t.first){const i=t.iterator;for(;i.next();)e.push(i.value)}else for(const i of t)e.push(i);return this.Yi(),this}clear(){this.f&&y.L(this),this.r.length=0,this.Yi()}contains(t){return this.has(t)}has(t){return t===null?!1:this.r.indexOf(t)!==-1}indexOf(t){return t===null?-1:this.r.indexOf(t)}elt(t){const e=this.r;return(t<0||t>=e.length)&&y.J(t,"0 <= i < length",J,"elt:i"),e[t]}get(t){return this.elt(t)}setElt(t,e){const i=this.r;(t<0||t>=i.length)&&y.J(t,"0 <= i < length",J,"setElt:i"),this.f&&y.L(this,t),i[t]=e}set(t,e){this.setElt(t,e)}first(){const t=this.r;return t.length===0?null:t[0]}last(){const t=this.r,e=t.length;return e>0?t[e-1]:null}pop(){this.f&&y.L(this);const t=this.r;if(t.length>0){const e=t.pop();return e===void 0?null:e}return null}any(t){const e=this.r,i=this.rt,s=e.length;for(let n=0;n<s;n++){if(t(e[n]))return!0;this.rt!==i&&y.Gi(this)}return!1}all(t){const e=this.r,i=this.rt,s=e.length;for(let n=0;n<s;n++){if(!t(e[n]))return!1;this.rt!==i&&y.Gi(this)}return!0}each(t){const e=this.r,i=this.rt,s=e.length;for(let n=0;n<s;n++)t(e[n]),this.rt!==i&&y.Gi(this);return this}map(t){const e=new J,i=[],s=this.r,n=this.rt,o=s.length;for(let r=0;r<o;r++)i.push(t(s[r])),this.rt!==n&&y.Gi(this);return e.r=i,e.Yi(),e}filter(t){const e=new J,i=[],s=this.r,n=this.rt,o=s.length;for(let r=0;r<o;r++){const a=s[r];t(a)&&i.push(a),this.rt!==n&&y.Gi(this)}return e.r=i,e.Yi(),e}insertAt(t,e){t<0&&y.J(t,">= 0",J,"insertAt:i"),this.f&&y.L(this,t);const i=this.r;t>=i.length?i.push(e):i.splice(t,0,e),this.Yi()}remove(t){return this.delete(t)}delete(t){if(t===null)return!1;this.f&&y.L(this,t);const e=this.r,i=e.indexOf(t);return i===-1?!1:(i===e.length-1?e.pop():e.splice(i,1),this.Yi(),!0)}removeAt(t){const e=this.r;(t<0||t>=e.length)&&y.J(t,"0 <= i < length",J,"removeAt:i"),this.f&&y.L(this,t),t===e.length-1?e.pop():e.splice(t,1),this.Yi()}removeRange(t,e){const i=this.r,s=i.length;if(t<0)t=0;else if(t>=s)return this;if(e<0)return this;if(e>=s&&(e=s-1),t>e)return this;this.f&&y.L(this);let n=t,o=e+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(e-t+1),this.Yi(),this}copy(){const t=new J,e=this.r;return e.length>0&&(t.r=Array.prototype.slice.call(e)),t}toArray(){const t=this.r,e=this.count,i=new Array(e);for(let s=0;s<e;s++)i[s]=t[s];return i}get AL(){return this.r}toSet(){const t=new K,e=this.r,i=this.count;for(let s=0;s<i;s++)t.add(e[s]);return t}sort(t){return this.f&&y.L(this),this.r.sort(t),this.Yi(),this}sortRange(t,e,i){const s=this.r,n=s.length;e===void 0&&(e=0),i===void 0&&(i=n),this.f&&y.L(this);const o=i-e;if(o<=1)return this;if((e<0||e>=n-1)&&y.J(e,"0 <= from < length",J,"sortRange:from"),o===2){const r=s[e],a=s[e+1];return t(r,a)>0&&(s[e]=a,s[e+1]=r,this.Yi()),this}if(e===0)if(i>=n)s.sort(t);else{const r=s.slice(0,i);r.sort(t);for(let a=0;a<i;a++)s[a]=r[a]}else if(i>=n){const r=s.slice(e);r.sort(t);for(let a=e;a<n;a++)s[a]=r[a-e]}else{const r=s.slice(e,i);r.sort(t);for(let a=e;a<i;a++)s[a]=r[a-e]}return this.Yi(),this}reverse(){return this.f&&y.L(this),this.r.reverse(),this.Yi(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return Ut.instance;const t=this.gr;return t!==null?(t.reset(),t):new Se(this)}get iteratorBackwards(){if(this.r.length<=0)return Ut.instance;const t=this.pr;return t!==null?(t.reset(),t):new Ls(this)}}class As{Do;oe;constructor(t){this.Do=t,this.oe=t.g.values()}[Symbol.iterator](){return this.Do.g.values()}key;value;get iterator(){return this}reset(){const t=this.Do;this.oe=t.g.values()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.Do.g.size===0?null:(this.oe=this.Do.g.values(),this.oe.next().value)}any(t){return this.Do.any(t)}all(t){return this.Do.all(t)}each(t){return this.Do.each(t),this}map(t){const e=new J;return this.Do.g.forEach(i=>e.add(t(i))),e.iterator}filter(t){const e=new J;return this.Do.g.forEach(i=>{t(i)&&e.add(i)}),e.iterator}get count(){return this.Do.count}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"SetIterator"}}class K{f;g;constructor(t){this.f=!1,this.g=new Set,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"Set()#"+K.xs(this)}add(t){return t===null?this:(this.g.add(t),this)}addAll(t){if(t===null)return this;if(this.f&&y.L(this),t.first){const e=t.iterator;for(;e.next();)this.g.add(e.value)}else for(const e of t)this.g.add(e);return this}has(t){return this.g.has(t)}contains(t){return this.has(t)}containsAll(t){if(t===null)return!0;if(t.first){const e=t.iterator;for(;e.next();)if(!this.has(e.value))return!1}else for(const e of t)if(!this.has(e))return!1;return!0}containsAny(t){if(t===null)return!0;if(t.first){const e=t.iterator;for(;e.next();)if(this.has(e.value))return!0}else for(const e of t)if(this.has(e))return!0;return!1}first(){return this.g.size===0?null:this.g.values().next().value}any(t){for(const e of this.g)if(t(e))return!0;return!1}all(t){for(const e of this.g)if(!t(e))return!1;return!0}each(t){for(const e of this.g)t(e);return this}map(t){const e=new K;for(const i of this.g)e.add(t(i));return e}filter(t){const e=new K;for(const i of this.g)t(i)&&e.add(i);return e}delete(t){return this.f&&y.L(this),this.g.delete(t)}remove(t){return this.delete(t)}removeAll(t){if(t===null)return this;if(this.f&&y.L(this),t.first){const e=t.iterator;for(;e.next();)this.delete(e.value)}else for(const e of t)this.delete(e);return this}retainAll(t){if(t===null)return this;if(this.count===0)return this;this.f&&y.L(this);const e=new K;e.addAll(t);const i=[];if(t.first){const s=t.iterator;for(;s.next();){const n=s.value;e.has(n)||i.push(n)}}else for(const s of t)e.has(s)||i.push(s);return this.removeAll(i),this}clear(){this.f&&y.L(this),this.g.clear()}copy(){const t=new K;return this.g.forEach(e=>t.add(e)),t}toArray(){return Array.from(this.g)}toList(){const t=new J;return this.g.forEach(e=>t.add(e)),t}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?Ut.instance:new As(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(t,e){return this.g.forEach(t,e)}static Ww=1;static Je(t){t.__gohashid=K.Ww++}static xs(t){return t.__gohashid}}class Ki{q;oe;constructor(t){this.q=t,this.oe=t.g.keys()}[Symbol.iterator](){return this.q.g.keys()}key;value;get iterator(){return this}reset(){const t=this.q;this.oe=t.g.keys()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.oe=this.q.g.keys(),this.oe.next().value)}any(t){for(const e of this.q.g)if(t(e[0]))return!0;return!1}all(t){for(const e of this.q.g)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.q.g)t(e[0]);return this}map(t){const e=this.q,i=new J;for(const s of e.g)i.add(t(s[0]));return i.iterator}filter(t){const e=this.q,i=new J;for(const s of e.g){const n=s[0];t(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapKeySetIterator"}}class ni extends K{q;constructor(t){super(),K.Je(this),this.f=!0,this.q=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}k(){return this}ce(){return this}toString(){return"MapKeySet("+this.q.toString()+")"}add(t){y.o("This Set is read-only: "+this.toString())}has(t){return this.q.has(t)}contains(t){return this.has(t)}delete(t){y.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){y.o("This Set is read-only: "+this.toString())}first(){return this.q.g.size===0?null:this.q.g.keys().next().value}any(t){for(const e of this.q.g)if(t(e[0]))return!0;return!1}all(t){for(const e of this.q.g)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.q.g)t(e[0]);return this}map(t){const e=new K;for(const i of this.q.g)e.add(t(i[0]));return e}filter(t){const e=new K;for(const i of this.q.g){const s=i[0];t(s)&&e.add(s)}return e}copy(){return new ni(this.q)}toSet(){const t=new K,e=this.q.g;for(const i of e)t.add(i[0]);return t}toArray(){const t=this.q.g,e=new Array(t.size);let i=0;for(const s of t)e[i]=s[0],i++;return e}toList(){const t=new J,e=this.q.g;for(const i of e)t.add(i[0]);return t}get count(){return this.q.size}get size(){return this.q.size}get iterator(){return this.q.size<=0?Ut.instance:new Ki(this.q)}}class Ds{q;oe;constructor(t){this.q=t,this.oe=t.g.values()}[Symbol.iterator](){return this.q.g.values()}key;value;get iterator(){return this}reset(){const t=this.q;this.oe=t.g.values()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.oe=this.q.g.values(),this.oe.next().value)}any(t){for(const e of this.q.g)if(t(e[1]))return!0;return!1}all(t){for(const e of this.q.g)if(!t(e[1]))return!1;return!0}each(t){for(const e of this.q.g)t(e[1]);return this}map(t){const e=this.q,i=new J;for(const s of e.g)i.add(t(s[1]));return i.iterator}filter(t){const e=this.q,i=new J;for(const s of e.g){const n=s[1];t(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapValueSetIterator"}}class ne{constructor(t,e){this.key=t,this.value=e}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class Fs{q;oe;constructor(t){this.q=t,this.oe=t.g.entries()}[Symbol.iterator](){return this.q.g.entries()}key;value;get iterator(){return this}reset(){const t=this.q;this.oe=t.g.entries()}next(){const t=this.oe.next();return t.done?(this.key=null,this.value=null,!1):(this.key=t.value[0],this.value=t.value[1],!0)}hasNext(){return this.next()}first(){if(this.q.g.size===0)return null;this.oe=this.q.g.entries();const t=this.oe.next().value;return this.key=t[0],this.value=t[1],new ne(t[0],t[1])}any(t){return this.q.any(t)}all(t){return this.q.all(t)}each(t){return this.q.each(t),this}map(t){const e=new J;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new ne(n,s):(i.key=n,i.value=s),e.add(t(i))}),e.iterator}filter(t){const e=new J;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new ne(n,s):(i.key=n,i.value=s),t(i)&&(e.add(i),i=null)}),e.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapIterator"}}class bt{f;g;constructor(t){K.Je(this),this.f=!1,this.g=new Map,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"Map()#"+K.xs(this)}set(t,e){return this.f&&y.L(this,t),this.g.set(t,e),this}add(t,e){return this.set(t,e)}addAll(t){if(t===null)return this;if(this.f&&y.L(this),t instanceof bt){const e=t.iterator;for(;e.next();)this.g.set(e.key,e.value)}else if(t.first){const e=t.iterator;for(;e.next();){const i=e.value;this.g.set(i.key,i.value)}}else for(const e of t){const i=e;Array.isArray(i)?this.g.set(i[0],i[1]):this.g.set(i.key,i.value)}return this}first(){if(this.g.size===0)return null;const t=this.g.entries().next().value;return t?new ne(t[0],t[1]):null}any(t){let e=null;for(const[i,s]of this.g)if(e===null?e=new ne(i,s):(e.key=i,e.value=s),t(e))return!0;return!1}all(t){let e=null;for(const[i,s]of this.g)if(e===null?e=new ne(i,s):(e.key=i,e.value=s),!t(e))return!1;return!0}each(t){let e=null;for(const[i,s]of this.g)e===null?e=new ne(i,s):(e.key=i,e.value=s),t(e);return this}map(t){const e=new bt;let i=null;for(const[s,n]of this.g)i===null?i=new ne(s,n):(i.key=s,i.value=n),e.set(s,t(i));return e}filter(t){const e=new bt;let i=null;for(const[s,n]of this.g)i===null?i=new ne(s,n):(i.key=s,i.value=n),t(i)&&e.set(s,n);return e}has(t){return this.g.has(t)}contains(t){return this.has(t)}get(t){const e=this.g.get(t);return e===void 0?null:e}getValue(t){return this.get(t)}delete(t){return t===null?!1:(this.f&&y.L(this,t),this.g.delete(t))}remove(t){return this.delete(t)}clear(){this.f&&y.L(this),this.g.clear()}copy(){const t=new bt;return t.g=new Map(this.g),t}toArray(){const t=this.g,e=new Array(t.size);let i=0;for(const s of t)e[i]=new ne(s[0],s[1]),i++;return e}toKeySet(){return new ni(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?Ut.instance:new Fs(this)}get iteratorKeys(){return this.count<=0?Ut.instance:new Ki(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?Ut.instance:new Ds(this)}values(){return this.g.values()}forEach(t,e){return this.g.forEach(t,e)}}class P{px;py;f;constructor(t,e){t===void 0?(this.px=0,this.py=0):typeof t=="number"&&typeof e=="number"?(this.px=t,this.py=e):y.o("Invalid arguments to Point constructor: "+t+", "+e),this.f=!1}h(t){return this.px=t.px,this.py=t.py,this}e(t,e){return this.px=t,this.py=e,this}setTo(t,e){return this.px=t,this.py=e,this}set(t){return this.px=t.px,this.py=t.py,this}copy(){const t=new P;return t.px=this.px,t.py=this.py,t}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;return n=e[i++],n&&(o=parseFloat(n)),new P(s,o)}else return new P}static stringify(t){return t.x.toString()+" "+t.y.toString()}static stringifyFixed(t){return e=>e.x.toFixed(t)+" "+e.y.toFixed(t)}toString(){return"Point("+this.x+","+this.y+")"}equals(t){return t instanceof P?this.px===t.x&&this.py===t.y:!1}equalTo(t,e){return this.px===t&&this.py===e}equalsApprox(t){return L.u(this.px,t.x)&&L.u(this.py,t.y)}add(t){return this.px+=t.x,this.py+=t.y,this}subtract(t){return this.px-=t.x,this.py-=t.y,this}offset(t,e){return this.px+=t,this.py+=e,this}rotate(t){if(t===0)return this;const e=this.px,i=this.py;if(e===0&&i===0)return this;let s=0,n=0;if(t=L.Ee(t),t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const o=t*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.px=s*e-n*i,this.py=n*e+s*i,this}scale(t,e){return this.px*=t,this.py*=e,this}distanceSquaredPoint(t){const e=t.x-this.px,i=t.y-this.py;return e*e+i*i}distanceSquared(t,e){const i=t-this.px,s=e-this.py;return i*i+s*s}normalize(){const t=this.px,e=this.py,i=Math.sqrt(t*t+e*e);return i>0&&(this.px=t/i,this.py=e/i),this}directionPoint(t){return this.TL(t.x-this.px,t.y-this.py)}direction(t,e){return this.TL(t-this.px,e-this.py)}TL(t,e){if(t===0)return e>0?90:e<0?270:0;if(e===0)return t>0?0:180;{if(isNaN(t)||isNaN(e))return 0;let i=Math.atan(Math.abs(e/t))*180/Math.PI;return t<0?e<0?i+=180:i=180-i:e<0&&(i=360-i),i}}static compareWithLineSegment(t,e,i,s,n,o){return L.ku(t,e,i,s,n,o)}compareWithLineSegmentPoint(t,e){return L.ku(t.x,t.y,e.x,e.y,this.x,this.y)}static intersectingLineSegments(t,e,i,s,n,o,r,a){return L.Pu(t,e,i,s,n,o,r,a)}projectOntoLineSegment(t,e,i,s){return L.Nl(t,e,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(t,e){return L.Nl(t.x,t.y,e.x,e.y,this.px,this.py,this),this}snapToGrid(t,e,i,s){return L.tm(this.px,this.py,t,e,i,s,this),this}snapToGridPoint(t,e){return L.tm(this.px,this.py,t.x,t.y,e.width,e.height,this),this}setRectSpot(t,e){return this.px=t.x+e.x*t.width+e.offsetX,this.py=t.y+e.y*t.height+e.offsetY,this}setSpot(t,e,i,s,n){return this.px=t+n.x*i+n.offsetX,this.py=e+n.y*s+n.offsetY,this}v(t){return t.gt(this),this}Ki(t){return t.Ci(this),this}static distanceLineSegmentSquared(t,e,i,s,n,o){let r=n-i,a=o-s;const l=r*r+a*a,h=i-t,u=s-e,c=-h*r-u*a;if(c<=0||c>=l)return r=n-t,a=o-e,Math.min(h*h+u*u,r*r+a*a);{const d=r*u-a*h;return d*d/l}}static distanceSquared(t,e,i,s){const n=i-t,o=s-e;return n*n+o*o}static direction(t,e,i,s){const n=i-t,o=s-e;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.px}set x(t){this.px=t}get y(){return this.py}set y(t){this.py=t}isReal(){return isFinite(this.x)&&isFinite(this.y)}static gn=new P(0,0).kt();static DL=new P(-1/0,-1/0).kt();static vL=new P(1/0,1/0).kt();static FL=new P(6,6).kt();static mn=new P(NaN,NaN).kt();static $w=[];static l(){const t=P.$w.pop();return t===void 0?new P:t}static bs(t){const e=P.$w.pop();return e===void 0?t.copy():e.h(t)}static z(t,e){const i=P.$w.pop();return i===void 0?new P(t,e):(i.x=t,i.y=e,i)}static i(t){P.$w.push(t)}}class st{sw;sh;f;constructor(t,e){t===void 0?(this.sw=0,this.sh=0):typeof t=="number"&&(t>=0||isNaN(t))&&typeof e=="number"&&(e>=0||isNaN(e))?(this.sw=t,this.sh=e):y.o("Invalid arguments to Size constructor: "+t+", "+e),this.f=!1}h(t){return this.sw=t.sw,this.sh=t.sh,this}e(t,e){return this.sw=t,this.sh=e,this}setTo(t,e){return this.sw=t,this.sh=e,this}set(t){return this.sw=t.sw,this.sh=t.sh,this}copy(){const t=new st;return t.sw=this.sw,t.sh=this.sh,t}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;return n=e[i++],n&&(o=parseFloat(n)),new st(s,o)}else return new st}static stringify(t){return t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return e=>e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Size("+this.width+","+this.height+")"}equals(t){return t instanceof st?this.sw===t.width&&this.sh===t.height:!1}equalTo(t,e){return this.sw===t&&this.sh===e}equalsApprox(t){return L.u(this.sw,t.width)&&L.u(this.sh,t.height)}inflate(t,e){const i=this.width+t;this.sw=i>=0?i:0;const s=this.height+e;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(t){t<0&&y.J(t,">= 0",st,"width"),this.sw=t}get height(){return this.sh}set height(t){t<0&&y.J(t,">= 0",st,"height"),this.sh=t}isReal(){return isFinite(this.width)&&isFinite(this.height)}static bc=new st(0,0).kt();static TP=new st(1,1).kt();static RL=new st(6,6).kt();static Su=new st(8,8).kt();static OL=new st(10,10).kt();static DP=new st(1/0,1/0).kt();static Zw=new st(NaN,NaN).kt();static IL=[];static l(){const t=st.IL.pop();return t===void 0?new st:t}static i(t){st.IL.push(t)}}class I{rx;ry;rw;rh;f;constructor(t,e,i,s){if(t===void 0)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if(typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&(i>=0||isNaN(i))&&typeof s=="number"&&(s>=0||isNaN(s)))this.rx=t,this.ry=e,this.rw=i,this.rh=s;else if(t instanceof P){const n=t.x,o=t.y;if(e instanceof P){const r=e.x,a=e.y;this.rx=Math.min(n,r),this.ry=Math.min(o,a),this.rw=Math.abs(n-r),this.rh=Math.abs(o-a)}else e instanceof st?(this.rx=n,this.ry=o,this.rw=e.width,this.rh=e.height):y.o("Incorrect second argument supplied to Rect constructor "+e)}else y.o("Invalid arguments to Rect constructor: "+t+", "+e+", "+i+", "+s);this.f=!1}h(t){return this.rx=t.rx,this.ry=t.ry,this.rw=t.rw,this.rh=t.rh,this}e(t,e,i,s){return this.rx=t,this.ry=e,this.rw=i,this.rh=s,this}jn(t,e){return this.rw=t,this.rh=e,this}setTo(t,e,i,s){return this.rx=t,this.ry=e,this.rw=i,this.rh=s,this}set(t){return this.rx=t.rx,this.ry=t.ry,this.rw=t.rw,this.rh=t.rh,this}setPoint(t){return this.rx=t.x,this.ry=t.y,this}setSize(t){return this.rw=t.width,this.rh=t.height,this}copy(){const t=new I;return t.rx=this.rx,t.ry=this.ry,t.rw=this.rw,t.rh=this.rh,t}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}ce(){return this.f&&(Object.isFrozen(this)&&y.o("cannot thaw constant: "+this),this.f=!1),this}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;n=e[i++],n&&(o=parseFloat(n));let r=0;for(;e[i]==="";)i++;n=e[i++],n&&(r=parseFloat(n));let a=0;for(;e[i]==="";)i++;return n=e[i++],n&&(a=parseFloat(n)),new I(s,o,r,a)}else return new I}static stringify(t){return t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(t){return t instanceof I?this.rx===t.x&&this.ry===t.y&&this.rw===t.width&&this.rh===t.height:!1}equalTo(t,e,i,s){return this.rx===t&&this.ry===e&&this.rw===i&&this.rh===s}equalsApprox(t){return L.u(this.rx,t.x)&&L.u(this.ry,t.y)&&L.u(this.rw,t.width)&&L.u(this.rh,t.height)}equalsApproxTo(t,e,i,s){return L.u(this.rx,t)&&L.u(this.ry,e)&&L.u(this.rw,i)&&L.u(this.rh,s)}equalsApproxClose(t){return L.X(this.rx,t.x)&&L.X(this.ry,t.y)&&L.X(this.rw,t.width)&&L.X(this.rh,t.height)}containsPoint(t){return this.rx<=t.x&&this.rx+this.rw>=t.x&&this.ry<=t.y&&this.ry+this.rh>=t.y}containsRect(t){return this.rx<=t.x&&t.x+t.width<=this.rx+this.rw&&this.ry<=t.y&&t.y+t.height<=this.ry+this.rh}contains(t,e,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.rx<=t&&t+i<=this.rx+this.rw&&this.ry<=e&&e+s<=this.ry+this.rh}offset(t,e){return this.rx+=t,this.ry+=e,this}inflate(t,e){return this.Qw(e,t,e,t)}addMargin(t){return this.Qw(t.top,t.right,t.bottom,t.left)}subtractMargin(t){return this.Qw(-t.top,-t.right,-t.bottom,-t.left)}grow(t,e,i,s){return this.Qw(t,e,i,s)}Qw(t,e,i,s){const n=this.rw;e+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=e+s);const o=this.rh;return t+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=t,this.rh+=t+i),this}intersectRect(t){return this.EL(t.x,t.y,t.width,t.height)}intersect(t,e,i,s){return this.EL(t,e,i,s)}EL(t,e,i,s){const n=Math.max(this.rx,t),o=Math.max(this.ry,e),r=Math.min(this.rx+this.rw,t+i),a=Math.min(this.ry+this.rh,e+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,r-n),this.rh=Math.max(0,a-o),this}intersectsRect(t){return this.intersects(t.x,t.y,t.width,t.height)}intersects(t,e,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=t,isNaN(i)||isNaN(n)||o>i||t>n))return!1;let r=this.rh;const a=this.ry;return!(r!==1/0&&s!==1/0&&(r+=a,s+=e,isNaN(s)||isNaN(r)||a>s||e>r))}UL(t,e){let i=this.rw,s=t.width+e+e;const n=this.rx,o=t.x-e;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.rh,a=t.height+e+e;const l=this.ry,h=t.y-e;return r+=l,a+=h,!(l>a||h>r)}unionPoint(t){return this.re(t.x,t.y,0,0)}unionRect(t){return this.re(t.rx,t.ry,t.rw,t.rh)}union(t,e,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.re(t,e,i,s)}re(t,e,i,s){const n=Math.min(this.rx,t),o=Math.min(this.ry,e),r=Math.max(this.rx+this.rw,t+i),a=Math.max(this.ry+this.rh,e+s);return this.rx=n,this.ry=o,this.rw=r-n,this.rh=a-o,this}setSpot(t,e,i){return this.rx=t-i.offsetX-i.x*this.rw,this.ry=e-i.offsetY-i.y*this.rh,this}nearestSideDirection(t,e){return L._w(this,t,e,!0)}nearestSideDirectionPoint(t){return L._w(this,t.x,t.y,!0)}static contains(t,e,i,s,n,o,r,a){return r===void 0&&(r=0),a===void 0&&(a=0),t<=n&&n+r<=t+i&&e<=o&&o+a<=e+s}static intersects(t,e,i,s,n,o,r,a){let l=i,h=r;const u=t,c=n;if(l+=u,h+=c,u>h||c>l)return!1;let d=s,f=a;const m=e,g=o;return d+=m,f+=g,!(m>f||g>d)}static intersectsLineSegment(t,e,i,s,n,o,r,a){return L.VL(t,e,i,s,n,o,r,a)}get x(){return this.rx}set x(t){this.rx=t}get y(){return this.ry}set y(t){this.ry=t}get width(){return this.rw}set width(t){t<0&&y.J(t,">= 0",I,"width"),this.rw=t}get height(){return this.rh}set height(t){t<0&&y.J(t,">= 0",I,"height"),this.rh=t}get left(){return this.rx}set left(t){this.rx=t}get top(){return this.ry}set top(t){this.ry=t}get right(){return this.rx+this.rw}set right(t){this.rx+=t-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(t){this.ry+=t-(this.ry+this.rh)}get position(){return new P(this.rx,this.ry)}set position(t){this.rx=t.x,this.ry=t.y}get size(){return new st(this.rw,this.rh)}set size(t){this.rw=t.width,this.rh=t.height}get center(){return new P(this.rx+this.rw/2,this.ry+this.rh/2)}set center(t){this.rx=t.x-this.rw/2,this.ry=t.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(t){this.rx=t-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(t){this.ry=t-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static em=new I(0,0,0,0).kt();static GF=new I(NaN,NaN,NaN,NaN).kt();static tx=[];static l(){const t=I.tx.pop();return t===void 0?new I:t}static bs(t){const e=I.tx.pop();return e===void 0?t.copy():e.h(t)}static z(t,e,i,s){const n=I.tx.pop();return n===void 0?new I(t,e,i,s):n.e(t,e,i,s)}static i(t){I.tx.push(t)}}class Mt{mt;mr;mb;ml;constructor(t,e,i,s){t===void 0?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):e===void 0?(e=t,i=t,s=t,this.mt=t,this.mr=e,this.mb=i,this.ml=s):i===void 0?(i=t,s=e,this.mt=t,this.mr=e,this.mb=i,this.ml=s):s!==void 0?(this.mt=t,this.mr=e,this.mb=i,this.ml=s):y.o("Invalid arguments to Margin constructor: "+t+", "+e+", "+i+", "+s)}setTo(t,e,i,s){return this.mt=t,this.mr=e,this.mb=i,this.ml=s,this}set(t){return this.mt=t.mt,this.mr=t.mr,this.mb=t.mb,this.ml=t.ml,this}copy(){const t=new Mt;return t.mt=this.mt,t.mr=this.mr,t.mb=this.mb,t.ml=this.ml,t}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=NaN;for(;e[i]==="";)i++;let n=e[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new Mt;let o=NaN;for(;e[i]==="";)i++;if(n=e[i++],n&&(o=parseFloat(n)),isNaN(o))return new Mt(s);let r=NaN;for(;e[i]==="";)i++;if(n=e[i++],n&&(r=parseFloat(n)),isNaN(r))return new Mt(s,o);let a=NaN;for(;e[i]==="";)i++;return n=e[i++],n&&(a=parseFloat(n)),isNaN(a)?new Mt(s,o):new Mt(s,o,r,a)}else return new Mt}static stringify(t){return t.top.toString()+" "+t.right.toString()+" "+t.bottom.toString()+" "+t.left.toString()}static stringifyFixed(t){return e=>e.top.toFixed(t)+" "+e.right.toFixed(t)+" "+e.bottom.toFixed(t)+" "+e.left.toFixed(t)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(t){return t instanceof Mt?this.mt===t.top&&this.mr===t.right&&this.mb===t.bottom&&this.ml===t.left:!1}equalTo(t,e,i,s){return this.mt===t&&this.mr===e&&this.mb===i&&this.ml===s}equalsApprox(t){return L.u(this.mt,t.top)&&L.u(this.mr,t.right)&&L.u(this.mb,t.bottom)&&L.u(this.ml,t.left)}get top(){return this.mt}set top(t){this.mt=t}get right(){return this.mr}set right(t){this.mr=t}get bottom(){return this.mb}set bottom(t){this.mb=t}get left(){return this.ml}set left(t){this.ml=t}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static im=new Mt(0,0,0,0).kt();static BL=new Mt(2,2,2,2).kt()}class T{sx;sy;ox;oy;constructor(t,e,i,s){t===void 0?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),this.sx=t,this.sy=e,this.ox=i,this.oy=s)}setTo(t,e,i,s){return this.sx=t,this.sy=e,this.ox=i,this.oy=s,this}set(t){return this.sx=t.sx,this.sy=t.sy,this.ox=t.ox,this.oy=t.oy,this}copy(){const t=new T;return t.sx=this.sx,t.sy=this.sy,t.ox=this.ox,t.oy=this.oy,t}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(t){}Hi(t){return this.sx=NaN,this.sy=NaN,this.ox=t,this.kt()}DU(t,e){(isNaN(t)||t>1||t<0)&&y.J(t,"0 <= "+e+" <= 1",T,e)}vU(t,e){(isNaN(t)||t===1/0||t===-1/0)&&y.J(t,"real number, not NaN or Infinity",T,e)}static parse(t){if(typeof t=="string"){if(t=t.trim(),t==="None")return T.None;if(t==="TopLeft")return T.TopLeft;if(t==="Top"||t==="TopCenter"||t==="MiddleTop")return T.TopCenter;if(t==="TopRight")return T.TopRight;if(t==="Left"||t==="LeftCenter"||t==="MiddleLeft")return T.LeftCenter;if(t==="Center")return T.Center;if(t==="Right"||t==="RightCenter"||t==="MiddleRight")return T.RightCenter;if(t==="BottomLeft")return T.BottomLeft;if(t==="Bottom"||t==="BottomCenter"||t==="MiddleBottom")return T.BottomCenter;if(t==="BottomRight")return T.BottomRight;if(t==="TopSide")return T.TopSide;if(t==="LeftSide")return T.LeftSide;if(t==="RightSide")return T.RightSide;if(t==="BottomSide")return T.BottomSide;if(t==="TopBottomSides")return T.TopBottomSides;if(t==="LeftRightSides")return T.LeftRightSides;if(t==="TopLeftSides")return T.TopLeftSides;if(t==="TopRightSides")return T.TopRightSides;if(t==="BottomLeftSides")return T.BottomLeftSides;if(t==="BottomRightSides")return T.BottomRightSides;if(t==="NotTopSide")return T.NotTopSide;if(t==="NotLeftSide")return T.NotLeftSide;if(t==="NotRightSide")return T.NotRightSide;if(t==="NotBottomSide")return T.NotBottomSide;if(t==="AllSides")return T.AllSides;if(t==="Default")return T.Default;const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;n=e[i++],n!==void 0&&n.length>0&&(o=parseFloat(n));let r=0;for(;e[i]==="";)i++;n=e[i++],n!==void 0&&n.length>0&&(r=parseFloat(n));let a=0;for(;e[i]==="";)i++;return n=e[i++],n!==void 0&&n.length>0&&(a=parseFloat(n)),new T(s,o,r,a)}else return new T}static stringify(t){return t.isSpot()?t.x.toString()+" "+t.y.toString()+" "+t.offsetX.toString()+" "+t.offsetY.toString():t.toString()}static stringifyFixed(t){return e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.offsetX.toFixed(t)+" "+e.offsetY.toFixed(t)}toString(){return this.isSpot()?this.ox===0&&this.oy===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(T.None)?"None":this.equals(T.TopLeft)?"TopLeft":this.equals(T.TopCenter)?"Top":this.equals(T.TopRight)?"TopRight":this.equals(T.LeftCenter)?"Left":this.equals(T.Center)?"Center":this.equals(T.RightCenter)?"Right":this.equals(T.BottomLeft)?"BottomLeft":this.equals(T.BottomCenter)?"Bottom":this.equals(T.BottomRight)?"BottomRight":this.equals(T.TopSide)?"TopSide":this.equals(T.LeftSide)?"LeftSide":this.equals(T.RightSide)?"RightSide":this.equals(T.BottomSide)?"BottomSide":this.equals(T.TopBottomSides)?"TopBottomSides":this.equals(T.LeftRightSides)?"LeftRightSides":this.equals(T.TopLeftSides)?"TopLeftSides":this.equals(T.TopRightSides)?"TopRightSides":this.equals(T.BottomLeftSides)?"BottomLeftSides":this.equals(T.BottomRightSides)?"BottomRightSides":this.equals(T.NotTopSide)?"NotTopSide":this.equals(T.NotLeftSide)?"NotLeftSide":this.equals(T.NotRightSide)?"NotRightSide":this.equals(T.NotBottomSide)?"NotBottomSide":this.equals(T.AllSides)?"AllSides":this.equals(T.Default)?"Default":"None"}equals(t){return t instanceof T?(this.sx===t.x||isNaN(this.sx)&&isNaN(t.x))&&(this.sy===t.y||isNaN(this.sy)&&isNaN(t.y))&&this.ox===t.offsetX&&this.oy===t.offsetY:!1}opposite(){return new T(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(t){if(!this.isSide())return!1;if(!t.isSide())if(t.equals(T.Left))t=T.LeftSide;else if(t.equals(T.Right))t=T.RightSide;else if(t.equals(T.Top))t=T.TopSide;else if(t.equals(T.Bottom))t=T.BottomSide;else return!1;const e=this.oy,i=t.offsetY;return(e&i)===i}get x(){return this.sx}set x(t){this.sx=t}get y(){return this.sy}set y(t){this.sy=t}get offsetX(){return this.ox}set offsetX(t){this.ox=t}get offsetY(){return this.oy}set offsetY(t){this.oy=t}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}static None=new T(0,0,0,0).Hi(0);static Default=new T(0,0,-1,0).Hi(-1);static TopLeft=new T(0,0,0,0).kt();static TopCenter=new T(.5,0,0,0).kt();static TopRight=new T(1,0,0,0).kt();static LeftCenter=new T(0,.5,0,0).kt();static Center=new T(.5,.5,0,0).kt();static RightCenter=new T(1,.5,0,0).kt();static BottomLeft=new T(0,1,0,0).kt();static BottomCenter=new T(.5,1,0,0).kt();static BottomRight=new T(1,1,0,0).kt();static MiddleTop=T.TopCenter;static MiddleLeft=T.LeftCenter;static MiddleRight=T.RightCenter;static MiddleBottom=T.BottomCenter;static Top=T.TopCenter;static Left=T.LeftCenter;static Right=T.RightCenter;static Bottom=T.BottomCenter;static TopSide=new T(0,0,1,1).Hi(1);static LeftSide=new T(0,0,1,2).Hi(1);static RightSide=new T(0,0,1,4).Hi(1);static BottomSide=new T(0,0,1,8).Hi(1);static TopBottomSides=new T(0,0,1,9).Hi(1);static LeftRightSides=new T(0,0,1,6).Hi(1);static TopLeftSides=new T(0,0,1,3).Hi(1);static TopRightSides=new T(0,0,1,5).Hi(1);static BottomLeftSides=new T(0,0,1,10).Hi(1);static BottomRightSides=new T(0,0,1,12).Hi(1);static NotTopSide=new T(0,0,1,14).Hi(1);static NotLeftSide=new T(0,0,1,13).Hi(1);static NotRightSide=new T(0,0,1,11).Hi(1);static NotBottomSide=new T(0,0,1,7).Hi(1);static AllSides=new T(0,0,1,15).Hi(1);static vP=new T(.156,.156).kt();static FP=new T(.844,.844).kt()}class wt{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,e,i,s,n,o){return this.m11=t,this.m12=e,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const t=new wt;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}RP(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}Ue(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}kc(t){const e=this.m11*t.m11+this.m21*t.m12,i=this.m12*t.m11+this.m22*t.m12,s=this.m11*t.m21+this.m21*t.m22,n=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=e,this.m12=i,this.m21=s,this.m22=n,this}zL(t){const e=1/(t.m11*t.m22-t.m12*t.m21),i=t.m22*e,s=-t.m12*e,n=-t.m21*e,o=t.m11*e,r=e*(t.m21*t.dy-t.m22*t.dx),a=e*(t.m12*t.dx-t.m11*t.dy),l=this.m11*i+this.m21*s,h=this.m12*i+this.m22*s,u=this.m11*n+this.m21*o,c=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*a+this.dx,this.dy=this.m12*r+this.m22*a+this.dy,this.m11=l,this.m12=h,this.m21=u,this.m22=c,this}ex(){const t=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*t,i=-this.m12*t,s=-this.m21*t,n=this.m11*t,o=t*(this.m21*this.dy-this.m22*this.dx),r=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=e,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}ks(t,e,i){if(t=L.Ee(t),t===0)return this;this.Gs(e,i);let s=0,n=0;if(t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const h=t*Math.PI/180;s=Math.cos(h),n=Math.sin(h)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,a=this.m11*-n+this.m21*s,l=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=a,this.m22=l,this.Gs(-e,-i),this}Gs(t,e){return this.dx+=this.m11*t+this.m21*e,this.dy+=this.m12*t+this.m22*e,this}it(t,e){return e===void 0&&(e=t),this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}YF(){if(this.m11===1&&this.m12===0)return 0;let t=Math.atan2(this.m12,this.m11)*180/Math.PI;return t<0&&(t+=360),t}gt(t){const e=t.x,i=t.y;return t.e(e*this.m11+i*this.m21+this.dx,e*this.m12+i*this.m22+this.dy)}Ci(t){const e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,o=this.m11*e,r=t.x-this.dx,a=t.y-this.dy;return t.e(r*i+a*n,r*s+a*o)}Mu(t){const e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,o=this.m11*e,r=e*(this.m21*this.dy-this.m22*this.dx),a=e*(this.m12*this.dx-this.m11*this.dy),l=t.x*1.25,h=t.y*1.2;return t.e(l*i+h*n+r,l*s+h*o+a)}sm(t){const e=t.x,i=t.y,s=e+t.width,n=i+t.height,o=this.m11,r=this.m12,a=this.m21,l=this.m22,h=this.dx,u=this.dy,c=e*o+i*a+h,d=e*r+i*l+u,f=s*o+i*a+h,m=s*r+i*l+u,g=e*o+n*a+h,p=e*r+n*l+u,b=s*o+n*a+h,v=s*r+n*l+u;let w=c,k=c,S=d,N=d;return w=Math.min(w,f),k=Math.max(k,f),S=Math.min(S,m),N=Math.max(N,m),w=Math.min(w,g),k=Math.max(k,g),S=Math.min(S,p),N=Math.max(N,p),w=Math.min(w,b),k=Math.max(k,b),S=Math.min(S,v),N=Math.max(N,v),t.e(w,S,k-w,N-S),t}static XL=[];static l(){const t=wt.XL.pop();return t===void 0?new wt:t}static i(t){wt.XL.push(t)}static OP="54a702f3e53909c447824c6706603faf4c"}const L={KF:"7da71ca0ad381e90",qn:4*((Math.sqrt(2)-1)/3),GL:[],ix:x=>{if(x<=0)return 0;let t=L.GL;if(t===null){t=[];for(let e=0;e<=2e3;e++)t[e]=Math.sqrt(e);L.GL=t}if(x<1){const e=1/x;return e<=2e3?1/t[e|0]:Math.sqrt(x)}else return x<=2e3?t[x|0]:Math.sqrt(x)},u:(x,t)=>{const e=x-t;return e<.5&&e>-.5},X:(x,t)=>{const e=x-t;return e<5e-8&&e>-5e-8},Ve:(x,t,e,i,s,n,o)=>{s<=0&&(s=1e-6);let r=0,a=0,l=0,h=0;if(x<e?(a=x,r=e):(a=e,r=x),t<i?(h=t,l=i):(h=i,l=t),x===e)return h<=o&&o<=l&&x-s<=n&&n<=x+s;if(t===i)return a<=n&&n<=r&&t-s<=o&&o<=t+s;const u=r+s,c=a-s;if(c<=n&&n<=u){const d=l+s,f=h-s;if(f<=o&&o<=d)if(u-c>d-f)if(x-e>s||e-x>s){const m=(i-t)/(e-x)*(n-x)+t;if(m-s<=o&&o<=m+s)return!0}else return!0;else if(t-i>s||i-t>s){const m=(e-x)/(i-t)*(o-t)+x;if(m-s<=n&&n<=m+s)return!0}else return!0}return!1},nx:(x,t,e,i,s,n,o,r,a,l,h,u)=>{if(!L.Ve(x,t,o,r,u,e,i)||!L.Ve(x,t,o,r,u,s,n)){const c=(x+e)/2,d=(t+i)/2,f=(e+s)/2,m=(i+n)/2,g=(s+o)/2,p=(n+r)/2,b=(c+f)/2,v=(d+m)/2,w=(f+g)/2,k=(m+p)/2,S=(b+w)/2,N=(v+k)/2;return L.nx(x,t,c,d,b,v,S,N,a,l,h,u)||L.nx(S,N,w,k,g,p,o,r,a,l,h,u)}else return L.Ve(x,t,o,r,u,l,h)},YL:(x,t,e,i,s,n,o,r,a)=>{const l=(x+e)/2,h=(t+i)/2,u=(e+s)/2,c=(i+n)/2,d=(s+o)/2,f=(n+r)/2,m=(l+u)/2,g=(h+c)/2,p=(u+d)/2,b=(c+f)/2;return a.e((m+p)/2,(g+b)/2),a},HF:(x,t,e,i,s,n,o,r)=>{const a=(x+e)/2,l=(t+i)/2,h=(e+s)/2,u=(i+n)/2,c=(s+o)/2,d=(n+r)/2,f=(a+h)/2,m=(l+u)/2,g=(h+c)/2,p=(u+d)/2;return P.direction(f,m,g,p)},Nu:(x,t,e,i,s,n,o,r,a,l)=>{if(!L.Ve(x,t,o,r,a,e,i)||!L.Ve(x,t,o,r,a,s,n)){const h=(x+e)/2,u=(t+i)/2,c=(e+s)/2,d=(i+n)/2,f=(s+o)/2,m=(n+r)/2,g=(h+c)/2,p=(u+d)/2,b=(c+f)/2,v=(d+m)/2,w=(g+b)/2,k=(p+v)/2;L.Nu(x,t,h,u,g,p,w,k,a,l),L.Nu(w,k,b,v,f,m,o,r,a,l)}else l.re(x,t,0,0),l.re(o,r,0,0);return l},Wn:(x,t,e,i,s,n,o,r,a,l)=>{if(!L.Ve(x,t,o,r,a,e,i)||!L.Ve(x,t,o,r,a,s,n)){const h=(x+e)/2,u=(t+i)/2,c=(e+s)/2,d=(i+n)/2,f=(s+o)/2,m=(n+r)/2,g=(h+c)/2,p=(u+d)/2,b=(c+f)/2,v=(d+m)/2,w=(g+b)/2,k=(p+v)/2;L.Wn(x,t,h,u,g,p,w,k,a,l),L.Wn(w,k,b,v,f,m,o,r,a,l)}else l.length===0&&(l.push(x),l.push(t)),l.push(o),l.push(r);return l},IP:(x,t,e,i,s,n,o,r,a,l)=>{if(L.Ve(x,t,s,n,l,e,i))return L.Ve(x,t,s,n,l,r,a);{const h=(x+e)/2,u=(t+i)/2,c=(e+s)/2,d=(i+n)/2,f=(h+c)/2,m=(u+d)/2;return L.IP(x,t,h,u,f,m,o,r,a,l)||L.IP(f,m,c,d,s,n,o,r,a,l)}},EP:(x,t,e,i,s,n,o,r)=>{if(L.Ve(x,t,s,n,o,e,i))r.re(x,t,0,0),r.re(s,n,0,0);else{const a=(x+e)/2,l=(t+i)/2,h=(e+s)/2,u=(i+n)/2,c=(a+h)/2,d=(l+u)/2;L.EP(x,t,a,l,c,d,o,r),L.EP(c,d,h,u,s,n,o,r)}return r},nm:(x,t,e,i,s,n,o,r)=>{if(L.Ve(x,t,s,n,o,e,i))r.length===0&&(r.push(x),r.push(t)),r.push(s),r.push(n);else{const a=(x+e)/2,l=(t+i)/2,h=(e+s)/2,u=(i+n)/2,c=(a+h)/2,d=(l+u)/2;L.nm(x,t,a,l,c,d,o,r),L.nm(c,d,h,u,s,n,o,r)}return r},om:(x,t,e,i,s,n,o,r,a,l,h,u,c,d)=>{if(!L.Ve(x,t,o,r,c,e,i)||!L.Ve(x,t,o,r,c,s,n)){const f=(x+e)/2,m=(t+i)/2,g=(e+s)/2,p=(i+n)/2,b=(s+o)/2,v=(n+r)/2,w=(f+g)/2,k=(m+p)/2,S=(g+b)/2,N=(p+v)/2,D=(w+S)/2,A=(k+N)/2;let M=1/0,C=!1,F=0,O=0;if(L.om(x,t,f,m,w,k,D,A,a,l,h,u,c,d)){const E=(d.x-a)**2+(d.y-l)**2;E<M&&(M=E,C=!0,F=d.x,O=d.y)}if(L.om(D,A,S,N,b,v,o,r,a,l,h,u,c,d)){const E=(d.x-a)**2+(d.y-l)**2;E<M&&(M=E,C=!0,F=d.x,O=d.y)}return C&&(d.x=F,d.y=O),C}else{if(!L.Pu(x,t,o,r,a,l,h,u))return!1;const f=(x-o)*(l-u)-(t-r)*(a-h);if(f===0)return!1;const m=((x*r-t*o)*(a-h)-(x-o)*(a*u-l*h))/f,g=((x*r-t*o)*(l-u)-(t-r)*(a*u-l*h))/f;return d.e(m,g),!0}},rm:(x,t,e,i,s,n,o,r,a,l,h,u,c)=>{let d=0;if(!L.Ve(x,t,o,r,c,e,i)||!L.Ve(x,t,o,r,c,s,n)){const f=(x+e)/2,m=(t+i)/2,g=(e+s)/2,p=(i+n)/2,b=(s+o)/2,v=(n+r)/2,w=(f+g)/2,k=(m+p)/2,S=(g+b)/2,N=(p+v)/2,D=(w+S)/2,A=(k+N)/2;d+=L.rm(x,t,f,m,w,k,D,A,a,l,h,u,c),d+=L.rm(D,A,S,N,b,v,o,r,a,l,h,u,c)}else{const f=(x-o)*(l-u)-(t-r)*(a-h);if(f===0)return d;const m=((x*r-t*o)*(a-h)-(x-o)*(a*u-l*h))/f,g=((x*r-t*o)*(l-u)-(t-r)*(a*u-l*h))/f;if(m>=h)return d;let p=0,b=0;if((a>h?a-h:h-a)<(l>u?l-u:u-l)){if(t<r?(p=t,b=r):(p=r,b=t),g<p||g>b)return d}else if(x<o?(p=x,b=o):(p=o,b=x),m<p||m>b)return d;f>0?d++:f<0&&d--}return d},Nl:(x,t,e,i,s,n,o)=>{if(L.X(x,e)){let r=0,a=0;t<i?(r=t,a=i):(r=i,a=t);const l=n;return l<r?(o.e(x,r),!1):l>a?(o.e(x,a),!1):(o.e(x,l),!0)}else if(L.X(t,i)){let r=0,a=0;x<e?(r=x,a=e):(r=e,a=x);const l=s;return l<r?(o.e(r,t),!1):l>a?(o.e(a,t),!1):(o.e(l,t),!0)}else{const r=(e-x)**2+(i-t)**2,a=((x-s)*(x-e)+(t-n)*(t-i))/r;if(a<-5e-6)return o.e(x,t),!1;if(a>1.000005)return o.e(e,i),!1;{const l=x+a*(e-x),h=t+a*(i-t);return o.e(l,h),!0}}},vo:(x,t,e,i,s,n,o,r,a)=>{if(L.u(x,e)&&L.u(t,i))return a.e(x,t),!1;if(L.X(s,o)){if(L.X(x,e))return L.Nl(x,t,e,i,s,n,a),!1;{const l=(i-t)/(e-x)*(s-x)+t;return L.Nl(x,t,e,i,s,l,a)}}else{const l=(r-n)/(o-s);if(L.X(x,e)){const h=l*(x-s)+n;let u=0,c=0;return t<i?(u=t,c=i):(u=i,c=t),h<u?(a.e(x,u),!1):h>c?(a.e(x,c),!1):(a.e(x,h),!0)}else{const h=(i-t)/(e-x);if(L.X(l,h))return L.Nl(x,t,e,i,s,n,a),!1;{const u=(h*x-l*s+n-t)/(h-l);if(L.X(h,0)){let c=0,d=0;return x<e?(c=x,d=e):(c=e,d=x),u<c?(a.e(c,t),!1):u>d?(a.e(d,t),!1):(a.e(u,t),!0)}else{const c=h*(u-x)+t;return L.Nl(x,t,e,i,u,c,a)}}}}},Cl:(x,t,e,i,s,n,o,r,a)=>{let l=1e21,h=x,u=t;if(L.vo(x,t,x,i,s,n,o,r,a)){const c=(a.x-s)**2+(a.y-n)**2;c<l&&(l=c,h=a.x,u=a.y)}if(L.vo(e,t,e,i,s,n,o,r,a)){const c=(a.x-s)**2+(a.y-n)**2;c<l&&(l=c,h=a.x,u=a.y)}if(L.vo(x,t,e,t,s,n,o,r,a)){const c=(a.x-s)**2+(a.y-n)**2;c<l&&(l=c,h=a.x,u=a.y)}if(L.vo(x,i,e,i,s,n,o,r,a)){const c=(a.x-s)**2+(a.y-n)**2;c<l&&(l=c,h=a.x,u=a.y)}return a.e(h,u),l<1e21},lx:(x,t,e)=>L.VL(x.x,x.y,x.width,x.height,t.x,t.y,e.x,e.y),VL:(x,t,e,i,s,n,o,r)=>{const a=x,l=x+e,h=t,u=t+i;if(s===o){let c=0,d=0;return n<r?(c=n,d=r):(c=r,d=n),a<=s&&s<=l&&c<=u&&d>=h}if(n===r){let c=0,d=0;return s<o?(c=s,d=o):(c=o,d=s),h<=n&&n<=u&&c<=l&&d>=a}return!!(I.contains(x,t,e,i,s,n)||I.contains(x,t,e,i,o,r)||L.Pu(a,h,l,h,s,n,o,r)||L.Pu(l,h,l,u,s,n,o,r)||L.Pu(l,u,a,u,s,n,o,r)||L.Pu(a,u,a,h,s,n,o,r))},Pu:(x,t,e,i,s,n,o,r)=>x===e&&t===i&&s===o&&n===r?x===s&&t===n:L.ku(x,t,e,i,s,n)*L.ku(x,t,e,i,o,r)<=0&&L.ku(s,n,o,r,x,t)*L.ku(s,n,o,r,e,i)<=0,ku:(x,t,e,i,s,n)=>{const o=e-x,r=i-t;let a=s-x,l=n-t,h=a*r-l*o;return h===0&&(h=a*o+l*r,h>0&&(a-=o,l-=r,h=a*o+l*r,h<0&&(h=0))),h},_w(x,t,e,i){i===void 0&&(i=!1);let s=0;const n=x===null?t:(t-x.x)/(x.width>0?x.width:1),o=x===null?e:(e-x.y)/(x.height>0?x.height:1);return n>o?n>1-o||(i||n<1-o?s=270:s=315):i||n<o?n>1-o?s=90:i||n<1-o?s=180:s=135:n<.5?s=225:n>.5&&(s=45),s},Ee:x=>(x>=360?x-=360:x<0&&(x+=360),x),jF:(x,t)=>x>t?Math.min(x-t,Math.abs(x-360-t)):t>x?Math.min(t-x,Math.abs(x-(t-360))):0,KL:(x,t,e,i,s,n)=>{const o=Math.PI;n||(i=i*(o/180),s=s*(o/180));const r=i>s?-1:1,a=1e-5,l=o*2,h=[],u=o/2;let c=i,d=Math.min(l,Math.abs(s-i));if(d<a){const f=c+r*Math.min(d,u),m=x+e*Math.cos(c),g=t+e*Math.sin(c),p=x+e*Math.cos(f),b=t+e*Math.sin(f),v=(m+p)/2,w=(g+b)/2;return h.push([m,g,v,w,v,w,p,b]),h}for(;d>a;){const f=c+r*Math.min(d,u);h.push(L.qF(e,c,f,x,t)),d-=Math.abs(f-c),c=f}return h},qF:(x,t,e,i,s)=>{const n=(e-t)/2,o=x*Math.cos(n),r=x*Math.sin(n),a=o,l=-r,h=a*a+l*l,u=h+a*o+l*r,c=4/3*(Math.sqrt(2*h*u)-u)/(a*r-l*o),d=a-c*l,f=l+c*a,m=d,g=-f,p=n+t,b=Math.cos(p),v=Math.sin(p);return[i+x*Math.cos(t),s+x*Math.sin(t),i+d*b-f*v,s+d*v+f*b,i+m*b-g*v,s+m*v+g*b,i+x*Math.cos(e),s+x*Math.sin(e)]},tm:(x,t,e,i,s,n,o)=>{const r=s,a=n,l=Math.floor((x-e)/r)*r+e,h=Math.floor((t-i)/a)*a+i;let u=l;l+r-x<r/2&&(u=l+r);let c=h;return h+a-t<a/2&&(c=h+a),o.e(u,c),o},HL:(x,t)=>{let e=Math.max(x,t),i=Math.min(x,t),s=1,n=1;do s=e%i,n=i,e=i,i=s;while(s>0);return n},WF:(x,t,e,i)=>{const s=e<0,n=i<0;let o=0,r=0,a=0;x<t?(r=1,a=0):(r=0,a=1);let l=0,h=0,u=0,c=0;return o=r,l=o===0?x:t,u=o===0?e:i,(o===0?s:n)&&(u=-u),o=a,h=o===0?x:t,c=o===0?e:i,(o===0?s:n)&&(c=-c),L.JF(l,h,u,c,0,0)},JF:(x,t,e,i,s,n)=>{let o=0;if(i>0)if(e>0){const r=x*x,a=t*t,l=x*e,h=t*i;let u=-a+h,c=-a+Math.sqrt(l*l+h*h),d=u;const f=9999999999;for(let p=0;p<f&&(d=.5*(u+c),!(d===u||d===c));++p){const b=l/(d+r),v=h/(d+a),w=b*b+v*v-1;if(w>0)u=d;else if(w<0)c=d;else break}s=r*e/(d+r),n=a*i/(d+a);const m=s-e,g=n-i;o=Math.sqrt(m*m+g*g)}else s=0,n=t,o=Math.abs(i-t);else{const r=x*x-t*t,a=x*e;if(a<r){const l=a/r,h=l*l;s=x*l,n=t*Math.sqrt(Math.abs(1-h));const u=s-e;o=Math.sqrt(u*u+n*n)}else s=x,n=0,o=Math.abs(e-x)}return o},Jn:{},lm:new Zt,yr:new Zt,wr:0,am:100};L.za=L.KF;var Me=(x=>(x[x.Line=1]="Line",x[x.Rectangle=2]="Rectangle",x[x.Ellipse=3]="Ellipse",x[x.Path=4]="Path",x))(Me||{}),oi=(x=>(x[x.None=0]="None",x[x.Default=1]="Default",x[x.Fill=2]="Fill",x[x.Uniform=6]="Uniform",x))(oi||{});class yt{n;hm;cm;Pc;Cu;Lu;$n;Zn;Qn;W;Li;Ai;ni;oi;Ys;Sc;Mc;constructor(t,e){K.Je(this),this.n=2,t===void 0&&(t=4),this.W=t,this.Li=0,this.Ai=0,this.ni=0,this.oi=0,t===4?this.Ys=new J:this.Ys=yt.hx,this.hm=this.Ys.rt,this.cm=new I,this.Pc=null,this.Cu=null,this.Lu=NaN,this.$n=T.TopLeft,this.Zn=T.BottomRight,this.Sc=NaN,this.Mc=NaN,this.Qn=2,e&&Object.assign(this,e)}copy(){const t=new yt;if(t.n=this.n&-2,t.W=this.W,t.Li=this.Li,t.Ai=this.Ai,t.ni=this.ni,t.oi=this.oi,this.W===4){const e=this.Ys.r,i=t.Ys;for(let s=0;s<e.length;s++){const n=e[s];i.add(n.copy())}t.Ys=i}else t.Ys=this.Ys;return t.hm=this.hm,t.cm.h(this.cm),t.Pc=this.Pc,t.Cu=this.Cu,t.Lu=this.Lu,t.$n=this.$n.N(),t.Zn=this.Zn.N(),t.Sc=this.Sc,t.Mc=this.Mc,t.Qn=this.Qn,t}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static hx=new J().k();get f(){return(this.n&1)!==0}set f(t){t?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(t){t?this.n|=2:this.n&=-3}k(){if(this.f=!0,this.type!==4)return this;const t=this.figures;t.k();for(const e of t)e.k();return this}equalsApprox(t){if(!(t instanceof yt))return!1;if(this.type!==t.type)return this.type===1&&t.type===4?this.jL(t):t.type===1&&this.type===4?t.jL(this):!1;if(this.type===4){const e=this.figures.r,i=t.figures.r,s=e.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=e[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}else return L.u(this.startX,t.startX)&&L.u(this.startY,t.startY)&&L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)}jL(t){if(this.type!==1||t.type!==4)return!1;if(t.figures.count===1){const e=t.figures.elt(0);if(e.segments.count===1&&L.u(this.startX,e.startX)&&L.u(this.startY,e.startY)){const i=e.segments.elt(0);if(i.type===2&&L.u(this.endX,i.endX)&&L.u(this.endY,i.endY))return!0}}return!1}static stringify(t){return t.toString()}static stringifyFixed(t){return e=>e.toString(t)}fe(t){t in Me?this.type=t:y.dr(this,t)}toString(t){t===void 0&&(t=-1);const e=s=>s===0?"0":s.toFixed(t);let i;switch(this.type){case 1:return t<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+e(this.startX)+" "+e(this.startY)+"L"+e(this.endX)+" "+e(this.endY);case 2:return i=new I(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),t<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+e(i.x)+" "+e(i.y)+"H"+e(i.right)+"V"+e(i.bottom)+"H"+e(i.left)+"z";case 3:if(i=new I(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),t<0){const r=i.left.toString()+" "+(i.y+i.height/2).toString(),a=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+r+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+a+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+r}else{const r=e(i.left)+" "+e(i.y+i.height/2),a=e(i.right)+" "+e(i.y+i.height/2);return"M"+r+"A"+e(i.width/2)+" "+e(i.height/2)+" 0 0 1 "+a+"A"+e(i.width/2)+" "+e(i.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];r>0&&(s+=" x "),a.isFilled&&(s+="F "),s+=a.toString(t)}return s;default:return Me[this.type]}}static fillPath(t){const e=t.split(/[Xx]/),i=e.length;let s="";for(let n=0;n<i;n++){const o=e[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static fm="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(t,e){e===void 0&&(e=!1);const i=new RegExp("(["+yt.fm+"])(["+yt.fm+"])","gm"),s=new RegExp("(["+yt.fm+"])([^s])","gm"),n=new RegExp("([^s])(["+yt.fm+"])","gm");t=t.replace(/,/gm," "),t=t.replace(i,"$1 $2"),t=t.replace(i,"$1 $2"),t=t.replace(s,"$1 $2"),t=t.replace(n,"$1 $2"),t=t.replace(/([0-9])([+\-])/gm,"$1 $2"),t=t.replace(/[\s\r\t\n]+/gm," "),t=t.replace(/^\s+|\s+$/g,"");const o=t.split(" ");for(let F=0;F<o.length;F++){const O=o[F];if(O.match(/(\.[0-9]*)(\.)/gm)!==null){const E=y.nt();let B="",z=!1;for(let V=0;V<O.length;V++){const Y=O[V];Y==="."&&!z?(z=!0,B+=Y):Y==="."?(E.push(B),B="."):B+=Y}E.push(B),o.splice(F,1);for(let V=0;V<E.length;V++)o.splice(F+V,0,E[V]);F+=E.length-1,y.Z(E)}}let r=-1,a="",l="";const h=new P(0,0),u=new P(0,0),c=new P(0,0);let d=!0;function f(){return r>=w-1||o[r+1].match(M)!==null?!0:(d=!1,!1)}function m(){return r++,o[r]}function g(F){let O=parseFloat(m()),E=parseFloat(m());a===a.toLowerCase()&&(O=c.x+O,E=c.y+E),F.e(O,E)}function p(){return g(c),c}function b(){return g(u),u}function v(){const F=l.toLowerCase();return F==="c"||F==="s"||F==="q"||F==="t"?new P(2*c.x-u.x,2*c.y-u.y):new P(c.x,c.y)}const w=o.length,k=me.qL(null);let S=!1,N=!1,D=!1,A=!0;const M=new RegExp("["+yt.fm+"]");for(;!(r>=w-1);){if(l=a,a=m(),a==="")continue;d=!0;let F=!1;switch(a.toUpperCase()){case"X":A=!0,S=!1,N=!1;break;case"M":const O=p();for(k.Ne===null||A===!0?(k.Au(O.x,O.y,S,!1,!N,D),A=!1):k.$F(O.x,O.y),h.h(c);!f();){const E=p();k.Ks(E.x,E.y)}break;case"L":for(;!f();){const E=p();k.Ks(E.x,E.y)}d&&(F=!0);break;case"H":for(;!f();)c.e((a===a.toLowerCase()?c.x:0)+parseFloat(m()),c.y),k.Ks(c.x,c.y);break;case"V":for(;!f();)c.e(c.x,(a===a.toLowerCase()?c.y:0)+parseFloat(m())),k.Ks(c.x,c.y);d&&(F=!0);break;case"C":for(;!f();){const E=new P;g(E);const B=b(),z=p();k.xr(E.x,E.y,B.x,B.y,z.x,z.y)}d&&(F=!0);break;case"S":for(;!f();){const E=v(),B=b(),z=p();k.xr(E.x,E.y,B.x,B.y,z.x,z.y)}d&&(F=!0);break;case"Q":for(;!f();){const E=b(),B=p();k.Tu(E.x,E.y,B.x,B.y)}d&&(F=!0);break;case"T":for(;!f();){const E=v();u.h(E);const B=p();k.Tu(E.x,E.y,B.x,B.y),u.h(B)}d&&(F=!0);break;case"B":for(;!f();){const E=parseFloat(m()),B=parseFloat(m());let z=parseFloat(m()),V=parseFloat(m());const Y=parseFloat(m());let _=Y,nt=!1;f()||(_=parseFloat(m()),f()||(nt=parseFloat(m())!==0)),a===a.toLowerCase()&&(z+=c.x,V+=c.y),k.ZF(E,B,z,V,Y,_,nt)}d&&(F=!0);break;case"A":for(;!f();){const E=Math.abs(parseFloat(m())),B=Math.abs(parseFloat(m())),z=parseFloat(m());let V=!1,Y=!1,_=0,nt=0;const $=m();$.length===1?(V=!!parseFloat($),Y=!!parseFloat(m()),_=parseFloat(m()),nt=parseFloat(m())):$.length===2?(V=!!parseFloat($[0]),Y=!!parseFloat($[1]),_=parseFloat(m()),nt=parseFloat(m())):(V=!!parseFloat($[0]),Y=!!parseFloat($[1]),_=parseFloat($.slice(2)),nt=parseFloat(m())),a===a.toLowerCase()&&(_=c.x+_,nt=c.y+nt),c.e(_,nt),k.QF(E,B,z,V,Y,_,nt)}d&&(F=!0);break;case"Z":k._F(),c.h(h);break;case"F":{let E="",B=1;for(;o[r+B];){if(o[r+B]==="0"){D=!0,B++;continue}if(o[r+B].match(/[Uu]/)!==null){B++;continue}if(o[r+B].match(M)===null){B++;continue}E=o[r+B];break}E.match(/[Mm]/)?S=!0:k.tR();break}case"U":{let E="",B=1;for(;o[r+B];){if(o[r+B].match(/[Ff]/)!==null){B++;continue}if(o[r+B].match(M)===null){B++;continue}E=o[r+B];break}E.match(/[Mm]/)?N=!0:k.eR(!1);break}default:if(a==="0"||a==="1")break;y.ne("Unknown geometry command: "+a);break}if(F){y.ne(`Bad geometry command: ${a}, next token: ${m()},
string: ${t}`);break}}const C=k.um;if(me.WL(k),e){const F=C.figures.iterator;for(;F.next();){const O=F.value;O.isFilled=!0}}return C}static JL(t,e){const i=t.length,s=P.l();for(let n=0;n<i;n++){const o=t[n];s.x=o[0],s.y=o[1],e.gt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],e.gt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],e.gt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],e.gt(s),o[6]=s.x,o[7]=s.y}P.i(s)}UP(){if(this.yt)return!0;if(this.type===4){const t=this.figures;if(this.hm!==t.rt)return!0;const e=this.figures.r,i=e.length;for(let s=0;s<i;s++)if(e[s].UP())return!0}return!1}cx(){if(this.yt=!1,this.Pc=null,this.Cu=null,this.Lu=NaN,this.type===4){const e=this.figures;this.hm=e.rt;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].iR()}const t=this.cm;isNaN(this.Sc)||isNaN(this.Mc)?t.e(0,0,0,0):t.e(0,0,this.Sc,this.Mc),this.$L(t,!1),t.re(0,0,0,0)}computeBoundsWithoutOrigin(){const t=new I;return this.$L(t,!0),t}$L(t,e){switch(this.type){case 1:case 2:case 3:e?t.e(this.Li,this.Ai,0,0):t.re(this.Li,this.Ai,0,0),t.re(this.ni,this.oi,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const r=s[o];e&&o===0?t.e(r.startX,r.startY,0,0):t.re(r.startX,r.startY,0,0);const a=r.segments.r,l=a.length;let h=r.startX,u=r.startY;for(let c=0;c<l;c++){const d=a[c];switch(d.type){case 2:case 1:h=d.endX,u=d.endY,t.re(h,u,0,0);break;case 3:L.Nu(h,u,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,t),h=d.endX,u=d.endY;break;case 4:L.EP(h,u,d.point1X,d.point1Y,d.endX,d.endY,.5,t),h=d.endX,u=d.endY;break;case 5:case 6:const f=d.type===5?d.Fo(r):d.Za(r,h,u),m=f.length;if(m===0){h=d.type===5?d.centerX:d.endX,u=d.type===5?d.centerY:d.endY,t.re(h,u,0,0);break}let g=null;for(let p=0;p<m;p++)g=f[p],L.Nu(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],.5,t);g!==null&&(h=g[6],u=g[7]);break;default:y.o("Unknown Segment type: "+d.type)}}}break;default:y.o("Unknown Geometry type: "+this.type)}}sR(t,e){const i=this.bounds;let s=t/i.width,n=e/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.f&&y.L(this);const t=this.computeBoundsWithoutOrigin();return this.offset(-t.x,-t.y),new P(-t.x,-t.y)}offset(t,e){return this.f&&y.L(this),this.v(1,0,0,1,t,e),this}scale(t,e){return this.f&&y.L(this),this.v(t,0,0,e,0,0),this}rotate(t,e,i){this.f&&y.L(this),e===void 0&&(e=0),i===void 0&&(i=0);const s=wt.l();return s.Ue(),s.ks(t,e,i),this.v(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),wt.i(s),this}v(t,e,i,s,n,o){let r=0,a=0;switch(this.type){case 1:case 2:case 3:r=this.Li,a=this.Ai,this.Li=r*t+a*i+n,this.Ai=r*e+a*s+o,r=this.ni,a=this.oi,this.ni=r*t+a*i+n,this.oi=r*e+a*s+o;break;case 4:const l=this.figures.r,h=l.length;for(let u=0;u<h;u++){const c=l[u];r=c.startX,a=c.startY,c.startX=r*t+a*i+n,c.startY=r*e+a*s+o;const d=c.segments.r,f=d.length;for(let m=0;m<f;m++){const g=d[m];switch(g.type){case 2:case 1:r=g.endX,a=g.endY,g.endX=r*t+a*i+n,g.endY=r*e+a*s+o;break;case 3:r=g.point1X,a=g.point1Y,g.point1X=r*t+a*i+n,g.point1Y=r*e+a*s+o,r=g.point2X,a=g.point2Y,g.point2X=r*t+a*i+n,g.point2Y=r*e+a*s+o,r=g.endX,a=g.endY,g.endX=r*t+a*i+n,g.endY=r*e+a*s+o;break;case 4:r=g.point1X,a=g.point1Y,g.point1X=r*t+a*i+n,g.point1Y=r*e+a*s+o,r=g.endX,a=g.endY,g.endX=r*t+a*i+n,g.endY=r*e+a*s+o;break;case 5:if(r=g.centerX,a=g.centerY,g.centerX=r*t+a*i+n,g.centerY=r*e+a*s+o,e!==0){let p=Math.atan2(e,t)*180/Math.PI;p<0&&(p+=360),g.startAngle+=p}t<0&&(g.startAngle=180-g.startAngle,g.sweepAngle=-g.sweepAngle),s<0&&(g.startAngle=-g.startAngle,g.sweepAngle=-g.sweepAngle),g.radiusX*=Math.sqrt(t*t+i*i),g.radiusY!==void 0&&(g.radiusY*=Math.sqrt(e*e+s*s));break;case 6:if(r=g.endX,a=g.endY,g.endX=r*t+a*i+n,g.endY=r*e+a*s+o,g.radiusX===0||g.radiusY===0)break;if(e!==0){let p=Math.atan2(e,t)*180/Math.PI;p<0&&(p+=360),g.xAxisRotation+=p}t<0&&(g.xAxisRotation=180-g.xAxisRotation,g.isClockwiseArc=!g.isClockwiseArc),s<0&&(g.xAxisRotation=-g.xAxisRotation,g.isClockwiseArc=!g.isClockwiseArc),g.radiusX*=Math.sqrt(t*t+i*i),g.radiusY*=Math.sqrt(e*e+s*s);break;default:y.o("Unknown Segment type: "+g.type)}}}break}return this.yt=!0,this}containsPoint(t,e){e===void 0&&(e=0);const i=this.Li,s=this.Ai,n=this.ni,o=this.oi;switch(this.type){case 1:return L.Ve(i,s,n,o,e,t.x,t.y);case 2:{const r=Math.min(i,n)-e,a=Math.min(s,o)-e,l=Math.abs(n-i)+e*2,h=Math.abs(o-s)+e*2,u=I.z(r,a,l,h),c=u.containsPoint(t);return I.i(u),c}case 3:{let r=Math.min(i,n)-e,a=Math.min(s,o)-e;const l=Math.abs(n-i)+e*2,h=Math.abs(o-s)+e*2,u=l/2,c=h/2;return u<=0||c<=0?!1:(r=t.x-(r+u),a=t.y-(a+c),r*r/(u*u)+a*a/(c*c)<=1)}case 4:return this.VP(t,e,!0,!1);default:return!1}}VP(t,e,i,s){const n=t.x,o=t.y,r=this.bounds.x-20,a=o;let l=0,h=0,u=0,c=0,d=0,f=0;const m=this.figures.r,g=m.length;for(let p=0;p<g;p++){const b=m[p],v=!b.isEvenOdd;if(b.isFilled){if(i&&b.BP(n,o,e))return!0}else{if(b.BP(n,o,s?e:e+2))return!0;continue}const w=b.segments;h=b.startX,u=b.startY;let k=h,S=u;const N=w.r;let D=N[0];for(let A=0;A<=w.length;A++){let M;switch(A!==w.length?(D=N[A],M=D.type,d=D.endX,f=D.endY):(M=2,d=k,f=S),M){case 1:{const C=this.fx(n,o,r,a,h,u,k,S);if(isNaN(C))return!0;l+=C,k=d,S=f;break}case 2:{const C=this.fx(n,o,r,a,h,u,d,f);if(isNaN(C))return!0;l+=C;break}case 3:c=L.rm(h,u,D.point1X,D.point1Y,D.point2X,D.point2Y,d,f,r,a,n,o,.5),l+=c;break;case 4:{const C=(h+2*D.point1X)/3,F=(u+2*D.point1Y)/3,O=(D.point1X*2+d)/3,E=(D.point1Y*2+f)/3;c=L.rm(h,u,C,F,O,E,d,f,r,a,n,o,.5),l+=c;break}case 5:case 6:{const C=D.type===5?D.Fo(b):D.Za(b,h,u),F=C.length;if(F===0){const E=this.fx(n,o,r,a,h,u,D.type===5?D.centerX:D.endX,D.type===5?D.centerY:D.endY);if(isNaN(E))return!0;l+=E;break}let O=null;for(let E=0;E<F;E++){if(O=C[E],E===0){const B=this.fx(n,o,r,a,h,u,O[0],O[1]);if(isNaN(B))return!0;l+=B}c=L.rm(O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],r,a,n,o,.5),l+=c}O!==null&&(d=O[6],f=O[7]);break}default:y.o("Unknown Segment type: "+D.type)}h=d,u=f}if(v){if(l!==0)return!0}else if(l%2!==0)return!0;l=0}return!1}fx(t,e,i,s,n,o,r,a){if(L.Ve(n,o,r,a,.05,t,e))return NaN;const l=(t-i)*(o-a);if(l===0)return 0;const h=((t*s-e*i)*(n-r)-(t-i)*(n*a-o*r))/l,u=(t*s-e*i)*(o-a)/l;if(h>=t)return 0;if((n>r?n-r:r-n)<(o>a?o-a:a-o)){if(o<a){if(u<o||u>a)return 0}else if(u<a||u>o)return 0}else if(n<r){if(h<n||h>r)return 0}else if(h<r||h>n)return 0;return l>0?1:-1}ZL(t,e,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].BP(t,e,i))return!0;return!1}getPointAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),e===void 0&&(e=new P),this.type===1)return e.e(this.startX+t*(this.endX-this.startX),this.startY+t*(this.endY-this.startY)),e;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*t;let a=0;for(let l=0;l<o;l++){const h=s[l],u=h.length;for(let c=0;c<u;c++){const d=h[c];if(a+d>=r){const f=r-a,m=d===0?0:f/d,g=i[l],p=g[c*2],b=g[c*2+1],v=g[c*2+2],w=g[c*2+3];return e.e(p+(v-p)*m,b+(w-b)*m),e}a+=d}}return e}getAngleAlongPath(t){if(t<0?t=0:t>1&&(t=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=e.length,o=s*t;let r=0;for(let a=0;a<n;a++){const l=i[a],h=l.length;for(let u=0;u<h;u++){const c=l[u];if(r+c>=o){const d=e[a],f=d[u*2],m=d[u*2+1],g=d[u*2+2],p=d[u*2+3];return Math.abs(g-f)<1&&Math.abs(p-m)<1?0:Math.abs(g-f)<1?p-m>=0?90:270:Math.abs(p-m)<1?g-f>=0?0:180:Math.atan2(p-m,g-f)*180/Math.PI}r+=c}}return NaN}getPointAndAngleAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),e===void 0&&(e=[]),e.length=3,this.type===1)return e[0]=this.startX+t*(this.endX-this.startX),e[1]=this.startY+t*(this.endY-this.startY),e[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,e;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*t;let a=0;for(let l=0;l<o;l++){const h=s[l],u=h.length;for(let c=0;c<u;c++){const d=h[c];if(a+d>=r){const f=r-a,m=d===0?0:f/d,g=i[l],p=g[c*2],b=g[c*2+1],v=g[c*2+2],w=g[c*2+3];e[0]=p+(v-p)*m,e[1]=b+(w-b)*m;let k;return Math.abs(v-p)<1&&Math.abs(w-b)<1?k=0:Math.abs(v-p)<1?k=w-b>=0?90:270:Math.abs(w-b)<1?k=v-p>=0?0:180:k=Math.atan2(w-b,v-p)*180/Math.PI,e[2]=k,e}a+=d}}return e}getFractionForPoint(t){if(this.type===1){const e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{const o=t.x,r=t.y;let a=0,l=0;if(e===s)return i<n?(a=i,l=n):(a=n,l=i),r<=a?a===i?0:1:r>=l?l===i?0:1:Math.abs(r-i)/(l-a);if(i===n)return e<s?(a=e,l=s):(a=s,l=e),o<=a?a===e?0:1:o>=l?l===e?0:1:Math.abs(o-e)/(l-a);{const h=(s-e)**2+(n-i)**2,u=P.l();L.Nl(e,i,s,n,o,r,u);const c=u.x,d=u.y;return P.i(u),Math.sqrt(((c-e)**2+(d-i)**2)/h)}}}else if(this.type===2){const e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{const o=s-e,r=n-i,a=o*2+r*2;let l=t.x,h=t.y;l=Math.min(Math.max(l,e),s),h=Math.min(Math.max(h,i),n);const u=Math.abs(l-e),c=Math.abs(l-s),d=Math.abs(h-i),f=Math.abs(h-n),m=Math.min(u,c,d,f);if(m===d)return l/a;if(m===c)return(o+h)/a;if(m===f)return(o*2+r-l)/a;if(m===u)return(o*2+r*2-h)/a}}else{const e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=P.l();let o=1/0,r=0,a=0;const l=e.length;let h=0,u=0;for(let d=0;d<l;d++){const f=e[d],m=i[d],g=f.length;for(let p=0;p<g;p+=2){const b=f[p],v=f[p+1];if(p===0){h=b,u=v;continue}L.Nl(h,u,b,v,t.x,t.y,n);const w=(n.x-t.x)**2+(n.y-t.y)**2;w<o&&(o=w,r=a,r+=Math.sqrt((n.x-h)**2+(n.y-u)**2)),a+=m[(p-2)/2],h=b,u=v}}P.i(n);const c=r/s;return c<0?0:c>1?1:c}return 0}get flattenedSegments(){return this.QL(),this.Pc}QL(){if(this.Pc===null){const t=this.Pc=[],e=this.Cu=[];this.nR(t,e)}}get flattenedLengths(){return this.QL(),this.Cu}get flattenedTotalLength(){let t=this.Lu;if(isNaN(t)){if(this.type===1){const e=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);t=Math.sqrt(e*e+i*i)}else if(this.type===2){const e=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);t=e*2+i*2}else{const e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++){const n=e[s],o=n.length;for(let r=0;r<o;r++)t+=n[r]}}this.Lu=t}return t}zP(t){const e=[];let i=0,s=0;const n=t.length;for(let o=0;o<n;o+=2){const r=t[o],a=t[o+1];if(o===0){i=r,s=a;continue}const l=Math.sqrt(P.distanceSquared(i,s,r,a));e.push(l),i=r,s=a}return e}nR(t,e){let i=[];const s=[];if(this.type===1)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),t.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),e.push(s);else if(this.type===2)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),t.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),e.push(s);else if(this.type===3){const n=new Lt;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new dt(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.Fo(n),a=r.length;if(a===0)i.push(o.centerX),i.push(o.centerY);else{let l=n.startX,h=n.startY;for(let u=0;u<a;u++){const c=r[u];L.Wn(l,h,c[2],c[3],c[4],c[5],c[6],c[7],.5,i),l=c[6],h=c[7]}}t.push(i),e.push(this.zP(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let r=o.startX,a=o.startY,l=r,h=a;const u=o.segments.r,c=u.length;for(let d=0;d<c;d++){const f=u[d];switch(f.type){case 1:i.length>=4&&(t.push(i),e.push(this.zP(i))),i=[],i.push(f.endX),i.push(f.endY),r=f.endX,a=f.endY,l=r,h=a;break;case 2:i.push(f.endX),i.push(f.endY),r=f.endX,a=f.endY;break;case 3:L.Wn(r,a,f.point1X,f.point1Y,f.point2X,f.point2Y,f.endX,f.endY,.5,i),r=f.endX,a=f.endY;break;case 4:L.nm(r,a,f.point1X,f.point1Y,f.endX,f.endY,.5,i),r=f.endX,a=f.endY;break;case 5:{const m=f.Fo(o),g=m.length;if(g===0){i.push(f.centerX),i.push(f.centerY),r=f.centerX,a=f.centerY;break}for(let p=0;p<g;p++){const b=m[p];L.Wn(r,a,b[2],b[3],b[4],b[5],b[6],b[7],.5,i),r=b[6],a=b[7]}break}case 6:{const m=f.Za(o,r,a),g=m.length,p=f.endX,b=f.endY;if(g===0){i.push(p),i.push(b),r=p,a=b;break}for(let v=0;v<g;v++){const w=m[v];L.Wn(r,a,w[2],w[3],w[4],w[5],w[6],w[7],.5,i),r=w[6],a=w[7]}break}default:y.o("Segment not of valid type: "+f.type)}f.isClosed&&(i.push(l),i.push(h))}i.length>=4&&(t.push(i),e.push(this.zP(i)))}}}get type(){return this.W}set type(t){this.W!==t&&(this.f&&y.L(this,t),this.W=t,t===4?this.Ys=new J:(yt.hx===null&&(yt.hx=new J().k()),this.Ys=yt.hx),this.yt=!0)}get startX(){return this.Li}set startX(t){this.Li!==t&&(this.f&&y.L(this,t),this.Li=t,this.yt=!0)}get startY(){return this.Ai}set startY(t){this.Ai!==t&&(this.f&&y.L(this,t),this.Ai=t,this.yt=!0)}get endX(){return this.ni}set endX(t){this.ni!==t&&(this.f&&y.L(this,t),this.ni=t,this.yt=!0)}get endY(){return this.oi}set endY(t){this.oi!==t&&(this.f&&y.L(this,t),this.oi=t,this.yt=!0)}get figures(){return this.Ys}set figures(t){this.Ys!==t&&(this.f&&y.L(this,t),this.Ys=t,this.yt=!0)}add(t){return this.Ys.add(t),this}setSpots(t,e,i,s,n,o,r,a){return this.f&&y.L(this),this.$n=new T(t,e,n,o),this.Zn=new T(i,s,r,a),this}get spot1(){return this.$n}set spot1(t){this.f&&y.L(this,t),this.$n=t.N()}get spot2(){return this.Zn}set spot2(t){this.f&&y.L(this,t),this.Zn=t.N()}get defaultStretch(){return this.Qn}set defaultStretch(t){this.Qn=t}get bounds(){return this.UP()&&this.cx(),this.cm}polygonClosestSegment(t,e){if(e===void 0&&(e=10),this.type!==4)return null;const i=t.x,s=t.y;let n=1/0,o=0,r=0,a=0,l=0,h=0,u=0,c=0,d=0;return this.figures.each(f=>{let m=f.startX,g=f.startY;f.segments.each(p=>{let b=p.endX,v=p.endY,w=0;if(p.type===2)w=P.distanceLineSegmentSquared(i,s,m,g,b,v);else{m=p.endX,g=p.endY;return}w<n&&(n=w,o=a,r=l,h=m,u=g,c=b,d=v),m=b,g=v,l++,p.isClosed&&(b=f.startX,v=f.startY,w=P.distanceLineSegmentSquared(i,s,m,g,b,v),w<n&&(n=w,o=a,r=l,h=m,u=g,c=b,d=v),l++)}),a++,l=0}),n<e*e?{figi:o,segi:r,ax:h,ay:u,bx:c,by:d}:null}get polygonArea(){if(this.type===4){const t=this.figures.iterator;let e=0,i=0,s=0,n=0,o=0;for(;t.next();){const r=t.value;if(!r.isFilled)continue;e=r.startX,i=r.startY;const a=r.segments.iterator;for(;a.next();){const l=a.value;s=l.endX,n=l.endY,l.type===1||l.type!==5&&(o+=e*n-i*s),e=s,i=n}o+=e*r.startY-i*r.startX}return Math.abs(o)/2}else if(this.type===2){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return t*e}else if(this.type===3){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return Math.PI*t/2*e/2}else return 0}get polygonLength(){if(this.type===4){const t=this.figures.iterator;let e=0,i=0,s=0,n=0,o=0;for(;t.next();){const r=t.value;e=r.startX,i=r.startY;const a=r.segments.iterator;for(;a.next();){const h=a.value;s=h.endX,n=h.endY,h.type===1||h.type!==5&&(o+=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i))),e=s,i=n}const l=r.segments.last();l&&l.isClosed&&(s=r.startX,n=r.startY,o+=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i)))}return o}else if(this.type===2){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return t*2+e*2}else if(this.type===3){const t=Math.abs(this.startX-this.endX)/2,e=Math.abs(this.startY-this.endY)/2;if(t+e===0)return 0;const i=(t-e)*(t-e)/((t+e)*(t+e));let s=i,n=1+s/4;return s*=i,n+=s/64,s*=i,n+=s/256,s*=i,n+=s*25/16384,s*=i,n+=s*49/65536,s*=i,n+=s*441/1048576,Math.PI*(t+e)*n}else{const t=this.startX,e=this.startY,i=this.endX,s=this.endY;return Math.sqrt((i-t)*(i-t)+(s-e)*(s-e))}}static computeConvexHull(t){t.sort((s,n)=>s.x===n.x?n.y-s.y:n.x-s.x);const e=[];for(let s=0;s<t.length;s++){for(;e.length>=2&&t[s].compareWithLineSegmentPoint(e[e.length-2],e[e.length-1])>=0;)e.pop();e.push(t[s])}e.pop();const i=[];for(let s=t.length-1;s>=0;s--){for(;i.length>=2&&t[s].compareWithLineSegmentPoint(i[i.length-2],i[i.length-1])>=0;)i.pop();i.push(t[s])}return i.pop(),e.concat(i)}static generatePolygon(t,e,i){e===void 0&&(e=0),i===void 0&&(i=!0);const s=new yt;if(t.length>1)if(e>0)if(i){t.push(t[0]),t.push(t[1]);let n=!0;const o=new Lt(0,0,i,!1);for(let a=1;a<t.length;a++){const l=(t[a-1].x+t[a].x)/2,h=(t[a-1].y+t[a].y)/2,u=t[a-1].distanceSquaredPoint(t[a]),c=.5*e/Math.sqrt(u);if(c<.5){const d=t[a-1].x+(t[a].x-t[a-1].x)*c,f=t[a-1].y+(t[a].y-t[a-1].y)*c;if(n?(n=!1,o.startX=d,o.startY=f):o.add(new dt(3,d,f,t[a-1].x,t[a-1].y,t[a-1].x,t[a-1].y)),a<t.length-1){const m=t[a].x+(t[a-1].x-t[a].x)*c,g=t[a].y+(t[a-1].y-t[a].y)*c;o.add(new dt(2,m,g))}}else n?(n=!1,o.startX=l,o.startY=h):o.add(new dt(3,l,h,t[a-1].x,t[a-1].y,t[a-1].x,t[a-1].y))}const r=o.segments.last();r&&r.close(),s.add(o)}else{const n=new Lt(t[0].x,t[0].y,!1,!1);for(let o=1;o<t.length;o++){const r=(t[o-1].x+t[o].x)/2,a=(t[o-1].y+t[o].y)/2,l=t[o-1].distanceSquaredPoint(t[o]),h=.5*e/Math.sqrt(l);if(h<.5){if(o>1){const d=t[o-1].x+(t[o].x-t[o-1].x)*h,f=t[o-1].y+(t[o].y-t[o-1].y)*h;n.add(new dt(3,d,f,t[o-1].x,t[o-1].y,t[o-1].x,t[o-1].y))}const u=t[o].x+(t[o-1].x-t[o].x)*h,c=t[o].y+(t[o-1].y-t[o].y)*h;n.add(new dt(2,u,c))}else o>1&&n.add(new dt(3,r,a,t[o-1].x,t[o-1].y,t[o-1].x,t[o-1].y));o===t.length-1&&n.add(new dt(2,t[o].x,t[o].y))}s.add(n)}else{const n=new Lt(t[0].x,t[0].y,i,!1);for(let o=1;o<t.length;o++)n.add(new dt(2,t[o].x,t[o].y));if(i){const o=n.segments.last();o&&o.close()}s.add(n)}return s}}yt.stringify=yt.stringify,yt.stringifyFixed=yt.stringifyFixed,yt.fillPath=yt.fillPath,yt.parse=yt.parse;class Lt{n;Li;Ai;Nc;dm;ji;constructor(t,e,i,s,n){i===void 0&&(i=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),t!==void 0?this.Li=t:this.Li=0,e!==void 0?this.Ai=e:this.Ai=0,this.Nc=new J,this.dm=this.Nc.rt,this.ji=null}copy(){const t=new Lt;t.n=this.n&-2,t.Li=this.Li,t.Ai=this.Ai;const e=this.Nc.r,i=e.length,s=t.Nc;for(let n=0;n<i;n++){const o=e[n].copy();s.add(o)}return t.dm=this.dm,t.ji=this.ji,t}equalsApprox(t){if(!(t instanceof Lt)||!L.u(this.startX,t.startX)||!L.u(this.startY,t.startY))return!1;const e=this.segments.r,i=t.segments.r,s=e.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=e[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}toString(t){t===void 0&&(t=-1);let e="";if(t<0)e="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(t);e="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];e+=" "+o.toString(t)}return e}get f(){return(this.n&1)!==0}set f(t){t?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(t){t?this.n|=2:this.n&=-3}k(){this.f=!0;const t=this.segments;t.k();const e=t.r,i=t.length;for(let s=0;s<i;s++)e[s].k();return this}UP(){if(this.yt)return!0;const t=this.segments;if(this.dm!==t.rt)return!0;for(const e of t)if(e.yt)return!0;return!1}iR(){this.yt=!1,this.ji=null;const t=this.segments;this.dm=t.rt;for(const e of t)e.yt=!1,e.Hs=null}get isFilled(){return(this.n&4)!==0}set isFilled(t){this.f&&y.L(this,t),t?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(t){this.f&&y.L(this,t),t?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(t){this.f&&y.L(this,t),t?this.n|=16:this.n&=-17}get startX(){return this.Li}set startX(t){this.f&&y.L(this,t),this.Li=t,this.ji=null,this.yt=!0}get startY(){return this.Ai}set startY(t){this.f&&y.L(this,t),this.Ai=t,this.ji=null,this.yt=!0}get segments(){return this.Nc}set segments(t){this.f&&y.L(this,t),this.Nc=t,this.ji=null,this.yt=!0}add(t){return this.Nc.add(t),this.ji=null,this}BP(t,e,i){const s=this;let n=s.startX,o=s.startY,r=n,a=o;const l=s.segments.r,h=l.length;for(let u=0;u<h;u++){const c=l[u];switch(c.type){case 1:r=c.endX,a=c.endY,n=c.endX,o=c.endY;break;case 2:if(L.Ve(n,o,c.endX,c.endY,i,t,e))return!0;n=c.endX,o=c.endY;break;case 3:if(L.nx(n,o,c.point1X,c.point1Y,c.point2X,c.point2Y,c.endX,c.endY,.5,t,e,i))return!0;n=c.endX,o=c.endY;break;case 4:if(L.IP(n,o,c.point1X,c.point1Y,c.endX,c.endY,.5,t,e,i))return!0;n=c.endX,o=c.endY;break;case 5:case 6:const d=c.type===5?c.Fo(s):c.Za(s,n,o),f=d.length,m=c.type===5?c.centerX:c.endX,g=c.type===5?c.centerY:c.endY;if(f===0){if(L.Ve(n,o,m,g,i,t,e))return!0;n=m,o=g;break}let p=null;for(let b=0;b<f;b++)if(p=d[b],b===0&&L.Ve(n,o,p[0],p[1],i,t,e)||L.nx(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,t,e,i))return!0;p!==null&&(n=p[6],o=p[7]);break;default:y.o("Unknown Segment type: "+c.type)}if(c.isClosed&&(n!==r||o!==a)&&L.Ve(n,o,r,a,i,t,e))return!0}return!1}}var Be=(x=>(x[x.Move=1]="Move",x[x.Line=2]="Line",x[x.Bezier=3]="Bezier",x[x.QuadraticBezier=4]="QuadraticBezier",x[x.Arc=5]="Arc",x[x.SvgArc=6]="SvgArc",x))(Be||{});class dt{W;n;ni;oi;pn;Ll;Al;br;Hs;constructor(t,e,i,s,n,o,r,a){if(K.Je(this),t===void 0&&(t=2),this.W=t,this.n=2,e!==void 0?this.ni=e:this.ni=0,i!==void 0?this.oi=i:this.oi=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),r===void 0&&(r=0),t===6){let l=o;l=l%360,l<0&&(l+=360),this.pn=l,this.Ll=0,this.Al=Math.max(s,0),this.br=Math.max(n,0),typeof r=="boolean"?r&&(this.isLargeArc=!0):typeof r=="number"&&r&&(this.isLargeArc=!0),a&&(this.isClockwiseArc=!0)}else this.pn=s,this.Ll=n,t===5&&(o=Math.max(o,0)),this.Al=o,typeof r=="number"?(t===5&&(r=Math.max(r,0)),this.br=r):this.br=0;this.Hs=null}copy(){const t=new dt;return t.W=this.W,t.n=this.n&-2,t.ni=this.ni,t.oi=this.oi,t.pn=this.pn,t.Ll=this.Ll,t.Al=this.Al,t.br=this.br,t}equalsApprox(t){if(!(t instanceof dt)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return L.u(this.endX,t.endX)&&L.u(this.endY,t.endY);case 3:return L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)&&L.u(this.point1X,t.point1X)&&L.u(this.point1Y,t.point1Y)&&L.u(this.point2X,t.point2X)&&L.u(this.point2Y,t.point2Y);case 4:return L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)&&L.u(this.point1X,t.point1X)&&L.u(this.point1Y,t.point1Y);case 5:return L.u(this.startAngle,t.startAngle)&&L.u(this.sweepAngle,t.sweepAngle)&&L.u(this.centerX,t.centerX)&&L.u(this.centerY,t.centerY)&&L.u(this.radiusX,t.radiusX)&&L.u(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&L.u(this.xAxisRotation,t.xAxisRotation)&&L.u(this.endX,t.endX)&&L.u(this.endY,t.endY)&&L.u(this.radiusX,t.radiusX)&&L.u(this.radiusY,t.radiusY);default:return!1}}fe(t){t in Be?this.type=t:y.dr(this,t)}toString(t){t===void 0&&(t=-1);const e=s=>s===0?"0":s.toFixed(t);let i="";switch(this.type){case 1:t<0?i="M"+this.endX.toString()+" "+this.endY.toString():i="M"+e(this.endX)+" "+e(this.endY);break;case 2:t<0?i="L"+this.endX.toString()+" "+this.endY.toString():i="L"+e(this.endX)+" "+e(this.endY);break;case 3:t<0?i="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="C"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.point2X)+" "+e(this.point2Y)+" "+e(this.endX)+" "+e(this.endY);break;case 4:t<0?i="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="Q"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.endX)+" "+e(this.endY);break;case 5:t<0?i="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():i="B"+e(this.startAngle)+" "+e(this.sweepAngle)+" "+e(this.centerX)+" "+e(this.centerY)+" "+e(this.radiusX)+" "+e(this.radiusY);break;case 6:t<0?i="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():i="A"+e(this.radiusX)+" "+e(this.radiusY)+" "+e(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+e(this.endX)+" "+e(this.endY);break;default:i=Be[this.type]}return i+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get f(){return(this.n&1)!==0}set f(t){t?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(t){t?this.n|=2:this.n&=-3}k(){return this.f=!0,this}close(){return this.isClosed=!0,this}Fo(t){if(this.Hs!==null&&t.yt===!1)return this.Hs;const e=this.radiusX;let i=this.radiusY;if(i===void 0&&(i=e),e===0||i===0)return this.Hs=[],this.Hs;const s=this.pn,n=this.Ll,o=L.KL(0,0,e<i?e:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(e!==i){const a=wt.l();a.Ue(),e<i?a.it(1,i/e):a.it(e/i,1),yt.JL(o,a),wt.i(a)}const r=o.length;for(let a=0;a<r;a++){const l=o[a];l[0]+=s,l[1]+=n,l[2]+=s,l[3]+=n,l[4]+=s,l[5]+=n,l[6]+=s,l[7]+=n}return this.Hs=o,this.Hs}Za(t,e,i){if(this.Hs!==null&&t.yt===!1)return this.Hs;if(this.radiusX===0||this.radiusY===0)return this.Hs=[],this.Hs;const s=e,n=i;let o=this.Al,r=this.br;o===0&&(o=1e-4),r===0&&(r=1e-4);const a=this.pn*(Math.PI/180),l=this.isLargeArc,h=this.isClockwiseArc,u=this.ni,c=this.oi,d=Math.cos(a),f=Math.sin(a),m=d*(s-u)/2+f*(n-c)/2,g=-f*(s-u)/2+d*(n-c)/2,p=m*m/(o*o)+g*g/(r*r);p>1&&(o*=Math.sqrt(p),r*=Math.sqrt(p));let b=(l===h?-1:1)*Math.sqrt((o*o*r*r-o*o*g*g-r*r*m*m)/(o*o*g*g+r*r*m*m));isNaN(b)&&(b=0);let v=b*o*g/r,w=b*-r*m/o;isNaN(v)&&(v=0),isNaN(w)&&(w=0);const k=(s+u)/2+d*v-f*w,S=(n+c)/2+f*v+d*w,N=(it,Q)=>Math.sqrt(it*it+Q*Q),D=(it,Q,rt,ut)=>(it*rt+Q*ut)/(N(it,Q)*N(rt,ut)),A=(it,Q,rt,ut)=>(it*ut<Q*rt?-1:1)*Math.acos(D(it,Q,rt,ut)),M=A(1,0,(m-v)/o,(g-w)/r),C=(m-v)/o,F=(g-w)/r,O=(-m-v)/o,E=(-g-w)/r;let B=A(C,F,O,E);const z=D(C,F,O,E);z<=-1?B=Math.PI:z>=1&&(B=0),!h&&B>0&&(B=B-2*Math.PI),h&&B<0&&(B=B+2*Math.PI);const V=o>r?o:r,Y=o>r?1:o/r,_=o>r?r/o:1,nt=L.KL(0,0,V,M,M+B,!0),$=wt.l();return $.Ue(),$.Gs(k,S),$.ks(this.pn,0,0),$.it(Y,_),yt.JL(nt,$),wt.i($),this.Hs=nt,this.Hs}get isClosed(){return(this.n&8)!==0}set isClosed(t){this.isClosed!==t&&(t?this.n|=8:this.n&=-9,this.yt=!0)}get type(){return this.W}set type(t){this.f&&y.L(this,t),this.W=t,this.yt=!0}get endX(){return this.ni}set endX(t){this.f&&y.L(this,t),this.ni=t,this.yt=!0}get endY(){return this.oi}set endY(t){this.f&&y.L(this,t),this.oi=t,this.yt=!0}get point1X(){return this.pn}set point1X(t){this.f&&y.L(this,t),this.pn=t,this.yt=!0}get point1Y(){return this.Ll}set point1Y(t){this.f&&y.L(this,t),this.Ll=t,this.yt=!0}get point2X(){return this.Al}set point2X(t){this.f&&y.L(this,t),this.Al=t,this.yt=!0}get point2Y(){return this.br}set point2Y(t){this.f&&y.L(this,t),this.br=t,this.yt=!0}get centerX(){return this.pn}set centerX(t){this.f&&y.L(this,t),this.pn=t,this.yt=!0}get centerY(){return this.Ll}set centerY(t){this.f&&y.L(this,t),this.Ll=t,this.yt=!0}get radiusX(){return this.Al}set radiusX(t){t<0&&y.J(t,">= zero",dt,"radiusX"),this.f&&y.L(this,t),this.Al=t,this.yt=!0}get radiusY(){return this.br}set radiusY(t){t<0&&y.J(t,">= zero",dt,"radiusY"),this.f&&y.L(this,t),this.br=t,this.yt=!0}get startAngle(){return this.ni}set startAngle(t){this.f&&y.L(this,t),t=t%360,t<0&&(t+=360),this.ni=t,this.yt=!0}get sweepAngle(){return this.oi}set sweepAngle(t){this.f&&y.L(this,t),t>360&&(t=360),t<-360&&(t=-360),this.oi=t,this.yt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(t){this.f&&y.L(this,t),t?this.n|=4:this.n&=-5,this.yt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(t){this.f&&y.L(this,t),t?this.n|=16:this.n&=-17,this.yt=!0}get xAxisRotation(){return this.pn}set xAxisRotation(t){this.f&&y.L(this,t),t=t%360,t<0&&(t+=360),this.pn=t,this.yt=!0}}class te{a;ux;gx;gm;mm;pm;ym;wm;xm;bm;km;Pm;Sm;Mm;Ro;Nm;Cm;Ps;Ti;constructor(){this.a=null,this.ux=new P(0,0).k(),this.gx=new P(0,0).k(),this.gm=0,this.mm=0,this.pm=1,this.ym="",this.wm="",this.xm=!1,this.bm=!1,this.km=0,this.Pm=0,this.Sm=!1,this.Mm=!1,this.Ro=!1,this.Nm=null,this.Cm=0,this.Ps=null,this.Ti=null}copy(){const t=new te;return this.clone(t)}clone(t){return t.a=this.a,t.ux.h(this.viewPoint),t.gx.h(this.documentPoint),t.gm=this.gm,t.mm=this.mm,t.pm=this.pm,t.ym=this.ym,t.wm=this.wm,t.xm=this.xm,t.bm=this.bm,t.km=this.km,t.Pm=this.Pm,t.Sm=this.Sm,t.Mm=this.Mm,t.Ro=this.Ro,t.Nm=this.Nm,t.Cm=this.Cm,t.Ps=this.Ps,t.Ti=this.Ti,t}toString(){let t="^";return this.modifiers!==0&&(t+="M:"+this.modifiers),this.button!==0&&(t+="B:"+this.button),this.key!==""&&(t+="K:"+this.key),this.clickCount!==0&&(t+="C:"+this.clickCount),this.delta!==0&&(t+="D:"+this.delta),this.handled&&(t+="h"),this.bubbles&&(t+="b"),this.documentPoint!==null&&(t+="@"+this.documentPoint.toString()),t}get diagram(){return this.a}set diagram(t){this.a=t}get viewPoint(){return this.ux}set viewPoint(t){this.ux.h(t)}get documentPoint(){return this.gx}set documentPoint(t){this.gx.h(t)}getMultiTouchViewPoint(t,e){const i=this.diagram;return i===null||i._L(this.event,t,e),e}getMultiTouchDocumentPoint(t,e){const i=this.diagram;return i===null||(i._L(this.event,t,e),e.h(i.transformViewToDoc(e))),e}get modifiers(){return this.gm}set modifiers(t){this.gm=t}get button(){return this.mm}set button(t){if(this.mm=t,this.event===null)switch(t){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.pm}set buttons(t){this.pm=t}get key(){return this.ym}set key(t){this.ym=t}get code(){return this.wm}set code(t){this.wm=t}get down(){return this.xm}set down(t){this.xm=t}get up(){return this.bm}set up(t){this.bm=t}get clickCount(){return this.km}set clickCount(t){this.km=t}get delta(){return this.Pm}set delta(t){this.Pm=t}get isMultiTouch(){return this.Sm}set isMultiTouch(t){this.Sm=t}get handled(){return this.Mm}set handled(t){this.Mm=t}get bubbles(){return this.Ro}set bubbles(t){this.Ro=t}get event(){return this.Nm}set event(t){this.Nm=t}get isTouchEvent(){const t=this.event;return t===null?!1:t.pointerType==="touch"||t.pointerType==="pen"}get timestamp(){return this.Cm}set timestamp(t){this.Cm=t}get targetDiagram(){return this.Ps}set targetDiagram(t){this.Ps=t}get targetObject(){return this.Ti}set targetObject(t){this.Ti=t}get control(){return(this.modifiers&1)!==0}set control(t){this.modifiers=t?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(t){this.modifiers=t?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(t){this.modifiers=t?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(t){this.modifiers=t?this.modifiers|8:this.modifiers&-9}get left(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(t){t?this.buttons|=1:this.buttons&=-2}get right(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(t){t?this.buttons|=2:this.buttons&=-3}get middle(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(t){t?this.buttons|=4:this.buttons&=-5}get commandKey(){const t=this.code,e=this.key;return"cxvyzagCXVYZAG".includes(e)?e.toLowerCase():t==="KeyC"?"c":t==="KeyX"?"x":t==="KeyV"?"v":t==="KeyY"?"y":t==="KeyZ"?"z":t==="KeyA"?"a":t==="KeyG"?"g":t!==""?t:e}}class We{a;Pt;Lm;Am;constructor(){this.a=null,this.Pt="",this.Lm=null,this.Am=null}copy(){const t=new We;return t.a=this.a,t.Pt=this.Pt,t.Lm=this.Lm,t.Am=this.Am,t}toString(){let t="*"+this.name;return this.subject!==null&&(t+=":"+this.subject.toString()),this.parameter!==null&&(t+="("+this.parameter.toString()+")"),t}get diagram(){return this.a}set diagram(t){this.a=t}get name(){return this.Pt}set name(t){this.Pt=t}get subject(){return this.Lm}set subject(t){this.Lm=t}get parameter(){return this.Am}set parameter(t){this.Am=t}}var ri=(x=>(x[x.Transaction=1]="Transaction",x[x.Property=2]="Property",x[x.Insert=3]="Insert",x[x.Remove=4]="Remove",x))(ri||{});class Ne{Du;Tm;yn;Ce;a;vu;Cc;Lc;Ac;Tc;constructor(){this.Du=2,this.Tm="",this.yn="",this.Ce=null,this.a=null,this.vu=null,this.Cc=null,this.Lc=null,this.Ac=null,this.Tc=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Ce=null,this.a=null,this.vu=null,this.Cc=null,this.Lc=null,this.Ac=null,this.Tc=null}copy(){const t=new Ne;t.Du=this.Du,t.Tm=this.Tm,t.yn=this.yn,t.Ce=this.Ce,t.a=this.a,t.vu=this.vu;let e=this.Cc;return y.$(e)&&y.st(e.copyFrozen)?t.Cc=e.copyFrozen():t.Cc=e,e=this.Lc,y.$(e)&&y.st(e.copyFrozen)?t.Lc=e.copyFrozen():t.Lc=e,e=this.Ac,y.$(e)&&y.st(e.copyFrozen)?t.Ac=e.copyFrozen():t.Ac=e,e=this.Tc,y.$(e)&&y.st(e.copyFrozen)?t.Tc=e.copyFrozen():t.Tc=e,t}fe(t){t in ri?this.change=t:y.dr(this,t)}toString(){let t="";return this.change===1?t+="* ":this.change===2?t+=this.model!==null?"!m":"!d":t+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",this.change===1?this.oldValue!==null&&(t+=" "+this.oldValue):(this.object!==null&&(t+=y.toString(this.object)),this.oldValue!==null&&(t+="  old: "+y.toString(this.oldValue)),this.oldParam!==null&&(t+=" "+this.oldParam),this.newValue!==null&&(t+="  new: "+y.toString(this.newValue)),this.newParam!==null&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.tA(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.tA(this,!1))}get model(){return this.Ce}set model(t){this.Ce=t}get diagram(){return this.a}set diagram(t){this.a=t}get change(){return this.Du}set change(t){this.Du=t}get modelChange(){return this.Tm}set modelChange(t){this.Tm=t}get propertyName(){return this.yn}set propertyName(t){this.yn=t}get isTransactionFinished(){return this.Du===1&&(this.yn==="CommittedTransaction"||this.yn==="FinishedUndo"||this.yn==="FinishedRedo")}get object(){return this.vu}set object(t){this.vu=t}get oldValue(){return this.Cc}set oldValue(t){this.Cc=t}get oldParam(){return this.Lc}set oldParam(t){this.Lc=t}get newValue(){return this.Ac}set newValue(t){this.Ac=t}get newParam(){return this.Tc}set newParam(t){this.Tc=t}}class Ve{eA;Pt;XP;constructor(){this.eA=new J().k(),this.Pt="",this.XP=!1}toString(t){let e="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(t!==void 0&&t>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);n!==null&&(e+=`
  `+n.toString())}}return e}clear(){const t=this.changes;t.ce();for(let e=t.count-1;e>=0;e--){const i=t.elt(e);i!==null&&i.clear()}t.clear(),t.k()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let t=this.changes.count-1;t>=0;t--){const e=this.changes.elt(t);e!==null&&e.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const t=this.changes.count;for(let e=0;e<t;e++){const i=this.changes.elt(e);i!==null&&i.redo()}}oR(t){const e=this.changes;for(let i=e.count-1;i>=t;i--){const s=e.elt(i);s!==null&&s.undo(),e.ce(),e.removeAt(i)}e.k()}thaw(){this.changes.ce()}optimize(){if(!this.isComplete)return;const t=this.changes;t.ce();const e=new Map;for(let s=0;s<t.count;s++){const n=t.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=e.get(n.object);o||(o=new Map,e.set(n.object,o));const r=o.get(n.propertyName);r===void 0?o.set(n.propertyName,-1):(r>0&&t.setElt(r,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<t.count;s++){const n=t.elt(s);n!==null&&(s>i&&t.setElt(i,n),i++)}for(;t.length>i;)t.pop();t.k()}get changes(){return this.eA}get name(){return this.Pt}set name(t){this.Pt=t}get isComplete(){return this.XP}set isComplete(t){this.XP=t}}class Je{mx;Be;iA;js;GP;Dm;Tl;YP;KP;wn;Dc;yx;qs;wx;xx;vm;kx;constructor(t){this.mx=new K,this.Be=!1,this.iA=new J().k(),this.js=-1,this.GP=999,this.qs=!1,this.Dm=null,this.Tl=0,this.YP=!1,this.KP=23,this.wn=new J().k(),this.Dc=new J,this.yx=!0,this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1,t&&Object.assign(this,t)}toString(t){let e="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;e+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(e+=" "),e+=this.nestedTransactionNames.elt(s);if(e+="]",t!==void 0&&t>0){i=this.history.count;for(let s=0;s<i;s++)e+=`
 `+this.history.elt(s).toString(t-1)}return e}clear(){const t=this.history;t.ce();for(let e=t.count-1;e>=0;e--){const i=t.elt(e);i!==null&&i.clear()}t.clear(),this.js=-1,t.k(),this.qs=!1,this.Dm=null,this.Tl=0,this.wn.ce(),this.wn.clear(),this.wn.k(),this.Dc.clear(),this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1}copyProperties(t){this.isEnabled=t.isEnabled,this.maxHistoryLength=t.maxHistoryLength,this.Fm=t.Fm}addModel(t){this.mx.add(t)}removeModel(t){this.mx.delete(t)}startTransaction(t){if(t===void 0&&(t=""),t===null&&(t=""),this.isUndoingRedoing)return!1;this.yx===!0&&(this.yx=!1,this.Tl++,this.Dl||this.vl("StartingFirstTransaction",t,this.currentTransaction),this.Tl>0&&this.Tl--),this.isEnabled&&(this.wn.ce(),this.wn.add(t),this.wn.k(),this.currentTransaction===null?this.Dc.add(0):this.Dc.add(this.currentTransaction.changes.count)),this.Tl++;const e=this.transactionLevel===1;return e&&(this.Dl||this.vl("StartedTransaction",t,this.currentTransaction)),e}commitTransaction(t){return t===void 0&&(t=""),this.sA(!0,t)}rollbackTransaction(){return this.sA(!1,"")}sA(t,e){if(this.isUndoingRedoing)return!1;this.Fm&&this.transactionLevel<1&&y.ne("Ending transaction without having started a transaction: "+e);const i=this.transactionLevel===1;let s=this.currentTransaction;i&&t&&(this.Dl||this.vl("CommittingTransaction",e,s));let n=0;if(this.transactionLevel>0&&(this.Tl--,this.isEnabled)){const o=this.wn.count;o>0&&(e===""&&(e=this.wn.elt(0)),this.wn.ce(),this.wn.removeAt(o-1),this.wn.k());const r=this.Dc.count;r>0&&(n=this.Dc.elt(r-1),this.Dc.removeAt(r-1))}if(i){if(t){if(this.vm=!1,s===null&&e!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=e),this.discardHistoryAfterIndex();const r=this.history;r.ce();const a=this.maxHistoryLength;if(a>=0){if(a===0)r.clear();else if(r.count>=a){const l=r.elt(0);l!==null&&l.clear(),r.removeAt(0),this.js--}}a!==0&&(r.count===0||r.get(r.count-1)!==o)&&(r.add(o),this.js++),r.k(),s=o}this.Dl||this.vl("CommittedTransaction",e,s)}else{this.qs=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.Dl||this.vl("RolledBackTransaction",e,s),this.qs=!1}s!==null&&s.clear()}return this.Dm=null,this.Px&&this.clear(),this.Px=!1,this.Sx=!1,!0}else return this.isEnabled&&!t&&s!==null&&s.oR(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const t=this.history;t.ce();for(let e=t.count-1;e>this.historyIndex;e--){const i=t.elt(e);i!==null&&i.clear(),t.removeAt(e),this.vm=!0}t.k()}thaw(){this.history.ce()}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToUndo;return!!(t!==null&&t.canUndo())}undo(){if(!this.canUndo())return;const t=this.transactionToUndo;if(t!==null)try{this.qs=!0,this.vl("StartingUndo","Undo",t),this.js--,t.undo()}catch(e){y.ne("undo error: "+e.toString())}finally{this.vl("FinishedUndo","Undo",t),this.qs=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToRedo;return!!(t!==null&&t.canRedo())}redo(){if(!this.canRedo())return;const t=this.transactionToRedo;if(t!==null)try{this.qs=!0,this.vl("StartingRedo","Redo",t),this.js++,t.redo()}catch(e){y.ne("redo error: "+e.toString())}finally{this.vl("FinishedRedo","Redo",t),this.qs=!1}}vl(t,e,i){const s=new Ne;s.change=1,s.propertyName=t,s.object=i,s.oldValue=e;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.rR(s)}}handleChanged(t){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(t)){let e=this.currentTransaction;e===null&&(e=new Ve,this.Dm=e);const i=t.copy(),s=e.changes;if(s.ce(),s.add(i),s.k(),this.Fm&&this.KP>0&&this.transactionLevel<=0&&!this.yx){const n=t.diagram;if(n!==null&&n.Qa===!1)return;y.ne("Change not within a transaction: "+i.toString()),this.KP--}}}skipsEvent(t){if(t===null||t.change===1)return!0;const e=t.object;if(e===null)return!1;if(e.layer!==void 0){const i=e.layer;if(i!==null&&i.isTemporary)return!0}else if(e.isTemporary)return!0;return!1}get models(){return this.mx.iterator}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.qs}get history(){return this.iA}get maxHistoryLength(){return this.GP}set maxHistoryLength(t){this.GP=t}get historyIndex(){return this.js}get currentTransaction(){return this.Dm}get transactionLevel(){return this.Tl}get isInTransaction(){return this.Tl>0}get Fm(){return this.YP}set Fm(t){this.YP=t}get nestedTransactionNames(){return this.wn}get Px(){return this.wx}set Px(t){this.wx=t}get Sx(){return this.xx}set Sx(t){this.xx=t}get Dl(){return this.kx}set Dl(t){this.kx=t}get isJustDiscarded(){return this.vm}}class qt{a;Pt;Be;HP;jP;Rm;nA;constructor(){K.Je(this),this.a=X.Om(),this.Pt="",this.Be=!0,this.HP=!1,this.jP=null,this.nA=new te,this.Rm=-1}get diagram(){return this.a}set diagram(t){t instanceof X&&(this.a=t)}toString(){return this.name!==""?this.name+" Tool":y.Hn(this.constructor)}updateAdornments(t){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const t=this.diagram;t.currentTool===this&&(t.currentTool=null,t.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,P.z(NaN,NaN)),s=e.getMultiTouchViewPoint(1,P.z(NaN,NaN));if(!i.isReal()||!s.isReal()){P.i(i),P.i(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){t.qP=t.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);t.WP=r,e.bubbles=!1}P.i(i),P.i(s)}standardPinchZoomMove(){const t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,P.z(NaN,NaN)),s=e.getMultiTouchViewPoint(1,P.z(NaN,NaN));if(!i.isReal()||!s.isReal()){P.i(i),P.i(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o)/t.WP,a=new P((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),l=t.qP*r,h=t.commandHandler;if(l!==t.scale&&h.canResetZoom(l)){const u=t.zoomPoint;t.zoomPoint=a,h.resetZoom(l),t.zoomPoint=u}e.bubbles=!1}P.i(i),P.i(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(t){return t===void 0&&(t=this.name),this.transactionResult=null,this.diagram.startTransaction(t)}stopTransaction(){const t=this.diagram;return this.transactionResult===null?t.rollbackTransaction():t.commitTransaction(this.transactionResult)}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;const e=t.lastInput,i=t.findPartAt(e.documentPoint,!1);if(i!==null){if(y.ur?e.meta:e.control){t.T("ChangingSelection",t.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),t.T("ChangedSelection",t.selection)}else if(e.shift){if(!i.isSelected){t.T("ChangingSelection",t.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),t.T("ChangedSelection",t.selection)}}else if(!i.isSelected){let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&t.select(s)}}else e.left&&!(y.ur?e.meta:e.control)&&!e.shift&&t.clearSelection()}standardMouseClick(t,e){t===void 0&&(t=null),e===void 0&&(e=o=>!o.layer?.isTemporary);const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,t,e);return s.targetObject=n,this.oA(n,s,i)}oA(t,e,i){if(e.handled=!1,t!==null&&!t.isEnabledObject())return!1;let s=0;e.left?e.clickCount===1?s=1:e.clickCount===2?s=2:s=1:e.right&&e.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(t!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&i.T(n,t)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&i.T(n)}if(t!==null)for(;t!==null;){let o=null;switch(s){case 1:o=t.click;break;case 2:o=t.doubleClick?t.doubleClick:t.click;break;case 3:o=t.contextClick;break}if(o!==null&&(o(e,t),e.handled))break;t=t.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick;break}o!==null&&o(e)}return e.handled}standardMouseOver(){const t=this.diagram,e=t.lastInput;if(t.animationManager.ke===!0)return;const i=t.skipsUndoManager;t.skipsUndoManager=!0;let s=t.viewportBounds.containsPoint(e.documentPoint)?t.findObjectAt(e.documentPoint,null,null):null;e.event&&(e.event.type==="pointercancel"||e.event.type==="pointerout")&&(s=null),e.targetObject=s;let n=!1;if(s!==t.vc){let o=t.vc;const r=o;for(t.vc=s,this.rA(o,s),e.handled=!1;o!==null;){const a=o.mouseLeave;if(a!==null&&(s===o||s!==null&&s.isContainedBy(o)||(a(e,o,s),n=!0,e.handled)))break;o=o.panel}for(o=r,e.handled=!1;s!==null;){const a=s.mouseEnter;if(a!==null&&(o===s||o!==null&&o.isContainedBy(s)||(a(e,s,o),n=!0,e.handled)))break;s=s.panel}s=t.vc}if(s!==null){let o=s,r="";for(;o!==null&&(r=o.cursor,r==="");)o=o.panel;for(t.currentCursor=r,e.handled=!1,o=s;o!==null;){const a=o.mouseOver;if(a!==null&&(a(e,o),n=!0,e.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=t.mouseOver;o!==null&&(o(e),n=!0)}n&&t.requestUpdate(),t.skipsUndoManager=i}doUpdateCursor(t){const e=this.diagram;e&&(e.currentCursor="")}rA(t,e){}standardMouseWheel(){const t=this.diagram,e=t.lastInput;let i=e.delta;if(i===0||!t.documentBounds.isReal())return;const s=t.commandHandler,n=t.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!e.shift||n===1&&e.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=t.zoomPoint;t.zoomPoint=e.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),t.zoomPoint=o}e.bubbles=!1}else if(n===2&&e.shift||n===1&&!e.control){const o=t.position.copy(),r=e.event,a=r.deltaMode;let l=r.deltaX,h=r.deltaY,u="pixel";if((l!==0||h!==0)&&!e.shift){switch(a){case 0:u="pixel";break;case 1:u="line";break;case 2:u="page";break}if(l!==0&&t.allowHorizontalScroll){const c=t.scrollHorizontalLineChange;l=l*(c/16),t.scroll(u,l>0?"right":"left",Math.abs(l))}if(h!==0&&t.allowVerticalScroll){const c=t.scrollVerticalLineChange;h=h*(c/16),t.scroll(u,h>0?"down":"up",Math.abs(h))}}else!e.shift&&t.allowVerticalScroll?(i=i*3*t.scrollVerticalLineChange,t.scroll(u,i>0?"up":"down",Math.abs(i))):e.shift&&t.allowHorizontalScroll&&(i=i*3*t.scrollHorizontalLineChange,t.scroll(u,i>0?"left":"right",Math.abs(i)));this.doWheelChange(t,o,e)}}doWheelChange(t,e,i){(!t.position.equals(e)||i.event.wheelDeltaX!==0)&&(i.bubbles=!1)}standardWaitAfter(t,e){e===void 0&&(e=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=e.clone(this.nA);this.Rm=y.dn(()=>i.doWaitAfter(s),t)}cancelWaitAfter(){this.Rm!==-1&&y.wc(this.Rm),this.Rm=-1}doWaitAfter(t){}findToolHandleAt(t,e){const i=this.diagram.findObjectAt(t,s=>{for(;s!==null&&!(s.panel instanceof pt);)s=s.panel;return s});return i===null?null:i.part.category===e?i:null}isBeyondDragSize(t,e){const i=this.diagram;t===void 0&&(t=i.firstInput.viewPoint),e===void 0&&(e=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(e.x-t.x)>n||Math.abs(e.y-t.y)>o}get name(){return this.Pt}set name(t){this.Pt=t}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get isActive(){return this.HP}set isActive(t){this.HP=t}get transactionResult(){return this.jP}set transactionResult(t){this.jP=t}}var Yi=(x=>(x[x.Scroll=1]="Scroll",x[x.Zoom=2]="Zoom",x[x.None=3]="None",x))(Yi||{}),Ui=(x=>(x[x.Zoom=1]="Zoom",x[x.Cancel=2]="Cancel",x[x.None=3]="None",x))(Ui||{});class Ce extends qt{lA;aA;hA;JP;$P;ZP;QP;_P;tS;eS;Im;_a;constructor(t){super(),this.name="ToolManager",this.lA=new J,this.aA=new J,this.hA=new J,this.JP=850,this.$P=850,this.ZP=new st(2,2).kt(),this.QP=5e3,this._P=1,this.tS=1,this.eS=null,this.Im=null,this._a=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this._P}set mouseWheelBehavior(t){this._P=t}get gestureBehavior(){return this.tS}set gestureBehavior(t){this.tS=t}initializeStandardTools(){return this}updateAdornments(t){const e=this.currentToolTip;if(e instanceof pt&&this.Im===t){const i=e.adornedObject;(t!==null?i!==null&&i.part===t:i===null)?this.showToolTip(e,i):this.hideToolTip()}}doMouseDown(){const t=this.diagram,e=t.lastInput;if(e.isTouchEvent&&this.gestureBehavior===2&&(e.bubbles=!1),e.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){e.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}t.undoManager;const i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.diagram=this.diagram,n.canStart()){t.doFocus(),t.currentTool=n,t.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,e)}doMouseMove(){const t=this.diagram,e=t.lastInput;if(e.isMultiTouch){if(this.gestureBehavior===3){e.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseMove());return}}}this.cA(t);const i=e.event;i!==null&&(i.type==="pointermove"||!i.cancelable)&&(e.bubbles=!0)}cA(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}rA(t,e){const i=this.currentToolTip;i!==null&&(e!==null&&i instanceof pt&&(e===i||e.isContainedBy(i))||this.hideToolTip())}doWaitAfter(t){const e=this.diagram;if(!e.lR())return;const i=e.lastInput;if(e.lastInput=t,this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!e.lastInput.handled){const s=t.copy();s.button=2,e.lastInput=s,e.Mx=!0,e.doMouseUp()}e.lastInput=i}doMouseHover(){const t=this.diagram,e=t.lastInput;e.targetObject===null&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(i!==null)for(e.handled=!1;i!==null;){const s=this.isActive?i.mouseHold:i.mouseHover;if(s!==null&&(s(e,i),e.handled))break;i=i.panel}else{const s=this.isActive?t.mouseHold:t.mouseHover;s!==null&&s(e)}}doToolTip(){const t=this.diagram,e=t.lastInput;e.targetObject===null&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(i!==null){const s=this.currentToolTip;if(s instanceof pt&&(i===s||i.isContainedBy(s)))return;for(;i!==null;){const n=i.toolTip;if(n!==null){this.showToolTip(n,i);return}i=i.panel}this.hideToolTip()}else{const s=t.toolTip;s!==null?this.showToolTip(s,null):this.hideToolTip()}}showToolTip(t,e){const i=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof pt){t.layerName="Tool",t.selectable=!1,t.scale=1/i.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=i.scale);const s=t.diagram;s!==null&&s!==i&&s.remove(t),i.add(t),e!==null?t.adornedObject=e:t.data=i.model,t.ensureBounds(),this.positionToolTip(t,e)}else t instanceof ye&&t!==this.currentToolTip&&t.show!==null&&t.show(e,i,this);this.currentToolTip=t,this.extendToolTip(this.toolTipDuration)}positionToolTip(t,e){if(t.hasPlaceholder())return;const i=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=i.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+20/s.scale+o.height>r.bottom?n.y-=o.height+5/s.scale:n.y+=20/s.scale,n.y<r.y&&(n.y=r.y),i.position=n}extendToolTip(t){t===void 0&&(t=3e3),this.currentToolTip!==null&&(this._a!==-1&&(y.wc(this._a),this._a=-1),t>0&&t!==1/0&&(this._a=y.dn(()=>this.hideToolTip(),t)))}hideToolTip(){this._a!==-1&&(y.wc(this._a),this._a=-1);const t=this.diagram,e=this.currentToolTip;e!==null&&(e instanceof pt?(t.remove(e),this.Im!==null&&this.Im.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof ye&&e.hide!==null&&e.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eS}set currentToolTip(t){this.eS=t,this.Im=t!==null&&t instanceof pt?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const e=this.mouseUpTools.length;for(let i=0;i<e;i++){const s=this.mouseUpTools.elt(i);if(s.diagram=this.diagram,s.canStart()){t.doFocus(),t.currentTool=s,t.currentTool===s&&(s.isActive||s.doActivate(),s.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){let e=this.mouseDownTools.length;for(let i=0;i<e;i++){const s=this.mouseDownTools.elt(i);if(s.name===t)return s}e=this.mouseMoveTools.length;for(let i=0;i<e;i++){const s=this.mouseMoveTools.elt(i);if(s.name===t)return s}e=this.mouseUpTools.length;for(let i=0;i<e;i++){const s=this.mouseUpTools.elt(i);if(s.name===t)return s}return null}replaceTool(t,e){e!==null&&(e.diagram=this.diagram);let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return e!==null?this.mouseDownTools.setElt(s,e):this.mouseDownTools.removeAt(s),n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return e!==null?this.mouseMoveTools.setElt(s,e):this.mouseMoveTools.removeAt(s),n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return e!==null?this.mouseUpTools.setElt(s,e):this.mouseUpTools.removeAt(s),n}return null}replaceStandardTool(t,e,i){this.Jt(t,e,i)}Jt(t,e,i){e!==null&&(e.name=t,e.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,e):e!==null&&i.add(e)}get mouseDownTools(){return this.lA}get mouseMoveTools(){return this.aA}get mouseUpTools(){return this.hA}get hoverDelay(){return this.JP}set hoverDelay(t){this.JP=t}get holdDelay(){return this.$P}set holdDelay(t){this.$P=t}get dragSize(){return this.ZP}set dragSize(t){this.ZP=t.N()}get toolTipDuration(){return this.QP}set toolTipDuration(t){this.QP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}class St extends qt{iS;sS;xn;nS;oS;rS;lS;Fc;Em;aS;th;kr;fA;hS;Fu;Ru;cS;fS;uS;dS;static Nx=new J;static le=null;static eh=null;constructor(t){super(),this.name="Dragging",this.iS=!0,this.dS=!0,this.sS=!0,this.xn=null,this.nS=null,this.oS=null,this.rS=null,this.lS=!1,this.Fu=!1,this.Fc=new P(NaN,NaN),this.Em=new P,this.aS=!0,this.th=100,this.kr=[],this.fA=new K().k(),this.hS=new Ze,this.Ru=null,this.cS="copy",this.fS="",this.uS="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.iS}set isCopyEnabled(t){this.iS=t}get copiesEffectiveCollection(){return this.sS}set copiesEffectiveCollection(t){this.sS=t}get dragOptions(){return this.hS}set dragOptions(t){this.hS=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.aS}set isComplexRoutingRealtime(t){this.aS=t;const e=this.diagram.findRouter("AvoidsLinks");e!==null&&(e.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){this.dragOptions.dragsTree=t}get copyCursor(){return this.cS}set copyCursor(t){this.cS=t}get moveCursor(){return this.fS}set moveCursor(t){this.fS=t}get nodropCursor(){return this.uS}set nodropCursor(t){this.uS=t}get currentPart(){return this.nS}set currentPart(t){t!==null&&y.se(t,ft,St,"currentPart"),this.nS=t}get copiedParts(){return this.rS}set copiedParts(t){this.rS=t}get draggedParts(){return this.oS}set draggedParts(t){this.oS=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.fA}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){t!==null&&y.se(t,U,St,"draggedLink"),this.diagram.draggedLink=t}get isDragOutStarted(){return this.lS}set isDragOutStarted(t){this.lS=t}get startPoint(){return this.Em}set startPoint(t){this.Em.equals(t)||this.Em.h(t)}get delay(){return this.th}set delay(t){this.th=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const e=t.lastInput;return!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.isTouchEvent&&e.timestamp-t.firstInput.timestamp<this.th)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(e===null)return null;for(;e!==null&&!e.canSelect();)e=e.containingGroup;return e!==null&&(e.canMove()||e.canCopy())?e:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(e!==null){for(;e!==null&&!e.canSelect();)e=e.containingGroup;if(this.currentPart=e,this.currentPart!==null&&!this.currentPart.isSelected){t.T("ChangingSelection",t.selection);const i=t.lastInput;!(y.ur?i.meta:i.control)&&!i.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.T("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.Ru=null,this.currentPart===null&&this.standardMouseSelect();const e=this.currentPart;if(e===null||!e.canMove()&&!e.canCopy())return;t.cacheGroupExternalLinks(!0),St.le=null,this.isActive=!0,this.Fc.set(t.position),this.gS(t.selection),this.kr.length=0,t.animationManager.stopAnimation();const i=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=i,this.dS=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.Ou=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Cx(),t.uA(this.draggedParts),t.Iu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.aR()}gS(t){if(!this.dragsLink)return;const e=this.diagram,i=e.model.Um(),s=t.first();i&&t.count===1&&s instanceof U&&this.mayDragLink(s)?(this.draggedLink=s,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.xn=e.toolManager.findTool("Relinking"),this.xn===null&&(this.xn=new De,this.xn.diagram=e),this.xn.originalLink=this.draggedLink):(this.draggedLink=null,this.xn=null)}mayDragLink(t){const e=this.diagram;return e!==null&&e.allowRelink}computeEffectiveCollection(t,e){return this.diagram.commandHandler.computeEffectiveCollection(t,e)}Ws(t){return t===void 0?new Te(P.gn):this.isGridSnapEnabled?new Te(new P(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new Te(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.dS,t.Iu=!1,t.Fl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.mS(),t.pS(this.draggedParts),this.Ru=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.Fu=!1,St.hR(),this.dA(),this.Fc.e(NaN,NaN),St.eh!==null&&(St.eh.currentCursor=""),St.eh=null,St.le=null,this.Rl(),t.isMouseCaptured=!1,t.currentCursor="",t.Ou=!1,this.stopTransaction(),t.yS(!0)}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}mS(){const t=this.diagram,e=t.skipsUndoManager;t.skipsUndoManager=!0;const i=t.lastInput;this.gA(i,null),t.skipsUndoManager=e,this.kr.length=0}mA(){this.Rl(),this.wS();const t=this.diagram;this.Fc.isReal()&&(t.position=this.Fc),t.stopAutoScroll()}doCancel(){this.Rl(),this.wS();const t=this.diagram;this.Fc.isReal()&&(t.position=this.Fc),this.stopTool()}doKeyDown(){const t=this.diagram;if(!this.isActive)return;const e=t.lastInput,i=t.previousInput;e.code==="Escape"?this.doCancel():(e.code!==i.code||e.modifiers!==i.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}cR(t,e){let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=t.iterator;for(;r.next();){const a=r.value;if(!a.isVisible())continue;const l=a.location,h=l.x,u=l.y;isNaN(h)||isNaN(u)||(h<i&&(i=h),u<s&&(s=u),h>n&&(n=h),u>o&&(o=u))}return i===1/0?e.e(0,0,0,0):e.e(i,s,n-i,o-s),e}xS(t){if(this.copiedParts!==null)return;const e=this.diagram;if(t&&(e.isReadOnly||e.isModelReadOnly)||this.draggedParts===null)return;const i=e.undoManager;i.isEnabled&&i.isInTransaction?i.currentTransaction!==null&&i.currentTransaction.changes.count>0&&(e.undoManager.rollbackTransaction(),e.startTransaction("Drag")):this.wS(),e.skipsUndoManager=!t,e.partManager.addsToTemporaryLayer=!t,this.startPoint=e.firstInput.documentPoint;const s=this.copiesEffectiveCollection?this.draggedParts.toKeySet():e.selection,n=e.copyParts(s,e,!0),o=new bt,r=this.draggedParts.iterator;for(;r.next();){const l=r.key;if(l.Di()&&l.canCopy()){const h=n.get(l);if(h===null)continue;h.location=l.location,h.ensureBounds(),o.set(h,this.Ws(h.location))}}const a=n.iterator;for(;a.next();){const l=a.value;l instanceof U&&l.canCopy()&&o.set(l,this.Ws())}if(this.copiedParts=o,this.gS(o.toKeySet()),this.draggedLink!==null){const l=this.draggedLink,h=l.routeBounds;l.Pr(this.startPoint.x-(h.x+h.width/2),this.startPoint.y-(h.y+h.height/2))}this.doUpdateCursor(null)}Rl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const e=this.draggedParts.iterator;for(;e.next();)if(e.key instanceof U){const i=e.value;i.point=new P(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}dA(){this.draggedLink!==null&&(this.dragsLink&&this.xn!==null&&(this.xn.stopDraggingMouseMove(),this.xn.originalLink=null),this.draggedLink=null,this.xn=null)}Rc(t,e){if(t===null)return;const i=this.diagram,s=this.startPoint,n=P.l();n.h(i.lastInput.documentPoint),this.moveParts(t,n.subtract(s),e),P.i(n),i.getRenderingHint("temporaryPixelRatio")===!0&&i.Ol===null&&i.avgSpf>30&&(i.Cx(),i.Eu())}moveParts(t,e,i){i===void 0&&(i=!1);const s=this.diagram;s!==null&&s.Lx(t,e,this.dragOptions,i)}wS(){if(this.draggedParts===null)return;const t=this.diagram;let e=this.draggedParts.iterator;for(;e.next();){const i=e.key;i.Di()&&(i.location=e.value.point)}for(e=this.draggedParts.iterator;e.next();){const i=e.key;if(i instanceof U&&i.suspendsRouting){const s=e.value.point;this.draggedParts.set(i,this.Ws()),i.Pr(-s.x,-s.y)}}t.maybeUpdate()}fR(t){if(t===null)return!0;const e=t.part;return!!(e===null||e instanceof pt||e.layer?.isTemporary||this.draggedParts&&this.draggedParts.has(e)||this.copiedParts&&this.copiedParts.has(e))}bS(t){const e=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.pA(!1));const i=this.findDragOverObject(t),s=e.lastInput;s.targetObject=i,this.doUpdateCursor(i);const n=e.skipsUndoManager;let o=!1;try{if(e.skipsUndoManager=!0,o=this.gA(s,i),!this.isActive&&St.le===null)return;const r=i!==null?i.part:null;if(r===null||e.handlesDragDropForTopLevelParts&&r.isTopLevel&&!(r instanceof at)){const a=e.mouseDragOver;a!==null&&(a(s),o=!0)}if(!this.isActive&&St.le===null||(this.doDragOver(t,i),!this.isActive&&St.le===null))return}finally{e.skipsUndoManager=n,o&&e.maybeUpdate()}this.Ru=i,!e.isReadOnly&&(e.allowMove||e.allowCopy)&&(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(s.viewPoint)}findDragOverObject(t){return this.diagram.kS(t,null,e=>!this.fR(e))}doUpdateCursor(t){const e=this.diagram;(t===null||this.Ru!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?e.currentCursor=this.copyCursor:this.mayMove()?e.currentCursor=this.moveCursor:this.mayDragOut()&&(e.currentCursor=this.nodropCursor))}gA(t,e){let i=!1,s=this.kr.length;const n=s>0?this.kr[0]:null;if(e===n)return!1;t.handled=!1;for(let r=0;r<s;r++){const a=this.kr[r],l=a.mouseDragLeave;if(l!==null&&(l(t,a,e),i=!0,t.handled))break}if(this.kr.length=0,!this.isActive&&St.le===null||e===null)return i;t.handled=!1;let o=e;for(;o!==null;)this.kr.push(o),o=this.yA(o);s=this.kr.length;for(let r=0;r<s;r++){const a=this.kr[r],l=a.mouseDragEnter;if(l!==null&&(l(t,a,n),i=!0,t.handled))break}return i}FU(t,e){return t===null?!1:!!(t===e||t.isContainedBy(e)||e instanceof at&&!(t instanceof at)&&e.handlesDragDropForMembers&&t.part?.isMemberOf(e))}yA(t){const e=t.panel;if(e!==null)return e;if(t instanceof ft&&!(t instanceof at)){const i=t.containingGroup;if(i!==null&&i.handlesDragDropForMembers)return i}return null}wA(t,e){const i=this.diagram,s=this.xn;if(s===null)return null;const n=s.portGravity,o=i.findObjectsNear(t,n,h=>s.findValidLinkablePort(h,e)),r=P.l();let a=1/0,l=null;for(const h=o.iterator;h.next();){const u=h.value;if(u.part===null)continue;const c=u.getDocumentPoint(T.Center,r),d=t.distanceSquaredPoint(c);d<a&&(l=u,a=d)}return P.i(r),l}pA(t){const e=this.draggedLink;if(e!==null){if(e.pointsCount<2)return;const i=this.diagram;if(i.isReadOnly)return;const s=this.xn;if(s===null)return;let n=null,o=null;e.fromNode===null&&(n=this.wA(e.getPoint(0),!1),n!==null&&(o=n.part));let r=null,a=null;e.toNode===null&&(r=this.wA(e.getPoint(e.pointsCount-1),!0),r!==null&&(a=r.part)),s.isValidLink(o,n,a,r)?t?(e.defaultFromPoint=e.getPoint(0),e.defaultToPoint=e.getPoint(e.pointsCount-1),e.suspendsRouting=!1,e.fromNode=o,n!==null&&(e.fromPortId=n.portId),e.toNode=a,r!==null&&(e.toPortId=r.portId),e.fromPort!==i.PS&&i.T("LinkRelinked",e,i.PS),e.toPort!==i.SS&&i.T("LinkRelinked",e,i.SS)):s.doDraggingMouseMove(o,n,a,r):s.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,e){}xA(t){const e=this.diagram;this.dragsLink&&this.pA(!0),this.mS();const i=this.findDragOverObject(t),s=e.lastInput;if(s.targetObject=i,i!==null){s.handled=!1;let a=i;for(;a!==null;){const l=a.mouseDrop;if(l!==null&&(l(s,a),s.handled))break;this.uR(s,a),a=this.yA(a)}}else{const a=e.mouseDrop;a!==null&&a(s)}if(!this.isActive&&St.le===null)return;const n=this.copiedParts||this.draggedParts;if(n!==null){const a=n.iterator;for(;a.next();){const l=a.key;l instanceof W&&l.linksConnected.each(h=>h.suspendsRouting=!1)}}if(this.doDropOnto(t,i),!this.isActive&&St.le===null)return;const o=I.l(),r=e.selection.iterator;for(;r.next();){const a=r.value;a instanceof W&&this.dR(e,a,o)}I.i(o)}uR(t,e){const i=this.diagram,s=e.part;if(i.handlesDragDropForTopLevelParts&&s!==null&&s.isTopLevel&&!(s instanceof at)){const n=i.mouseDrop;n!==null&&n(t)}}dR(t,e,i){if(!e.canAvoid())return;let s=!1;i=e.getAvoidableRect(i),t.viewportBounds.containsRect(i)&&(s=!0);const n=this.copiedParts||this.draggedParts;if(n===null)return;const o=t.MS(i,a=>a.part,a=>a instanceof U,!0,a=>a instanceof U,s);if(o.count===0)return;const r=o.iterator;for(;r.next();){const a=r.value;n.has(a)&&n.has(e)||!a.isMemberOf(e)&&a.isAvoiding&&a.$t()}}doDropOnto(t,e){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,e=t.lastInput;this.simulatedMouseMove(e.event,e.documentPoint,e.targetDiagram)||this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.xS(!1),this.Rc(this.copiedParts,!1)):this.mayMove()?(this.Rl(),this.Rc(this.draggedParts,!0)):this.mayDragOut()?(this.xS(!1),this.Rc(this.copiedParts,!1)):this.Rl(),this.bS(t.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;const t=this.diagram,e=t.lastInput;if(this.simulatedMouseUp(e.event,e.documentPoint,e.targetDiagram))return;let i=!1;const s=this.mayCopy();if(s&&this.copiedParts!==null?(this.Rl(),this.xS(!0),this.Rc(this.copiedParts,!1),this.copiedParts!==null&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0}))):(i=!0,this.Rl(),this.mayMove()&&(this.Rc(this.draggedParts,!0),this.bS(t.lastInput.documentPoint))),this.Fu=!0,this.xA(t.lastInput.documentPoint),this.isActive){const n=s&&this.copiedParts,o=n?this.copiedParts?.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,i&&this.gR(),t.invalidateDocumentBounds(),t.pS(this.draggedParts),this.transactionResult=n?"Copy":"Move",t.T(n?"SelectionCopied":"SelectionMoved",o)}this.stopTool(),s&&t.T("ChangedSelection",t.selection)}simulatedMouseMove(t,e,i){if(St.le===null)return!1;const s=St.le.diagram;i instanceof X||(i=null);const n=St.eh;if(i!==n){if(n!==null&&n!==s){n.stopAutoScroll(),St.le.isDragOutStarted=!1;const r=n.toolManager.findTool("Dragging");r!==null&&r.doSimulatedDragLeave()}if(St.eh=i,i!==null&&i!==s){St.le.mA();const r=i.toolManager.findTool("Dragging");r!==null&&(r.bA(),r.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(i===null||i===s||!i.allowDrop||i.isReadOnly||!i.allowInsert)return!1;const o=i.toolManager.findTool("Dragging");if(o!==null){let r=e;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),r=i.getMouse(t)),i.lastInput.documentPoint=r,i.lastInput.viewPoint=i.transformDocToView(r),i.lastInput.down=!1,i.lastInput.up=!1,o.doSimulatedDragOver()}return!0}simulatedMouseUp(t,e,i){if(St.le===null)return!1;const s=St.eh,n=St.le.diagram;if(i===null)return St.le.doCancel(),!0;if(i!==s){if(s!==null){const r=s.toolManager.findTool("Dragging");if(s!==null&&s!==n&&r!==null)return s.stopAutoScroll(),St.le.isDragOutStarted=!1,r.doSimulatedDragLeave(),!1}St.eh=i;const o=i.toolManager.findTool("Dragging");o!==null&&(St.le.mA(),o.bA(),o.doSimulatedDragEnter())}if(i!==this.diagram){let o=e;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),o=i.getMouse(t)):o===null&&(o=new P),i.lastInput.documentPoint=o,i.lastInput.viewPoint=i.transformDocToView(o),i.lastInput.down=!1,i.lastInput.up=!0;const r=i.toolManager.findTool("Dragging");r!==null&&r.doSimulatedDrop();const a=St.le;if(a!==null){const l=a.mayCopy();a.transactionResult=l?"Copy":"Move",a.stopTool()}return!0}return!1}gR(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const e=t.key;if(e instanceof W){const i=e.containingGroup;i!==null&&i.hasPlaceholder()&&!this.draggedParts.has(i)&&i.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(y.ur?t.lastInput.alt:t.lastInput.control))return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}bA(){St.Nx.has(this)||St.Nx.add(this)}static hR(){if(St.Nx.count>0){const t=St.Nx,e=t.length;for(let i=0;i<e;i++){const s=t.elt(i);s.dA(),s.Rl(),s.mS(),s.diagram.stopAutoScroll()}t.clear()}}mR(t,e,i){return!this.Fu&&this.draggedParts!==null&&!this.draggedParts.has(t)?(i.h(e),!0):!1}get draggingSource(){return St.le}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const e=St.le;return!(e===null||e.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.Sr(),t.animationManager.stopAnimation();const e=St.le;e!==null&&(this.diagram.Ou=!0,t.lastInput.event===null&&(t.lastInput.event=e.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=St.le;t!==null&&t.doSimulatedDragOut(),this.diagram.Ou=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.Uu=!0;const e=St.le;if(e!==null&&e.draggedParts!==null){if(!this.mayDragIn())return;this.kA(e.draggedParts.toKeySet(),!1,t.firstInput),this.Rc(this.copiedParts,!1),this.bS(t.lastInput.documentPoint)}t.animationManager.Uu=!1}doSimulatedDrop(){const t=this.diagram,e=St.le;if(e!==null){const i=e.diagram;if(e.Fu=!0,this.Rl(),e.draggedParts===null||!this.mayDragIn())return;t.animationManager.Uu=!0,t.T("ChangingSelection",t.selection),this.startTransaction("Drop"),this.kA(e.draggedParts.toKeySet(),!0,t.lastInput),this.Rc(this.copiedParts,!1);const s=new K;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0,s.add(n)})),this.xA(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.Ou=!1,t.T("ExternalObjectsDropped",s,i),this.stopTransaction(),t.T("ChangedSelection",t.selection)}t.animationManager.Uu=!1}kA(t,e,i){if(this.copiedParts!==null)return;const s=this.diagram;if(s.isReadOnly||s.isModelReadOnly)return;s.skipsUndoManager=!e,s.partManager.addsToTemporaryLayer=!e,this.startPoint=i.documentPoint;const n=s.copyParts(t,s,!0),o=I.l();this.cR(t,o);const r=o.x+o.width/2,a=o.y+o.height/2;I.i(o);const l=this.Em,h=new bt,u=P.l(),c=t.iterator;for(;c.next();){const f=c.value;if(f instanceof U&&f.canCopy()){const m=n.get(f);if(m===null)continue;m.points=f.points,m.Pr(l.x-r,l.y-a),m.suspendsRouting=!0,h.set(m,this.Ws())}}const d=t.iterator;for(;d.next();){const f=d.value;if(f.Di()&&f.canCopy()){const m=n.get(f);if(m===null)continue;const g=f.location;u.e(l.x-(r-g.x),l.y-(a-g.y)),m.location=u,m.ensureBounds(),h.set(m,this.Ws(u))}}if(P.i(u),this.copiedParts=h,this.gS(h.toKeySet()),this.draggedLink!==null){const f=this.draggedLink,m=f.routeBounds;f.Pr(this.startPoint.x-(m.x+m.width/2),this.startPoint.y-(m.y+m.height/2))}this.doUpdateCursor(null)}aR(){this.isDragOutStarted=!0,this.Fu=!1,St.le=this,St.eh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.Ru=null}computeMove(t,e,i,s){const n=this.diagram;return n!==null?n.computeMove(t,e,this.dragOptions,s):new P}}Ce.prototype.doCancel=function(){St.le!==null&&St.le.doCancel(),qt.prototype.doCancel.call(this)};class ai extends qt{NS;CS;Il;LS;AS;ih;TS;nh;DS;vS;FS;RS;OS;IS;PA;ES;El;US;constructor(){super(),this.NS=100,this.CS=!1,this.Il="pointer",this.LS=new U({layerName:"Tool"}).add(new et({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new et({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).It(),this.ih=new et("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:st.TP}).theme("stroke","tempPort"),this.AS=new W({selectable:!1,layerName:"Tool"}).add(this.ih).It(),this.nh=new et("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:st.TP}).theme("stroke","tempPort"),this.TS=new W({selectable:!1,layerName:"Tool"}).add(this.nh).It(),this.DS=null,this.vS=null,this.FS=null,this.RS=null,this.OS=null,this.IS=!0,this.PA=new bt,this.ES=null,this.El=null,this.US=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.NS}set portGravity(t){t>=0&&(this.NS=t)}get isUnconnectedLinkValid(){return this.CS}set isUnconnectedLinkValid(t){this.CS=t}get linkingCursor(){return this.Il}set linkingCursor(t){this.Il=t}get temporaryLink(){return this.LS}set temporaryLink(t){t.It(),this.LS=t}get temporaryFromNode(){return this.AS}set temporaryFromNode(t){t.It(),this.AS=t,t&&(this.ih=t.port)}get temporaryFromPort(){return this.ih}set temporaryFromPort(t){if(this.ih!==null){const e=this.ih.panel;if(e!==null){const i=e.D.indexOf(this.ih);e.removeAt(i),e.insertAt(i,t)}}this.ih=t}get temporaryToNode(){return this.TS}set temporaryToNode(t){t.It(),this.TS=t,t&&(this.nh=t.port)}get temporaryToPort(){return this.nh}set temporaryToPort(t){if(this.nh!==null){const e=this.nh.panel;if(e!==null){const i=e.D.indexOf(this.nh);e.removeAt(i),e.insertAt(i,t)}}this.nh=t}get originalLink(){return this.DS}set originalLink(t){this.DS=t}get originalFromNode(){return this.vS}set originalFromNode(t){this.vS=t}get originalFromPort(){return this.FS}set originalFromPort(t){this.FS=t}get originalToNode(){return this.RS}set originalToNode(t){this.RS=t}get originalToPort(){return this.OS}set originalToPort(t){this.OS=t}get isForwards(){return this.IS}set isForwards(t){this.IS=t}get validPortsCache(){return this.PA}get targetPort(){return this.ES}set targetPort(t){this.ES=t}copyPortProperties(t,e,i,s,n){if(t===null||e===null||i===null||s===null)return;const o=e.getDocumentScale(),r=st.l();r.width=e.naturalBounds.width*o,r.height=e.naturalBounds.height*o,s.desiredSize=r,st.i(r),n?(s.toSpot=e.toSpot,s.toEndSegmentLength=e.toEndSegmentLength):(s.fromSpot=e.fromSpot,s.fromEndSegmentLength=e.fromEndSegmentLength),i.locationSpot=T.Center;const a=P.l();i.location=e.getDocumentPoint(T.Center,a),P.i(a),s.angle=e.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,e,i,s,n)}setNoTargetPortProperties(t,e,i){e!==null&&(e.desiredSize=st.TP,e.fromSpot=T.None,e.toSpot=T.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,e,i)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof W){const e=this.targetPort.part;this.isForwards?this.copyPortProperties(e,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(e,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,e){if(t===null)return null;const i=t.part;if(!(i instanceof W))return null;for(;t!==null;){const s=e?t.toLinkable:t.fromLinkable;if(s===!0&&(t.portId!==null||t instanceof W)&&(e?this.isValidTo(i,t):this.isValidFrom(i,t)))return t;if(s===!1)return null;t=t.panel}return null}findTargetPort(t){const e=this.diagram,i=e.lastInput.documentPoint;let s=this.portGravity;const n=e.findObjectsNear(i,s,l=>this.findValidLinkablePort(l,t),null,!0);let o=1/0,r=null;const a=n.iterator;for(;a.next();){const l=a.value,h=l.part;if(!(h instanceof W))continue;const u=l.getDocumentPoint(T.Center,P.l()),c=i.x-u.x,d=i.y-u.y;P.i(u);const f=c*c+d*d;if(f<o){const m=this.validPortsCache.get(l);m!==null?m&&(r=l,o=f):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,h,l)||!t&&this.isValidLink(h,l,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(l,!0),r=l,o=f):this.validPortsCache.set(l,!1)}}if(r!==null){const l=r.part;if(l instanceof W&&(l.layer===null||l.layer.allowLink))return r}return null}isValidFrom(t,e){if(t===null||e===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||e.fromLinkable!==!0))return!1;const i=e.fromMaxLinks;if(i<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&e===this.originalFromPort)return!0;let s=e.portId;if(s===null&&(s=""),t.findLinksOutOf(s).count>=i)return!1}return!0}isValidTo(t,e){if(t===null||e===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||e.toLinkable!==!0))return!1;const i=e.toMaxLinks;if(i<1/0){if(this.originalLink!==null&&t===this.originalToNode&&e===this.originalToPort)return!0;let s=e.portId;if(s===null&&(s=""),t.findLinksInto(s).count>=i)return!1}return!0}isInSameNode(t,e){if(t===null||e===null)return!1;if(t===e)return!0;const i=t.part,s=e.part;return i!==null&&i===s}isLinked(t,e){if(t===null||e===null)return!1;const i=t.part;if(!(i instanceof W))return!1;let s=t.portId;s===null&&(s="");const n=e.part;if(!(n instanceof W))return!1;let o=e.portId;o===null&&(o="");const r=n.findLinksInto(o);for(;r.next();){const a=r.value;if(a.fromNode===i&&a.fromPortId===s)return!0}return!1}isValidLink(t,e,i,s){if(!this.isValidFrom(t,e)||!this.isValidTo(i,s)||e!==null&&s!==null&&(!(e.fromLinkableSelfNode&&s.toLinkableSelfNode)&&this.isInSameNode(e,s)||!(e.fromLinkableDuplicates&&s.toLinkableDuplicates)&&this.isLinked(e,s))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||i!==null&&this.isLabelDependentOnLink(i,this.originalLink))||t!==null&&i!==null&&(t.data===null&&i.data!==null||t.data!==null&&i.data===null)||!this.isValidCycle(t,i,this.originalLink))return!1;let n;return t!==null&&e!==null&&(n=t.linkValidation,n!==null&&!n(t,e,i,s,this.originalLink))||i!==null&&s!==null&&(n=i.linkValidation,n!==null&&!n(t,e,i,s,this.originalLink))?!1:(n=this.linkValidation,n!==null?n(t,e,i,s,this.originalLink):!0)}isLabelDependentOnLink(t,e){if(t===null)return!1;const i=t.labeledLink;if(i===null)return!1;if(i===e)return!0;const s=new K;return s.add(t),this.VS(i,e,s)}VS(t,e,i){if(t===e)return!0;const s=t.fromNode;if(s!==null&&s.labeledLink&&(i.add(s),this.VS(s.labeledLink,e,i)))return!0;const n=t.toNode;return!!(n!==null&&n.labeledLink&&(i.add(n),this.VS(n.labeledLink,e,i)))}isValidCycle(t,e,i){if(i===void 0&&(i=null),t===null||e===null)return this.isUnconnectedLinkValid;const s=this.diagram;let n=1;if(s&&(s.model.Vm()?n=s.isTreePathToChildren?5:6:n=s.validCycle),n===1)return!0;if(n===5){const o=i||this.temporaryLink;if(o!==null&&!o.isTreeLink)return!0;const r=e.linksConnected;for(;r.next();){const a=r.value;if(a!==i&&a.isTreeLink&&a.toNode===e)return!1}return!this.Vu(t,e,i,!0)}else if(n===6){const o=i||this.temporaryLink;if(o!==null&&!o.isTreeLink)return!0;const r=t.linksConnected;for(;r.next();){const a=r.value;if(a!==i&&a.isTreeLink&&a.fromNode===t)return!1}return!this.Vu(t,e,i,!0)}else{if(n===2)return!this.pR(t,e,i);if(n===3)return!this.Vu(t,e,i,!1);if(n===4)return!this.yR(t,e,i)}return!0}Vu(t,e,i,s){if(t===e)return!0;if(t===null||e===null)return!1;const n=t.linksConnected;for(;n.next();){const o=n.value;if(o===i||s&&!o.isTreeLink||o.toNode!==t)continue;const r=o.fromNode;if(!(r===t||r===null)&&this.Vu(r,e,i,s))return!0}return!1}pR(t,e,i){if(t===e)return!0;const s=new Set;return s.add(e),this.SA(s,t,e,i)}SA(t,e,i,s){if(e===i)return!0;if(e===null||i===null||t.has(e))return!1;t.add(e);const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===s||o.toNode!==e)continue;const r=o.fromNode;if(!(r===e||r===null)&&this.SA(t,r,i,s))return!0}return!1}yR(t,e,i){if(t===e)return!0;const s=new Set;return s.add(e),this.MA(s,t,e,i)}MA(t,e,i,s){if(e===i)return!0;if(e===null||i===null||t.has(e))return!1;t.add(e);const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===s)continue;const r=o.fromNode,a=o.toNode,l=r===e?a:r;if(!(l===e||l===null)&&this.MA(t,l,i,s))return!0}return!1}get linkValidation(){return this.El}set linkValidation(t){this.El=t}get portTargeted(){return this.US}set portTargeted(t){this.US=t}}var ji=(x=>(x[x.Either=1]="Either",x[x.ForwardsOnly=2]="ForwardsOnly",x[x.BackwardsOnly=3]="BackwardsOnly",x))(ji||{});class ze extends ai{BS;zS;P;XS;constructor(t){super(),this.name="Linking",this.BS={},this.zS=null,this.P=1,this.XS=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.BS}set archetypeLinkData(t){t!==null&&y.xc(t,ze,"archetypeLinkData"),this.BS=t}get archetypeLabelNodeData(){return this.zS}set archetypeLabelNodeData(t){t!==null&&y.xc(t,ze,"archetypeLabelNodeData"),this.zS=t}get direction(){return this.P}set direction(t){this.P=t}get startObject(){return this.XS}set startObject(t){this.XS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Ax()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let e=this.startObject;if(e===null&&(e=t.findObjectAt(t.firstInput.documentPoint,null,null)),e===null)return null;const i=e.part;if(!(i instanceof W))return null;const s=this.direction;if(s===1||s===2){const n=this.findValidLinkablePort(e,!1);if(n!==null)return this.isForwards=!0,n;if(this.startObject===i){const o=i.port;if(this.findValidLinkablePort(o,!1))return this.isForwards=!0,o}}if(s===1||s===3){const n=this.findValidLinkablePort(e,!0);if(n!==null)return this.isForwards=!1,n;if(this.startObject===i){const o=i.port;if(this.findValidLinkablePort(o,!0))return this.isForwards=!1,o}}return null}doActivate(){const t=this.diagram,e=this.findLinkablePort();if(e===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=e;const i=this.originalFromPort.part;i instanceof W&&(this.originalFromNode=i),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=e;const i=this.originalToPort.part;i instanceof W&&(this.originalToNode=i),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let e=null,i=null,s=null,n=null,o=null;try{this.targetPort=this.findTargetPort(this.isForwards);const r=this.targetPort;if(r!==null){const a=r.part;a instanceof W&&(this.isForwards?(this.originalFromNode!==null&&(e=this.originalFromNode,i=this.originalFromPort),s=a,n=r):(e=a,i=r,this.originalToNode!==null&&(s=this.originalToNode,n=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(e=this.originalFromNode,i=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(s=this.originalToNode,n=this.originalToPort);e!==null||s!==null?(o=this.insertLink(e,i,s,n),o!==null?(r===null&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),o.isSelected=!0),this.transactionResult=this.name,t.T("LinkDrawn",o)):this.doNoLink(e,i,s,n)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),o&&t.allowSelect&&t.T("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof U)return t.isTreeLink;const e=this.diagram;if(e===null)return!0;const i=e.partManager.getLinkCategoryForData(t),s=e.partManager.findLinkTemplateForCategory(i);return s!==null?s.isTreeLink:!0}insertLink(t,e,i,s){return this.diagram.partManager.insertLink(t,e,i,s)}doNoLink(t,e,i,s){}}class De extends ai{NA=null;CA=null;GS=null;YS=null;Ss;KS;constructor(t){super(),this.name="Relinking",this.fromHandleArchetype=new et("Diamond",{desiredSize:st.Su,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new et("Diamond",{desiredSize:st.Su,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.KS=new I,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof U))return;let e="RelinkFrom",i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;s!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(e),i===null&&(i=this.makeAdornment(s,!1),t.addAdornment(e,i)))}if(i===null&&t.removeAdornment(e),e="RelinkTo",i=null,t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;s!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(e),i===null?(i=this.makeAdornment(s,!0),t.addAdornment(e,i)):i.c())}i===null&&t.removeAdornment(e)}makeAdornment(t,e){let i=e?this.YS:this.GS;return i&&(i=i.copy(),i.adornedObject=t),i}get fromHandleArchetype(){return this.NA}set fromHandleArchetype(t){t!==null&&y.se(t,tt,De,"fromHandleArchetype"),this.NA=t,t!==null?this.GS=new pt(j.Link).add(t).It():this.GS=null}get toHandleArchetype(){return this.CA}set toHandleArchetype(t){t!==null&&y.se(t,tt,De,"toHandleArchetype"),this.CA=t,t!==null?this.YS=new pt(j.Link).add(t).It():this.YS=null}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof pt||y.o("new handle is not in an Adornment: "+t)),this.Ss=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Ax()||!t.lastInput.left)return!1;let e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return e===null&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),e!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let i=this.handle;if(i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),i===null)return;const s=i.part;if(!(s instanceof pt)||!(s.adornedPart instanceof U))return;this.handle=i,this.isForwards=s===null||s.category==="RelinkTo",this.originalLink=s.adornedPart}const e=this.originalLink;e!==null&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=e.fromPort,this.originalFromNode=e.fromNode,this.originalToPort=e.toPort,this.originalToNode=e.toNode,this.KS.set(e.actualBounds),e.pointsCount>0&&(e.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=st.bc),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=e.getPoint(0))),e.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=st.bc),this.temporaryToNode!==null&&(this.temporaryToNode.location=e.getPoint(e.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(e,this.temporaryLink),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,e){if(t===null||e===null)return;e.adjusting=t.adjusting,e.corner=t.corner;let i=t.curve;(i===11||i===10)&&(i=0),e.curve=i,e.curviness=t.curviness,e.isTreeLink=t.isTreeLink,e.points=t.points,e.routing=t.routing,e.smoothness=t.smoothness,e.fromSpot=t.fromSpot,e.fromEndSegmentLength=t.fromEndSegmentLength,e.fromShortLength=t.fromShortLength,e.toSpot=t.toSpot,e.toEndSegmentLength=t.toEndSegmentLength,e.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let e=this.originalFromNode,i=this.originalFromPort,s=this.originalToNode,n=this.originalToPort,o=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const r=this.targetPort.part;r instanceof W&&(this.isForwards?(s=r,n=this.targetPort):(e=r,i=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(s=null,n=null):(e=null,i=null):o=null;o!==null?(this.reconnectLink(o,this.isForwards?s:e,this.isForwards?n:i,this.isForwards),this.targetPort===null&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint,o.$t()),this.transactionResult=this.name,t.T("LinkRelinked",o,this.isForwards?this.originalToPort:this.originalFromPort)):this.originalLink!==null&&this.doNoRelink(this.originalLink,this.isForwards),this.originalLink!==null&&this.originalLink.invalidateOtherJumpOvers(this.KS)}finally{this.stopTool()}}}reconnectLink(t,e,i,s){const n=i!==null&&i.portId!==null?i.portId:"";return s?(t.toNode=e,t.toPortId=n):(t.fromNode=e,t.fromPortId=n),!0}doNoRelink(t,e){}doDraggingMouseMove(t,e,i,s){t!==null?(this.copyPortProperties(t,e,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),i!==null?(this.copyPortProperties(i,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var Gi=(x=>(x[x.None=0]="None",x[x.Horizontal=1]="Horizontal",x[x.Vertical=2]="Vertical",x[x.All=3]="All",x))(Gi||{});class qi extends qt{Mr;HS;jS;Ss;Tx;qS;Bm;constructor(t){super(),this.name="LinkReshaping",this.Mr=new et("Rectangle",{desiredSize:st.RL,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HS=new et("Diamond",{desiredSize:st.Su,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.jS=3,this.Ss=null,this.Tx=null,this.qS=new P,this.Bm=new J,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.Nr:0}setReshapingBehavior(t,e){t.Nr=e}updateAdornments(t){if(t===null||!(t instanceof U))return;let e=null;if(t.isSelected&&!this.diagram.isReadOnly){const i=t.path;i!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&(e=t.findAdornment(this.name),(e===null||e.WS!==t.pointsCount||e.JS!==t.resegmentable)&&(e=this.makeAdornment(i),e!==null&&(e.WS=t.pointsCount,e.JS=t.resegmentable,t.addAdornment(this.name,e))))}e===null&&t.removeAdornment(this.name)}makeAdornment(t){const e=t.part,i=e.points,s=e.pointsCount,n=e.isOrthogonal;let o=null;if(i!==null&&s>1){o=new pt,o.type=j.Link;const r=e.firstPickIndex,a=e.lastPickIndex,l=n?1:0;if(e.resegmentable&&e.computeCurve()!==9)for(let h=r+l;h<a-l;h++){const u=this.makeResegmentHandle(t,h);u!==null&&(u.segmentIndex=h,u.segmentFraction=.5,u.fromMaxLinks=999,o.add(u))}for(let h=r+1;h<a;h++){const u=this.makeHandle(t,h);if(u!==null){if(u.segmentIndex=h,h!==r)if(h===r+1&&n){const c=e.getPoint(r);let d=e.getPoint(r+1);L.u(c.x,d.x)&&L.u(c.y,d.y)?(d=e.getPoint(r-1),L.u(c.x,d.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(c.y,d.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")):L.u(c.x,d.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(c.y,d.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")}else if(h===a-1&&n){let c=e.getPoint(a-1);const d=e.getPoint(a);L.u(c.x,d.x)&&L.u(c.y,d.y)?(c=e.getPoint(a+1),L.u(c.x,d.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(c.y,d.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")):L.u(c.x,d.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):L.u(c.y,d.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")}else h===a||(this.setReshapingBehavior(u,3),u.cursor="move");o.add(u)}}o.adornedObject=t}return o}makeHandle(t,e){const i=this.handleArchetype;return i===null?null:i.copy().$S()}get handleArchetype(){return this.Mr}set handleArchetype(t){this.Mr=t}makeResegmentHandle(t,e){const i=this.midHandleArchetype;return i===null?null:i.copy().$S()}get midHandleArchetype(){return this.HS}set midHandleArchetype(t){this.HS=t}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof pt||y.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedLink(){return this.Tx}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const e=this.handle.part.adornedPart;if(e instanceof U){if(this.Tx=e,t.isMouseCaptured=!0,this.startTransaction(this.name),e.resegmentable&&this.handle.fromMaxLinks===999){const i=e.points.copy(),s=this.getResegmentingPoint();if(i.insertAt(this.handle.segmentIndex+1,s),e.isOrthogonal&&i.insertAt(this.handle.segmentIndex+1,s),e.points=i,e.invalidateAdornments(),e.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.qS=e.getPoint(this.handle.segmentIndex),this.Bm=e.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Tx=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.Bm),this.stopTool()}getResegmentingPoint(){return this.handle===null?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(T.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e)}}doMouseUp(){const t=this.diagram;if(this.isActive){const e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e);const i=this.adornedLink;if(i!==null&&i.resegmentable&&this.handle!==null){const s=this.handle.segmentIndex,n=i.getPoint(s-1),o=i.getPoint(s),r=i.getPoint(s+1);if(i.isOrthogonal){if(s>i.firstPickIndex+1&&s<i.lastPickIndex-1){let a=i.getPoint(s-2);if(this.isWithinResegmentingDistance(n,o)&&(this.isInLineOrtho(a,n,o,r,!0)||this.isInLineOrtho(a,n,o,r,!1))){const l=i.points.copy();this.isInLineOrtho(a,n,o,r,!0)?(l.setElt(s-2,new P(a.x,(r.y+a.y)/2)),l.setElt(s+1,new P(r.x,(r.y+a.y)/2))):(l.setElt(s-2,new P((r.x+a.x)/2,a.y)),l.setElt(s+1,new P((r.x+a.x)/2,r.y))),l.removeAt(s),l.removeAt(s-1),i.points=l,i.invalidateAdornments()}else if(a=i.getPoint(s+2),this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(n,o,r,a,!0)||this.isInLineOrtho(n,o,r,a,!1))){const l=i.points.copy();this.isInLineOrtho(n,o,r,a,!0)?(l.setElt(s-1,new P(n.x,(n.y+a.y)/2)),l.setElt(s+2,new P(a.x,(n.y+a.y)/2))):(l.setElt(s-1,new P((n.x+a.x)/2,n.y)),l.setElt(s+2,new P((n.x+a.x)/2,a.y))),l.removeAt(s+1),l.removeAt(s),i.points=l,i.invalidateAdornments()}}}else{const a=P.l();if(L.Nl(n.x,n.y,r.x,r.y,o.x,o.y,a)&&a.distanceSquaredPoint(o)<this.resegmentingDistance*this.resegmentingDistance){const l=i.points.copy();l.removeAt(s),i.points=l,i.invalidateAdornments()}P.i(a)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("LinkReshaped",this.adornedLink,this.Bm)}this.stopTool()}isWithinResegmentingDistance(t,e){return Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(t.y-e.y)<this.resegmentingDistance}isInLineOrtho(t,e,i,s,n){return n?Math.abs(t.y-e.y)<this.resegmentingDistance&&Math.abs(e.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance:Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(e.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance}get resegmentingDistance(){return this.jS}set resegmentingDistance(t){this.jS=t}reshape(t){const e=this.adornedLink;if(e===null)return;const i=this.handle;if(i===null)return;e.startRoute();let s=i.segmentIndex;const n=this.getReshapingBehavior(i);if(e.isOrthogonal)if(s===e.firstPickIndex+1){const o=e.firstPickIndex+1;n===2?(e.setPointAt(o,e.getPoint(o-1).x,t.y),e.setPointAt(o+1,e.getPoint(o+2).x,t.y)):n===1&&(e.setPointAt(o,t.x,e.getPoint(o-1).y),e.setPointAt(o+1,t.x,e.getPoint(o+2).y))}else if(s===e.lastPickIndex-1){const o=e.lastPickIndex-1;n===2?(e.setPointAt(o-1,e.getPoint(o-2).x,t.y),e.setPointAt(o,e.getPoint(o+1).x,t.y)):n===1&&(e.setPointAt(o-1,t.x,e.getPoint(o-2).y),e.setPointAt(o,t.x,e.getPoint(o+1).y))}else{let o=s;const r=e.getPoint(o);if(!t.equalsApprox(r)){const a=e.getPoint(o-2),l=e.getPoint(o-1),h=e.getPoint(o+1),u=e.getPoint(o+2);L.u(r.x,h.x)&&L.u(h.y,u.y)?e.setPointAt(o+1,t.x,h.y):L.u(r.y,h.y)&&L.u(h.x,u.x)&&e.setPointAt(o+1,h.x,t.y),L.u(r.x,l.x)&&L.u(l.y,a.y)?e.setPointAt(o-1,t.x,l.y):L.u(r.y,l.y)&&L.u(l.x,a.x)&&e.setPointAt(o-1,l.x,t.y)}e.setPointAt(s,t.x,t.y)}else{e.setPointAt(s,t.x,t.y);let o=e.fromNode,r=e.fromPort;if(o!==null){const h=o.findVisibleNode();h!==null&&h!==o&&(o=h,r=o.port)}if(s===1&&r!==null&&e.computeSpot(!0,r).isNoSpot()){const h=r.getDocumentPoint(T.Center,P.l()),u=e.getLinkPointFromPoint(o,r,h,t,!0,P.l());e.setPointAt(0,u.x,u.y),P.i(h),P.i(u)}let a=e.toNode,l=e.toPort;if(a!==null){const h=a.findVisibleNode();h!==null&&h!==a&&(a=h,l=a.port)}if(s===e.pointsCount-2&&l!==null&&e.computeSpot(!1,l).isNoSpot()){const h=l.getDocumentPoint(T.Center,P.l()),u=e.getLinkPointFromPoint(a,l,h,t,!1,P.l());e.setPointAt(e.pointsCount-1,u.x,u.y),P.i(h),P.i(u)}}e.commitRoute()}computeReshape(t){const e=this.adornedLink;if(e===null)return t;const i=this.handle;if(i===null)return t;const s=i.segmentIndex;switch(this.getReshapingBehavior(i)){case 3:return t;case 2:{const n=e.getPoint(s);return new P(n.x,t.y)}case 1:{const n=e.getPoint(s);return new P(t.x,n.y)}default:case 0:return e.getPoint(s)}}get originalPoint(){return this.qS}get originalPoints(){return this.Bm}}class Hi extends qt{Cr;Lr;Oo;Oc;ZS;Ms;Mr;Ss;zm;QS;Ic;Dx;vx;Fx;constructor(t){super(),this.name="Resizing",this.Cr=new st(1,1).k(),this.Lr=new st(9999,9999).k(),this.Oo=new st(NaN,NaN).k(),this.Oc=!1,this.ZS=!0,this.Ms=null,this.Mr=new et("Rectangle",{alignmentFocus:T.Center,desiredSize:st.RL,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.zm=new P,this.QS=new st,this.Ic=new P,this.Dx=new st(0,0),this.vx=new st(1/0,1/0),this.Fx=new st(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Ar()){const e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const e=t.resizeObject;let i=t.findAdornment(this.name);if(e!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()&&((i===null||i.adornedObject!==e)&&(i=this.makeAdornment(e)),i!==null)){const s=e.getDocumentAngle();t.Ul()&&this.updateResizeHandles(i,s),t.addAdornment(this.name,i);return}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null;const i=t.part?.resizeAdornmentTemplate;if(i){if(e=i.copy(),e===null)return null}else{e=new pt,e.type=j.Spot,e.locationSpot=T.Center;const s=new Jt;s.isPanelMain=!0,e.add(s);let n=this.makeHandle(t,T.TopLeft);n!==null&&e.add(n),n=this.makeHandle(t,T.TopRight),n!==null&&e.add(n),n=this.makeHandle(t,T.BottomRight),n!==null&&e.add(n),n=this.makeHandle(t,T.BottomLeft),n!==null&&e.add(n),n=this.makeHandle(t,T.MiddleTop),n!==null&&e.add(n),n=this.makeHandle(t,T.MiddleRight),n!==null&&e.add(n),n=this.makeHandle(t,T.MiddleBottom),n!==null&&e.add(n),n=this.makeHandle(t,T.MiddleLeft),n!==null&&e.add(n)}return e.adornedObject=t,e}makeHandle(t,e){const i=this.handleArchetype;if(i===null)return null;const s=i.copy().$S();return s.alignment=e,s}updateResizeHandles(t,e){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.wR(t,e);else if(t instanceof j){const i=t.elements;for(;i.next();){const s=i.value;this.updateResizeHandles(s,e)}}}}wR(t,e){let i=t.alignment;i.isNoSpot()&&(i=T.Center);let s=e;if(i.x<=0)i.y<=0?s+=225:i.y>=1?s+=135:s+=180;else if(i.x>=1)i.y<=0?s+=315:i.y>=1&&(s+=45);else if(i.y<=0)s+=270;else if(i.y>=1)s+=90;else return;s=L.Ee(s),s<22.5?t.cursor="e-resize":s<67.5?t.cursor="se-resize":s<112.5?t.cursor="s-resize":s<157.5?t.cursor="sw-resize":s<202.5?t.cursor="w-resize":s<247.5?t.cursor="nw-resize":s<292.5?t.cursor="n-resize":s<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.Mr}set handleArchetype(t){this.Mr=t}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof pt||y.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){t!==null&&t.part instanceof pt&&y.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&this.adornedObject.part!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.Iu=!0,this.startTransaction(this.name),this.zm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Ic.set(this.adornedObject.part.location),this.QS.set(this.adornedObject.desiredSize),this.Fx=this.computeCellSize(),this.Dx=this.computeMinSize(),this.vx=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.Iu=!1,t.Fl=!0,this.stopTransaction(),this.handle=null,this.Ms=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){this.adornedObject!==null&&this.adornedObject.part!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive||this.adornedObject===null||this.handle===null)return;const e=this.Dx,i=this.vx,s=this.Fx,n=t.lastInput.documentPoint,o=this.adornedObject.getLocalPoint(n,P.l()),r=this.computeReshape(),a=this.computeResize(o,this.handle.alignment,e,i,s,r);this.resize(a),t.maybeUpdate(),P.i(o)}doMouseUp(){const t=this.diagram;if(this.isActive&&this.adornedObject!==null&&this.handle!==null){const e=this.Dx,i=this.vx,s=this.Fx,n=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,P.l()),o=this.computeReshape(),r=this.computeResize(n,this.handle.alignment,e,i,s,o);this.resize(r),P.i(n),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const e=this.diagram,i=this.adornedObject;if(i===null)return;i.desiredSize=t.size;const s=i.part;if(s===null||this.handle===null)return;s.ensureBounds();const n=i.getDocumentPoint(this.handle.alignment.opposite());if(s instanceof at){const o=new J;o.add(s);let r;!this.dragsMembers&&!s.hasPlaceholder()&&(r=new Ze,r.dragsMembers=!1),e.moveParts(o,this.oppositePoint.copy().subtract(n),!0,r)}else s.location=s.location.copy().subtract(n).add(this.oppositePoint);e.maybeUpdate()}computeResize(t,e,i,s,n,o){if(this.adornedObject===null)return I.em;e.isNoSpot()&&(e=T.Center);const r=this.adornedObject.naturalBounds,a=r.x,l=r.y,h=r.x+r.width,u=r.y+r.height;let c=1;if(!o){let m=r.width,g=r.height;m<=0&&(m=1),g<=0&&(g=1),c=g/m}const d=P.l();L.tm(t.x,t.y,a,l,n.width,n.height,d);const f=r.copy();return e.x<=0?e.y<=0?(f.x=Math.max(d.x,h-s.width),f.x=Math.min(f.x,h-i.width),f.width=Math.max(h-f.x,i.width),f.y=Math.max(d.y,u-s.height),f.y=Math.min(f.y,u-i.height),f.height=Math.max(u-f.y,i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(c*f.width,s.height),i.height),f.width=f.height/c):(f.width=Math.max(Math.min(f.height/c,s.width),i.width),f.height=c*f.width),f.x=h-f.width,f.y=u-f.height)):e.y>=1?(f.x=Math.max(d.x,h-s.width),f.x=Math.min(f.x,h-i.width),f.width=Math.max(h-f.x,i.width),f.height=Math.max(Math.min(d.y-l,s.height),i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(c*f.width,s.height),i.height),f.width=f.height/c):(f.width=Math.max(Math.min(f.height/c,s.width),i.width),f.height=c*f.width),f.x=h-f.width)):(f.x=Math.max(d.x,h-s.width),f.x=Math.min(f.x,h-i.width),f.width=h-f.x,o||(f.height=Math.max(Math.min(c*f.width,s.height),i.height),f.width=f.height/c,f.y=l+.5*(u-l-f.height))):e.x>=1?e.y<=0?(f.width=Math.max(Math.min(d.x-a,s.width),i.width),f.y=Math.max(d.y,u-s.height),f.y=Math.min(f.y,u-i.height),f.height=Math.max(u-f.y,i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(c*f.width,s.height),i.height),f.width=f.height/c):(f.width=Math.max(Math.min(f.height/c,s.width),i.width),f.height=c*f.width),f.y=u-f.height)):e.y>=1?(f.width=Math.max(Math.min(d.x-a,s.width),i.width),f.height=Math.max(Math.min(d.y-l,s.height),i.height),o||(f.height/f.width>=1?(f.height=Math.max(Math.min(c*f.width,s.height),i.height),f.width=f.height/c):(f.width=Math.max(Math.min(f.height/c,s.width),i.width),f.height=c*f.width))):(f.width=Math.max(Math.min(d.x-a,s.width),i.width),o||(f.height=Math.max(Math.min(c*f.width,s.height),i.height),f.width=f.height/c,f.y=l+.5*(u-l-f.height))):e.y<=0?(f.y=Math.max(d.y,u-s.height),f.y=Math.min(f.y,u-i.height),f.height=u-f.y,o||(f.width=Math.max(Math.min(f.height/c,s.width),i.width),f.height=c*f.width,f.x=a+.5*(h-a-f.width))):e.y>=1&&(f.height=Math.max(Math.min(d.y-l,s.height),i.height),o||(f.width=Math.max(Math.min(f.height/c,s.width),i.width),f.height=c*f.width,f.x=a+.5*(h-a-f.width))),P.i(d),f}computeReshape(){let t=0;return this.adornedObject instanceof et&&(t=this.adornedObject._S()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){if(this.adornedObject===null)return st.bc;const t=this.adornedObject.minSize.copy(),e=this.minSize;return!isNaN(e.width)&&e.width>t.width&&(t.width=e.width),!isNaN(e.height)&&e.height>t.height&&(t.height=e.height),t}computeMaxSize(){if(this.adornedObject===null)return st.DP;const t=this.adornedObject.maxSize.copy(),e=this.maxSize;return!isNaN(e.width)&&e.width<t.width&&(t.width=e.width),!isNaN(e.height)&&e.height<t.height&&(t.height=e.height),t}computeCellSize(){const t=new st(NaN,NaN),e=this.adornedObject?.part;if(e){const n=e.resizeCellSize;!isNaN(n.width)&&n.width>0&&(t.width=n.width),!isNaN(n.height)&&n.height>0&&(t.height=n.height)}let i=this.cellSize;isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height);const s=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&s){const n=s.grid;n!==null&&n.visible&&this.isGridSnapEnabled&&(i=n.gridCellSize,isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.Cr}set minSize(t){if(!this.Cr.equals(t)){let e=t.width;isNaN(e)&&(e=0);let i=t.height;isNaN(i)&&(i=0),this.Cr.e(e,i)}}get maxSize(){return this.Lr}set maxSize(t){if(!this.Lr.equals(t)){let e=t.width;isNaN(e)&&(e=1/0);let i=t.height;isNaN(i)&&(i=1/0),this.Lr.e(e,i)}}get cellSize(){return this.Oo}set cellSize(t){this.Oo.equals(t)||this.Oo.h(t)}get isGridSnapEnabled(){return this.Oc}set isGridSnapEnabled(t){this.Oc=t}get dragsMembers(){return this.ZS}set dragsMembers(t){this.ZS=t}get oppositePoint(){return this.zm}set oppositePoint(t){this.zm.equals(t)||this.zm.h(t)}get originalDesiredSize(){return this.QS}get originalLocation(){return this.Ic}}class Wi extends qt{tM;eM;Ms=null;Mr=null;Rx=null;Ss=null;iM;Xm;Ic;sM;nM;constructor(t){super(),this.name="Rotating",this.tM=45,this.eM=2,this.Ic=new P,this.Ms=null,this.handleArchetype=new et("Ellipse",{desiredSize:st.Su,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.iM=0,this.Xm=new P(NaN,NaN),this.sM=0,this.nM=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Ar()){const e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const e=t.rotateObject;if(e!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()){let i=t.findAdornment(this.name);if((i===null||i.adornedObject!==e)&&(i=this.makeAdornment(e)),i!==null){i.angle=e.getDocumentAngle(),i.hasPlaceholder()||(i.location=this.computeAdornmentLocation(e)),t.addAdornment(this.name,i);return}}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null;const i=t.part?.rotateAdornmentTemplate;return i?e=i.copy():this.Rx!==null&&(e=this.Rx.copy()),e===null?null:(e.adornedObject=t,e)}get handleArchetype(){return this.Mr}set handleArchetype(t){this.Mr=t,t!==null?this.Rx=new pt(j.Position,{locationSpot:T.Center}).add(t).It():this.Rx=null}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof pt||y.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){t!==null&&t.part instanceof pt&&y.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject===null||this.adornedObject.part===null||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.iM=this.adornedObject.angle,this.Xm=this.computeRotationPoint(this.adornedObject),this.Ic=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const e=t.part;if(e!==null){const i=e.locationObject;if(e.rotationSpot.isSpot())return t.getDocumentPoint(e.rotationSpot);if(t===e||t===i)return i.getDocumentPoint(e.locationSpot)}return t.getDocumentPoint(T.Center)}computeAdornmentLocation(t){let e=this.rotationPoint;e.isReal()||(e=this.computeRotationPoint(t));const i=t.getLocalPoint(e);let s=this.handleAngle;s=L.Ee(s),s=Math.round(Math.round(s/45)*45);const n=this.handleDistance;return s===0?i.x=t.naturalBounds.width+n:s===45?(i.x=t.naturalBounds.width+n,i.y=t.naturalBounds.height+n):s===90?i.y=t.naturalBounds.height+n:s===135?(i.x=-n,i.y=t.naturalBounds.height+n):s===180?i.x=-n:s===225?(i.x=-n,i.y=-n):s===270?i.y=-n:s===315&&(i.x=t.naturalBounds.width+n,i.y=-n),t.getDocumentPoint(i)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.Ms=null,this.Xm=new P(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const e=this.adornedObject;if(e===null||e.part===null)return;e.angle=t;const i=e.part;i.ensureBounds();const s=i.locationObject,n=i.rotateObject;if(s===n||s.isContainedBy(n)){const o=this.Ic.copy();i.location=o.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){let e=this.rotationPoint.directionPoint(t)-this.handleAngle;const i=this.adornedObject?.panel;i&&(e-=i.getDocumentAngle()),e=L.Ee(e);const s=Math.min(Math.abs(this.snapAngleMultiple),180),n=Math.min(Math.abs(this.snapAngleEpsilon),s/2);return!this.diagram.lastInput.shift&&s>0&&n>0&&(e%s<n?e=Math.floor(e/s)*s:e%s>s-n&&(e=(Math.floor(e/s)+1)*s)),L.Ee(e)}get snapAngleMultiple(){return this.tM}set snapAngleMultiple(t){this.tM=t}get snapAngleEpsilon(){return this.eM}set snapAngleEpsilon(t){this.eM=t}get originalAngle(){return this.iM}get rotationPoint(){return this.Xm}set rotationPoint(t){this.Xm=t.copy()}get handleAngle(){return this.sM}set handleAngle(t){this.sM=t}get handleDistance(){return this.nM}set handleDistance(t){this.nM=t}}class Ji extends qt{constructor(t){super(),this.name="ClickSelecting",t&&Object.assign(this,t)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class $i extends qt{Ec;constructor(t){super(),this.name="Action",this.Ec=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,e=t.lastInput,i=t.findObjectAt(e.documentPoint,s=>{for(;s.panel!==null;){if(s.isActionable)return s;s=s.panel}return s});return i!==null&&i.isActionable?(this.Ec=i,t.vc=t.findObjectAt(e.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const t=this.diagram.lastInput,e=this.Ec;if(e===null)return;t.targetObject=e,e.actionDown!==null&&e.actionDown(t,e)}}doMouseMove(){if(this.isActive){const t=this.diagram.lastInput,e=this.Ec;if(e===null)return;t.targetObject=e,e.actionMove!==null&&e.actionMove(t,e)}}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,e=this.Ec;if(e===null)return;t.targetObject=e,e.actionUp!==null&&e.actionUp(t,e),this.standardMouseClick(i=>{for(;i.panel!==null;){if(i.isActionable&&i===e)return i;i=i.panel}return i},i=>i===e)}this.stopTool()}doCancel(){const t=this.diagram.lastInput,e=this.Ec;e!==null&&(t.targetObject=e,e.actionCancel!==null&&e.actionCancel(t,e),this.stopTool())}doStop(){this.Ec=null}}class $e extends qt{Vl;oM;Oc;rM;constructor(t){super(),this.name="ClickCreating",this.Vl=null,this.oM=!0,this.Oc=!1,this.rM=new P(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.rM=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.rM))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const e=this.diagram,i=this.archetypeNodeData;if(i===null)return null;let s=null;try{if(e.T("ChangingSelection",e.selection),this.startTransaction(this.name),i instanceof ft)i.Di()&&(i.It(),s=i.copy(),s!==null&&e.add(s));else if(i!==null){const n=e.model.copyNodeData(i);e.model.addNodeData(n),s=e.findPartForData(n)}if(s!==null){const n=P.z(t.x,t.y);this.isGridSnapEnabled&&this.diagram.lM(s,t,n),s.location=n,e.allowSelect&&(e.clearSelection(!0),s.isSelected=!0),P.i(n)}e.invalidateDocumentBounds(),this.transactionResult=this.name,e.T("PartCreated",s)}finally{this.stopTransaction(),e.T("ChangedSelection",e.selection)}return s}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){t!==null&&y.xc(t,$e,"archetypeNodeData"),this.Vl=t}get isDoubleClick(){return this.oM}set isDoubleClick(t){this.oM=t}get isGridSnapEnabled(){return this.Oc}set isGridSnapEnabled(t){this.Oc=t}}class Zi extends qt{th;aM;Bl;constructor(t){super(),this.name="DragSelecting",this.th=175,this.aM=!1,this.Bl=new ft({layerName:"Tool",selectable:!1}).add(new et("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).It(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const e=t.lastInput;return!(!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(e.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const e=this.computeBoxBounds();let i=this.box.findObject("SHAPE");i===null&&(i=this.box.findMainElement());const s=st.l().e(e.width,e.height);i!==null&&(i.desiredSize=s),this.box.Uc(e.x,e.y,!1),st.i(s),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.T("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new I(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const e=this.diagram,i=e.lastInput,s=e.findPartsIn(t,this.isPartialInclusion);if(y.ur?i.meta:i.control)if(i.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected&&(o.isSelected=!1)}}else{const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected=!o.isSelected}}else if(i.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected||(o.isSelected=!0)}}else{const n=new J,o=e.selection.iterator;for(;o.next();){const l=o.value;s.has(l)||n.add(l)}const r=n.iterator;for(;r.next();){const l=r.value;l.isSelected=!1}const a=s.iterator;for(;a.next();){const l=a.value;l.isSelected||(l.isSelected=!0)}}}get delay(){return this.th}set delay(t){this.th=t}get isPartialInclusion(){return this.aM}set isPartialInclusion(t){this.aM=t}get box(){return this.Bl}set box(t){t!==null&&t.It(),this.Bl=t}}class Qi extends qt{Ox;LA;Ro;hM;constructor(t){super(),this.name="Panning",this.Ox=new P,this.LA=new P,this.Ro=!1;const e=this;this.hM=()=>{const i=e.diagram;i!==null&&i.Le(H.document,"scroll",e.hM,!1),e.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.Ro?(t.lastInput.bubbles=!0,t.Et(H.document,"scroll",this.hM,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.Ox.h(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.Ox,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.AA()}doMouseUp(){this.AA(),this.stopTool()}AA(){const t=this.diagram;if(this.isActive&&t){if(this.Ro){t.lastInput.bubbles=!0;return}const e=t.position,i=t.firstInput.documentPoint,s=t.lastInput.documentPoint;let n=e.x+i.x-s.x,o=e.y+i.y-s.y;t.allowHorizontalScroll||(n=e.x),t.allowVerticalScroll||(o=e.y),t.position=this.LA.e(n,o)}}get bubbles(){return this.Ro}set bubbles(t){this.Ro=t}get originalPosition(){return this.Ox}}class ye{Ix;Ex;cM;fM;constructor(t){this.Ix=null,this.Ex=null,this.cM=null,this.fM=null,t&&Object.assign(this,t)}get mainElement(){return this.cM}set mainElement(t){this.cM=t}get show(){return this.Ix}set show(t){this.Ix!==t&&(this.Ix=t)}get hide(){return this.Ex}set hide(t){this.Ex!==t&&(this.Ex=t)}get valueFunction(){return this.fM}set valueFunction(t){this.fM=t}}class Qt{ue;Ux;Vc;constructor(t,e,i){this.ue=t,this.Ux=e,this.Vc=i}}class At extends qt{uM;Vx;dM;gM;Bx;zx;Gm;constructor(t){super(),this.name="ContextMenu",this.uM=null,this.Vx=null,this.dM=null,this.gM=new P,this.Bx=null,this.Gm=!1;const e=this;this.zx=()=>e.stopTool(),t&&Object.assign(this,t)}xR(){const t=new ye;t.show=(r,a,l)=>l.showDefaultContextMenu(),t.hide=(r,a)=>a.hideDefaultContextMenu(),At.Bu=t;const e=this;this.zx=()=>e.stopTool();const i=y.Ni("div"),s=y.Ni("div");i.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",s.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const n=y.Ni("style");H.document.getElementsByTagName("head")[0].appendChild(n),n.sheet.insertRule(".goCXul { list-style: none; }",0),n.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),n.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const o=this.diagram;o!==null&&(o.Et(i,"contextmenu",At.oh,!1),o.Et(i,"selectstart",At.oh,!1),o.Et(s,"contextmenu",At.oh,!1)),i.className="goCXforeground",s.className="goCXbackground",H.document.body&&(H.document.body.appendChild(i),H.document.body.appendChild(s)),At.Ym=i,At.Km=s,At.mM=!0}static Bu=null;static mM=!1;static Km;static Ym;static oh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.gM.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Gm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const e=this.diagram,i=e.lastInput;let s=null;if(t instanceof X||(t instanceof tt?s=t:s=e.findObjectAt(i.documentPoint,null,n=>!n.layer?.isTemporary)),s!==null){let n=s;for(;n!==null;){if(n.contextMenu!==null)return n;n=n.panel}if(e.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return s.part}else if(e.contextMenu!==null)return e;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof pt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof pt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const e=this.currentContextMenu;if(e===null)return;let i=null;e instanceof ye||(i=t.findObjectAt(t.lastInput.documentPoint,null,null),i!==null&&i.isContainedBy(e)&&this.standardMouseClick(null,null)),this.maybeStopTool(i)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,e){if(e===void 0&&(e=null),this.Gm)return;this.Gm=!0;let i=!1;if(e instanceof X){const s=this.diagram.lastInput;s.targetObject=null,i=this.oA(null,s,this.diagram)}else t&&this.standardMouseSelect(),i=this.standardMouseClick();if(this.Gm=!1,!i){this.isActive=!0;const s=At.Bu;if(e===null&&(e=this.findObjectWithContextMenu()),e!==null){const n=e.contextMenu;n!==null?(this.currentObject=e instanceof tt?e:null,this.showContextMenu(n,this.currentObject)):s!==null&&this.showContextMenu(s,this.currentObject)}else s!==null&&this.showContextMenu(s,null);this.currentContextMenu instanceof pt&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,e){const i=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof pt){const s=t;s.layerName="Tool",s.selectable=!1,s.scale=1/i.scale,s.category=this.name,s.hasPlaceholder()&&(s.placeholder.scale=i.scale);const n=s.diagram;n!==null&&n!==i&&n.remove(s),i.add(s),e!==null?s.adornedObject=e:s.data=i.model,s.ensureBounds(),this.positionContextMenu(s,e)}else t instanceof ye&&t.show!==null&&t.show(e,i,this);this.currentContextMenu=t}positionContextMenu(t,e){if(t.hasPlaceholder())return;const i=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=i.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+o.height>r.bottom&&(n.y-=o.height+5/s.scale),n.y<r.y&&(n.y=r.y),i.position=n}hideContextMenu(){const t=this.diagram,e=this.currentContextMenu;e!==null&&(e instanceof pt?(t.remove(e),this.Vx!==null&&this.Vx.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof ye&&(e.hide!==null?e.hide(t,this):e.mainElement!==null&&(e.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}bR(){const t=this,e=new J;return e.add(new Qt("Copy",i=>i.commandHandler.copySelection(),i=>i.commandHandler.canCopySelection())),e.add(new Qt("Cut",i=>i.commandHandler.cutSelection(),i=>i.commandHandler.canCutSelection())),e.add(new Qt("Delete",i=>i.commandHandler.deleteSelection(),i=>i.commandHandler.canDeleteSelection())),e.add(new Qt("Paste",i=>i.commandHandler.pasteSelection(t.mouseDownPoint),i=>i.commandHandler.canPasteSelection(t.mouseDownPoint))),e.add(new Qt("Select All",i=>i.commandHandler.selectAll(),i=>i.commandHandler.canSelectAll())),e.add(new Qt("Undo",i=>i.commandHandler.undo(),i=>i.commandHandler.canUndo())),e.add(new Qt("Redo",i=>i.commandHandler.redo(),i=>i.commandHandler.canRedo())),e.add(new Qt("Scroll To Part",i=>i.commandHandler.scrollToPart(),i=>i.commandHandler.canScrollToPart())),e.add(new Qt("Zoom To Fit",i=>i.commandHandler.zoomToFit(),i=>i.commandHandler.canZoomToFit())),e.add(new Qt("Reset Zoom",i=>i.commandHandler.resetZoom(),i=>i.commandHandler.canResetZoom())),e.add(new Qt("Group Selection",i=>i.commandHandler.groupSelection(),i=>i.commandHandler.canGroupSelection())),e.add(new Qt("Ungroup Selection",i=>i.commandHandler.ungroupSelection(),i=>i.commandHandler.canUngroupSelection())),e.add(new Qt("Edit Text",i=>i.commandHandler.editTextBlock(),i=>i.commandHandler.canEditTextBlock())),e}showDefaultContextMenu(){const t=this.diagram;this.Bx===null&&(this.Bx=this.bR()),At.Ym.innerHTML="",At.Km.addEventListener("pointerdown",this.zx,!1);const e=this,i=y.Ni("ul");i.className="goCXul",At.Ym.appendChild(i),i.innerHTML="";const s=this.Bx.iterator;for(;s.next();){const n=s.value,o=n.Ux,r=n.Vc;if(!y.st(o)||y.st(r)&&!r(t))continue;const a=y.Ni("li");a.className="goCXli";const l=y.Ni("a");l.className="goCXa",l.href="#",l.Ux=o,l.addEventListener("pointerdown",function(h){return this.Ux(t),e.stopTool(),h.preventDefault(),!1},!1),l.textContent=n.ue,a.appendChild(l),i.appendChild(a)}At.Ym.style.display="block",At.Km.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==At.Bu)return;At.Ym.style.display="none",At.Km.style.display="none";const t=this.diagram;t!==null&&t.Le(At.Km,"pointerdown",this.zx,!1),this.currentContextMenu=null}doMouseWheel(){this.standardMouseWheel()}get currentContextMenu(){return this.uM}set currentContextMenu(t){this.uM=t,this.Vx=t instanceof pt?t.adornedPart:null}get defaultTouchContextMenu(){return At.mM===!1&&At.Bu===null&&X.isUsingDOM()&&this.xR(),At.Bu}set defaultTouchContextMenu(t){t===null&&(At.mM=!0),At.Bu=t}get currentObject(){return this.dM}set currentObject(t){this.dM=t}get mouseDownPoint(){return this.gM}}var _i=(x=>(x[x.LostFocus=1]="LostFocus",x[x.MouseDown=2]="MouseDown",x[x.Tab=3]="Tab",x[x.Enter=4]="Enter",x))(_i||{}),ts=(x=>(x[x.SingleClick=1]="SingleClick",x[x.SingleClickSelected=2]="SingleClickSelected",x[x.DoubleClick=3]="DoubleClick",x))(ts||{}),es=(x=>(x[x.None=1]="None",x[x.Active=2]="Active",x[x.Editing=3]="Editing",x[x.Validating=4]="Validating",x[x.Invalid=5]="Invalid",x[x.Validated=6]="Validated",x))(es||{});class oe extends qt{vi;pM;yM;zl;Gt;wM;xM;bM;Xx;Gx;constructor(t){super(),this.name="TextEditing",this.vi=new lt,this.pM=null,this.yM=2,this.zl=null,this.Gt=1,this.wM=1,this.xM=!0,this.bM=null,this.Xx=new ye,this.Gx=null,this.kR(this.Xx),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;kR(t){if(!X.isUsingDOM())return;const e=y.Ni("textarea");this.Gx=e;const i=this;e.addEventListener("input",function(s){if(i.textBlock===null)return;const n=i.measureTemporaryTextBlock(this.value),o=this.textScale;this.style.width=20+Math.max(i.textBlock.measuredBounds.width,n.measuredBounds.width)*o+"px",this.rows=Math.max(i.textBlock.lineCount,n.lineCount)},!1),e.addEventListener("keydown",function(s){if(s.isComposing||i.textBlock===null)return;const n=s.key;if(n==="Enter"){i.textBlock.isMultiline===!1&&s.preventDefault(),i.acceptText(4);return}else if(n==="Tab"){i.acceptText(3),s.preventDefault();return}else n==="Escape"&&(i.doCancel(),i.diagram!==null&&i.diagram.doFocus())},!1),e.addEventListener("focus",function(s){i.PR(s)},!1),e.addEventListener("blur",function(s){i.SR(s)},!1),t.valueFunction=()=>e.value,t.mainElement=e,t.show=(s,n,o)=>{if(!(s instanceof lt)||!n||!n.div||!(o instanceof oe))return;if(o.state===5){e.style.border="3px solid red",e.focus();return}const r=s.getDocumentPoint(T.Center),a=n.position,l=n.scale;let h=s.getDocumentScale()*l;h<o.minimumEditorScale&&(h=o.minimumEditorScale);const u=s.naturalBounds.width*h+6,c=s.naturalBounds.height*h+2,d=(r.x-a.x)*l,f=(r.y-a.y)*l,m=s.verticalAlignment,g=(s.lineHeight+s.spacingAbove+s.spacingBelow)*s.lineCount*h,p=.5*c-.5*g,b=m.y*c-m.y*g+m.offsetY-p-g/2;e.value=s.text,n.div.style.font=s.font;const v=1;e.style.position="absolute",e.style.zIndex="100",e.style.font="inherit",e.style.fontSize=h*100+"%",e.style.lineHeight="normal",e.style.width=u+"px",e.style.left=(d-u/2|0)-v+"px",e.style.top=(f+b|0)-v+"px",e.style.textAlign=s.textAlign,e.style.margin="0",e.style.padding=v+"px",e.style.border="0",e.style.outline="none",e.style.whiteSpace="pre-wrap",e.style.overflow="hidden",e.rows=s.lineCount,e.textScale=h,e.className="goTXarea",n.div.appendChild(e),e.focus(),o.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))},t.hide=(s,n)=>{s.div&&s.div.removeChild(e)}}get textBlock(){return this.pM}set textBlock(t){this.pM=t}get currentTextEditor(){return this.bM}set currentTextEditor(t){this.bM=t}get defaultTextEditor(){return this.Xx}set defaultTextEditor(t){this.Xx=t}get starting(){return this.yM}set starting(t){this.yM=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||oe.Bc&&oe.Bc!==this&&(oe.Bc.acceptText(2),oe.Bc&&oe.Bc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const e=t.lastInput.documentPoint,i=t.findObjectAt(e);if(i===null||!(i instanceof lt)||!i.editable||i.part===null||!i.part.canEdit())return!1;const s=i.part;return!(s===null||this.starting===2&&!s.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){oe.Bc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let e=this.textBlock;if(e===null&&(e=t.findObjectAt(t.lastInput.documentPoint)),e===null||!(e instanceof lt)||(this.textBlock=e,e.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let i=this.defaultTextEditor;e.textEditor!==null&&(i=e.textEditor),this.vi=this.textBlock.copy();const s=new I(this.textBlock.getDocumentPoint(T.TopLeft),this.textBlock.getDocumentPoint(T.BottomRight));t.scrollToRect(s),i!==null&&i.show!==null&&i.show(e,t,this),this.currentTextEditor=i}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Gt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.TA());break;case 1:case 4:case 3:if(t===4&&this.textBlock!==null&&this.textBlock.isMultiline===!0)return;(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.TA());break}}TA(){const t=this.textBlock,e=this.diagram,i=this.currentTextEditor;if(t!==null&&i!==null){const s=t.text;let n="";if(i.valueFunction!==null&&(n=i.valueFunction()),!this.isValidText(t,s,n)){this.Gt=5,this.doError(s,n);return}this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=n,this.doSuccess(s,n),e!==null&&e.T("TextEdited",t,s),this.stopTransaction(),this.stopTool(),e!==null&&e.doFocus()}}doError(t,e){const i=this.textBlock;if(i===null)return;i.errorFunction!==null&&i.errorFunction(this,t,e);const s=this.currentTextEditor;s!==null&&s.show!==null&&s.show(i,this.diagram,this)}doSuccess(t,e){const i=this.textBlock;i!==null&&i.textEdited!==null&&i.textEdited(i,t,e)}doDeactivate(){const t=this.diagram;if(t!==null){if(this.Gt=1,this.currentTextEditor!==null){const e=this.currentTextEditor;e!==null&&e.hide!==null&&e.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){oe.Bc=null}PR(t){if(this.currentTextEditor===null||this.state===1)return;const e=this.Gx;this.Gt===2&&(this.Gt=3),y.st(e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}SR(t){if(this.currentTextEditor===null||this.state===1)return;const e=this.Gx;y.st(e.focus)&&e.focus(),y.st(e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}isValidText(t,e,i){const s=this.textValidation;if(s!==null&&!s(t,e,i))return!1;const n=t.textValidation;return!(n!==null&&!n(t,e,i))}get textValidation(){return this.zl}set textValidation(t){this.zl=t}get minimumEditorScale(){return this.wM}set minimumEditorScale(t){this.wM=t}get selectsTextOnActivate(){return this.xM}set selectsTextOnActivate(t){this.xM=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const e=this.vi;return e.text=t,this.textBlock!==null&&e.ht(this.textBlock.Xl,1/0),e}static Bc=null}var is=(x=>(x[x.Default=1]="Default",x[x.AnimateLocations=2]="AnimateLocations",x[x.None=3]="None",x))(is||{});class re{a;Ae;Be;Tr;_n;Io;kM;PM;Hm;Yx;ke;zc;bn;jm;lh;Kx;qm;Hx;Xc;Uu;Wm;constructor(t){this.a=X.Om(),this.Ae=!1,this.Hm=!1,this.Yx=!1,this.ke=!1,this.zc=!1,this.Hx=!0,this.Xc=1,this.Uu=!1,this.Be=!0,this.Tr=!0,this.Io=600,this.kM=!1,this.PM=!1,this._n=new K,this.bn=new ae,this.jm=new ae,this.bn.Ns=this,this.lh=new K,this.Kx=new K,this.qm=new K,this.Wm=new K,t&&Object.assign(this,t)}Eo(t){this.a=t}RU(){return this.a}canStart(t){return!0}Gl(t){return!this.Be||!this.canStart(t)?!1:(this._n.add(t),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.a.Te(),this.ke=!0,!0)}getBundleAnimation(){return this.jm}SM(){if(!this.Be||(this.jm.yi.count>0&&this.jm.start(),!this.ke))return;const t=this.bn,e=this.a,i=this._n.has("Model");if(i&&(this.zc=!0,this.Xc===1?(t.isViewportUnconstrained=!0,t.yi.clear(),t.add(e,"position",e.position.copy().offset(0,-200),e.position),t.add(e,"opacity",0,1)):this.Xc===3&&t.yi.clear(),this.Xc===2&&e.jx.equals(e.ct)?this.Hx=!0:this.Hx=!1,e.T("InitialAnimationStarting",this)),i&&!this.Tr||t.yi.count===0){this._n.clear(),this.ke=!1,t.yi.clear(),t.qx(e),this.zc=!1,e.C();return}this._n.clear(),e.Dr=!1;const s=t.yi.get(e);e.autoScale!==1&&s!==null&&(delete s.ae.scale,delete s.Cs.scale);const n=this;H.requestAnimationFrame(()=>{n.ke===!1||t.Ae||(e.getRenderingHint("temporaryPixelRatio")&&e.Cx(),e.MM(),n.ke=!1,t.start(),t.Ae&&(n.zu(),e.invalidateDocumentBounds(),t.DA(0),e.Sr(!0),n.Xu(),e.T("AnimationStarting",n)))})}NM(){return this._n.has("Trigger")&&this._n.count===1}vA(t,e,i,s){this.isTicking||this.NM()||t instanceof U&&(t.fromNode!==null||t.toNode!==null)||this.bn.add(t,"position",e,i,s)}Wx(t){return this.bn.Wx(t)}CM(t){return this.bn.CM(t)}MR(t){const e=this.lh,i=this;function s(){if(i.qm.count>0&&(e.addAll(i.qm),i.qm.clear(),i.Ae=!0),i.Ae===!1||e.count===0){i.Yx=!1;return}i.Kx.addAll(e);const n=i.Kx.iterator;for(;n.next();){const o=n.value;o.Ae!==!1&&(o.NR()?o.FA(!1):o.Gc=!0)}if(i.Kx.clear(),i.Ae===!1){H.requestAnimationFrame(s);return}i.zu(),i.a.Sr(),i.Xu(),H.requestAnimationFrame(s)}this.Ae?this.RA(t):(this.Ae=!0,this.Yx?this.RA(t):(this.Yx=!0,e.add(t),H.requestAnimationFrame(()=>s())))}RA(t){this.qm.add(t)}CR(){const t=this.lh.iterator;for(;t.next();)t.value.Gc=!1}zu(){if(this.Hm)return;const t=this.a;this.kM=t.skipsUndoManager,this.PM=t.wi,t.skipsUndoManager=!0,t.wi=!0,this.Hm=!0}Xu(){const t=this.a;t.skipsUndoManager=this.kM,t.wi=this.PM,this.Hm=!1}stopAnimation(t){const e=this.bn;if(this.ke===!0&&(this.ke=!1,this.zc=!1,this._n.clear(),e.LR()&&this.a.requestUpdate()),!this.Ae){e.yi.clear(),e.qx(this.a);return}if(e.Gu(!0),e.qx(null),t===!0){const i=this.lh.toArray();for(let s=0;s<i.length;s++)i[s].Gu(!0)}}Gu(t){this.lh.delete(t),this.lh.count===0&&(this.Ae=!1,this.a.requestUpdate()),t===this.defaultAnimation&&this.a.T("AnimationFinished",this)}Yc(t,e){this.ke&&(!this._n.has("Expand Tree")&&!this._n.has("Expand SubGraph")||(this.bn.Yc(t,e),this.OA(t)))}Kc(t,e){this.ke&&(!this._n.has("Collapse Tree")&&!this._n.has("Collapse SubGraph")||(this.bn.Kc(t,e),this.bn.LM(e,"position",e.position,e.position),this.OA(t)))}IA(t,e){!this.ke||t.equals(e)||this.NM()||(this.a.Qa||(t=e.copy()),this.bn.LM(this.a,"position",t,e))}EA(t,e){this.ke&&(this.NM()||this.bn.add(this.a,"scale",t,e))}AM(t,e){t.Fi&&(t.vr=e,this.Wm.add(t))}OA(t){const e=t.findLinksConnected();for(;e.next();){const i=e.value;i.Fi&&(i.vr=i.points.copy(),this.Wm.add(i))}}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t,t&&this.lh.each(e=>{!e.isAnimating&&e.runCount===1/0&&e.start()})}get duration(){return this.Io}set duration(t){t<1&&y.J(t,">= 1",re,"duration"),this.Io=t}get isAnimating(){return this.Ae}get isTicking(){return this.Hm}get isInitial(){return this.Tr}set isInitial(t){this.Tr=t}get defaultAnimation(){return this.bn}get activeAnimations(){return this.lh}get initialAnimationStyle(){return this.Xc}set initialAnimationStyle(t){this.Xc=t}static Jx=new bt;static defineAnimationEffect(t,e){re.Jx.set(t,e)}static TM(t,e,i,s,n){t===null&&(t=[0,0,0,0]),e===null&&(e=[0,0,0,0]);let o=t[0],r=t[1];const a=t[2],l=t[3];let h=e[0],u=e[1];const c=e[2],d=e[3];a===0||a===100?(o=h,r=u):(c===0||c===100)&&(h=o,u=r),Math.abs(h-o)>180&&(h>o?o+=360:h+=360);const f=n(i,o,h-o,s)%360,m=n(i,r,u-r,s),g=n(i,a,c-a,s),p=n(i,l,d-l,s);return"hsla("+f+", "+m+"%, "+g+"%, "+p+")"}static Default=1;static AnimateLocations=2;static None=3}{const x=re.Jx,t=(e,i,s,n,o,r)=>{e.position=new P(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))};x.set("position:diagram",t),x.set("position",t),x.set("position:part",(e,i,s,n,o,r)=>{o<r?e.Uc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):e.position=new P(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),x.set("location",(e,i,s,n,o,r)=>{o<r?e.Uc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!0):e.location=new P(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),x.set("position:placeholder",(e,i,s,n,o,r)=>{o<r?e.Uc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):e.position=new P(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),x.set("position:nodeCollapse",(e,i,s,n,o,r)=>{const a=e.actualBounds,l=s.actualBounds,h=l.x+l.width/2-a.width/2,u=l.y+l.height/2-a.height/2;o<r?e.Uc(n(o,i.x,h-i.x,r),n(o,i.y,u-i.y,r),!1):e.position=new P(n(o,i.x,h-i.x,r),n(o,i.y,u-i.y,r))}),x.set("desiredSize",(e,i,s,n,o,r)=>{e.desiredSize=new st(n(o,i.width,s.width-i.width,r),n(o,i.height,s.height-i.height,r))}),x.set("width",(e,i,s,n,o,r)=>{e.width=n(o,i,s-i,r)}),x.set("height",(e,i,s,n,o,r)=>{e.height=n(o,i,s-i,r)}),x.set("fill",(e,i,s,n,o,r)=>{e.fill=re.TM(i,s,o,r,n)}),x.set("stroke",(e,i,s,n,o,r)=>{e.stroke=re.TM(i,s,o,r,n)}),x.set("strokeWidth",(e,i,s,n,o,r)=>{e.strokeWidth=n(o,i,s-i,r)}),x.set("strokeDashOffset",(e,i,s,n,o,r)=>{e.strokeDashOffset=n(o,i,s-i,r)}),x.set("background",(e,i,s,n,o,r)=>{e.background=re.TM(i,s,o,r,n)}),x.set("opacity",(e,i,s,n,o,r)=>{e.opacity=n(o,i,s-i,r)}),x.set("scale",(e,i,s,n,o,r)=>{e.scale=n(o,i,s-i,r)}),x.set("angle",(e,i,s,n,o,r)=>{e.angle=n(o,i,s-i,r)})}class ae{$x;Jm;Ae;Yu;Io;Ls;UA;Hc;yi;Zx;ae;to;Ku;jc;Qx;_x;Gc;DM;tb;Ns;a;vM;FM;RM;constructor(t){this.a=null,this.Ns=null,this.DM=null,this.tb=null,this.vM=!1,this.Ae=!1,this.Gc=!1,this.ae=0,this.to=0,this.$x=ae.EaseInOutQuad,this.Jm=ae.EaseInOutQuad,this.Ku=!1,this.jc=!1,this.Qx=1,this._x=0,this.Io=NaN,this.Ls=NaN,this.FM=0,this.Yu=null,this.UA=P.gn,this.yi=new bt,this.Zx=new bt,this.Hc=new K,this.RM=1,t&&Object.assign(this,t)}suspend(){this.Gc=!0}advanceTo(t,e){e&&(this.Gc=!1),this.Ku&&t>=this.Ls&&(this.jc=!0,t=t-this.Ls),this.FM=t,this.FA(!0),this.Ns.zu(),this.a.Sr(),this.Ns.Xu(),this.a.redraw()}qx(t){if(this.Zx.clear(),this.jc=!1,this._x=0,this.Ls=NaN,this.Hc.count>0&&this.Hc.clear(),t!==null){const e=t.links;for(;e.next();)e.value.vr=null}}LR(){return this.yi.count>0}start(){if(this.yi.count===0)return this;if(this.Ae)return this;let t=this.a;const e=this.yi.iterator;for(;e.next();){const s=e.key;t===null&&(s instanceof X?t=s:s instanceof tt&&(t=s.diagram))}if(t!==null)this.a=t,this.Ns=t.animationManager;else return this;const i=this.Ns;return i.isEnabled===!1?this:(this.Ls=isNaN(this.Io)?i.duration:this.Io,this.Jm=this.$x,i.zc&&i.Xc===1&&this===i.defaultAnimation&&(this.Jm=ae.EaseOutExpo,this.Ls=isNaN(this.Io)?i.duration===600?900:i.duration:this.Io),this.RM=t.scrollMode,this.isViewportUnconstrained&&(t.ah=2),i.zu(),this.Hc.each(s=>{s.data=null,t.add(s)}),i.Xu(),this.Ae=!0,this.ae=+new Date,this.to=this.ae+this.Ls,i.MR(this),this)}addTemporaryPart(t,e){return t.Di()?(this.Hc.add(t),this.a=e,this):this}add(t,e,i,s,n){if(this.a===null&&(t instanceof X?this.a=t:t instanceof tt&&t.diagram!==null&&(this.a=t.diagram)),t instanceof ft){if(!t.isAnimated)return this;e==="position"&&(e="position:part")}return this.LM(t,e,i,s,n),this}LM(t,e,i,s,n){const o=this.yi;let r,a,l;if(t instanceof X&&e==="position"&&(e="position:diagram"),(e==="fill"||e==="stroke"||e==="background")&&(R.Uo(i),R.OM(),i=[R.ze.n0,R.ze.n1,R.ze.n2,R.ze.n3],R.Uo(s),R.OM(),s=[R.ze.n0,R.ze.n1,R.ze.n2,R.ze.n3]),o.has(t))r=o.get(t),a=r.ae,l=r.Cs,a[e]===void 0&&(a[e]=this.Hu(i)),l[e]=this.Hu(s);else{if(e==="position"&&i.equalsApprox(s))return;a={},l={},a[e]=this.Hu(i),l[e]=this.Hu(s),r=new Os(a,l,n),o.set(t,r)}const h=a[e];h instanceof P&&!h.isReal()&&h.h(this.UA),n&&e.indexOf("position:")===0&&t instanceof ft?r.eb.location=this.Hu(t.location):n&&(r.eb[e]=this.Hu(i))}Hu(t){return t instanceof P||t instanceof st?t.copy():t}AR(t){const e=this.yi;if(e.has(t)){const i=e.get(t);i.ib=!0}}Wx(t){if(!this.Ae)return!1;const e=this.yi.get(t);return e!==null&&e.ib}CM(t){if(!this.Ae)return!1;const e=this.yi.get(t);return e!==null&&!!(e.ae.position||e.ae["position:part"]||e.ae.location)}NR(){if(this.Hc.count>0)return!0;const t=this.yi.iterator;for(;t.next();){const e=t.key;if(e instanceof tt&&e.diagram!==null||e instanceof X)return!0}return!1}FA(t){if(this.Gc&&!t)return;const e=this.Ns;if(this.Ae===!1)return;const i=+new Date;let s=i>this.to?this.Ls:i-this.ae;t&&(s=this.FM,s<this.Ls?(this.ae=+new Date-s,this.to=this.ae+this.Ls):s=this.Ls),e.zu(),this.DA(s),this.a.Sr(!0),e.Xu(),i>this.to&&(this.Ku&&!this.jc?(this.ae=+new Date,this.to=this.ae+this.Ls,this.jc=!0):this.Gu(!1))}DA(t){const e=this.Ls,i=this.yi.iterator,s=this.jc;for(;i.next();){const n=i.key;if(n instanceof tt&&n.diagram===null)continue;const o=i.value,r=s?o.Cs:o.ae,a=s?o.ae:o.Cs,l=re.Jx;for(const h in a)h==="position"&&(a["position:placeholder"]||a["position:nodeCollapse"])||l.get(h)!==null&&l.get(h)(n,r[h],a[h],this.Jm,t,e,this)}}stop(){return this.Ae?(this.Gu(!0),this):this}Gu(t){if(this.tb!==null&&this.tb.TR(this.DM),!this.Ae)return;const e=this.a,i=this.Ns;i.zc=!1,this.Ae=!1,this.Gc=!1,i.zu();const s=this.yi,n=this.Hc.iterator;for(;n.next();)e.remove(n.value);const o=this.Ku,r=s.iterator,a=re.Jx;for(;r.next();){const h=r.key,u=r.value,c=o?u.Cs:u.ae,d=o?u.ae:u.Cs,f=u.eb;for(const m in d)if(a.get(m)!==null){let g=m;u.sb&&(g==="position:nodeCollapse"||g==="position:placeholder")&&(g="position"),a.get(g)(h,c[m],f[m]!==void 0?f[m]:u.sb?c[m]:d[m],this.Jm,this.Ls,this.Ls,this)}u.sb&&f.location!==void 0&&h instanceof ft&&(h.location=f.location),u.ib&&h instanceof ft&&h.Xe(!1)}this._x++;const l=!t&&this.Qx>this._x;if(!l&&(this===i.jm||this===i.defaultAnimation)&&this.yi.clear(),e.nb.clear(),e.yS(!1),e.invalidateDocumentBounds(),e.C(),e.Sr(!0),i.defaultAnimation===this){const h=i.Wm.iterator;for(;h.next();)h.value.DR();i.Wm.clear()}if(e.Sr(!0),this.isViewportUnconstrained&&(e.scrollMode=this.RM),i.Xu(),l){this.jc=!1,this.start();return}this.qx(null),e.VA(),i.Gu(this),this.Yu&&this.Yu(this),e.requestUpdate()}Yc(t,e){const i=e.actualBounds;let s=null;if(e instanceof at&&(s=e.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(T.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(t,"position",n,t.position,!1)}else this.add(t,"position",new P(i.x+i.width/2,i.y+i.height/2),t.position,!1);this.add(t,"scale",.01,t.scale,!1),t instanceof at&&this.vR(t,e)}vR(t,e){const i=t.memberParts;for(;i.next();){const s=i.value;s instanceof W&&this.Yc(s,e)}}Kc(t,e){if(!t.isVisible())return;let i=null;if(e instanceof at&&(i=e.placeholder),i!==null&&i.visible){const s=i.getDocumentPoint(T.TopLeft),n=i.padding;s.x+=n.left,s.y+=n.top,this.add(t,"position:placeholder",t.position,s,!0)}else this.add(t,"position:nodeCollapse",t.position,e,!0);this.add(t,"scale",t.scale,.01,!0),this.AR(t),t instanceof at&&this.FR(t,e)}FR(t,e){const i=t.memberParts;for(;i.next();){const s=i.value;s instanceof W&&this.Kc(s,e)}}get duration(){return this.Io}set duration(t){y.s(t,"number",ae,"duration"),t<1&&y.J(t,">= 1",ae,"duration"),this.Io=t}get reversible(){return this.Ku}set reversible(t){this.Ku=t}get runCount(){return this.Qx}set runCount(t){t>0?this.Qx=t:y.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Yu}set finished(t){this.Yu!==t&&(t!==null&&y.S(t,ae,"finished"),this.Yu=t)}get easing(){return this.$x}set easing(t){this.$x=t}get isViewportUnconstrained(){return this.vM}set isViewportUnconstrained(t){this.vM=t}get isAnimating(){return this.Ae}getTemporaryState(t){let e=this.Zx.get(t);return e===null&&(e={},this.Zx.set(t,e)),e}static EaseLinear=(t,e,i,s)=>i*t/s+e;static EaseInOutQuad=(t,e,i,s)=>(t/=s/2,t<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e);static EaseInQuad=(t,e,i,s)=>i*(t/=s)*t+e;static EaseOutQuad=(t,e,i,s)=>-i*(t/=s)*(t-2)+e;static EaseInExpo=(t,e,i,s)=>t===0?e:i*Math.pow(2,10*(t/s-1))+e;static EaseOutExpo=(t,e,i,s)=>t===s?e+i:i*(-Math.pow(2,-10*t/s)+1)+e}class Os{ae;Cs;eb;sb;ib;constructor(t,e,i){this.ae=t,this.Cs=e,this.eb={},this.sb=i,this.ib=!1}}var ss=(x=>(x[x.Default=1]="Default",x[x.Immediate=2]="Immediate",x[x.Bundled=3]="Bundled",x))(ss||{});class Xe{Ti;yn;ju;qc;constructor(t,e,i){this.Ti=null,this.yn=t,this.ju=i||1,this.qc=null,e!==void 0&&(this.qc=e,i===void 0&&(this.ju=2))}copy(){const t=new Xe(this.yn);t.ju=this.ju;const e=this.qc;if(e!==null){const i={};e.duration!==void 0&&(i.duration=e.duration),e.finished!==void 0&&(i.finished=e.finished),e.easing!==void 0&&(i.easing=e.easing),t.qc=i}return t}get propertyName(){return this.yn}set propertyName(t){this.yn=t}get animationSettings(){return this.qc}set animationSettings(t){this.qc=t}RR(t){const e=this.qc;e!==null&&(e.duration&&(t.duration=e.duration),e.finished&&(t.finished=e.finished),e.easing&&(t.easing=e.easing))}get startCondition(){return this.ju}set startCondition(t){this.ju=t}static Default=1;static Immediate=2;static Bundled=3}class Ht{a;Pt;Zt;Fr;Yl;Kl;Hl;jl;ql;Wl;Jl;$l;Zl;Ql;_l;ta;Vc;ea;ob;$m;qu;Ct;constructor(t){K.Je(this),this.a=null,this.Ct=new J,this.Pt="",this.Zt=1,this.Fr=!1,this.Yl=!0,this.Kl=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Vc=!0,this.ea=!0,this.ob=!0,this.$m=!1,this.qu=[],t&&Object.assign(this,t)}OR(){const t=this.Ct;for(let e=0;e<t.length;e++)t.r[e].IM(null);t.clear(),this.qu.length=0}Eo(t){this.a=t}toString(t){t===void 0&&(t=0);const e='Layer "'+this.name+'"';if(t<=0)return e;let i=0,s=0,n=0,o=0,r=0;const a=this.Ct.iterator;for(;a.next();){const h=a.value;h instanceof at?n++:h instanceof W?s++:h instanceof U?o++:h instanceof pt?r++:i++}let l="";if(i>0&&(l+=i+" Parts "),s>0&&(l+=s+" Nodes "),n>0&&(l+=n+" Groups "),o>0&&(l+=o+" Links "),r>0&&(l+=r+" Adornments "),t>1){const h=this.Ct.iterator;for(;h.next();){const u=h.value;l+=`
    `+u.toString();const c=u.data;c!==null&&K.xs(c)&&(l+=" #"+K.xs(c)),u instanceof W?l+=" "+y.toString(c):u instanceof U&&(l+=" "+y.toString(u.fromNode)+" "+y.toString(u.toNode))}}return e+" "+this.Ct.count+": "+l}findObjectAt(t,e,i){if(e===void 0&&(e=null),i===void 0&&(i=null),this.ea===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(s=!0);const n=P.l(),o=this.Ct.r,r=o.length;for(let a=r;a--;){const l=o[a];if(s===!0&&l.Ul()===!1||!l.isVisible())continue;n.h(t),n.Ki(l.Js);let h=l.BA(n,e,i);if(h!==null&&(e!==null&&(h=e(h)),h!==null&&(i===null||i(h))))return P.i(n),h}return P.i(n),null}findObjectsAt(t,e,i,s){if(e===void 0&&(e=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.ea===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(n=!0);const o=P.l(),r=this.Ct.r,a=r.length;for(let l=a;l--;){const h=r[l];if(n===!0&&h.Ul()===!1||!h.isVisible())continue;o.h(t),o.Ki(h.Js);let u=h;h.zA(o,e,i,s)&&(e!==null&&(u=e(u)),u!==null&&(i===null||i(u))&&s.add(u))}return P.i(o),s}findObjectsIn(t,e,i,s,n){if(e===void 0&&(e=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.ea===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(t)&&(o=!0);const r=this.Ct.r,a=r.length;for(let l=a;l--;){const h=r[l];if(o===!0&&h.Ul()===!1||!h.isVisible())continue;let u=h;h.Zm(t,e,i,s,n)&&(e!==null&&(u=e(u)),u!==null&&(i===null||i(u))&&n.add(u))}return n}MS(t,e,i,s,n,o,r){if(this.ea===!1)return n;const a=this.Ct.r,l=a.length;for(let h=l;h--;){const u=a[h];if(r===!0&&u.Ul()===!1||!o(u)||!u.isVisible())continue;let c=u;u.Zm(t,e,i,s,n)&&(e!==null&&(c=e(c)),c!==null&&(i===null||i(c))&&n.add(c))}return n}findObjectsNear(t,e,i,s,n,o){if(i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.ea===!1)return o;let r=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(r=!0);const a=P.l(),l=P.l(),h=this.Ct.r,u=h.length;for(let c=u;c--;){const d=h[c];if(r===!0&&d.Ul()===!1||!d.isVisible())continue;a.h(t),a.Ki(d.Js),l.e(t.x+e,t.y),l.Ki(d.Js);let f=d;d.XA(a,l,i,s,n,o)&&(i!==null&&(f=i(f)),f!==null&&(s===null||s(f))&&o.add(f))}return P.i(a),P.i(l),o}EM(){return this.Ct.r}As(t,e){if(!this.visible)return;const i=this.Ct.r,s=i.length;if(s===0)return;const n=y.nt(),o=y.nt();for(let r=0;r<s;r++){const a=i[r];if(a.UM=r,a instanceof U){if(a.Fi===!1)continue}else if(a instanceof pt&&a.adornedPart!==null)continue;const l=a.actualBounds;a.isVisible()&&l.UL(e,10)?(a.As(!0),n.push(a)):(a.As(!1),a.adornments!==null&&a.adornments.count>0&&o.push(a))}for(let r=0;r<n.length;r++){const a=n[r];a.VM();const l=a.adornments;for(;l.next();){const h=l.value;h.ht(1/0,1/0),h.Ut(),h.As(!0)}}for(let r=0;r<o.length;r++)o[r].VM();y.Z(n),y.Z(o)}Wu(t){let e=1;return this.Zt!==1&&(e=t.globalAlpha,t.globalAlpha=e*this.Zt),e}GA(t,e){for(let i=0;i<e;i++)t[i].Wc()}Ge(t,e,i){if(!this.visible||this.Zt===0||(i===void 0&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(n===0)return;t.Fr&&this.GA(s,n);const o=this.Wu(t),r=this.qu;r.length=0;const a=e.scale,l=I.l();for(let h=0;h<n;h++){const u=s[h];this.Qm(t,u,e,r,a,l,!0)}I.i(l),t.Fr&&this.GA(s,n),t.globalAlpha=o}OU(t,e,i){if(!this.visible||this.Zt===0)return;const s=this.Ct.r,n=s.length;if(n===0)return;const o=this.Wu(t),r=this.qu;r.length=0;const a=e.scale,l=I.l();for(let h=0;h<n;h++){const u=s[h];i.has(u)||this.Qm(t,u,e,r,a,l,!0)}I.i(l),t.globalAlpha=o}IR(t,e,i,s){if(!this.visible||this.Zt===0||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(o===0)return;const r=this.Wu(t),a=this.qu;a.length=0;const l=e.scale,h=I.l();for(let u=0;u<o;u++){const c=n[u];i.has(c)&&this.Qm(t,c,e,a,l,h,!1)}I.i(h),t.globalAlpha=r}ER(t,e,i,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.Wu(t);o.Ge(t,i),t.globalAlpha=r}}else{const r=this.Wu(t),a=i.scale,l=I.l(),h=this.Ct.r,u=h.length;for(let c=0;c<u;c++){const d=h[c];!n&&d===o||this.Qm(t,d,i,null,a,l,!1)}I.i(l),t.globalAlpha=r}}IU(t,e,i){if(!this.visible||this.Zt===0)return;const s=this.Wu(t),n=this.qu;n.length=0;const o=e.scale,r=I.l(),a=this.Ct.r,l=a.length,h=i.length;for(let u=0;u<l;u++){const c=a[u],d=c.hh(c.actualBounds);this.UR(d,i,h,o)&&this.Qm(t,c,e,n,o,r,!0)}I.i(r),t.globalAlpha=s}Qm(t,e,i,s,n,o,r){if(r&&!e.Ul()){t.removePartFromView(e);return}if(s!==null&&e instanceof U&&(e.isOrthogonal&&s.push(e),e.Fi===!1)){t.removePartFromView(e);return}let a=!1,l=e.containingGroup;for(;l!==null;)a?l.he!==null&&o.intersectRect(l.he):l.he!==null&&(a=!0,o.h(l.he)),l=l.containingGroup;const h=e.actualBounds;let u=!1;if(a&&e.isVisible()){if(!o.intersectsRect(h)){t.removePartFromView(e);return}u=!o.containsRect(h)}u&&(t.save(),t instanceof Wt?t.partClipRect=o.copy():(t.beginPath(),t.rect(o.x,o.y,o.width,o.height),t.clip())),h.width*n>i._m||h.height*n>i._m?e.Ge(t,i):this.VR(t,e,i),u&&(t.restore(),t.clearContextCache(!0))}VR(t,e,i){if(t instanceof Wt){e.Ge(t,i);return}const s=e.actualBounds,n=e.naturalBounds;if(s.width===0||s.height===0||isNaN(s.x)||isNaN(s.y)||!e.isVisible())return;const o=e.v;if(e.background===null){e.kn(t,"rgba(0,0,0,0.3)",!0,!1,n,s),t.fillRect(s.x,s.y,s.width,s.height);return}if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),e.kn(t,e.background,!0,!1,n,s),t.fillRect(0,0,n.width/2,n.height/2),!o.RP()){const r=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*r,-o.m12*r,-o.m21*r,o.m11*r,r*(o.m21*o.dy-o.m22*o.dx),r*(o.m12*o.dx-o.m11*o.dy))}}UR(t,e,i,s){const n=2/s,o=4/s;for(let r=0;r<i;r++){const a=e[r];if(!(a.width===0||a.height===0)&&t.intersects(a.x-n,a.y-n,a.width+o,a.height+o))return!0}return!1}t(t,e,i,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,t,this,e,i,s,n)}ch(t,e,i){const s=this.Ct;if(e.IM(this),t>=s.count)t=s.count;else if(s.elt(t)===e)return-1;s.insertAt(t,e),e.tp(i);const n=this.diagram;return n!==null&&(i?n.C():n.ch(e)),this.rb(t,e),t}ri(t,e,i){if(!i&&e.layer!==this&&e.layer!==null)return e.layer.ri(t,e,i);const s=this.Ct;if(t<0||t>=s.length){if(t=s.indexOf(e),t<0)return-1}else if(s.elt(t)!==e&&(t=s.indexOf(e),t<0))return-1;e.ep(i),s.removeAt(t);const n=this.diagram;return n!==null&&(i?n.C():n.ri(e)),e.IM(null),t}rb(t,e){t=this.BR(t,e),e instanceof at&&this.zR(t,e),e.svg!==null&&e.svg.remove()}BR(t,e){const i=e.zOrder;if(isNaN(i))return t;const s=this.Ct,n=s.count;if(n<=1)return t;if(t<0&&(t=s.indexOf(e)),t<0)return-1;let o=t-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,!!isNaN(r));)o--;let a=t+1,l=NaN;for(;a<n&&(l=s.elt(a).zOrder,!!isNaN(l));)a++;if(!isNaN(r)&&r>i)for(;;){if(o===-1||r<=i)return o++,o===t?t:(s.removeAt(t),s.insertAt(o,e),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,!!isNaN(r)););}else if(!isNaN(l)&&l<i)for(;;){if(a===n||l>=i)return a--,a===t?t:(s.removeAt(t),s.insertAt(a,e),a);for(l=NaN;++a<n&&(l=s.elt(a).zOrder,!!isNaN(l)););}return t}zR(t,e){if(e===null||!isNaN(e.zOrder))return;this.XR(t,e);const i=e.containingGroup;i!==null&&this.rb(-1,i)}XR(t,e){if(e.memberParts.count===0)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===e&&(t=o,i>=0)||i<0&&r.containingGroup===e&&(i=o,t>=0))break}if(!(i<0)&&i<t){const o=this.Ct;o.removeAt(t),o.insertAt(i,e)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.a}get name(){return this.Pt}set name(t){const e=this.Pt;if(e!==t){const i=this.diagram;if(i!==null){e===""&&y.o("Cannot rename default Layer to: "+t);const n=i.layers;for(;n.next();)n.value.name===t&&y.o("Layer.name is already present in this diagram: "+t)}this.Pt=t,this.t("name",e,t);const s=this.Ct.iterator;for(;s.next();){const n=s.value;n.layerName=this.Pt}}}get opacity(){return this.Zt}set opacity(t){const e=this.Zt;if(e!==t){(t<0||t>1)&&y.J(t,"0 <= value <= 1",Ht,"opacity"),this.Zt=t;const i=this.diagram;i!==null&&i.C(),this.t("opacity",e,t)}}get isViewportAligned(){return this.$m}set isViewportAligned(t){const e=this.$m;e!==t&&(this.$m=t,this.diagram&&(this.YA(),this.diagram.C()),this.t("isViewportAligned",e,t),t&&(this.isInDocumentBounds=!1))}YA(){if(!this.$m)return;const t=this.diagram;if(t===null)return;const e=this.Ct.r,i=e.length,s=t.wt,n=t.xt;for(let o=0;o<i;o++){const r=e[o],a=r.naturalBounds.width,l=r.naturalBounds.height;let h=r.alignment;(h.isDefault()||!h.isSpot())&&(h=T.BottomRight);let u=r.alignmentFocus;u.isDefault()&&(u=new T(h.x,h.y));const c=h.x*s+h.offsetX-(u.x*a+u.offsetX),d=h.y*n+h.offsetY-(u.y*l+u.offsetY),f=P.z(c,d);t.GR(f),r.Uc(f.x,f.y,!0),P.i(f),r.it=1/t.scale}}get isTemporary(){return this.Fr}set isTemporary(t){const e=this.Fr;e!==t&&(this.Fr=t,this.t("isTemporary",e,t))}get visible(){return this.Vc}set visible(t){const e=this.Vc;if(e!==t){this.Vc=t;const i=this.Ct.iterator;for(;i.next();)i.value.Xe(t);const s=this.diagram;s!==null&&s.C(),this.t("visible",e,t)}}get pickable(){return this.ea}set pickable(t){const e=this.ea;e!==t&&(this.ea=t,this.t("pickable",e,t))}get isInDocumentBounds(){return this.ob}set isInDocumentBounds(t){const e=this.ob;e!==t&&(this.ob=t,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t))}get allowCopy(){return this.Yl}set allowCopy(t){const e=this.Yl;e!==t&&(this.Yl=t,this.t("allowCopy",e,t))}get allowDelete(){return this.Kl}set allowDelete(t){const e=this.Kl;e!==t&&(this.Kl=t,this.t("allowDelete",e,t))}get allowTextEdit(){return this.Hl}set allowTextEdit(t){const e=this.Hl;e!==t&&(this.Hl=t,this.t("allowTextEdit",e,t))}get allowGroup(){return this.jl}set allowGroup(t){const e=this.jl;e!==t&&(this.jl=t,this.t("allowGroup",e,t))}get allowUngroup(){return this.ql}set allowUngroup(t){const e=this.ql;e!==t&&(this.ql=t,this.t("allowUngroup",e,t))}get allowLink(){return this.Wl}set allowLink(t){const e=this.Wl;e!==t&&(this.Wl=t,this.t("allowLink",e,t))}get allowRelink(){return this.Jl}set allowRelink(t){const e=this.Jl;e!==t&&(this.Jl=t,this.t("allowRelink",e,t))}get allowMove(){return this.$l}set allowMove(t){const e=this.$l;e!==t&&(this.$l=t,this.t("allowMove",e,t))}get allowReshape(){return this.Zl}set allowReshape(t){const e=this.Zl;e!==t&&(this.Zl=t,this.t("allowReshape",e,t))}get allowResize(){return this.Ql}set allowResize(t){const e=this.Ql;e!==t&&(this.Ql=t,this.t("allowResize",e,t))}get allowRotate(){return this._l}set allowRotate(t){const e=this._l;e!==t&&(this._l=t,this.t("allowRotate",e,t))}get allowSelect(){return this.ta}set allowSelect(t){const e=this.ta;e!==t&&(this.ta=t,this.t("allowSelect",e,t))}}var li=(x=>(x[x.None=1]="None",x[x.Uniform=2]="Uniform",x[x.UniformToFill=3]="UniformToFill",x))(li||{}),ns=(x=>(x[x.All=1]="All",x[x.NotDirected=2]="NotDirected",x[x.NotDirectedFast=3]="NotDirectedFast",x[x.NotUndirected=4]="NotUndirected",x[x.DestinationTree=5]="DestinationTree",x[x.SourceTree=6]="SourceTree",x))(ns||{}),os=(x=>(x[x.Document=1]="Document",x[x.Infinite=2]="Infinite",x))(os||{}),rs=(x=>(x[x.TreeParent=1]="TreeParent",x[x.AllParents=2]="AllParents",x[x.AnyParents=3]="AnyParents",x))(rs||{});class X{Ns;qt;BM;lb;Rr;Ju;ab;hb;cb;fb;ub;db;fh;ah;gb;pb;yb;ia;Jc;Or;ip;wb;xb;$u;eo;Ir;uh;Vo;sp;$c;np;Zc;Zu;Er;io;zM;XM;bb;kb;GM;Pb;YM;KM;HM;Sb;op;Ur;Vr;Br;zr;Xr;Gr;Mb;Yr;Nb;Kr;Hr;jr;qr;Cb;jM;Bo;qM;Lb;Ab;WM;Ce;JM;Qc;$M;js;zo;Be;Tb;Yl;Kl;Db;vb;Hl;jl;ql;Fb;Wl;Jl;$l;Zl;Ql;_l;ta;Rb;Ob;ZM;Qu;_u;Ib;Eb;Ub;Vb;rp;Bb;zb;Xb;Qt;KA;Gb;HA;td;Pn;so;li;no;jA;sa;QM;_M;lp;Yb;ed;ap;Kb;Wr;na;dh;t2;e2;hp;Hb;jb;ls;sd;cp;nd;Xo;_c;fp;Jr;gh;i2;dp;Ht;v;qi;Dr;Ye;Ts;s2;oa;$r;Fl;Zr;mh;tf;o2;od;ph;rd;zt;ra;ct;it;ld;wt;xt;lt;ef;Mx;qb;yh;sf;Wb;Jb;gp;YR;KR;$e;Ol;_m;mp;l2;a2;qA;pp;HR;jR;qR;$b;WR;JR;$R;wh;WA;la;xh;bh;kh;Ph;Eu;oh;Wt;Nt;nf;qP;WP;vc;Zt;static Zb=null;static JA=new bt;static h2;static c2=null;Iu;Qb;_b;ad;t1;e1;yp;f2;wp;xp;bp;jx;u2;d2;of;kp;Pp;constructor(t,e){if(X.qw||(X.OP(),X.qw=!0),K.Je(this),X.$A(this),this.Ht=!0,this.Nt=null,this.wt=0,this.xt=0,this.lt=null,X.isUsingDOM()){const s=this,n=()=>{s.Le(H.document,"DOMContentLoaded",n,!1),s.setRTL()};H.document.body!==null?this.setRTL():s.Et(H.document,"DOMContentLoaded",n,!1)}this.ef=null,X.g2("Model",ee);const i=this;return this.JM=s=>i.partManager.doModelDataChanged(s),this.Qc=s=>i.partManager.doModelChanged(s),this.Wb=null,this.Jb=null,this.ZA(),this.model=ht.m2(),this.themeManager=new Ae,this.Bo=!0,this.QA(),this.layout=new Kt,this.Bo=!1,this.HR=null,this.jR=null,this.qR=null,this.$b=null,this.WR=null,this.JR=null,this.$R=null,this.wh=null,this.WA=null,this.la=null,this.xh=null,this.bh=null,this.kh=null,this.Ph=null,this.Eu=()=>{},this.oh=null,this.nd=!1,this.nf=new Rs(this),t!==void 0&&(typeof t=="string"||H.Element&&t instanceof Element?this.p2(t):e=t),e&&this.setProperties(e),this.Ht=!1,this.requestUpdate(),this}lR(){return this.lt!==null}get renderer(){return this._c}set renderer(t){if(this instanceof Ke)return;t===""&&(t="default");const e=t.toLowerCase(),i=this._c;if(e===i)return;this._c=e;let s=null;e==="default"||e==="canvas"?(s=this.Xo.get("svg"),s!==null&&s.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))):e==="svg"?(this.Xo.has("svg")?s=this.Xo.get("svg"):(s=new Ue(this,H.document),this.addRenderer("svg",s)),this.div!==null&&(s.bt.role="img",this.div.appendChild(s.bt)),this.lt&&(this.Wt=s._t,this.lt._t.setTransform(this.$e,0,0,this.$e,0,0),this.lt._t.clearRect(0,0,this.wt,this.xt))):e==="debug"&&(this.Xo.has("SVG")||(s=new Ue(this,H.document),this.addRenderer("SVG",s),s.bt.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.bt))),this.Ht||this.redraw()}ZA(){if(this.of=new J,this.setupRouters(),this.Ns=new re,this.Ns.Eo(this),this.qt=17,this.BM=!1,this.ld=!1,this.lb="default",this.zt=new J,this.Xo){const t=this.Xo.get("svg");t!==null&&t.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))}this.Xo=new bt,this._c="default",this.resetRenderingHints(),this.ZR(),this.Zt=1,this.ct=new P(NaN,NaN).k(),this.jx=new P(NaN,NaN),this.it=1,this.dp=1,this.ab=new P(NaN,NaN).k(),this.hb=NaN,this.cb=1e-4,this.fb=100,this.v=new wt,this.ub=new P(NaN,NaN).k(),this.db=new I(NaN,NaN,NaN,NaN).k(),this.fh=new Mt(0,0,0,0).kt(),this.ah=1,this.gb=!1,this.pb=null,this.yb=null,this.ia=1,this.Jc=T.Default,this.Or=1,this.ip=T.Default,this.wb=T.None,this.xb=T.None,this.qi=!0,this.$u=!1,this.eo=new Set,this.Ir=new K,this.uh=new K,this.Vo=!1,this.ra=new bt,this.od=!0,this.sp=250,this.$c=-1,this.np=new Mt(16,16,16,16).kt(),this.Dr=!1,this.Zc=!1,this.Zu=!0,this.fp=new te,this.fp.diagram=this,this.Jr=new te,this.Jr.diagram=this,this.gh=new te,this.gh.diagram=this,this.Er=null,this.io=null,this.Mx=!1,this.QR(),this.Zr=new K,this.bb=!0,this.kb=1,this.GM=!1,this.Pb=1,this.Sb="auto",this.op="auto",this.Ur=null,this.Vr=null,this.Br=null,this.zr=null,this.Xr=null,this.Gr=null,this.Mb=null,this.Yr=null,this.Nb=!1,this.Kr=null,this.Hr=null,this.jr=null,this.qr=null,this.Cb=!1,this.qb={},this.yh=[null,null],this.Bo=!1,this.qM=!1,this.Lb=!1,this.Ab=!1,this.WM=!0,this.Ts=!1,this.ph=!1,this.$M=!0,this.js=-2,this.oa=new bt,this.rd=new J,this.zo=!1,this.Be=!0,this.Tb=!0,this.Yl=!0,this.Kl=!0,this.Db=!1,this.vb=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Fb=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Rb=!0,this.Ob=!0,this.ZM=!1,this.sf=!1,this.Qu=!0,this._u=!0,this.Ib=!0,this.Eb=!0,this.Ub=16,this.Vb=16,this.rp=!1,this.Bb=!1,this.zb=0,this.Xb=0,this.Qt=new Mt(5).kt(),this.KA=new K().k(),this.Gb=999999999,this.HA=new K().k(),this.mh=!0,this.td=!0,this.tf=!0,this.Pn=!1,this.so=!1,this.$r=!0,this.Fl=!1,this.no=!1,this.jA=new K,this.o2=new K,this.sa=null,this.QM=new st(U._A,U.tT),this._M=999,this.lp=!1,this.qP=1,this.WP=0,this.Ye={scale:1,position:new P,bounds:new I,canvasSize:new st,newCanvasSize:new st,isScroll:!1},this.Ye.canvasSize=this.Ye.canvasSize,this.Ye.newCanvasSize=this.Ye.newCanvasSize,this.Ye.isScroll=!1,this.Yb=new I(NaN,NaN,NaN,NaN).k(),this.ed=new st(NaN,NaN).k(),this.ap=new I(NaN,NaN,NaN,NaN).k(),this.Kb=!1,this.kp=null,this.Pp=null,this._R(),this.ls=null,this.sd=!1,this.vc=null,this.partManager=new ee,this.toolManager=new Ce,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this._b=null,this.ad=new Ze,this.t1=null,this.e1=null,this.Qb=!1,this.Iu=!1,this.commandHandler=new Et,this.xp=null,this.bp=P.mn,this.u2=!1,this.$e=1,this.Ol=null,this._m=1,this.yp=0,this.f2=[0,0,0,0,0],this.wp=0,this.mp=1,this.l2=0,this.a2=new P,this.qA=500,this.cp=new P,this.pp=!1}static eT=H.document!==void 0;static isUsingDOM(){return X.eT}static setDocument(t){H.document=t}static useDOM(t){X.eT=t?H.document!==void 0:!1}static Wi=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),X.iT(),this.sT(!1),this.rd.clear(),this.nT(),this.sa=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}sT(t){this.animationManager.stopAnimation(!0),this.clearSelection(),this.clearHighlighteds();const e=this.skipsUndoManager,i=this.Ce!==null&&this.Ce!==void 0;i&&(this.skipsUndoManager=!0);let s=null;this.ls!==null&&(s=this.ls.part,s!==null&&this.remove(s));const n=[],o=this.zt.length;if(t){for(let r=0;r<o;r++){const a=this.zt.r[r].parts;for(;a.next();){const l=a.value;l!==s&&l.data===null&&n.push(l)}}for(let r=0;r<n.length;r++){const a=n[r];this.remove(a)}}for(let r=0;r<o;r++)this.zt.r[r].OR();return this.partManager.clear(),this.eo.clear(),this.Ir.clear(),this.uh.clear(),this.ra.clear(),this.Zr.clear(),this.vc=null,this.rd.clear(),this.nT(),y.LP=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=e),n}static Sp=null;static i1="";static iT(){X.Sp=null,X.i1=""}static EU(){return null}reset(){this.clear(),this.Ht=!0,this.ZA(),this.themeManager=new Ae,this.aa(),this.Bo=!0,this.QA(),this.layout=new Kt,this.Bo=!1,this.model=ht.m2(),this.model.undoManager=new Je,this.nd=!1,this.Ht=!1,this.C()}_R(){this.Wr=new bt,this.t2=new W().add(new lt({stroke:"black",font:"10pt sans-serif"}).bind("text","",y.toString).theme("stroke","text").theme("font","normal")),this.Wr.set("",this.t2),this.Wr.set("Comment",new W().add(new lt({stroke:"brown",font:"10pt sans-serif"}).bind("text","",y.toString).theme("stroke","comment").theme("font","normal"))),this.Wr.set("LinkLabel",new W({selectable:!1,avoidable:!1}).add(new et("Ellipse",{fill:"black",stroke:null,desiredSize:new st(3,3).kt()}).theme("fill","link"))),this.dh=new bt,this.s2=new at(j.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new lt({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",y.toString).theme("stroke","text").theme("font","bold"),new j(j.Auto,{name:"GROUPPPANEL"}).add(new et({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new Jt({padding:5}).theme("padding","group"))),this.dh.set("",this.s2),this.na=new bt,this.e2=new U().add(new et({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new et({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.na.set("",this.e2),this.na.set("Comment",new U().add(new et({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.hp=new pt(j.Auto).add(new et({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new Jt({margin:1.5}).theme("margin","selection","numbers",null,t=>t?new Mt(t/2):1.5)).freezeBindings(),this.Hb=this.hp,this.jb=new pt(j.Link).add(new et({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection")).freezeBindings()}setRTL(t){let e=t===void 0?this.div:t;e===null&&(e=H.document.body);const i=y.Ni("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",e.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,i.scrollLeft===0&&(s="negative")),e.removeChild(i),this.lb=s}setScrollWidth(t){let e=t===void 0?this.div:t;e===null&&(e=H.document.body);let i=0;if(X.isUsingDOM()){let s=X.c2,n=X.h2;s===null&&(X.c2=y.Ni("p"),s=X.c2,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",X.h2=y.Ni("div"),n=X.h2,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",e.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),e.removeChild(n),i=o-r,i===0&&!y.ur&&(i=11)}this.qt=i,this.BM=!0}fe(t){t in li?this.autoScale=t:y.dr(this,t)}toString(t){t===void 0&&(t=0);let e="";this.div&&this.div.id&&(e=this.div.id);let i='Diagram "'+e+'"';if(t<=0)return i;const s=this.zt.iterator;for(;s.next();){const n=s.value;i+=`
  `+n.toString(t-1)}return i}static $A(t){X.Zb=t}static Om(){return X.Zb}static fromDiv(t){let e=t;if(typeof t=="string"&&(e=H.document.getElementById(t)),e instanceof HTMLDivElement){const i=X.Wi.get(e);if(i)return i}return null}get div(){return this.Nt}set div(t){if(t!==null&&y.se(t,HTMLDivElement,X,"div"),this.Nt!==t){const e=this.Nt;if(e!==null){if(X.Wi.delete(e),e.goDiagram=void 0,e.go=void 0,e.innerHTML="",this.lt!==null){const s=this.lt.bt;this.Le(s,"pointermove",this.xh,!1),this.Le(s,"pointerdown",this.la,!1),this.Le(s,"pointerup",this.bh,!1),this.Le(s,"pointerout",this.kh,!1),this.Le(s,"pointercancel",this.Ph,!1),this.lt.dispose()}this.ef&&(this.ef.disconnect(),this.ef=null);const i=this.toolManager;i!==null&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.lt=null,this.Le(H,"resize",this.$b,!1),this.Le(H,"wheel",this.wh,!0),X.Om()===this&&X.$A(null)}else this.la===null&&(this.no=!1);if(this.Nt=null,t!==null){const i=X.Wi.get(t);i&&(i.div=null),this.p2(t),this.Eu(),this.themeManager&&this.themeManager.tO()}else this.themeManager&&this.themeManager.eO()}}setupRouters(){this.of.push(new rn)}p2(t){const e=this;if(!X.isUsingDOM())return;t==null&&y.o("Diagram setup requires an argument DIV."),e.Nt!==null&&y.o("Diagram has already completed setup."),typeof t=="string"?e.Nt=H.document.getElementById(t):t instanceof HTMLDivElement?e.Nt=t:y.o("No DIV or DIV id supplied: "+t),e.Nt===null&&y.o("Invalid DIV id; could not get element with id: "+t);const i=X.Wi.get(e.Nt);if(i&&i!==this&&y.o("Invalid div id; div already has a Diagram associated with it."),!e.ef&&H.ResizeObserver){const u=H.ResizeObserver,c=y.CP(()=>e.requestUpdate(),250,!1);e.ef=new u(()=>c()),e.ef.observe(e.Nt)}H.getComputedStyle(e.Nt,null).position==="static"&&(e.Nt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,e.Nt.style["-webkit-tap-highlight-color"]=n,e.Nt.innerHTML="",X.Wi.set(e.Nt,e),e.Nt.goDiagram=e,e.Nt.go=H.go;const o=new xe(e);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",H.getComputedStyle(e.Nt,null).getPropertyValue("direction")==="rtl"&&(e.ld=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),o.bt.setAttribute("role","application"),e.lt=o,e.Wt=o._t;const r=e.Wt;e.$e=e.computePixelRatio(),e.viewSize.isReal()||(e.wt=e.Nt.clientWidth||1,e.xt=e.Nt.clientHeight||1),e.oT(e.wt,e.xt);const a=e;e.Nt.insertBefore(o.bt,e.Nt.firstChild);const l=new xe(null);if(l.width=1,l.height=1,e.YR=l,e.KR=l._t,X.isUsingDOM()){const u=y.Ni("div"),c=y.Ni("div");u.style.position="absolute",u.style.overflow="auto",u.style.width=e.wt+"px",u.style.height=e.xt+"px",u.style.zIndex="1",c.style.position="absolute",c.style.width="1px",c.style.height="1px",e.Nt.appendChild(u),u.appendChild(c),u.onscroll=X.iO,u.addEventListener("pointerdown",X.sO),u.a=e,u.nO=!0,u.oO=!0,e.Wb=u,e.Jb=c}e.Eu=y.CP(()=>{e.Ol=null,e.C()},300,!1),e.$b=y.CP(()=>{e.MM()},250,!1),e.oh=u=>(u.preventDefault(),!1),e.wh=u=>{if(!a.isEnabled)return;const c=a.rf(u,!0);c.bubbles=!0;let d=0,f=0;c.delta=0,u.deltaX!==void 0?(u.deltaX!==0&&(d=u.deltaX>0?1:-1),u.deltaY!==0&&(f=u.deltaY>0?1:-1),c.delta=Math.abs(u.deltaX)>Math.abs(u.deltaY)?-d:-f):u.wheelDeltaX!==void 0?(u.wheelDeltaX!==0&&(d=u.wheelDeltaX>0?-1:1),u.wheelDeltaY!==0&&(f=u.wheelDeltaY>0?-1:1),c.delta=Math.abs(u.wheelDeltaX)>Math.abs(u.wheelDeltaY)?-d:-f):u.wheelDelta!==void 0&&u.wheelDelta!==0&&(c.delta=u.wheelDelta>0?1:-1),a.doMouseWheel(),a.Sh(c,u)},e.WA=u=>{if(!a.isEnabled)return;e.sf=!1,a.rf(u,!0);const c=a.currentTool;c.cancelWaitAfter(),c.standardMouseOver()},e.la=u=>{if(!a.isEnabled)return;e.sf=!0;const c=a.qb;c[u.pointerId]===void 0&&(c[u.pointerId]=u);const d=a.yh;let f=!1;if(d[0]!==null&&(d[0].pointerId===u.pointerId||d[0].pointerType!==u.pointerType))d[0]=u;else if(d[1]!==null&&d[1].pointerId===u.pointerId)d[1]=u,f=!0;else if(d[0]===null)d[0]=u;else if(d[1]===null)d[1]=u,f=!0;else{u.preventDefault();return}const m=u.pointerType==="touch"||u.pointerType==="pen";m&&(a.Mx=!1,a.pp=!0);const g=a.rO(u,u,f),p=a.a2,b=m?25:10;if(u.timeStamp-a.l2<a.qA&&!(Math.abs(p.x-u.screenX)>b||Math.abs(p.y-u.screenY)>b)?a.mp++:a.mp=1,g.clickCount=a.mp,a.l2=u.timeStamp,a.a2.setTo(u.screenX,u.screenY),a.doMouseDown(),u.button===1){u.preventDefault();return}a.Sh(g,u)},e.xh=u=>{if(!a.isEnabled)return;e.sf=!0;const c=a.yh;if(c[0]!==null&&(c[0].pointerId===u.pointerId||c[0].pointerType!==u.pointerType))c[0]=u;else if(c[1]!==null&&c[1].pointerId===u.pointerId){c[1]=u;return}else if(c[0]===null)c[0]=u;else return;if(c[0].pointerId!==u.pointerId)return;const d=a.lO(u,u,c[1]!==null);a.doMouseMove(),a.Sh(d,u)},e.bh=u=>{if(!a.isEnabled)return;e.sf=!0;const c=u.pointerType==="touch"||u.pointerType==="pen",d=a.qb;if(c&&a.Mx){delete d[u.pointerId],u.preventDefault();return}const f=a.yh;if(f[0]!==null&&(f[0].pointerId===u.pointerId||f[0].pointerType!==u.pointerType))f[0]=null;else if(f[1]!==null&&f[1].pointerId===u.pointerId){f[1]=null;return}else return;const m=a.w2(u,!1,!0,!1,!0,!1);let g=H.document.elementFromPoint(u.clientX,u.clientY)||null;g!==null&&g.shadowRoot&&(g=g.shadowRoot.elementFromPoint(u.clientX,u.clientY)||null),g!==null&&g.a instanceof X&&g.a!==a&&g.a.Mp(u,m),g===null&&(g=u.target),a.Mp(u,m),m.clickCount=a.mp,m.targetDiagram=a.s1(u,g),m.targetObject=null,a.doMouseUp(),a.Sh(m,u),c&&(a.pp=!1)},e.kh=u=>{if(!a.isEnabled)return;e.sf=!1;const c=a.qb;c[u.pointerId]&&delete c[u.pointerId];const d=a.yh;if(d[0]!==null&&d[0].pointerId===u.pointerId&&(d[0]=null),d[1]!==null&&d[1].pointerId===u.pointerId&&(d[1]=null),u.pointerType==="touch"||u.pointerType==="pen")return;const f=a.currentTool;f.cancelWaitAfter(),f.standardMouseOver()},e.Ph=u=>{const c=a.yh;c[0]!==null&&c[0].pointerId===u.pointerId?(c[0]=null,a.pp=!1):c[1]!==null&&c[1].pointerId===u.pointerId&&(c[1]=null)};const h=r;if(e.gp=h.F[y.We("7eba17a4ca3b1a8346")][y.We("78a118b7")](h.F,X.Mh,s,s),r.clearContextCache(!0),e.aO(),this._c==="svg"){const u=this.Xo.get("svg");this.Nt&&this.Nt.appendChild(u.bt),this.Wt=u._t}}addEventListener(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}Et(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}removeEventListener(t,e,i,s){t.removeEventListener(e,i,{capture:s})}Le(t,e,i,s){t.removeEventListener(e,i,{capture:s})}aO(){const t=this;let e=this.lt.bt;e instanceof HTMLCanvasElement||(e=t.div),this.Et(e,"pointerdown",t.la,!1),this.Et(e,"pointermove",t.xh,!1),this.Et(e,"pointerup",t.bh,!1),this.Et(e,"pointerout",t.kh,!1),this.Et(e,"pointercancel",t.Ph,!1),this.Et(e,"pointerenter",t.hO,!1),this.Et(e,"pointerleave",t.cO,!1),this.Et(e,"wheel",t.wh,!1),this.Et(e,"keydown",t.fO,!1),this.Et(e,"keyup",t.uO,!1),this.Et(e,"blur",t.dO,!1),this.Et(e,"focus",t.gO,!1),this.Et(e,"selectstart",i=>(i.preventDefault(),!1),!1),this.Et(e,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Et(H,"resize",t.$b,!1)}Cx(){this.yp>30&&(this.Ol=1)}yS(t){this.Ol!==null&&(this.Ol=null,t&&this.Eu(),this.yp=0,this.f2=[0,0,0,0,0],this.wp=0)}computePixelRatio(){return this.Ol!==null?this.Ol:H.devicePixelRatio||1}get avgSpf(){return this.yp}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){const t=this.commandHandler;if(!this.toggleKeyboardControl()){if((t.isFocusEnabled||t.isVirtualPointerEnabled)&&t.doVirtualFocusKeyDown()){const e=this.lastInput;e.bubbles=!1;const i=e.event;i&&(i.stopPropagation&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault());return}this.currentTool.doKeyDown()}}toggleKeyboardControl(){const t=this.lastInput,e=t.commandKey;if((t.control||t.meta)&&t.alt&&(e==="Enter"||e==="NumpadEnter")){const i=this.commandHandler,s=i.isFocusEnabled||i.isVirtualPointerEnabled;return i.isFocusEnabled=!s,i.isVirtualPointerEnabled=!s,i.focus=i.findFirstFocus(),this.T("FocusOrVirtualPointerEnabledChanged"),!0}return!1}doKeyUp(){const t=this.commandHandler;if((t.isFocusEnabled||t.isVirtualPointerEnabled)&&t.doVirtualFocusKeyUp()){const e=this.lastInput;e.bubbles=!1;const i=e.event;i&&(i.stopPropagation&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault());return}this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.lt)if(this.scrollsPageOnFocus)this.lt.focus();else{const t=H.scrollX,e=H.scrollY;this.lt.focus(),H.scrollTo(t,e)}}gO(t){const e=X.Wi.get(this);e&&e.T("GainedFocus")}dO(t){const e=X.Wi.get(this);e&&e.T("LostFocus")}MM(){if(this.lt===null)return;const t=this.Nt;if(t===null||t.clientWidth===0||t.clientHeight===0)return;this.BM||this.setScrollWidth();const e=this.so?this.qt:0,i=this.Pn?this.qt:0,s=this.$e;if(this.$e=this.computePixelRatio(),this.$e!==s&&(this.$u=!0,this.requestUpdate()),t.clientWidth!==this.wt+e||t.clientHeight!==this.xt+i){this.Nh(),this.qi=!0;const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(this.Zc=!0,n.p()),this.Ts||this.requestUpdate()}}QA(){let t=0,e=new Ht;e.name="Grid",e.allowSelect=!1,e.pickable=!1,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),e=new Ht,e.name="ViewportBackground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),e=new Ht,e.name="Background",this.Qr(e,t++),e=new Ht,e.name="",this.Qr(e,t++),e=new Ht,e.name="Foreground",this.Qr(e,t++),e=new Ht,e.name="ViewportForeground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),e=new Ht,e.name="Adornment",e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),e=new Ht,e.name="Tool",e.isTemporary=!0,e.isInDocumentBounds=!0,this.Qr(e,t++)}rT(){const t=new j(j.Grid,{name:"GRID"}).add(new et("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new et("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new et("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new et("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new et("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new et("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),e=new ft({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(t);return this.add(e),this.partManager.parts.delete(e),t.visible=!1,t}static iO(){const t=X.Wi.get(this.parentElement||this);if(t){if(t.Bb){t.Bb=!1;return}if(!t.isEnabled){t.lT();return}t.diagramScroll(this)}}static sO(t){if(!this.a.isEnabled){this.a.updateScroll();return}this.a.zb=t.target.scrollTop,this.a.Xb=t.target.scrollLeft}diagramScroll(t){if(this.lt===null)return;const e=this.Wb,i=this.Jb;this.rp=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.fh;let r=s.x-o.left,a=s.y-o.top;const l=s.width+o.left+o.right,h=s.height+o.top+o.bottom;let u=s.right+o.right,c=s.bottom+o.bottom,d=n.x,f=n.y;const m=n.width,g=n.height;let p=n.right,b=n.bottom;const v=this.scale;let w,k=t.scrollLeft;if(this.ld)switch(this.lb){case"negative":k=k+t.scrollWidth-t.clientWidth;break;case"reverse":k=t.scrollWidth-k-t.clientWidth;break}const S=k;if(m<l||g<h){w=P.z(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Xb!==S&&(w.x=S/v+r,this.Xb=S),this.allowVerticalScroll&&this.zb!==t.scrollTop&&(w.y=t.scrollTop/v+a,this.zb=t.scrollTop),this.position=w,P.i(w),this.rp=!1,this.td=!1;return}if(w=P.l(),t.nO&&this.allowHorizontalScroll&&(r<d&&(this.position=w.e(S+r,this.position.y)),u>p)){const N=e.scrollWidth-this.wt;this.position=w.e(-N+S-this.wt/v+u,this.position.y)}if(t.oO&&this.allowVerticalScroll&&(a<f&&(this.position=w.e(this.position.x,t.scrollTop+a)),c>b)){const N=e.scrollHeight-this.xt;this.position=w.e(this.position.x,-N+t.scrollTop-this.xt/v+c)}P.i(w),this.ha(),this.rp=!1,this.td=!1,s=this.documentBounds,n=this.viewportBounds,u=s.right,p=n.right,c=s.bottom,b=n.bottom,r=s.x,d=n.x,a=s.y,f=n.y,m>=l&&r>=d&&u<=p&&(i.style.width="1px"),g>=h&&a>=f&&c<=b&&(i.style.height="1px")}computeBounds(t){return t===void 0&&(t=new I),this.Te(),this.aT(t)}aT(t){if(this.fixedBounds.isReal())return t.h(this.fixedBounds),t.addMargin(this.Qt),t;let e=!0;const i=this.zt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.Ct.r,a=r.length;for(let l=0;l<a;l++){const h=r[l];if(!h.isInDocumentBounds||!h.isVisible())continue;const u=h.actualBounds;u.isReal()&&(e?(e=!1,t.h(u)):t.unionRect(u))}}return e&&t.e(0,0,0,0),t.addMargin(this.Qt),t}computePartsBounds(t,e){e===void 0&&(e=!1);let i;if(Array.isArray(t))for(let s=0;s<t.length;s++){const n=t[s];!e&&n instanceof U||(n.ensureBounds(),i===void 0?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=t.iterator;for(;s.next();){const n=s.value;!e&&n instanceof U||(n.ensureBounds(),i===void 0?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return i===void 0?new I(NaN,NaN,0,0):i}$s(t){if(!t&&!this.no||this.Ht||this.lt===null||!this.documentBounds.isReal())return;if(this.Ht=!0,t){const c=this.initialPosition;if(c.isReal()){this.Ht=!1,this.position=c;return}let d=this.initialDocumentSpot,f=this.initialViewportSpot;d.isNoSpot()&&(d=T.TopLeft),f.isNoSpot()&&(f=T.TopLeft);const m=P.l();m.setRectSpot(this.documentBounds,d);const g=this.viewportBounds,p=I.z(0,0,g.width,g.height),b=P.l();b.setRectSpot(p,f),b.e(m.x-b.x,m.y-b.y),this.Ht=!1,this.position=b,I.i(p),P.i(b)}let e=this.ia;t&&this.Or!==1&&(e=this.Or);const i=e!==1?this.hd(e):this.scale,s=this.ct.x,n=this.ct.y,o=this.wt/i,r=this.xt/i;let a=this.Jc;const l=this.ip;if(t&&!a.isSpot()&&(l.isSpot()||l.isDefault())){const c=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();a=l.isDefault()&&!c?T.Center:l}this.b2(this.documentBounds,o,r,a,t);const h=this.scale;this.scale=i,this.Ht=!1;const u=this.viewportBounds;u.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new I(s,n,o,r),u,h,!1)}hd(t){const e=this.dp;if(this.lt===null)return e;if(t===1)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return e;const s=i.width,n=i.height,o=this.wt+(this.so?this.qt:0),r=this.xt+(this.Pn?this.qt:0);let a=o/s,l=r/n;const h=this.fh,u=h.left+h.right!==0,c=h.top+h.bottom!==0;(u||c)&&(l===a?(l=(r-this.qt)/n,a=(o-this.qt)/s):l>a?l=(r-this.qt)/n:a=(o-this.qt)/s);let d=0;return t===2?d=Math.min(l,a):t===3&&(l>a?d=(r-this.qt)/n:d=(o-this.qt)/s),d>e&&(d=e),d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),d}zoomToFit(){const t=this.ah;this.ah=1,this.scale=this.hd(2),this.alignDocument(T.Center,T.Center),t!==1&&(this.$s(!1),this.b2(this.documentBounds,this.wt/this.it,this.xt/this.it,this.Jc,!1)),this.ah=t}zoomToRect(t,e){e===void 0&&(e=2);const i=t.width,s=t.height;if(i===0||s===0||isNaN(i)&&isNaN(s))return;let n=1;if(e===2||e===3)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.wt,r=this.xt;e===3?r/s>o/i?n=(r-(this.Pn?this.qt:0))/s:n=(o-(this.so?this.qt:0))/i:n=Math.min(r/s,o/i)}this.scale=n,this.position=new P(t.x,t.y)}get mO(){return this.Ht}set mO(t){this.Ht=t}alignDocument(t,e){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new P(i.x+(t.x*i.width+t.offsetX)-(e.x*s.width-e.offsetX),i.y+(t.y*i.height+t.offsetY)-(e.y*s.height-e.offsetY))}focusObject(t){if(t instanceof tt){this.xp=t;const e=P.l();this.bp=this.transformDocToView(t.getDocumentPoint(T.TopLeft,e)),P.i(e)}else this.xp=null,this.bp=P.mn}b2(t,e,i,s,n){const o=P.z(this.ct.x,this.ct.y);let r=o.x,a=o.y;if(this.xp!==null){let l=P.l();l=this.xp.getDocumentPoint(T.TopLeft,l),r=l.x-this.bp.x/this.scale,a=l.y-this.bp.y/this.scale,s=T.None,P.i(l)}if(n||this.scrollMode===1){s.isSpot()&&(e>t.width&&(r=t.x+(s.x*t.width+s.offsetX)-(s.x*e-s.offsetX)),i>t.height&&(a=t.y+(s.y*t.height+s.offsetY)-(s.y*i-s.offsetY)));const l=this.fh,h=e-t.width;if(e<t.width+l.left+l.right){let c=r+e/2;c=Math.min(c,t.right+Math.max(h,l.right)-e/2),c=Math.max(c,t.left-Math.max(h,l.left)+e/2),r=c-e/2}else r>t.left?r=t.left:r<t.right-e&&(r=t.right-e);const u=i-t.height;if(i<t.height+l.top+l.bottom){let c=a+i/2;c=Math.min(c,t.bottom+Math.max(u,l.bottom)-i/2),c=Math.max(c,t.top-Math.max(u,l.top)+i/2),a=c-i/2}else a>t.top?a=t.top:a<t.bottom-i&&(a=t.bottom-i)}if(o.x=isFinite(r)?r:-this.Qt.left,o.y=isFinite(a)?a:-this.Qt.top,this.positionComputation!==null){const l=this.positionComputation(this,o);o.x=l.x,o.y=l.y}this.Ns.IA(this.ct,o),this.ct.e(o.x,o.y),this.Np(),this.aa(),this.pO(),P.i(o)}findPartAt(t,e){if(e===void 0&&(e=!0),e){const i=this.kS(t,s=>s.part,s=>s.canSelect());if(i instanceof ft)return i}else{const i=this.kS(t,s=>s.part);if(i instanceof ft)return i}return null}findObjectAt(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null),this.Te();const s=this.zt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(t,e,i);if(o!==null)return o}return null}kS(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null),this.Te();const s=this.zt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(t,e,i);if(o!==null)return o}return null}findPartsAt(t,e,i){return e===void 0&&(e=!0),this.yO(t,s=>s.part,e?s=>s instanceof ft&&s.canSelect():null,i)}yO(t,e,i,s){e===void 0&&(e=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Te();const n=this.zt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(t,e,i,s)}return s}findObjectsAt(t,e,i,s){e===void 0&&(e=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Te();const n=this.zt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(t,e,i,s)}return s}findPartsIn(t,e,i,s){return e===void 0&&(e=!1),i===void 0&&(i=!0),this.wO(t,null,n=>n instanceof ft&&(!i||n.canSelect()),e,s)}findObjectsIn(t,e,i,s,n){e===void 0&&(e=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Te();const o=this.zt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(t,e,i,s,n)}return n}MS(t,e,i,s,n,o){const r=new K;this.Te();const a=this.zt.iteratorBackwards;for(;a.next();){const l=a.value;l.visible&&l.MS(t,e,i,s,r,n,o)}return r}wO(t,e,i,s,n){e===void 0&&(e=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Te();const o=this.zt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(t,e,i,s,n)}return n}findPartsNear(t,e,i,s,n){return i===void 0&&(i=!0),s===void 0&&(s=!0),this.xO(t,e,null,o=>o instanceof ft&&(!s||o.canSelect()),i,n)}findObjectsNear(t,e,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Te();const r=this.zt.iteratorBackwards;for(;r.next();){const a=r.value;a.visible&&a.findObjectsNear(t,e,i,s,n,o)}return o}xO(t,e,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Te();const r=this.zt.iteratorBackwards;for(;r.next();){const a=r.value;!a.visible||a.isTemporary||a.findObjectsNear(t,e,i,s,n,o)}return o}acceptEvent(t){return this.rf(t,t instanceof MouseEvent)}rf(t,e){const i=this.Jr;this.Jr=this.gh,this.gh=i,i.diagram=this,i.event=t,e?this.Mp(t,i):(i.viewPoint=this.Jr.viewPoint,i.documentPoint=this.Jr.documentPoint);let s=0;const n=t;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,n.buttons!==void 0&&(i.buttons=n.buttons),y.ur&&n.button===0&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=t.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.s1(t,t.target),i.targetObject=null,i}s1(t,e){if(e===null)return null;const i=X.Wi.get(e);if(i)return i;let s=t.path;if(!s&&y.st(t.composedPath)&&(s=t.composedPath()),s&&s[0]){const n=X.Wi.get(s[0]);if(n)return n}return null}rO(t,e,i){const s=this.w2(t,!0,!1,!1,!0,i);return this.Mp(e,s),s.targetDiagram=this.s1(t,t.target),s.targetObject=null,i||s.clone(this.fp),s}lO(t,e,i){const s=this.w2(t,!1,!1,!1,!1,i);let n=H.document.elementFromPoint(e.clientX,e.clientY)||null;n!==null&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(e.clientX,e.clientY)||null);let o=this,r=t;if(n){const a=this.s1(t,n);a&&(r=e,o=a)}return s.targetDiagram=o,this.Mp(r,s),s.targetObject=null,s}w2(t,e,i,s,n,o){const r=this.Jr;this.Jr=this.gh,this.gh=r,r.diagram=this,r.clickCount=1,r.delta=0;let a=0;return t.ctrlKey&&(a+=1),t.altKey&&(a+=2),t.shiftKey&&(a+=4),t.metaKey&&(a+=8),r.modifiers=a,r.event=t,r.timestamp=t.timeStamp,r.button=i?this.firstInput.button:t.button,r.buttons=t.buttons,y.ur&&t.button===0&&t.ctrlKey&&(r.button=2),r.down=e,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}Sh(t,e){return t.bubbles?!0:(e.stopPropagation!==void 0&&e.stopPropagation(),e.cancelable!==!1&&e.preventDefault(),e.cancelBubble=!0,!1)}fO(t){const e=X.Wi.get(this);if(!e||!e.isEnabled)return!1;const i=e.rf(t,!1);return i.key=t.key,i.code=t.code,i.down=!0,e.doKeyDown(),e.Sh(i,t)}uO(t){const e=X.Wi.get(this);if(!e||!e.isEnabled)return!1;const i=e.rf(t,!1);return i.key=t.key,i.code=t.code,i.up=!0,e.doKeyUp(),e.Sh(i,t)}hO(t){const e=X.Wi.get(this);if(!e||!e.isEnabled)return!1;const i=e.rf(t,!0);return e.mouseEnter!==null&&e.mouseEnter(i),e.currentTool.standardMouseOver(),e.Sh(i,t)}cO(t){const e=X.Wi.get(this);if(!e||!e.isEnabled)return!1;const i=e.rf(t,!0);return e.mouseLeave!==null&&e.mouseLeave(i),e.Sh(i,t)}getMouse(t){const e=this.lt;if(e===null)return new P(0,0);const i=e.getBoundingClientRect(),s=(t.clientX-i.left)*(this.wt/i.width),n=(t.clientY-i.top)*(this.xt/i.height);return new P(s,n).Ki(this.v)}Mp(t,e){const i=this.lt;let s=0,n=0;if(i!==null){const r=i.getBoundingClientRect();s=(t.clientX-r.left)*(this.wt/r.width),n=(t.clientY-r.top)*(this.xt/r.height)}e.viewPoint.e(s,n);const o=P.z(s,n);this.v.Ci(o),e.documentPoint.h(o),P.i(o)}_L(t,e,i){let s;if(this.yh[0]!==null)s=this.yh[e];else return;const n=this.lt;if(n!==null){const o=n.getBoundingClientRect();i.e((s.clientX-o.left)*(this.wt/o.width),(s.clientY-o.top)*(this.xt/o.height))}}invalidateDocumentBounds(){this.mh||(this.mh=!0,this.requestUpdate(!1))}bO(){this.Ts||this.Te(),this.ensureBounds()}redraw(){this.Ht||this.Ts||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Dr}delayInitialization(t){t===void 0&&(t=null);const e=this.animationManager,i=e.isEnabled;e.stopAnimation(),e.isEnabled=!1,this.Sr(),this.no=!1,this.jx=new P(NaN,NaN),e.isEnabled=i,this.Ts=!0;const s=this;t!==null&&y.dn(()=>{s.Ts=!1,e.Gl("Model"),t(s)},1)}requestUpdate(t){if(t===void 0&&(t=!1),this.Dr===!0||this.Ht||t===!1&&this.Ts)return;this.Dr=!0;const e=this;H.requestAnimationFrame(()=>{e.Dr&&e.maybeUpdate()})}maybeUpdate(){this.Zu&&!this.Dr||(this.Zu&&(this.Zu=!1),this.Sr())}k2(t,e){!this.td||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.lT()||(t&&this.Te(),e&&this.$s(!1))}Sr(t){if(this.Ts||(this.Dr=!1,this.Nt===null&&!this.ed.isReal()))return;this.Ts=!0;const e=this.animationManager,i=this.rd;if(!e.isAnimating&&i.length!==0){const u=i.r,c=u.length;for(let d=0;d<c;d++){const f=u[d];f.xi(!1),f.c()}i.clear()}const s=this.o2;s.count>0&&(s.each(u=>u.P2()),s.clear());let n=!1,o=!1;e.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),e.ke||this.MM(),t||this.k2(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.Fl||this.of.count!==0&&this.Ir.size!==0),a=!this.no||this.$r;this.Te(!0);let l=!1;(a||r)&&(this.no?this.S2(!this.Zc,r):(this.startTransaction("Initial Layout"),e.isEnabled===!1&&e.stopAnimation(),this.S2(!1,r)),l=a),this.Zc=!1,this.Fl=!1,this.Te(),this.ls!==null&&(this.ls.visible&&!this.sd&&(this.ca(),this.sd=!0),!this.ls.visible&&this.sd&&(this.sd=!1)),this.Lb||this.bO(),t||this.k2(!0,!1);let h=!1;if(l){const u=I.l();u.h(this.viewportBounds),this.no||(this.no=!0,h=!0,this.skipsUndoManager||(this.undoManager.Px=!0),this.undoManager.Sx=!0,this.kO()),this.PO(),this.Te(!1),t||this.k2(!0,!0),I.i(u)}else if(e.zc&&e.Hx){if(this.Or!==1)this.scale=this.hd(this.Or);else if(this.ia!==1)this.scale=this.hd(this.ia);else{const u=this.initialScale;isFinite(u)&&u>0&&(this.scale=u)}this.$s(!0)}l&&h&&this.commitTransaction("Initial Layout"),t||this.Ge(this.Wt),o&&(this.skipsUndoManager=n),this.Ts=!1}get Qa(){return this.no}kO(){if(this.Or!==1)this.scale=this.hd(this.Or);else if(this.ia!==1)this.scale=this.hd(this.ia);else{const e=this.initialScale;isFinite(e)&&e>0&&(this.scale=e)}this.$s(!0);const t=this.zt.r;this.As(t,t.length,this,this.viewportBounds),this.T("InitialLayoutCompleted"),this.jx.h(this.ct),this.ca()}PO(){this.T("LayoutCompleted")}Cp(t){this.eo.add(t)}addInvalidRoute(t){this.Vo?this.uh.add(t):this.Ir.add(t)}Te(t){if(this.eo.size!==0&&!(!this.Ts&&this.animationManager.isTicking)){if(this.Ts||(this.Fl=!0),t){this.hT(this.eo);return}for(let e=0;e<23&&this.eo.size!==0;e++){const i=new Set(this.eo);this.eo.clear(),this.P2(i,this.eo)}this.nodes.each(e=>{e instanceof at&&e.cT(!1)})}}hT(t,e){for(const i of t)!i.Di()||i instanceof at||(i._r()?(i.ht(1/0,1/0),i.Ut()):e&&e.add(i));for(const i of t)if(i instanceof at){if(!i.isVisible())continue;this.o1(i)}}P2(t,e){this.hT(t,e);for(const i of t){if(!(i instanceof U))continue;const s=i;s.isVisible()&&(s._r()?(s.ht(1/0,1/0),s.Ut()):e.add(s))}for(const i of t)i instanceof pt&&i.isVisible()&&(i._r()?(i.ht(1/0,1/0),i.Ut()):e.add(i))}cd(t){const e=t instanceof X,i=e?t.links:t.memberParts,s=this.eo;if(e)this.Te(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.Di()||n instanceof at||n._r()&&(n.ht(1/0,1/0),n.Ut()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof at){if(!n.isVisible())continue;this.o1(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof U&&s.has(n)&&n.isVisible()&&n._r()&&(n.ht(1/0,1/0),n.Ut())}}o1(t){const e=y.nt(),i=y.nt(),s=t.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof at?(o.Go()||o.as()||o.fa())&&this.o1(o):o instanceof U?o.fromNode===t||o.toNode===t?i.push(o):e.push(o):(o.ht(1/0,1/0),o.Ut()))}let n=e.length;for(let o=0;o<n;o++){const r=e[o];r.ht(1/0,1/0),r.Ut()}y.Z(e),t.ht(1/0,1/0),t.Ut(),n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ht(1/0,1/0),r.Ut()}y.Z(i)}As(t,e,i,s){if(!(!this.tf&&!this.animationManager.isAnimating)){for(let n=0;n<e;n++)t[n].As(i,s);this.Te()}}Ge(t){this.Nt!==null&&(this.lt===null&&y.o("No canvas specified"),this._c==="svg"?this.SO(t):this.MO(t))}MO(t){const e=this.animationManager;if(e.ke||e.isAnimating&&!e.isTicking)return;const i=new Date;if(this.Lp(),this.Nt&&this.Nt.style.opacity==="0")return;const s=t!==this.Wt,n=this.zt.r,o=n.length,r=this;if(this.As(n,o,r,r.viewportBounds),s)t.clearContextCache(!0),this.ha();else if(!this.qi&&!e.isAnimating)return;const a=this.v,l=this.$e;t.setTransform(l,0,0,l,0,0),t.clearRect(0,0,this.wt,this.xt),this.Zt!==1&&(t.globalAlpha=this.Zt),this.M2(t);for(let f=0;f<o;f++)t.setTransform(l,0,0,l,0,0),t.transform(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),t.commitTransform(),n[f].Ge(t,r);let h=!1;this.nf?this.nf.Mh(this,t)&&(h=this.gp()):h=!0,h&&(wt.prototype.Ci=wt.prototype.Mu),s?(this.Wt.clearContextCache(!0),this.ha()):(this.tf=!1,this.qi=!1);const u=+new Date-+i,c=!1,d=this.f2;if(this.Ol===null){d[this.wp]=u,this.wp=(this.wp+1)%d.length;let f=0;for(let m=0;m<d.length;m++)f+=d[m];this.yp=f/d.length}this.Zt!==1&&(t.globalAlpha=1)}SO(t){if(this.Nt===null)return;const e=this.animationManager;if(e.ke||e.isAnimating&&!e.isTicking)return;this.Lp();const i=this.wt,s=this.xt;t.surface.resize(i,s,i,s);const n=this.zt.r,o=n.length,r=this;if(this.As(n,o,r,r.viewportBounds),!this.qi&&!e.isAnimating)return;const a=this.v;t.lastDrawnPart=null,t.setDiagramPosScale(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),this.Zt!==1&&(t.globalAlpha=this.Zt),this.M2(t);const l=this.$e,h=this.lt._t;h.setTransform(l,0,0,l,0,0),h.clearRect(0,0,this.wt,this.xt);for(let c=0;c<o;c++)n[c].Ge(t,r);let u=!1;this.nf?this.nf.Mh(this,h)&&(u=this.gp()):u=!0,u&&(wt.prototype.Ci=wt.prototype.Mu),this.tf=!1,this.qi=!1}l1(t,e,i,s,n,o,r,a,l){o===void 0&&(o=null),r===void 0&&(r=null),a===void 0&&(a=!1),l===void 0&&(l=!1),this.Lp(),t.clearContextCache(!0),this.ha(),this.ph=!0;const h=this.it;this.it=s;const u=this,c=this.zt.r,d=c.length;try{const f=new I(n.x,n.y,i.width/s,i.height/s),m=f.copy();m.addMargin(e),this.ca(m),this.Te(),this.As(c,d,u,f),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i.width,i.height),r!==null&&r!==""&&(t.fillStyle=r,t.fillBackground(0,0,i.width,i.height));const g=wt.l();g.Ue(),g.Gs(e.left,e.top),g.it(s),(n.x!==0||n.y!==0)&&g.Gs(-n.x,-n.y),t.setTransform(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy),t.commitTransform(),t instanceof Wt&&t.setDiagramPosScale(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy),wt.i(g),this.M2(t),t.globalAlpha=this.Zt;const p=this.findLayer("Grid");if(o){const b=new K,v=o.iterator;for(v.reset();v.next();){const w=v.value;w instanceof ft&&(!l&&w.layer===p||(w.Wc(),b.add(w)))}for(let w=0;w<d;w++)c[w].IR(t,u,b,a);b.each(w=>w.Wc())}else for(let b=0;b<d;b++){const v=c[b];v===p?l&&v.Ge(t,u,!0):v.Ge(t,u,a)}this.ph=!1,this.nf&&this.Wt&&this.nf.Mh(this,this.Wt)&&this.gp()}finally{this.it=h,t.clearContextCache(!0),this.ha(),this.As(c,d,u,u.viewportBounds),this.ca(),this.Wt instanceof Wt&&(this.Wt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(t){return this.Rr[t]}setRenderingHint(t,e){t==="minDrawingLength"&&(this._m=e),this.Rr[t]=e,this.redraw()}resetRenderingHints(){this.Rr=new Zt,this.Rr.drawShadows=!0,this.Rr.textGreeking=!0,this.Rr.viewportOptimizations=!y.ur,this.Rr.temporaryPixelRatio=!0,this.Rr.pictureRatioOptimization=!0,this.Rr.minDrawingLength=1,this._m=1}M2(t){const e=this.Rr;if(e===null)return;if(e.imageSmoothingEnabled!==void 0){const s=!!e.imageSmoothingEnabled;t.setImageSmoothingEnabled(s)}const i=e.defaultFont;i!=null&&(t.font=i)}getInputOption(t){return this.Ju[t]}setInputOption(t,e){this.Ju[t]=e}ZR(){this.Ju=new Zt,this.Ju.extraTouchArea=10,this.Ju.extraTouchThreshold=10,this.Ju.hasGestureZoom=!0}set(t){return t?(Object.assign(this,t),this):this}attach(t){return this.setProperties(t)}setProperties(t){return X.Ap(this,t),this}static Ap(t,e){if(!e)return;const i=t instanceof j,s=t instanceof X;for(const n in e){n===""&&y.o("Setting properties requires non-empty property names");let o=t,r=n;if(i||s){const l=n.indexOf(".");if(l>0){const h=n.substring(0,l);i?o=t.findObject(h):(o=t[h],o==null&&(o=t.toolManager[h])),y.$(o)?r=n.substring(l+1):y.o("Unable to find object named: "+h+" in "+t.toString()+" when trying to set property: "+n)}}if(r[0]!=="_"&&!y.jw(o,r))if(s&&r==="ModelChanged"){t.addModelChangedListener(e[r]);continue}else if(s&&r==="Changed"){t.addChangedListener(e[r]);continue}else if(s&&y.jw(t.toolManager,r))o=t.toolManager;else if(s&&t.fT(r)){t.addDiagramListener(r,e[r]);continue}else if(t instanceof ht&&r==="Changed"){t.addChangedListener(e[r]);continue}else y.o('Trying to set undefined property "'+r+'" on object: '+o.toString());const a=e[n];o[r]=a,r[0]==="_"&&o instanceof tt&&o.addCopyProperty(r)}}VA(){if(this.ra.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.ra.count>0;){const t=this.ra;this.ra=new bt;const e=t.iterator;for(;e.next();){const i=e.key;i.invalidateOtherJumpOvers(e.value),i.ai()}}this.C()}}C(t){if(t===void 0)this.qi=!0,this.requestUpdate();else{const e=this.viewportBounds;t.isReal()&&e.intersectsRect(t)&&(this.qi=!0,this.requestUpdate())}this.T("InvalidateDraw")}invalidateViewport(t,e){if(this.qi!==!0){if(this.qi=!0,this._c==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Cx(),this.maybeUpdate(),this.yS(!0)):this.maybeUpdate()}}Nh(){this.td=!0}ha(){this.tf=!0}Lp(){this.$u!==!1&&(this.$u=!1,this.oT(this.wt,this.xt))}oT(t,e){this.aa();const i=this.$e,s=t*i,n=e*i;this.lt.resize(s,n,t,e)&&(this.qi=!0,this.Wt.clearContextCache(!0))}lT(){const t=this.lt;if(t===null||this.ed.isReal())return!0;const e=this.wt,i=this.xt,s=this.Nt;let n=!1,o=this.so?this.qt:0,r=this.Pn?this.qt:0,a=s.clientWidth||e+o,l=s.clientHeight||i+r;const h=this.viewportBounds,u=h.x,c=h.y,d=h.width,f=h.height;if((a!==e+o||l!==i+r)&&(this.so=!1,this.Pn=!1,o=0,r=0,this.wt=a,this.xt=l,this.$u=!0,n=!0,this.aa()),!this.no||!this.viewportBounds.isReal())return!0;const m=this.Wb,g=this.Jb;if(this.td=!1,!n&&!this.so&&!this.Pn&&!this.Qu&&!this._u)return!0;const p=this.documentBounds;let b=0,v=0,w=0,k=0;const S=h.width,N=h.height,D=this.fh;this.contentAlignment.isSpot()?(p.width>S&&(b=D.left,v=D.right),p.height>N&&(w=D.top,k=D.bottom)):(b=D.left,v=D.right,w=D.top,k=D.bottom);const A=p.width+b+v,M=p.height+w+k,C=this.scale,F=C;let O=A>a/C,E=M>l/C;if(!n&&!this.so&&!this.Pn&&!O&&!E)return!0;const B=p.x-b,z=h.x,V=p.right+v;let Y=h.right+o;const _=p.y-w,nt=h.y,$=p.bottom+k;let it=h.bottom+r,Q="1px",rt="1px";if(this.scrollMode===1&&(O||E)){if(O&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let Z=1;B+1<z&&(Z=Math.max((z-B)*C+this.wt,Z)),V>Y+1&&(Z=Math.max((V-Y)*C+this.wt,Z)),S+o+1<A&&(Z=Math.max((A-S)*C+this.wt,Z)),Q=Z.toString()+"px"}if(E&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let Z=1;_+1<nt&&(Z=Math.max((nt-_)*C+this.xt,Z)),$>it+1&&(Z=Math.max(($-it)*C+this.xt,Z)),N+r+1<M&&(Z=Math.max((M-N)*C+this.xt,Z)),rt=Z.toString()+"px"}}let ut=Q!=="1px",gt=rt!=="1px";if(!(ut&&gt)&&(ut||gt)){if(O=!(A<S+o),E=!(M<N+r),gt&&(Y-=this.qt),ut&&(it-=this.qt),O&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let xt=1;B+1<z&&(xt=Math.max((z-B)*C+this.wt,xt)),V>Y+1&&(xt=Math.max((V-Y)*C+this.wt,xt)),S+1<A&&(xt=Math.max((A-S)*C+this.wt,xt)),Q=xt.toString()+"px"}ut=Q!=="1px";let Z=this.xt;if(ut!==this.Pn&&(Z=ut?this.xt-this.qt:this.xt+this.qt),E&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let xt=1;_+1<nt&&(xt=Math.max((nt-_)*C+Z,xt)),$>it+1&&(xt=Math.max(($-it)*C+Z,xt)),N+1<M&&(xt=Math.max((M-N)*C+Z,xt)),rt=xt.toString()+"px"}gt=rt!=="1px"}if(this.rp&&!(ut!==this.Pn||gt!==this.so))return(e!==this.wt||i!==this.xt)&&this.maybeUpdate(),!1;if(ut!==this.Pn&&(Q==="1px"?this.xt=this.xt+this.qt:this.xt=Math.max(this.xt-this.qt,1),n=!0),this.Pn=ut,g.style.width=Q,gt!==this.so&&(rt==="1px"?this.wt=this.wt+this.qt:this.wt=Math.max(this.wt-this.qt,1),n=!0,this.ld)){const Z=P.l();gt?(t.style.left=this.qt+"px",this.position=Z.e(this.ct.x+this.qt/this.scale,this.ct.y)):(t.style.left="0px",this.position=Z.e(this.ct.x-this.qt/this.scale,this.ct.y)),P.i(Z)}n&&this.aa(),this.so=gt,g.style.height=rt,this.Bb=!0,n&&(this.$u=!0);let vt=m.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(S+1<A?vt=(this.position.x-B)*C:B+1<z?vt=m.scrollWidth-m.clientWidth:V>Y+1&&(vt=this.position.x*C)),this.ld)switch(this.lb){case"negative":vt=-(m.scrollWidth-vt-m.clientWidth);break;case"reverse":vt=m.scrollWidth-vt-m.clientWidth;break}if(m.scrollLeft=vt,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(N+1<M?m.scrollTop=(this.position.y-_)*C:_+1<nt?m.scrollTop=m.scrollHeight-m.clientHeight:$>it+1&&(m.scrollTop=this.position.y*C)),a=this.wt,l=this.xt,m.style.width=a+(this.so?this.qt:0)+"px",m.style.height=l+(this.Pn?this.qt:0)+"px",e!==a||i!==l||this.animationManager.ke){const Z=I.z(u,c,d,f);return this.onViewportBoundsChanged(Z,this.viewportBounds,F,n),I.i(Z),!1}return!0}add(t){const e=t.diagram;if(e===this)return;e!==null&&y.o("Cannot add part "+t.toString()+" to "+this.toString()+". It is already a part of "+e.toString());let i=this.findLayer(t.layerName);if(i===null&&(i=this.findLayer("")),i===null&&y.o('Cannot add a Part when unable find a Layer named "'+t.layerName+'" and there is no default Layer'),t.layer===i)return;const s=i.ch(99999999,t,t.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,t,null,s),i.isTemporary||this.invalidateDocumentBounds(),t.invalidateLayout(1);const n=t.layerChanged;n!==null&&n(t,null,i)}ch(t){this.partManager.ch(t);const e=this;X.isUsingDOM()&&t.Sn(i=>e.uT(i)),t.data||t.Yo(),t.hasPlaceholder()&&t.c(),t.data!==null&&t.Sn(i=>e.partManager.N2(i,null)),(t.as()===!0||t.fa()===!0)&&this.Cp(t),t.dT(!0,this),t instanceof W&&t.canAvoid()&&this.fd(t),t.gT()?(t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.kp!==null&&this.kp(this,t),this.requestUpdate()}ri(t){t.clearAdornments(),this.partManager.ri(t);const e=this;t.data!==null&&t.Sn(i=>e.partManager.C2(i,e)),this.eo.delete(t),t instanceof U?this.Ir.delete(t):t instanceof W&&t.canAvoid()&&this.fd(t),t.gT()?(t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.Pp!==null&&this.Pp(this,t),this.requestUpdate()}remove(t){this.L2(t,!0)}L2(t,e){const i=t.layer;if(i===null||i.diagram!==this)return;t.isSelected=!1,t.isHighlighted=!1,t.invalidateLayout(2),e&&t.lf();const s=i.ri(-1,t,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,t,null,s,null);const n=t.layerChanged;n!==null&&n(t,i,null)}removeParts(t,e){if(e===void 0&&(e=!1),Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++){const n=t[s];e&&!n.canDelete()||this.remove(n)}}else{const i=new K;i.addAll(t);const s=i.iterator;for(;s.next();){const n=s.value;e&&!n.canDelete()||this.remove(n)}}}copyParts(t,e,i){i===void 0&&(i=!1);let s=null;const n=e||this,o=n.model;let r=!1,a=!1;try{o.Vm()&&(r=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.Um()||o.a1())&&(a=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(t,e,i)}finally{o.Vm()&&(o.copiesParentKeyOfNodeData=r),(o.Um()||o.a1())&&(o.copiesGroupKeyOfNodeData=a)}return s}moveParts(t,e,i,s){if(i===void 0&&(i=!1),s===void 0&&(s=this.Tp()),this.toolManager===null)return;const n=new bt;if(t!==null)if(Array.isArray(t))for(let o=0;o<t.length;o++)this.tl(n,t[o],i,s);else{const o=t.iterator;for(;o.next();)this.tl(n,o.value,i,s)}else{let o=this.parts;for(;o.next();){const r=o.value;this.tl(n,r,i,s)}for(o=this.nodes;o.next();){const r=o.value;this.tl(n,r,i,s)}for(o=this.links;o.next();){const r=o.value;this.tl(n,r,i,s)}}this.Lx(n,e,s,i)}tl(t,e,i,s,n){if(!t.has(e)&&(n===void 0&&(n=!1),!(i&&!n&&!e.canMove()&&!e.canCopy())))if(s===void 0&&(s=this.Tp()),e instanceof W){if(t.set(e,this.Ws(s,e,e.location)),e instanceof at&&(e.hasPlaceholder()||s.dragsMembers)){const r=e.memberParts;for(;r.next();){const a=r.value;this.tl(t,a,i,s,s.groupsAlwaysMove)}}const o=e.linksConnected;for(;o.next();){const r=o.value;if(t.has(r))continue;const a=r.fromNode,l=r.toNode;a!==null&&t.has(a)&&l!==null&&t.has(l)&&this.tl(t,r,i,s)}if(s.dragsTree){const r=e.findTreeChildrenNodes();for(;r.next();){const a=r.value;this.tl(t,a,i,s)}}}else if(e instanceof U){t.set(e,this.Ws(s,e));const o=e.labelNodes;for(;o.next();){const r=o.value;this.tl(t,r,i,s)}}else e instanceof pt||t.set(e,this.Ws(s,e,e.location))}Lx(t,e,i,s){if(t===null||t.count===0)return;const n=P.l(),o=P.l();o.h(e),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.Qb;r||this.uA(t);const a=y.nt(),l=y.nt(),h=t.iterator;let u=P.l();for(;h.next();){const g=h.key,p=h.value;if(g.Di()){const b=this.mT(g,t);if(b!==null)a.push(new Es(g,p,b));else if(!s||g.canMove()){const v=p.point;n.h(v),this.computeMove(g,n.add(o),i,u),g.location=u,p.shifted===void 0&&(p.shifted=new P),p.shifted.h(u.subtract(v))}}else h.key instanceof U&&l.push(new ne(h.key,h.value))}P.i(u);const c=a.length;for(let g=0;g<c;g++){const p=a[g],b=p.pT.point;n.h(b),p.h1.shifted===void 0&&(p.h1.shifted=new P),p.Ri.location=n.add(p.h1.shifted)}const d=P.l(),f=P.l(),m=l.length;for(let g=0;g<m;g++){const p=l[g],b=p.key;if(b instanceof U){if(b.suspendsRouting){b.vr=null;const v=b.fromNode,w=b.toNode;if(this.draggedLink!==null&&i.dragsLink){const k=p.value.point;if(b.dragComputation===null){t.set(b,this.Ws(i,b,o));const S=o.x-k.x,N=o.y-k.y;b.Pr(S,N)}else{const S=P.z(0,0),N=b.getPoint(0);N&&N.isReal()&&S.h(N),u=P.l().h(S).add(o);let D=u;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(D=P.l(),this.lM(b,u,D,i)),u.h(b.dragComputation(b,u,D)).subtract(S),t.set(b,this.Ws(i,b,u));const A=u.x-k.x,M=u.y-k.y;b.Pr(A,M),P.i(S),P.i(u),D!==u&&P.i(D)}}else{if(v!==null){d.h(v.location);const k=t.get(v);k!==null&&d.subtract(k.point)}if(w!==null){f.h(w.location);const k=t.get(w);k!==null&&f.subtract(k.point)}if(v!==null&&w!==null)if(d.equalsApprox(f)){const k=p.value.point,S=n;S.h(d),S.subtract(k),t.set(b,this.Ws(i,b,d)),b.Pr(S.x,S.y)}else b.suspendsRouting=!1,b.$t();else{const k=p.value.point;let S;v!==null?S=d:w!==null?S=f:S=o,t.set(b,this.Ws(i,b,S));const N=S.x-k.x,D=S.y-k.y;b.Pr(N,D)}}}else if(b.fromNode===null||b.toNode===null){const v=p.value.point;t.set(b,this.Ws(i,b,o));const w=o.x-v.x,k=o.y-v.y;b.Pr(w,k)}}}P.i(n),P.i(o),P.i(d),P.i(f),y.Z(a),y.Z(l),r||(this.Te(),this.pS(t))}computeMove(t,e,i,s){if(s===void 0&&(s=new P),s.h(e),t===null)return s;let n=e;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=P.l(),this.lM(t,e,n,i));const r=t.dragComputation!==null?t.dragComputation(t,e,n):n,a=t.minLocation;let l=a.x;isNaN(l)&&(l=o?Math.round(t.location.x*1e3)/1e3:t.location.x);let h=a.y;isNaN(h)&&(h=o?Math.round(t.location.y*1e3)/1e3:t.location.y);const u=t.maxLocation;let c=u.x;isNaN(c)&&(c=o?Math.round(t.location.x*1e3)/1e3:t.location.x);let d=u.y;return isNaN(d)&&(d=o?Math.round(t.location.y*1e3)/1e3:t.location.y),s.e(Math.max(l,Math.min(r.x,c)),Math.max(h,Math.min(r.y,d))),n!==e&&P.i(n),s}Tp(){const t=this.toolManager.findTool("Dragging");return t instanceof St?t.dragOptions:this.ad}lM(t,e,i,s){if(s===void 0&&(s=this.Tp()),i.h(e),t===null)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,a=o.height;const l=s.gridSnapOrigin;let h=l.x,u=l.y;const c=s.gridSnapCellSpot;if(n!==null){const f=n.gridCellSize;isNaN(r)&&(r=f.width),isNaN(a)&&(a=f.height);const m=n.gridOrigin;isNaN(h)&&(h=m.x),isNaN(u)&&(u=m.y)}const d=P.z(0,0);return d.setSpot(0,0,r,a,c),L.tm(e.x,e.y,h+d.x,u+d.y,r,a,i),P.i(d),i}uA(t){if(t===null)return;this.Qb=!0;const e=t.iterator;for(;e.next();){const i=e.key;i instanceof U&&(i.suspendsRouting=!0)}}pS(t){if(t===null)return;const e=t.iterator;for(;e.next();){const i=e.key;i instanceof U&&(i.suspendsRouting=!1,i.yT()&&i.$t())}this.Qb=!1}get draggedLink(){return this._b}set draggedLink(t){this._b!==t&&(this._b=t,t!==null&&(this.t1=t.fromPort,this.e1=t.toPort))}get PS(){return this.t1}set PS(t){this.t1=t}get SS(){return this.e1}set SS(t){this.e1=t}mT(t,e){const i=t.containingGroup;if(i!==null){let s=this.mT(i,e);if(s!==null||(s=e.get(i),s!==null))return s}return null}Ws(t,e,i){if(i===void 0)return new Te(P.gn);let s=t.isGridSnapEnabled;return!t.groupsSnapMembers&&e.containingGroup!==null&&(s=!1),s?new Te(new P(Math.round(i.x*1e3)/1e3,Math.round(i.y*1e3)/1e3)):new Te(i.copy())}A2(t,e){if(t.diagram!==null&&t.diagram!==this&&y.o("Cannot share a Layer with another Diagram: "+t+" of "+t.diagram),e===null?t.diagram!==null&&y.o("Cannot add an existing Layer to this Diagram again: "+t):(e.diagram!==this&&y.o("Existing Layer must be in this Diagram: "+e+" not in "+e.diagram),t===e&&y.o("Cannot move a Layer before or after itself: "+t)),t.diagram===this)return;const i=t.name,s=this.zt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&y.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(t){this.A2(t,null),t.Eo(this);const e=this.zt;let i=e.count-1;if(!t.isTemporary)for(;i>=0&&e.elt(i).isTemporary;)i--;return e.insertAt(i+1,t),this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(t,e){this.A2(t,e),t.Eo(this);const i=this.zt,s=i.indexOf(t);s>=0&&(i.delete(t),this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===e){i.insertAt(o,t);break}return this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(t,e){this.A2(t,e),t.Eo(this);const i=this.zt,s=i.indexOf(t);s>=0&&(i.delete(t),this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===e){i.insertAt(o+1,t);break}return this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Qr(t,e){t.Eo(this),this.zt.insertAt(e,t)}wT(t){this.zt.removeAt(t)}removeLayer(t){if(t.diagram!==this&&y.o("Cannot remove a Layer from another Diagram: "+t+" of "+t.diagram),t.name==="")return;const e=this.zt,i=e.indexOf(t);if(e.delete(t)){const s=t.Ct.copy().iterator;for(;s.next();){const n=s.value,o=n.layerName;o!==t.name?n.layerName=o:n.layerName=""}this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,t,null,i,null),this.C(),this.invalidateDocumentBounds()}}findLayer(t){const e=this.layers;for(;e.next();){const i=e.value;if(i.name===t)return i}return null}findRouter(t){for(const e of this.of)if(e.name===t)return e;return null}addModelChangedListener(t){return y.S(t,X,"addModelChangedListener:listener"),this.io===null&&(this.io=new J),this.io.add(t),this.model&&this.model.addChangedListener(t),this}removeModelChangedListener(t){y.S(t,X,"removeModelChangedListener:listener"),this.io!==null&&(this.io.delete(t),this.io.count===0&&(this.io=null)),this.model.removeChangedListener(t)}addChangedListener(t){return y.S(t,X,"addChangedListener:listener"),this.Er===null&&(this.Er=new J),this.Er.add(t),this}removeChangedListener(t){y.S(t,X,"removeChangedListener:listener"),this.Er!==null&&(this.Er.delete(t),this.Er.count===0&&(this.Er=null))}T2(t){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(t),t.change!==1&&(this.isModified=!0),this.Er!==null){const e=this.Er,i=e.length;for(let s=0;s<i;s++)e.elt(s)(t)}}raiseChangedEvent(t,e,i,s,n,o,r){o===void 0&&(o=null),r===void 0&&(r=null);const a=new Ne;a.diagram=this,a.change=t,a.propertyName=e,a.object=i,a.oldValue=s,a.oldParam=o,a.newValue=n,a.newParam=r,this.T2(a)}raiseChanged(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}t(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}get partAdded(){return this.kp}set partAdded(t){this.partAdded!==t&&(this.kp=t)}get partRemoved(){return this.Pp}set partRemoved(t){this.partRemoved!==t&&(this.Pp=t)}get animationManager(){return this.Ns}get undoManager(){return this.Ce.undoManager}get skipsUndoManager(){return this.Bo}set skipsUndoManager(t){y.s(t,"boolean",X,"skipsUndoManager"),this.Bo=t,this.Ce.skipsUndoManager=t}get delaysLayout(){return this.Ab}set delaysLayout(t){this.Ab=t}tA(t,e){if(t===null||t.diagram!==this)return;const i=this.wi;try{this.wi=!0;const s=t.change;if(s===2){const n=t.object,o=t.propertyName,r=t.getValue(e);if(t.diagram.model.et(n,o,r),n instanceof tt){const a=n.part;a!==null&&(a.invalidateAdornments(),a instanceof U&&(a.fromNode?.Ze(a.fromPort),a.toNode?.Ze(a.toPort)))}this.isModified=!0}else if(s===3){const n=t.object,o=t.newParam,r=t.newValue;if(n instanceof j)if(typeof o=="number"&&r instanceof tt){e?n.ri(o):n.insertAt(o,r);const a=n.part;a!==null&&a.invalidateAdornments()}else typeof o=="number"&&r instanceof Dt&&(r.isRow?n.xT(o,e?void 0:r):n.bT(o,e?void 0:r));else if(n instanceof Ht){const a=t.oldParam===!0;typeof o=="number"&&r instanceof ft&&(e?(a||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.ri(a?o:-1,r,a)):n.ch(o,r,a))}else n instanceof X?typeof o=="number"&&r instanceof Ht&&(e?this.wT(o):this.Qr(r,o)):y.o("unknown ChangeType.Insert object: "+t.toString());this.isModified=!0}else if(s===4){const n=t.object,o=t.oldParam,r=t.oldValue;if(n instanceof j)typeof o=="number"&&r instanceof tt?e?n.insertAt(o,r):n.ri(o):typeof o=="number"&&r instanceof Dt&&(r.isRow?n.xT(o,e?r:void 0):n.bT(o,e?r:void 0));else if(n instanceof Ht){const a=t.newParam===!0;typeof o=="number"&&r instanceof ft&&(e?n.Ct.indexOf(r)<0&&n.ch(o,r,a):(a||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.ri(a?o:-1,r,a)))}else n instanceof X?typeof o=="number"&&r instanceof Ht&&(e?this.Qr(r,o):this.wT(o)):y.o("unknown ChangeType.Remove object: "+t.toString());this.isModified=!0}else s===1||y.o("unknown ChangedEvent: "+t.toString())}finally{this.wi=i}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(t){this.partManager.updateAllTargetBindings(t)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.ls!==null){const t=this.ls.part;t!==null&&t.Yo()}}setDivBackground(t){this.div&&(this.div.style.backgroundColor=t)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}Np(){const t=this.v,e=this.it,i=this.ct;t.Ue(),e!==1&&t.it(e),(i.x!==0||i.y!==0)&&t.Gs(-i.x,-i.y)}kT(t,e){const i=this.animationManager;if(this.Ht||this.Ts){this.it=e,this.aa(),this.C(),this.Nh(),i.EA(t,this.it),this.Np();return}if(this.lt===null){this.it=e,this.Np();return}this.Ht=!0;const s=this.viewportBounds.copy(),n=this.wt,o=this.xt;let r=this.zoomPoint.x,a=this.zoomPoint.y;const l=this.contentAlignment;isNaN(r)&&(l.isSide()?l.includesSide(T.LeftSide)?r=0:l.includesSide(T.RightSide)&&(r=n-1):l.isSpot()?r=l.x*(n-1):r=n/2),isNaN(a)&&(l.isSide()?l.includesSide(T.TopSide)?a=0:l.includesSide(T.BottomSide)&&(a=o-1):l.isSpot()?a=l.y*(o-1):a=o/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(e=this.scaleComputation(this,e)),e<this.minScale&&(e=this.minScale),e>this.maxScale&&(e=this.maxScale);const h=P.z(this.ct.x+r/t-r/e,this.ct.y+a/t-a/e);this.position=h,P.i(h),this.it=e,this.Np(),this.aa(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,t,!1),this.$s(!1),i.EA(t,this.it),this.C()}pO(){const t=this.zt.r;for(let e=0;e<t.length;e++)t[e].YA()}onViewportBoundsChanged(t,e,i,s){if(t.equals(e))return;s===void 0&&(s=!1),s||this.Nh(),this.ha();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(t.width!==e.width||t.height!==e.height)&&n.p();const o=this.currentTool;this.sf===!0&&o instanceof Ce&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.cA(this)),this.Ht||this.invalidateViewport(t,e),this.ca(),this.Ye.scale=i,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.canvasSize.width=Math.round(t.width*i),this.Ye.canvasSize.height=Math.round(t.height*i),this.Ye.newCanvasSize.width=this.wt,this.Ye.newCanvasSize.height=this.xt,this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,t),this.isVirtualized&&this.links.each(r=>{r.isAvoiding&&r.actualBounds.intersectsRect(e)&&r.$t()})}ca(t){const e=this.ls;if(e===null||!e.visible||e.part===null||e.layer===null)return;const i=t!==void 0?t:this.Yb;if(!i.isReal())return;const s=i.width,n=i.height;if(e.scale=1,e.angle=0,e.layer.isViewportAligned)e.width=s*this.scale,e.height=n*this.scale,e.part.alignment=T.TopLeft;else{e.Pe===null&&(e.Pe=new Oe);const o=e.Pe.af;if(!o.isReal())return;e.width=s+o.width*2,e.height=n+o.height*2;const r=P.l();L.tm(i.x,i.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),e.part.location=r,P.i(r)}}clearSelection(t){t===void 0&&(t=!1);const e=this.selection;if(e.count===0)return;t||this.T("ChangingSelection",e);const i=e.toArray(),s=i.length;for(let n=0;n<s;n++){const o=i[n];o.isSelected=!1}e.ce(),e.clear(),e.k(),t||this.T("ChangedSelection",e)}select(t){t!==null&&t.diagram===this&&(!t.isSelected||this.selection.count>1)&&(this.T("ChangingSelection",this.selection),this.clearSelection(!0),t.isSelected=!0,this.T("ChangedSelection",this.selection))}selectCollection(t){if(this.T("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++){const s=t[i];s instanceof ft||y.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const e=t.iterator;for(;e.next();){const i=e.value;i instanceof ft||y.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.T("ChangedSelection",this.selection)}clearHighlighteds(){const t=this.highlighteds;if(t.count>0){const e=t.toArray(),i=e.length;for(let s=0;s<i;s++){const n=e[s];n.isHighlighted=!1}t.ce(),t.clear(),t.k()}}highlight(t){t!==null&&t.diagram===this&&(!t.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),t.isHighlighted=!0)}highlightCollection(t){const e=new K().addAll(t),i=this.highlighteds.copy().removeAll(e).iterator;for(;i.next();){const n=i.value;n.isHighlighted=!1}const s=e.iterator;for(;s.next();){const n=s.value;n instanceof ft||y.o("Diagram.highlightCollection given something that is not a Part: "+n),n.isHighlighted=!0}}scroll(t,e,i){i===void 0&&(i=1);const s=e==="up"||e==="down";let n=0;const o=P.l();if(t==="pixel")n=i;else if(t==="line")n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(t==="page"){let a=s?this.viewportBounds.height:this.viewportBounds.width;if(a*=this.scale,a!==0){const l=Math.max(a-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*l}}else if(t==="document"){const a=this.documentBounds,l=this.viewportBounds;e==="up"?this.position=o.e(l.x,a.y):e==="left"?this.position=o.e(a.x,l.y):e==="down"?this.position=o.e(l.x,a.bottom-l.height):e==="right"&&(this.position=o.e(a.right-l.width,l.y)),P.i(o);return}else y.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+t);n/=this.scale;const r=this.position;e==="up"?this.position=o.e(r.x,r.y-n):e==="down"?this.position=o.e(r.x,r.y+n):e==="left"?this.position=o.e(r.x-n,r.y):e==="right"?this.position=o.e(r.x+n,r.y):y.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+e),P.i(o)}scrollToRect(t){const e=this.viewportBounds;if(e.containsRect(t))return;const i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}centerRect(t){const e=this.viewportBounds,i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}transformDocToView(t){return t.copy().v(this.v)}transformViewToDoc(t){return t.copy().Ki(this.v)}GR(t){return t.Ki(this.v)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this.Zt}set opacity(t){const e=this.Zt;e!==t&&(y.s(t,"number",X,"opacity"),(t<0||t>1)&&y.J(t,"0 <= value <= 1",X,"opacity"),this.Zt=t,this.t("opacity",e,t),this.C())}get validCycle(){return this.Pb}set validCycle(t){const e=this.Pb;e!==t&&(this.Pb=t,this.t("validCycle",e,t))}get layers(){return this.zt.iterator}get isModelReadOnly(){const t=this.Ce;return t===null?!1:t.isReadOnly}set isModelReadOnly(t){const e=this.Ce;e!==null&&(e.isReadOnly=t)}get isReadOnly(){return this.zo}set isReadOnly(t){const e=this.zo;e!==t&&(y.s(t,"boolean",X,"isReadOnly"),this.zo=t,this.t("isReadOnly",e,t))}get isEnabled(){return this.Be}set isEnabled(t){const e=this.Be;e!==t&&(y.s(t,"boolean",X,"isEnabled"),this.Be=t,this.t("isEnabled",e,t))}get allowClipboard(){return this.Tb}set allowClipboard(t){const e=this.Tb;e!==t&&(y.s(t,"boolean",X,"allowClipboard"),this.Tb=t,this.t("allowClipboard",e,t))}get allowCopy(){return this.Yl}set allowCopy(t){const e=this.Yl;e!==t&&(y.s(t,"boolean",X,"allowCopy"),this.Yl=t,this.t("allowCopy",e,t))}get allowDelete(){return this.Kl}set allowDelete(t){const e=this.Kl;e!==t&&(y.s(t,"boolean",X,"allowDelete"),this.Kl=t,this.t("allowDelete",e,t))}get allowDragOut(){return this.Db}set allowDragOut(t){const e=this.Db;e!==t&&(y.s(t,"boolean",X,"allowDragOut"),this.Db=t,this.t("allowDragOut",e,t))}get allowDrop(){return this.vb}set allowDrop(t){const e=this.vb;e!==t&&(y.s(t,"boolean",X,"allowDrop"),this.vb=t,this.t("allowDrop",e,t))}get allowTextEdit(){return this.Hl}set allowTextEdit(t){const e=this.Hl;e!==t&&(y.s(t,"boolean",X,"allowTextEdit"),this.Hl=t,this.t("allowTextEdit",e,t))}get allowGroup(){return this.jl}set allowGroup(t){const e=this.jl;e!==t&&(y.s(t,"boolean",X,"allowGroup"),this.jl=t,this.t("allowGroup",e,t))}get allowUngroup(){return this.ql}set allowUngroup(t){const e=this.ql;e!==t&&(y.s(t,"boolean",X,"allowUngroup"),this.ql=t,this.t("allowUngroup",e,t))}get allowInsert(){return this.Fb}set allowInsert(t){const e=this.Fb;e!==t&&(y.s(t,"boolean",X,"allowInsert"),this.Fb=t,this.t("allowInsert",e,t))}get allowLink(){return this.Wl}set allowLink(t){const e=this.Wl;e!==t&&(y.s(t,"boolean",X,"allowLink"),this.Wl=t,this.t("allowLink",e,t))}get allowRelink(){return this.Jl}set allowRelink(t){const e=this.Jl;e!==t&&(y.s(t,"boolean",X,"allowRelink"),this.Jl=t,this.t("allowRelink",e,t))}get allowMove(){return this.$l}set allowMove(t){const e=this.$l;e!==t&&(y.s(t,"boolean",X,"allowMove"),this.$l=t,this.t("allowMove",e,t))}get allowReshape(){return this.Zl}set allowReshape(t){const e=this.Zl;e!==t&&(y.s(t,"boolean",X,"allowReshape"),this.Zl=t,this.t("allowReshape",e,t))}get allowResize(){return this.Ql}set allowResize(t){const e=this.Ql;e!==t&&(y.s(t,"boolean",X,"allowResize"),this.Ql=t,this.t("allowResize",e,t))}get allowRotate(){return this._l}set allowRotate(t){const e=this._l;e!==t&&(y.s(t,"boolean",X,"allowRotate"),this._l=t,this.t("allowRotate",e,t))}get allowSelect(){return this.ta}set allowSelect(t){const e=this.ta;e!==t&&(y.s(t,"boolean",X,"allowSelect"),this.ta=t,this.t("allowSelect",e,t))}get allowUndo(){return this.Rb}set allowUndo(t){const e=this.Rb;e!==t&&(y.s(t,"boolean",X,"allowUndo"),this.Rb=t,this.t("allowUndo",e,t))}get allowZoom(){return this.Ob}set allowZoom(t){const e=this.Ob;e!==t&&(y.s(t,"boolean",X,"allowZoom"),this.Ob=t,this.t("allowZoom",e,t))}get hasVerticalScrollbar(){return this._u}set hasVerticalScrollbar(t){const e=this._u;e!==t&&(y.s(t,"boolean",X,"hasVerticalScrollbar"),this._u=t,this.Nh(),this.C(),this.t("hasVerticalScrollbar",e,t),this.$s(!1))}get hasHorizontalScrollbar(){return this.Qu}set hasHorizontalScrollbar(t){const e=this.Qu;e!==t&&(y.s(t,"boolean",X,"hasHorizontalScrollbar"),this.Qu=t,this.Nh(),this.C(),this.t("hasHorizontalScrollbar",e,t),this.$s(!1))}get allowHorizontalScroll(){return this.Ib}set allowHorizontalScroll(t){const e=this.Ib;e!==t&&(y.s(t,"boolean",X,"allowHorizontalScroll"),this.Ib=t,this.t("allowHorizontalScroll",e,t),this.$s(!1))}get allowVerticalScroll(){return this.Eb}set allowVerticalScroll(t){const e=this.Eb;e!==t&&(y.s(t,"boolean",X,"allowVerticalScroll"),this.Eb=t,this.t("allowVerticalScroll",e,t),this.$s(!1))}get scrollHorizontalLineChange(){return this.Ub}set scrollHorizontalLineChange(t){const e=this.Ub;e!==t&&(y.s(t,"number",X,"scrollHorizontalLineChange"),t<0&&y.J(t,">= 0",X,"scrollHorizontalLineChange"),this.Ub=t,this.t("scrollHorizontalLineChange",e,t))}get scrollVerticalLineChange(){return this.Vb}set scrollVerticalLineChange(t){const e=this.Vb;e!==t&&(y.s(t,"number",X,"scrollVerticalLineChange"),t<0&&y.J(t,">= 0",X,"scrollVerticalLineChange"),this.Vb=t,this.t("scrollVerticalLineChange",e,t))}get lastInput(){return this.gh}set lastInput(t){this.gh=t}get previousInput(){return this.Jr}set previousInput(t){this.Jr=t}get firstInput(){return this.fp}set firstInput(t){this.fp=t}get currentCursor(){return this.Sb}set currentCursor(t){if(t===""&&(t=this.op),this.Sb!==t){y.s(t,"string",X,"currentCursor");const e=this.lt,i=this.Nt;if(e===null||i===null)return;this.Sb=t;const s=e.style.cursor;e.style.cursor=t,i.style.cursor=t,e.style.cursor===s&&(e.style.cursor="-webkit-"+t,i.style.cursor="-webkit-"+t,e.style.cursor===s&&(e.style.cursor="-moz-"+t,i.style.cursor="-moz-"+t,e.style.cursor===s&&(e.style.cursor=t,i.style.cursor=t)))}}get defaultCursor(){return this.op}set defaultCursor(t){t===""&&(t="auto");const e=this.op;e!==t&&(y.s(t,"string",X,"defaultCursor"),this.op=t,this.t("defaultCursor",e,t))}get click(){return this.Ur}set click(t){const e=this.Ur;e!==t&&(t!==null&&y.S(t,X,"click"),this.Ur=t,this.t("click",e,t))}get doubleClick(){return this.Vr}set doubleClick(t){const e=this.Vr;e!==t&&(t!==null&&y.S(t,X,"doubleClick"),this.Vr=t,this.t("doubleClick",e,t))}get contextClick(){return this.Br}set contextClick(t){const e=this.Br;e!==t&&(t!==null&&y.S(t,X,"contextClick"),this.Br=t,this.t("contextClick",e,t))}get mouseOver(){return this.zr}set mouseOver(t){const e=this.zr;e!==t&&(t!==null&&y.S(t,X,"mouseOver"),this.zr=t,this.t("mouseOver",e,t))}get mouseHover(){return this.Xr}set mouseHover(t){const e=this.Xr;e!==t&&(t!==null&&y.S(t,X,"mouseHover"),this.Xr=t,this.t("mouseHover",e,t))}get mouseHold(){return this.Gr}set mouseHold(t){const e=this.Gr;e!==t&&(t!==null&&y.S(t,X,"mouseHold"),this.Gr=t,this.t("mouseHold",e,t))}get mouseDragOver(){return this.Mb}set mouseDragOver(t){const e=this.Mb;e!==t&&(t!==null&&y.S(t,X,"mouseDragOver"),this.Mb=t,this.t("mouseDragOver",e,t))}get mouseDrop(){return this.Yr}set mouseDrop(t){const e=this.Yr;e!==t&&(this.Yr=t,this.t("mouseDrop",e,t))}get handlesDragDropForTopLevelParts(){return this.Nb}set handlesDragDropForTopLevelParts(t){const e=this.Nb;e!==t&&(y.s(t,"boolean",X,"handlesDragDropForTopLevelParts"),this.Nb=t,this.t("handlesDragDropForTopLevelParts",e,t))}get mouseEnter(){return this.Kr}set mouseEnter(t){const e=this.Kr;e!==t&&(t!==null&&y.S(t,X,"mouseEnter"),this.Kr=t,this.t("mouseEnter",e,t))}get mouseLeave(){return this.Hr}set mouseLeave(t){const e=this.Hr;e!==t&&(t!==null&&y.S(t,X,"mouseLeave"),this.Hr=t,this.t("mouseLeave",e,t))}get toolTip(){return this.jr}set toolTip(t){const e=this.jr;e!==t&&(this.jr=t,this.t("toolTip",e,t))}get contextMenu(){return this.qr}set contextMenu(t){const e=this.qr;e!==t&&(this.qr=t,this.t("contextMenu",e,t))}get commandHandler(){return this.jM}set commandHandler(t){const e=this.jM;e!==t&&(e&&e.doStop(),this.jM=t,t.Eo(this),t.doStart())}get toolManager(){return this.YM}set toolManager(t){this.YM!==t&&(this.YM=t,t.diagram=this)}get defaultTool(){return this.KM}set defaultTool(t){const e=this.KM;e!==t&&(this.KM=t,t.diagram=this,this.currentTool===e&&(this.currentTool=t))}get currentTool(){return this.HM}set currentTool(t){const e=this.HM;e&&(e.isActive&&e.doDeactivate(),e.cancelWaitAfter(),e.doStop()),t===null&&(t=this.defaultTool),t!==null&&(this.HM=t,t.diagram=this,t.doStart())}get selection(){return this.KA}get maxSelectionCount(){return this.Gb}set maxSelectionCount(t){const e=this.Gb;if(e!==t)if(y.s(t,"number",X,"maxSelectionCount"),t>=0&&!isNaN(t)){if(this.Gb=t,this.t("maxSelectionCount",e,t),!this.undoManager.isUndoingRedoing){const i=this.selection.count-t;if(i>0){this.T("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.T("ChangedSelection",this.selection)}}}else y.J(t,">= 0",X,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.hp}set nodeSelectionAdornmentTemplate(t){const e=this.hp;e!==t&&(this.hp=t.It(),this.t("nodeSelectionAdornmentTemplate",e,t))}get groupSelectionAdornmentTemplate(){return this.Hb}set groupSelectionAdornmentTemplate(t){const e=this.Hb;e!==t&&(this.Hb=t.It(),this.t("groupSelectionAdornmentTemplate",e,t))}get linkSelectionAdornmentTemplate(){return this.jb}set linkSelectionAdornmentTemplate(t){const e=this.jb;e!==t&&(this.jb=t.It(),this.t("linkSelectionAdornmentTemplate",e,t))}get highlighteds(){return this.HA}get isModified(){const t=this.undoManager;return t.isEnabled?t.currentTransaction!==null?!0:this.nd&&this.js!==t.historyIndex:this.nd}set isModified(t){if(this.nd!==t){y.s(t,"boolean",X,"isModified"),this.nd=t;const e=this.undoManager;!t&&e.isEnabled&&(this.js=e.historyIndex),t||this.PT()}}PT(){const t=this.isModified;this.$M!==t&&(this.$M=t,this.T("Modified"))}get model(){return this.Ce}set model(t){const e=this.Ce;if(e!==t){this.currentTool.doCancel(),e&&e.undoManager!==t.undoManager&&e.undoManager.isInTransaction&&y.o("Do not replace a Diagram.model while a transaction is in progress.");const i=this.sT(!0);this.no=!1,this.Zu=!0,this.js=-2,this.Dr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Gl("Model"),e&&(this.io!==null&&this.io.each(n=>e.removeChangedListener(n)),e.removeChangedListener(this.Qc)),this.Ce=t,this.partManager=this.NO(this.Ce.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);t.addChangedListener(this.JM),this.partManager.D2(),t.removeChangedListener(this.JM),t.addChangedListener(this.Qc),this.io!==null&&this.io.each(n=>t.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.C(),e&&t.undoManager.copyProperties(e.undoManager)}}get themeManager(){return this.d2}set themeManager(t){const e=this.d2;e!==t&&(e&&e.removeDiagram(this),this.d2=t,t!==null&&t.addDiagram(this))}initializePartManager(t){}static g2(t,e){X.JA.set(t,e)}static get licenseKey(){return X.v2.last()}static set licenseKey(t){X.v2.add(t.replace(/\s/g,""))}static get version(){return X.CO}static v2=new J;static CO="3.1.3";NO(t){const e=X.JA.get(t);return e!==null?new e:new ee}get G(){return this.WM}set G(t){this.WM=t}get nb(){return this.jA}LO(t){if(t.model!==this.model)return;const e=t.change,i=t.propertyName;if(e===1&&i[0]==="S"){if(i==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.Ts&&!this.no&&(this.Zc=!0,this.Zu&&(this.Dr=!0))}else if(i==="StartingUndo"||i==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.T("ChangingSelection",this.selection)}else if(i==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.G){this.G=!1;try{if(t.modelChange===""&&e===1){(i==="FinishedUndo"||i==="FinishedRedo")&&(this.T("ChangedSelection",this.selection),this.Te());const s=this.animationManager;i==="RolledBackTransaction"&&s.stopAnimation(),this.VA(),this.Zc=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.SM(),i==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.js=Math.min(this.js,this.undoManager.historyIndex-1)),(i==="CommittedTransaction"||i==="RolledBackTransaction")&&this.undoManager.Sx&&y.dn(()=>{this.isModified=!1},1);const n=t.isTransactionFinished;if(n&&(this.PT(),this.nb.clear(),this.animationManager.CR()),!this.Cb&&n&&this.lastInput.targetDiagram){this.Cb=!0;const o=this;y.dn(()=>{o.currentTool.standardMouseOver(),o.Cb=!1},10)}}}finally{this.G=!0}}}get wi(){return this.qM}set wi(t){this.qM=t}get Ou(){return this.Lb}set Ou(t){this.Lb=t}uT(t){const e=t.D.r;for(const i of e)i instanceof Tt&&this.F2(i)}F2(t){const e=t.element;if(e===null||!H.HTMLImageElement||!(e instanceof HTMLImageElement)||(e.hs instanceof K&&e.hs.add(this),t.AO(),!e.Dp))return;const i=e.getAttribute("src")||"",s=this.oa.get(i);if(s===null){Tt.ST(t,e);const n=[];n.push(t),this.oa.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===t)return;s.push(t)}}TO(t){const e=t.D.r,i=e.length;for(let s=0;s<i;s++)this.R2(e[s])}R2(t){if(!(t instanceof Tt))return;const e=t.element;if(e===null||!H.HTMLImageElement||!(e instanceof HTMLImageElement)||!e.Dp)return;const i=e.getAttribute("src")||"",s=this.oa.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),s.length===0&&(this.oa.delete(i),Tt.DO(e),e.hs instanceof K&&e.hs.delete(this));return}}}nT(){Tt.clearCache(),this.oa.clear()}rebuildParts(){this.partManager.rebuildParts()}Kc(t,e){this.Ns.Kc(t,e)}Yc(t,e){this.Ns.Yc(t,e)}findPartForKey(t){return this.partManager.findPartForKey(t)}findNodeForKey(t){return this.partManager.findNodeForKey(t)}findLinkForKey(t){return this.partManager.findLinkForKey(t)}findPartForData(t){return this.partManager.findPartForData(t)}findNodeForData(t){return this.partManager.findNodeForData(t)}findLinkForData(t){return this.partManager.findLinkForData(t)}findNodesByExample(...t){return this.partManager.findNodesByExample(...t)}findLinksByExample(...t){return this.partManager.findLinksByExample(...t)}get nodeTemplate(){return this.Wr.get("")}set nodeTemplate(t){const e=this.Wr.get("");e!==t&&(this.Wr.set("",t),this.t("nodeTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Wr}set nodeTemplateMap(t){const e=this.Wr;e!==t&&(this.Wr=t,this.t("nodeTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.dh.get("")}set groupTemplate(t){const e=this.dh.get("");e!==t&&(this.dh.set("",t),this.t("groupTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.dh}set groupTemplateMap(t){const e=this.dh;e!==t&&(this.dh=t,this.t("groupTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.na.get("")}set linkTemplate(t){const e=this.na.get("");e!==t&&(this.na.set("",t),this.t("linkTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.na}set linkTemplateMap(t){const e=this.na;e!==t&&(this.na=t,this.t("linkTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.ZM}set isMouseCaptured(t){const e=this.lt;if(e===null)return;const i=e.bt;i instanceof SVGElement||(t?(this.lastInput.bubbles=!1,this.Le(i,"pointermove",this.xh,!1),this.Le(i,"pointerdown",this.la,!1),this.Le(i,"pointerup",this.bh,!1),this.Le(i,"pointerout",this.kh,!1),this.Le(i,"pointercancel",this.Ph,!1),this.Et(H,"pointermove",this.xh,!0),this.Et(H,"pointerdown",this.la,!0),this.Et(H,"pointerup",this.bh,!0),this.Et(H,"pointerout",this.kh,!0),this.Et(H,"pointercancel",this.Ph,!0),this.Le(i,"wheel",this.wh,!1),this.Et(H,"wheel",this.wh,!0),this.Et(H,"selectstart",this.oh,!1)):(this.Le(H,"pointermove",this.xh,!0),this.Le(H,"pointerdown",this.la,!0),this.Le(H,"pointerup",this.bh,!0),this.Le(H,"pointerout",this.kh,!0),this.Le(H,"pointercancel",this.Ph,!0),this.Et(i,"pointermove",this.xh,!1),this.Et(i,"pointerdown",this.la,!1),this.Et(i,"pointerup",this.bh,!1),this.Et(i,"pointerout",this.kh,!1),this.Et(i,"pointercancel",this.Ph,!1),this.Le(H,"wheel",this.wh,!0),this.Le(H,"selectstart",this.oh,!1),this.Et(i,"wheel",this.wh,!1)),this.ZM=t)}get position(){return this.ct}set position(t){if(this.ct.equals(t))return;const e=P.l().h(this.ct),i=this.viewportBounds.copy();if(this.ct.h(t),this.animationManager.IA(e,this.ct),!this.Ht&&!(this.lt===null&&!this.ed.isReal())){this.Ht=!0;const s=this.scale,n=this.wt/s,o=this.xt/s;this.b2(this.ap,n,o,this.Jc,!1),this.Ht=!1}else this.aa(),this.Np();if(!this.Ht){const s=this.viewportBounds;this.onViewportBoundsChanged(i,s,this.it,!1)}P.i(e)}get initialPosition(){return this.ab}set initialPosition(t){this.ab.equals(t)||(this.ab=t.N())}get initialScale(){return this.hb}set initialScale(t){this.hb!==t&&(y.s(t,"number",X,"initialScale"),this.hb=t)}get grid(){return this.ls===null&&(this.ls=this.rT()),this.ls}set grid(t){let e=this.ls;if(e!==t){e===null&&(this.ls=this.rT(),e=this.ls),t.type!==j.Grid&&y.o("Diagram.grid must be a Panel of type Panel.Grid");const i=e.panel;i!==null&&i.remove(e),this.ls=t,t.name="GRID",i!==null&&i.add(t),this.sd=!1,this.C(),this.t("grid",e,t)}}get viewportBounds(){return this.Yb}aa(){const t=this.Yb,e=this.ct,i=this.it;t.e(e.x,e.y,Math.max(this.wt,0)/i,Math.max(this.xt,0)/i),this.ha()}get viewSize(){return this.ed}set viewSize(t){const e=this.viewSize;if(!e.equals(t)){t=t.N(),this.ed=t;let i=0,s=0;t.isReal()?(i=t.width,s=t.height):this.Nt!==null&&(i=this.Nt.clientWidth||1,s=this.Nt.clientHeight||1),this.wt=i,this.xt=s,this.aa(),this.invalidateDocumentBounds(),this.t("viewSize",e,t),this.C()}}get fixedBounds(){return this.db}set fixedBounds(t){const e=this.db;e.equals(t)||((t.width===-1/0||t.height===1/0||t.height===-1/0)&&y.o("fixedBounds width/height must not be Infinity"),t=t.N(),this.db=t,this.invalidateDocumentBounds(),this.t("fixedBounds",e,t))}get scrollMargin(){return this.fh}set scrollMargin(t){typeof t=="number"&&(t=new Mt(t));const e=this.fh;e.equals(t)||(t=t.N(),this.fh=t,this.t("scrollMargin",e,t),this.Eu())}get scrollMode(){return this.ah}set scrollMode(t){const e=this.ah;e!==t&&(this.ah=t,t===1&&this.$s(!1),this.t("scrollMode",e,t),this.Nh(),this.C())}get scrollsPageOnFocus(){return this.gb}set scrollsPageOnFocus(t){const e=this.gb;e!==t&&(y.s(t,"boolean",X,"scrollsPageOnFocus"),this.gb=t,this.t("scrollsPageOnFocus",e,t))}get positionComputation(){return this.pb}set positionComputation(t){const e=this.pb;e!==t&&(t!==null&&y.S(t,X,"positionComputation"),this.pb=t,this.$s(!1),this.t("positionComputation",e,t))}get scaleComputation(){return this.yb}set scaleComputation(t){const e=this.yb;e!==t&&(t!==null&&y.S(t,X,"scaleComputation"),this.yb=t,this.kT(this.scale,this.scale),this.t("scaleComputation",e,t))}get documentBounds(){return this.ap}MT(t){this.mh=!1;let e=this.ap;e.equals(t)||(e=e.copy(),this.ap.h(t),this.$s(!1),this.T("DocumentBoundsChanged",void 0,e),this.Nh(),this.C())}ensureBounds(){if(this.mh){const t=I.l();this.MT(this.computeBounds(t)),I.i(t)}}get isVirtualized(){return this.Kb}set isVirtualized(t){const e=this.Kb;e!==t&&(y.s(t,"boolean",X,"isVirtualized"),this.Kb=t,this.t("isVirtualized",e,t))}get scale(){return this.it}set scale(t){const e=this.it;e!==t&&this.kT(e,t)}get defaultScale(){return this.dp}set defaultScale(t){this.dp=t}get autoScale(){return this.ia}set autoScale(t){const e=this.ia;e!==t&&(this.ia=t,this.t("autoScale",e,t),t!==1&&this.$s(!1))}get initialAutoScale(){return this.Or}set initialAutoScale(t){const e=this.Or;e!==t&&(this.Or=t,this.t("initialAutoScale",e,t))}get initialViewportSpot(){return this.xb}set initialViewportSpot(t){const e=this.xb;e!==t&&(t.isSpot()||y.o("initialViewportSpot must be a specific Spot: "+t),this.xb=t,this.t("initialViewportSpot",e,t))}get initialDocumentSpot(){return this.wb}set initialDocumentSpot(t){const e=this.wb;e!==t&&(t.isSpot()||y.o("initialViewportSpot must be a specific Spot: "+t),this.wb=t,this.t("initialDocumentSpot",e,t))}get minScale(){return this.cb}set minScale(t){const e=this.cb;e!==t&&(t>0?(this.cb=t,this.t("minScale",e,t),t>this.scale&&(this.scale=t)):y.J(t,"> 0",X,"minScale"))}get maxScale(){return this.fb}set maxScale(t){const e=this.fb;e!==t&&(t>0?(this.fb=t,this.t("maxScale",e,t),t<this.scale&&(this.scale=t)):y.J(t,"> 0",X,"maxScale"))}get zoomPoint(){return this.ub}set zoomPoint(t){this.ub.equals(t)||(t=t.N(),this.ub=t)}get contentAlignment(){return this.Jc}set contentAlignment(t){const e=this.Jc;e.equals(t)||(t=t.N(),this.Jc=t,this.t("contentAlignment",e,t),this.$s(!1))}get initialContentAlignment(){return this.ip}set initialContentAlignment(t){const e=this.ip;e.equals(t)||(t=t.N(),this.ip=t,this.t("initialContentAlignment",e,t))}get padding(){return this.Qt}set padding(t){typeof t=="number"&&(t=new Mt(t));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.invalidateDocumentBounds(),this.t("padding",e,t))}get partManager(){return this.i2}set partManager(t){const e=this.i2;e!==t&&(t.diagram!==null&&y.o("Cannot share PartManagers between Diagrams: "+t.toString()),e&&e.Eo(null),this.i2=t,t.Eo(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const t=new K,e=this.nodes;for(;e.next();){const s=e.value;s.isTopLevel&&t.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&t.add(s)}return t.iterator}findTopLevelGroups(){return this.Zr.iterator}get routers(){return this.of}doLinkRouting(t){this.Vo=!0;const e=this.of.r;for(let i=0;i<e.length;i++)e[i].canRoute(t)&&e[i].routeLinks(this.Ir,t);this.Vo=!1}get layout(){return this.li}set layout(t){const e=this.li;e!==t&&(this.li=t,t.diagram=this,t.group=null,this.$r=!0,this.t("layout",e,t),this.requestUpdate())}layoutDiagram(t){this.Te(),t&&this.c1(!0),this.Ts?this.S2(!1,this.Fl||this.of.count!==0&&this.eo.size!==0):(this.Zc=!0,this.Sr())}c1(t){const e=this.Zr.iterator;for(;e.next();)this.NT(e.value,t);this.layout&&(t?this.layout.isValidLayout=!1:this.layout.p())}NT(t,e){if(t===null)return;const i=t.Ch.iterator;for(;i.next();){const s=i.value;this.NT(s,e)}t.layout!==null&&(e?t.layout.isValidLayout=!1:t.layout.p())}S2(t,e){if(this.Ab)return;const i=this.G;this.G=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{n===0&&(this.undoManager.Dl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.ke&&(t||r.Gl(s)),this.$r=!1;let a=this.Zr.iterator;for(;a.next();)this.cd(a.value),this.CT(a.value,t,n,e);let l=!1;if(o.isValidLayout||(!t||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.cd(this),l=!0,o.isValidLayout=!0):this.$r=!0),l||this.cd(this),this.doLinkRouting(this),this.Ir.clear(),this.uh.size!==0){for(let h=0;h<23&&this.uh.size!==0;h++){for(a=this.Zr.iterator;a.next();)this.LT(a.value);const u=this.Ir;this.Ir=this.uh,this.uh=u,this.cd(this),this.doLinkRouting(this)}this.Ir.clear(),this.uh.clear()}}finally{const a=this.undoManager.Dl;n===0&&(this.commitTransaction(s),this.undoManager.Dl=!1),a&&(n===0||n===1)&&r.SM(),this.$r&&(this.$r=!o.isValidLayout),this.G=i}}CT(t,e,i,s){const n=t.Ch.iterator;for(;n.next();)this.CT(n.value,e,i,s);const o=t.layout;o!==null&&!o.isValidLayout?!e||o.isRealtime||i===0?(t.Lh=!t.location.isReal(),o.doLayout(t),t.invalidateLayout(32),this.o1(t),this.cd(t),this.doLinkRouting(t),o.isValidLayout=!0):(this.doLinkRouting(t),this.$r=!0):s&&this.doLinkRouting(t)}LT(t){const e=t.Ch.iterator;for(;e.next();)this.LT(e.value);this.cd(t),this.doLinkRouting(t)}get isTreePathToChildren(){return this.bb}set isTreePathToChildren(t){const e=this.bb;if(e!==t&&(y.s(t,"boolean",X,"isTreePathToChildren"),this.bb=t,this.t("isTreePathToChildren",e,t),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.vp()}}findTreeRoots(){const t=new J,e=this.nodes;for(;e.next();){const i=e.value;i.isTopLevel&&i.findTreeParentLink()===null&&t.add(i)}return t.iterator}get treeCollapsePolicy(){return this.kb}set treeCollapsePolicy(t){const e=this.kb;e!==t&&(t!==1&&t!==2&&t!==3&&y.o("Unknown Diagram.treeCollapsePolicy: "+t),this.kb=t,this.t("treeCollapsePolicy",e,t))}get isCollapsingExpanding(){return this.GM}set isCollapsingExpanding(t){this.GM=t}QR(){const t=new bt,e=new bt;function i(s){const n=s.toLowerCase(),o=new J;t.set(s,o),t.set(n,o),e.set(s,s),e.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("FocusOrVirtualPointerEnabledChanged"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.zM=t,this.XM=e}fT(t){const e=this.XM.get(t);return e!==null?e:this.XM.get(t.toLowerCase())}O2(t){let e=this.zM.get(t);if(e!==null)return e;const i=t.toLowerCase();if(e=this.zM.get(i),e!==null)return e;y.o("Unknown DiagramEvent name: "+t)}addDiagramListener(t,e){y.s(t,"string",X,"addDiagramListener:name"),y.S(e,X,"addDiagramListener:listener");const i=this.O2(t);return i!==null&&i.add(e),this}removeDiagramListener(t,e){y.s(t,"string",X,"removeDiagramListener:name"),y.S(e,X,"addDiagramListener:listener");const i=this.O2(t);i!==null&&i.delete(e)}raiseDiagramEvent(t,e,i){this.T(t,e,i)}T(t,e,i){const s=this.O2(t),n=new We;n.diagram=this;const o=this.fT(t);o!==null&&(n.name=o),e!==void 0&&(n.subject=e),i!==void 0&&(n.parameter=i);const r=s.length;if(r===1)s.elt(0)(n);else if(r!==0){const a=s.toArray();for(let l=0;l<r;l++){const h=a[l];h(n)}}}isUnoccupied(t,e){return this.getPositions(!1,null,e||null).isUnoccupied(t.x,t.y,t.width,t.height)}computeOccupiedArea(t){return this.isVirtualized?this.viewportBounds.copy():this.mh?this.aT(t):t.h(this.documentBounds)}getPositions(t,e,i){let s=this.sa;s===null&&(this.sa=s=new Ct(this.avoidanceCellSize));let n=e;if(s.Ko||s.Ah!==n||s.I2!==i){if(s.E2=Math.max(s.hf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.U2=Math.max(s.hf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.AT(n)),n===null){const o=I.l();this.computeOccupiedArea(o),o.inflate(100,100),s.f1(o);const r=this.nodes;for(;r.next();){const a=r.value,l=a.layer;l===null||!l.visible||l.isTemporary||this.V2(a,i,o)}I.i(o)}else{if(n.memberParts.count>0){const a=this.computePartsBounds(n.memberParts,!1);a.inflate(20,20),s.f1(a)}const o=I.l(),r=n.memberParts;for(;r.next();){const a=r.value;a instanceof W&&this.V2(a,i,o)}I.i(o)}s.Ah=n,s.I2=i,s.Ko=!1}else t&&s.TT();return s}get avoidanceCellSize(){return this.QM}set avoidanceCellSize(t){this.sa=null,this.QM=new st(Math.max(1,t.width),Math.max(1,t.height))}get avoidanceLimit(){return this._M}set avoidanceLimit(t){this._M=Math.max(1,t)}AT(t){return t.canAvoid()?t:t.containingGroup!==null?this.AT(t.containingGroup):null}V2(t,e,i){if(t===e||!t.isVisible())return;const s=t.canAvoid();if(s){const n=t.getAvoidableRect(i);this.sa.vO(n.x,n.y,n.width,n.height)}if(t instanceof at&&(!s||t.avoidableMembers)){const n=t.memberParts;for(;n.next();){const o=n.value;o instanceof W&&this.V2(o,e,i)}}}fd(t){this.sa!==null&&!this.sa.Ko&&(t===void 0||t.canAvoid())&&(this.sa.Ko=!0)}get autoScrollInterval(){return this.sp}set autoScrollInterval(t){const e=this.sp;e!==t&&(this.sp=t,this.t("autoScrollInterval",e,t))}get autoScrollRegion(){return this.np}set autoScrollRegion(t){typeof t=="number"&&(t=new Mt(t));const e=this.np;e.equals(t)||(t=t.N(),this.np=t,this.invalidateDocumentBounds(),this.t("autoScrollRegion",e,t))}doAutoScroll(t){this.cp.h(t);const e=P.l();this.computeAutoScrollPosition(this.cp,e).equalsApprox(this.position)?this.stopAutoScroll():this.DT(),P.i(e)}DT(){if(this.$c!==-1)return;const t=this.sp,e=this;this.$c=y.dn(()=>{if(e.$c===-1||(e.stopAutoScroll(),e.lastInput.event===null))return;const i=P.l(),s=e.computeAutoScrollPosition(e.cp,i);if(!s.equalsApprox(e.position)){e.position=s,e.lastInput.documentPoint=e.transformViewToDoc(e.cp),e.doMouseMove(),e.mh=!0;const n=I.l();e.computeBounds(n),n.unionRect(e.documentBounds),e.MT(n),I.i(n),e.qi=!0,e.maybeUpdate(),e.DT()}P.i(i)},t)}stopAutoScroll(){this.$c!==-1&&(y.wc(this.$c),this.$c=-1)}computeAutoScrollPosition(t,e){let i=this.position;e===void 0&&(e=new P),e.h(i);const s=this.np;if(s.top<=0&&s.left<=0&&s.right<=0&&s.bottom<=0)return e;const n=this.viewportBounds,o=this.scale,r=I.z(0,0,n.width*o,n.height*o),a=P.z(0,0);if(t.x>=r.x&&t.x<r.x+s.left&&this.allowHorizontalScroll){let l=Math.max(this.scrollHorizontalLineChange,1);l=l|0,a.x-=l,t.x<r.x+s.left/2&&(a.x-=l),t.x<r.x+s.left/4&&(a.x-=4*l)}else if(t.x<=r.x+r.width&&t.x>r.x+r.width-s.right&&this.allowHorizontalScroll){let l=Math.max(this.scrollHorizontalLineChange,1);l=l|0,a.x+=l,t.x>r.x+r.width-s.right/2&&(a.x+=l),t.x>r.x+r.width-s.right/4&&(a.x+=4*l)}if(t.y>=r.y&&t.y<r.y+s.top&&this.allowVerticalScroll){let l=Math.max(this.scrollVerticalLineChange,1);l=l|0,a.y-=l,t.y<r.y+s.top/2&&(a.y-=l),t.y<r.y+s.top/4&&(a.y-=4*l)}else if(t.y<=r.y+r.height&&t.y>r.y+r.height-s.bottom&&this.allowVerticalScroll){let l=Math.max(this.scrollVerticalLineChange,1);l=l|0,a.y+=l,t.y>r.y+r.height-s.bottom/2&&(a.y+=l),t.y>r.y+r.height-s.bottom/4&&(a.y+=4*l)}return a.equalsApprox(P.gn)||(e.x=i.x+a.x/o,e.y=i.y+a.y/o),I.i(r),P.i(a),e}makeSvg(t){this.Xo.has("SVG")||this.addRenderer("SVG",new Ue(this,H.document));const e=new Ue(this,H.document,!0);t===void 0&&(t={});const i=this;function s(n,o){const r=i.vT(n,"SVG",e),a=r!==null?r.svg:null,l=n.svgFinished;return a&&l&&l(a),y.st(o)?(o(a),null):a}return this.FT(s,t)}makeSVG(t){return this.makeSvg(t)}addRenderer(t,e){this.Xo.set(t,e)}removeRenderer(t){this.Xo.delete(t)}cacheGroupExternalLinks(t){this.u2=t,t||this.nodes.each(e=>{e instanceof at&&(e.Fp=null)})}FT(t,e){const i=e.callback;let s=!0;const n=this.oa.iterator;for(;n.next();)if(!n.value[0].Mn){s=!1;break}if(!y.st(i)||s)return t(e,i,this);const o=this;function r(){const h=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].Mn){s=!1;break}if(s||h-l>a){t(e,i,o);return}H.requestAnimationFrame(r)}const a=e.callbackTimeout||300,l=+new Date;return H.requestAnimationFrame(()=>r()),null}makeImage(t){return X.isUsingDOM()?(t===void 0&&(t={}),t.returnType="Image",this.makeImageData(t)):null}makeImageData(t){return t===void 0&&(t={}),this.FT(this.FO,t)}static img="image";FO(t,e,i){const s=i.vT(t,"canvas",null);if(s===null)return null;const n=s.F.canvas;let o=null;if(n!==null){let r=t.returnType;switch(r===void 0?r="string":r=r.toLowerCase(),r){case X.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case X.img:const a=(t.document||document).createElement("img");a.src=n.toDataURL(t.type,t.details),o=a;break;case"blob":{const l=n;return y.st(e)||(o="",y.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),y.st(l.toBlob)?(l.toBlob(e,t.type,t.details),"toBlob"):(e(null),null)}case"string":default:o=n.toDataURL(t.type,t.details)}}return y.st(e)?(e(o),null):o}static RO=!1;vT(t,e,i){this.animationManager.stopAnimation(),this.maybeUpdate(),y.$(t)||y.o("properties argument must be an Object.");let s=!1,n=t.size||null,o=t.scale||null;t.scale!==void 0&&isNaN(t.scale)&&(o="NaN");let r=t.maxSize;t.maxSize===void 0&&(s=!0,e==="SVG"?r=new st(1/0,1/0):r=new st(2e3,2e3));const a=t.position||null;let l=t.parts||null;Array.isArray(l)&&(l=new J(l));let h=t.padding===void 0?1:t.padding;const u=t.background||null;let c=t.omitTemporary;c===void 0&&(c=!0);const d=t.document||H.document,f=t.elementFinished||null;let m=t.showTemporary;m===void 0&&(m=!c);let g=t.showGrid;g===void 0&&(g=m),n!==null&&isNaN(n.width)&&isNaN(n.height)&&(n=null),typeof h=="number"?h=new Mt(h):h instanceof Mt||y.o("MakeImage padding must be a Margin or a number."),h.left=Math.max(h.left,0),h.right=Math.max(h.right,0),h.top=Math.max(h.top,0),h.bottom=Math.max(h.bottom,0),this.Wt&&this.Wt.clearContextCache(!0);const p=new xe(null,d,void 0,!0),b=p._t;if(!(n||o||l||a))return p.width=this.wt+Math.ceil(h.left+h.right),p.height=this.xt+Math.ceil(h.top+h.bottom),e==="SVG"?i===null?null:(i.resize(p.width,p.height,p.width,p.height),i.el=d,i.ud=f,this.l1(i._t,h,new st(p.width,p.height),this.it,this.ct,l,u,m,g),i._t):(this.od=!1,this.l1(b,h,new st(p.width,p.height),this.it,this.ct,l,u,m,g),this.od=!0,p._t);const v=this.dp,w=this.documentBounds.copy();if(w.subtractMargin(this.Qt),m){const F=this.zt.r,O=F.length;for(let E=0;E<O;E++){const B=F[E];if(!B.visible||!B.isTemporary)continue;const z=B.Ct.r,V=z.length;for(let Y=0;Y<V;Y++){const _=z[Y];if(!_.isInDocumentBounds||!_.isVisible())continue;const nt=_.actualBounds;nt.isReal()&&w.unionRect(nt)}}}let k=new P(w.x,w.y);if(l!==null){const F=new I(0,0,0,0);let O=!0;const E=l.iterator;for(E.reset();E.next();){const B=E.value;if(!(B instanceof ft))continue;const z=B.layer;if(z!==null&&!z.visible||z!==null&&!m&&z.isTemporary||!B.isVisible())continue;const V=B.actualBounds;V.isReal()&&(O?(O=!1,F.h(V)):F.unionRect(V))}w.width=F.width,w.height=F.height,k.x=F.x,k.y=F.y}a!==null&&a.isReal()&&(k=a,o||(o=v));let S=0,N=0;h!==null&&(S=h.left+h.right,N=h.top+h.bottom);let D=0,A=0;n!==null&&(D=n.width,A=n.height,isFinite(D)&&(D=Math.max(0,D-S)),isFinite(A)&&(A=Math.max(0,A-N)));let M=0,C=0;if(n!==null&&o!==null?(o==="NaN"&&(o=v),n.isReal()?(M=D,C=A):isNaN(A)?(M=D,C=w.height*o):(M=w.width*o,C=A)):n!==null?n.isReal()?(o=Math.min(D/w.width,A/w.height),M=D,C=A):isNaN(A)?(o=D/w.width,M=D,C=w.height*o):(o=A/w.height,M=w.width*o,C=A):o!==null?o==="NaN"&&r.isReal()?(o=Math.min((r.width-S)/w.width,(r.height-N)/w.height),o>v?(o=v,M=w.width,C=w.height):(M=r.width,C=r.height)):(M=w.width*o,C=w.height*o):(o=v,M=w.width,C=w.height),h!==null?(M+=S,C+=N):h=new Mt(0),r!==null){let F=r.width,O=r.height;e!=="SVG"&&s&&X.RO,isNaN(F)&&(F=2e3),isNaN(O)&&(O=2e3),isFinite(F)&&(M=Math.min(M,F)),isFinite(O)&&(C=Math.min(C,O))}return p.width=Math.ceil(M),p.height=Math.ceil(C),e==="SVG"?i===null?null:(i.resize(p.width,p.height,p.width,p.height),i.el=d,i.ud=f,this.l1(i._t,h,new st(Math.ceil(M),Math.ceil(C)),o,k,l,u,m,g),i._t):(this.od=!1,this.l1(b,h,new st(Math.ceil(M),Math.ceil(C)),o,k,l,u,m,g),this.od=!0,p._t)}static Mh=null;static B2="5da73c80a36555d5038e4972187c3cae51fd22";static OO="5da73c80a36555d503aa5c72106c30b35bb2006b9cd041b259";static qw=!1;static OP=()=>{if(X.B2[5]===void 0&&(wt.prototype.Ci=wt.prototype.Mu),!X.isUsingDOM())return;const t=y.Ni("canvas");t.width=350;const e=t.getContext("2d"),i=y.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[X.B2,y.qw+"4ae6247590da4bb21c324ba3a84e385776",wt.OP+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",L.za];e.scale(2,2);const o=8;for(let r=1;r<5;r++)e[y.We(s)](y.We(n[r-1]),o,r*15);e[i]=y.We("39f046ebb36e4b");for(let r=1;r<5;r++)e[y.We(s)](y.We(n[r-1]),o,r*15);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(wt.prototype.Ci=wt.prototype.Mu),X.Mh=t};static IO=()=>{if(X.B2[5]===void 0&&(wt.prototype.Ci=wt.prototype.Mu),!X.isUsingDOM())return;const t=y.Ni("canvas"),e=t.getContext("2d"),i=y.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[X.OO,L.za],o=5;e.scale(2,2);for(let r=1;r<3;r++)e[y.We(s)](y.We(n[r-1]),o,r*11);e[i]=y.We("39f046ebb36e4b");for(let r=1;r<3;r++)e[y.We(s)](y.We(n[r-1]),o,r*11);(n.length!==2||n[0][0]!=="5")&&(wt.prototype.Ci=wt.prototype.Mu),X.Mh=t}}class Rs{RT;OT;z2;bi;constructor(t){if(this.RT=null,this.OT="63ad05bbe23a1786468a4c741b6d2",this.z2="@onz",this.OT===this._tk){this.z2=!0,this.bi=this.z2;return}this.bi=null}EO(t,e){let i="f";const s=H[y.We("76a715b2f73f148a")][y.We("72ba13b5")]||"",n=y.We;if(this.bi=!0,!X.isUsingDOM())return;let o=X[n("76a115b6ed251eaf4692")];if(!o){const a=s[n("76ad18b4f73e")];for(let h=s[n("73a612b6fb191d")](n("35e7"))+2;h<a;h++)i+=s[h];const l=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.bi=!(l>=0&&l<i[n("73a612b6fb191d")](n("35")));return}const r=X.v2.iterator;for(;r.next();){o=r.value;const a=n(o).split(n("39e9")),l=a.length===7?1:0;if(a.length===1&&o.includes(n("5b8b3797c61b32a7"))){if(X.IO(),!t.lt)return;t.gp=t.lt._t.F[y.We("7eba17a4ca3b1a8346")][y.We("78a118b7")](t.lt._t.F,X.Mh,4,4)}if(a.length<6)return;const h=n(a[1+l]).split(".");if(a[4+l]!=="7da71ca0")return;const u=n(y[n("6cae19")]).split(".");if(!(h[0]>u[0]||h[0]===u[0]&&h[1]>=u[1]))continue;const c="73a612b6fb191d",d=H[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),f=d[n(c)](n("3aad1ab6e022098b4dc4")),m=n(a[2+l]);if(f>-1){const M=d[n(c)](m.toLowerCase()+"/");if(this.bi=!(M>-1&&M<f),!this.bi)return}const g=s[n("76ad18b4f73e")];for(let M=s[n(c)](n("35e7"))+2;M<g;M++)i+=s[M];let p=i[n(c)](m);if(p<0&&m!==n("7da71ca0ad381e90")&&(p=i[n(c)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(c)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(c)](n("2bfa41fdb3784bca12"))),p<0&&(p=s[n(c)](n("7baa19a6f76c1988428554"))),p<0&&(p=s[n(c)](n("7ea902b2b9221e9c57c45767196566"))),this.bi=!(p>=0&&p<i[n(c)](n("35"))||i[n(c)](n("35"))===-1),!this.bi||s[n(c)](n("7fb002b6ed25128b4da25b2e"))&&(this.bi=!(s[n(c)](m)>-1),!this.bi))return;const b=H[y.We("76a715b2f73f148a")][y.We("69ad17a1e03e")],v=b[n(c)](n("7fb002b6ed25128b4da25b2e"));if(v>-1&&(this.bi=!(b[n(c)](m)>v),!this.bi))return;const w=m;if(w[0]!=="#")continue;const k=y.Ni("div");let S=a[0+l].replace(/[A-Za-z]/g,"");for(;S.length<4;)S+="9";const N=S;S=S.substring(S.length-4);const D=parseInt(u[0]),A=parseInt(u[1]);if(D>3||D===3&&A>=1){const M=parseInt(N)%40+30,C=parseInt(w.substring(1,5),16);if(U.IT===M+C){this.bi=!1;return}}else{let M="";const C=["gsh","gsf"],F=["Header","Background","Display","Feedback"];if(M+=C[parseInt(S.substring(0,1),10)%2],M+=F[parseInt(S.substring(0,1),10)%4],k[n("79a417a0f0181a8946")]=M,H.document[n("78a712aa")]){H.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](k);const O=H.getComputedStyle(k).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),E=H.getComputedStyle(k).getPropertyValue(n("75b817b0ea2202"));if(H.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](k),!O)continue;const B=H[n("77a902b0eb1b1e804a8a")],z="0."+parseInt(N,10)%100;if(E===z||O.indexOf(parseInt(w[1]+w[2],16).toString())!==-1&&O.indexOf(parseInt(w[3]+w[4],16).toString())!==-1){this.bi=!1;return}else if(B&&B(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){M="."+M;for(let V=0;V<H.document.styleSheets.length;V++){const Y=H.document.styleSheets[V].rules||H.document.styleSheets[V].cssRules;for(const _ in Y)if(M===Y[_].selectorText){this.bi=!1;return}}}}else this.bi=null,e&&(this.bi=!1)}}}Mh(t,e){return e.setTransform(t.$e/2,0,0,t.$e/2,0,0),e.commitTransform(),this.bi===null&&this.EO(t,!0),0<this.bi&&this!==this.RT}}class Te{X2;G2;constructor(t){this.X2=t===void 0?new P:t,this.G2=new P}get point(){return this.X2}set point(t){this.X2=t}get shifted(){return this.G2}set shifted(t){this.G2=t}}class Es{Ri;pT;h1;constructor(t,e,i){this.Ri=t,this.pT=e,this.h1=i}}class Ze{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(t){this.Ue(),t&&Object.assign(this,t)}Ue(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new st(NaN,NaN).k(),this.gridSnapCellSpot=T.TopLeft,this.gridSnapOrigin=new P(NaN,NaN).k(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class Is extends X{constructor(t,e){let i;return t===void 0||typeof t=="string"||H.Element&&t instanceof Element?i=t:y.$(t)&&(e=t),super(i),this.ET(),e&&this.setProperties(e),this}ET(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=T.TopCenter,this.layout=new ei}setupRouters(){}reset(){super.reset(),this.ET()}}class Ke extends X{u1;d1;g1;m1;Rp;cf;Bl;Y2;K2;p1;H2;constructor(t,e){let i;return t===void 0||typeof t=="string"||H.Element&&t instanceof Element?i=t:y.$(t)&&(e=t),super(i),this.animationManager.isEnabled=!1,this.Ht=!0,this.u1=null,this.Qu=!1,this._u=!1,this.d1=!0,this.g1=!0,this.m1=0,this.Rp=!1,this.cf=null,this.setRenderingHint("drawShadows",!1),this.Bl=new ft({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new et({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).It(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new Mt(0,0,0,0),this.ct.e(0,0),this.toolManager.Jt("Dragging",new Bs,this.toolManager.mouseMoveTools),this.click=()=>{const s=this.observed;if(s===null)return;const n=s.viewportBounds,o=this.lastInput.documentPoint;s.position=new P(o.x-n.width/2,o.y-n.height/2)},this.Y2=s=>{this.invalidateDocumentBounds(),this.Op()},this.K2=s=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.C())},this.p1=s=>{this.updateDelay<1?this.C():this.Rp||(this.Rp=!0,y.dn(()=>this.redraw(),this.updateDelay))},this.H2=s=>{this.observed!==null&&this.Op()},this.autoScale=2,this.Ht=!1,e&&this.setProperties(e),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.Rp&&this.updateDelay>=1&&(this.Rp=!1,this.UO()),super.redraw()}Ge(){if(this.Nt===null&&y.o("No div specified"),this.lt===null&&y.o("No canvas specified"),this.lt instanceof Ue||(this.box.VM(),!this.qi))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Qa)return;this.Lp();const e=this.lt,i=this.Wt;if(i.clearContextCache(!0),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,e.width,e.height),this.updateDelay<1)this.UT();else if(this.cf!==null){i.drawImage(this.cf.bt,0,0);const o=this.v;i.scale(this.$e,this.$e),i.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),i.commitTransform()}const s=this.zt.r,n=s.length;for(let o=0;o<n;o++)s[o].Ge(i,this);this.tf=!1,this.qi=!1}UO(){const t=this.lt,e=this.Wt;if(!(t===null||e===null)){if(this.Lp(),this.cf===null){const i=new xe(null);i.width=t.width,i.height=t.height,this.cf=i}try{this.lt=this.cf,this.Wt=this.lt._t,this.Wt.clearContextCache(!0),this.Wt.setTransform(1,0,0,1,0,0),this.Wt.clearRect(0,0,this.lt.width,this.lt.height),this.UT()}finally{this.lt=t,this.Wt=e}}}UT(){const t=this.observed;if(t===null)return;const e=this.drawsTemporaryLayers,i=this.drawsGrid&&e,s=t.grid;if(i&&s!==null&&s.visible&&!(isNaN(s.width)||isNaN(s.height))){const u=I.l().h(this.viewportBounds).unionRect(t.viewportBounds);t.ca(u),I.i(u),t.Te()}const n=this.v,o=this.Wt;o.scale(this.$e,this.$e),o.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),o.commitTransform();const r=this.viewportBounds,a=t.zt.r,l=a.length,h=this.zt.r;this.As(h,h.length,this,this.viewportBounds);for(let u=0;u<l;u++)a[u].ER(o,r,this,e,i)}get observed(){return this.u1}set observed(t){const e=this.u1;if(t!==null&&y.se(t,X,Ke,"observed"),t instanceof Ke&&y.o("Overview.observed Diagram may not be an Overview itself: "+t),e!==t){if(e!==null&&this.VO(e),this.u1=t,t!==null&&this.BO(t),this.invalidateDocumentBounds(),t===null){this.cf=null;const i=this.lt,s=this.Wt;i&&s&&(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height))}else this.p1(null),this.Op(),this.C();this.t("observed",e,t)}}get box(){return this.Bl}set box(t){const e=this.Bl;e!==t&&(t.It(),this.Bl=t,this.remove(e),this.add(this.Bl),this.Op(),this.t("box",e,t))}get drawsTemporaryLayers(){return this.d1}set drawsTemporaryLayers(t){this.d1!==t&&(this.d1=t,this.redraw())}get drawsGrid(){return this.g1}set drawsGrid(t){this.g1!==t&&(this.g1=t,this.redraw())}get updateDelay(){return this.m1}set updateDelay(t){t<0&&(t=0),this.m1!==t&&(this.m1=t)}BO(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this.Y2),t.addDiagramListener("DocumentBoundsChanged",this.K2),t.addDiagramListener("InvalidateDraw",this.p1),t.addDiagramListener("AnimationFinished",this.H2),this.add(this.box))}VO(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.Y2),t.removeDiagramListener("DocumentBoundsChanged",this.K2),t.removeDiagramListener("InvalidateDraw",this.p1),t.removeDiagramListener("AnimationFinished",this.H2))}Op(){const t=this.box,e=this.observed;if(e===null)return;this.qi=!0;const i=e.viewportBounds,s=t.selectionObject,n=st.l();n.e(i.width,i.height),s.desiredSize=n,st.i(n);const o=2/this.scale;s instanceof et&&(s.strokeWidth=o),t.location=new P(i.x-o/2,i.y-o/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return I.em;const e=t.documentBounds.copy();return e.unionRect(t.viewportBounds),e}invalidateViewport(t,e){this.qi!==!0&&(this.qi=!0,this.requestUpdate())}onViewportBoundsChanged(t,e,i,s){this.Ht||(this.ha(),this.C(),this.Nh(),this.invalidateDocumentBounds(),this.Op(),this.Ye.scale=i,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,t))}}class Bs extends St{ua;constructor(){super(),this.ua=P.mn}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const e=t.observed;if(e===null)return!1;const i=t.lastInput;if(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const s=e.viewportBounds;this.ua=new P(s.width/2,s.height/2);const n=t.firstInput.documentPoint;e.position=new P(n.x-this.ua.x,n.y-this.ua.y)}return!0}doActivate(){this.ua=P.mn,super.doActivate()}doUpdateCursor(t){const e=this.diagram,i=e.box;i!==null&&i.cursor&&(e.currentCursor=i.cursor)}moveParts(t,e,i){const s=this.diagram,n=s.observed;if(n===null)return;const o=s.box;if(o===null)return;if(!this.ua.isReal()){const a=s.firstInput.documentPoint,l=o.location;this.ua=new P(a.x-l.x,a.y-l.y)}const r=s.lastInput.documentPoint;n.position=new P(r.x-this.ua.x,r.y-this.ua.y)}}class Et{a;w1="go._clipboard";b1="go._clipboardFormat";j2;q2;W2;J2;$2;Z2;Q2;_2;tN;da;eN;k1;P1;S1;M1;iN;Ho;sN;nN;Ip;oN;N1;rN;C1;lN;aN;dd;Ep;Up;hN;Qc;cN;fN;uN;dN;gN;gd;mN;Oi;Ps;L1;Vp;static md=["Ctrl","Shft","Alt","Meta"];static VT=Et.pN(230,40,15);static zO=Et.pN(270,40,15);static XO=Et.pN(310,40,15);constructor(t){K.Je(this),this.a=X.Om(),this.j2=!0,this.q2=!0,this.W2=!0,this.J2=!1,this.$2=!1,this.Z2=!1,this.Q2=!1,this._2="memory",this.tN=null,this.da=null,this.eN=1.05,this.k1=NaN,this.P1=P.mn,this.S1=NaN,this.M1=I.em,this.iN=!1,this.Ho=null,this.sN=200,this.nN=!1,this.Ip=new pt("Auto",{layerName:"Tool",pickable:!1,selectable:!1}).add(new j("Spot").add(new et({name:"SHAPE",fill:null,stroke:"lime",strokeWidth:4}).bindObject("stroke","adornedPart",e=>e.isSelected?"darkcyan":"lime"),new et({name:"SHAPE2",stretch:2,fill:null,stroke:"magenta",strokeWidth:4,strokeDashArray:[4,4]})),new Jt({padding:4})),this.oN=null,this.N1="",this.rN="",this.C1=y.ur,this.lN=!1,this.aN=!1,this.dd=new ft({layerName:"Tool",isInDocumentBounds:!1,locationObjectName:"CIRCLE",locationSpot:T.Center,pickable:!1,selectable:!1}).add(new et("Circle",{isGeometryPositioned:!0,width:30,height:30,fill:null,stroke:"darkcyan",strokeWidth:6,visible:!1}).bind("visible","down"),new et({isGeometryPositioned:!0,geometryString:"M15 0L15 30",stroke:"magenta"}),new et({isGeometryPositioned:!0,geometryString:"M0 15L30 15",stroke:"magenta"}),new et("Circle",{name:"CIRCLE",isGeometryPositioned:!0,width:20,height:20,fill:null,stroke:"magenta",position:new P(5,5)}),new et({isGeometryPositioned:!0,geometry:Et.VT,fill:null,stroke:"cyan",strokeWidth:4}).bind("geometry","button",Et.GO),new lt({position:new P(12,0),font:"bold 10pt sans-serif"}).bind("text","clickCount",e=>e>1?e.toString():""),new lt({position:new P(0,16)}).bind("text","modifiers",Et.YO)).freezeBindings(),this.Ep=10,this.Up=1,this.hN=null,this.Qc=e=>this.KO(e),this.cN=e=>this.HO(e),this.fN=e=>this.jO(e),this.uN=e=>this.qO(e),this.dN=null,this.gN="distance",this.gd=null,this.mN=0,this.Oi={},this.Ps=null,this.L1=!1,this.Vp=null,this.yN(),this.dd.data=this.Oi,t&&Object.assign(this,t)}toString(){return"CommandHandler"}get diagram(){return this.a}Eo(t){this.a=t}doStart(){const t=this.a;t&&(t.addModelChangedListener(this.Qc),t.addDiagramListener("ViewportBoundsChanged",this.cN),t.addDiagramListener("GainedFocus",this.fN),t.addDiagramListener("LostFocus",this.uN))}doStop(){const t=this.a;t&&(t.removeDiagramListener("ViewportBoundsChanged",this.cN),t.removeDiagramListener("GainedFocus",this.fN),t.removeDiagramListener("LostFocus",this.uN),t.removeModelChangedListener(this.Qc))}doKeyDown(){const t=this.a,e=t.lastInput,i=e.control||e.meta,s=e.shift,n=e.alt,o=e.commandKey;i&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():i&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():i&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():i&&o==="y"||i&&s&&o==="z"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():i&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():i&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():this.BT.indexOf(o)>=0?this.WO(o,i,s):o==="PageUp"?s&&t.allowHorizontalScroll?t.scroll("page","left"):t.allowVerticalScroll&&t.scroll("page","up"):o==="PageDown"?s&&t.allowHorizontalScroll?t.scroll("page","right"):t.allowVerticalScroll&&t.scroll("page","down"):o==="Home"?i&&t.allowVerticalScroll?t.scroll("document","up"):!i&&t.allowHorizontalScroll&&t.scroll("document","left"):o==="End"?i&&t.allowVerticalScroll?t.scroll("document","down"):!i&&t.allowHorizontalScroll&&t.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():i&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():i&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():i&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"||s&&o==="F10"||i&&s&&o==="Backslash"?this.canShowContextMenu()&&this.showContextMenu():e.bubbles=!0}doKeyUp(){const t=this.a.lastInput;t.bubbles=!0}stopCommand(){const t=this.a,e=t.currentTool;if(e instanceof Ce){if(e.currentToolTip!==null){e.hideToolTip();return}t.allowSelect&&t.clearSelection()}e!==null&&e.doCancel()}canStopCommand(){return!0}selectAll(){const t=this.a;t.C();try{t.currentCursor="wait",t.T("ChangingSelection",t.selection);const e=t.parts;for(;e.next();){const n=e.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=t.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=t.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{t.T("ChangedSelection",t.selection),t.currentCursor=""}}canSelectAll(){return this.a.allowSelect}deleteSelection(){const t=this.a;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Delete"),t.T("SelectionDeleting",t.selection);const e=new K,i=t.selection.iterator;for(;i.next();){const s=i.value;ft.ga(e,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}t.removeParts(e,!0),t.T("SelectionDeleted",e)}finally{t.commitTransaction("Delete"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canDeleteSelection(){const t=this.a;return!(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||t.selection.count===0)}copySelection(){const t=this.a;try{const e=new K,i=t.selection.iterator;for(;i.next();){const s=i.value;ft.ga(e,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(e)}finally{}}canCopySelection(){const t=this.a;return!(!t.allowCopy||!t.allowClipboard||t.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const t=this.a;return!(t.isReadOnly||t.isModelReadOnly||!t.allowCopy||!t.allowDelete||!t.allowClipboard||t.selection.count===0)}copyToClipboard(t){const e=this.a,i=this.storageLocation==="systemClipboard";if(i||this.storageLocation!=="memory")try{if(t===null)if(i&&H.navigator.clipboard)H.navigator.clipboard.writeText("");else{const n=H[this.storageLocation];if(!n)return;n.setItem(this.w1,""),n.setItem(this.b1,"")}else{const n=new X;if(n.isTreePathToChildren=e.isTreePathToChildren,n.toolManager.draggingTool.dragsLink=e.toolManager.draggingTool.dragsLink,n.model=e.model.copy(),e.copyParts(t,n,!1),i&&H.navigator.clipboard)H.navigator.clipboard.writeText(n.model.toJson());else{const o=H[this.storageLocation];if(!o)return;o.setItem(this.w1,n.model.toJson()),o.setItem(this.b1,n.model.dataFormat)}}e.T("ClipboardChanged",t);return}catch{return}let s=null;if(t===null)X.iT();else{let n=null;try{n=e.copyParts(t,null,!0)}finally{s=new J,n!==null&&s.addAll(n.iteratorValues),X.Sp=s,X.i1=e.model.dataFormat}}e.T("ClipboardChanged",s)}pasteFromClipboard(){const t=this.a;if(this.storageLocation!=="memory"){const n=new K;try{const o=H[this.storageLocation];if(!o)return n;const r=o.getItem(this.w1),a=o.getItem(this.b1);if(r===null||r===""||a!==t.model.dataFormat)return n;{const l=new X;l.model=ht.fromJson(r);const h=new K;h.addAll(l.parts).addAll(l.nodes).addAll(l.links);const u=t.copyParts(h,t,!1);return new K().addAll(u.iteratorValues)}}catch{return n}}const e=new K,i=X.Sp;if(i===null||X.i1!==t.model.dataFormat)return e;let s=null;try{s=t.copyParts(i,t,!1)}finally{if(s!==null){const n=s.iterator;for(;n.next();){const o=n.value,r=n.key;o.location.isReal()||(r.location.isReal()?o.location=r.location:!o.position.isReal()&&r.position.isReal()&&(o.position=r.position)),e.add(o)}}}return e}async pasteSelectionAsync(t){const e=this.a;if(H.navigator.clipboard===void 0){y.ne('Cannot paste with storageLocation "clipboard", window.isSecureContext may be false.');return}try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Paste");let i=null;const s=await H.navigator.clipboard.readText();try{const o=s;if(!(o===null||o==="")){const r=new X;r.model=ht.fromJson(o);const a=new K;a.addAll(r.parts).addAll(r.nodes).addAll(r.links);const l=e.copyParts(a,e,!1);i=new K().addAll(l.iteratorValues)}}catch{}if(i===null)return;i.count>0&&e.clearSelection(!0);const n=i.iterator;for(;n.next();){const o=n.value;o.isSelected=!0}if(t){const o=e.computePartsBounds(e.selection);if(o.isReal()){const r=this.computeEffectiveCollection(e.selection,e.ad);e.Lx(r,new P(t.x-o.centerX,t.y-o.centerY),e.ad,!1)}}e.T("ClipboardPasted",i)}finally{e.commitTransaction("Paste"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}pasteSelection(t){if(this.storageLocation==="systemClipboard"){this.pasteSelectionAsync(t);return}const e=this.a;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&e.clearSelection(!0);const s=i.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(t){const n=e.computePartsBounds(e.selection);if(n.isReal()){const o=this.computeEffectiveCollection(e.selection,e.ad);e.Lx(o,new P(t.x-n.centerX,t.y-n.centerY),e.ad,!1)}}e.T("ClipboardPasted",i)}finally{e.commitTransaction("Paste"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canPasteSelection(t){const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowClipboard)return!1;if(this.storageLocation==="systemClipboard")return!0;if(this.storageLocation!=="memory")try{const i=H[this.storageLocation];if(!i)return!1;const s=i.getItem(this.w1),n=i.getItem(this.b1);return!(s===null||s===""||n!==e.model.dataFormat)}catch{return!1}return!(X.Sp===null||X.Sp.count===0||X.i1!==e.model.dataFormat)}undo(){this.a.undoManager.undo()}canUndo(){const t=this.a;return t.isReadOnly||t.isModelReadOnly?!1:t.allowUndo&&t.undoManager.canUndo()}redo(){this.a.undoManager.redo()}canRedo(){const t=this.a;return t.isReadOnly||t.isModelReadOnly?!1:t.allowUndo&&t.undoManager.canRedo()}decreaseZoom(t){t===void 0&&(t=1/this.zoomFactor);const e=this.a;if(e.autoScale!==1)return;const i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canDecreaseZoom(t){t===void 0&&(t=1/this.zoomFactor);const e=this.a;if(e.autoScale!==1)return!1;const i=e.scale*t;return i<e.minScale||i>e.maxScale?!1:e.allowZoom}increaseZoom(t){t===void 0&&(t=this.zoomFactor);const e=this.a;if(e.autoScale!==1)return;const i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canIncreaseZoom(t){t===void 0&&(t=this.zoomFactor);const e=this.a;if(e.autoScale!==1)return!1;const i=e.scale*t;return i<e.minScale||i>e.maxScale?!1:e.allowZoom}resetZoom(t){t===void 0&&(t=this.defaultScale);const e=this.a;t<e.minScale||t>e.maxScale||(e.scale=t)}canResetZoom(t){t===void 0&&(t=this.defaultScale);const e=this.a;return t<e.minScale||t>e.maxScale?!1:e.allowZoom}zoomToFit(t){const e=this.a,i=e.animationManager;i.stopAnimation(),e.redraw();const s=e.position.copy(),n=e.scale;if(i.Gl("Zoom To Fit"),!t&&this.isZoomToFitRestoreEnabled&&n===this.S1&&!isNaN(this.k1)&&this.P1.isReal()&&e.documentBounds.equals(this.M1))e.scale=this.k1,e.position=this.P1,this.S1=NaN,this.M1=I.em;else{if(this.k1=n,this.P1=s,t){const o=t.copy();if(o.width>0&&o.height>0){const r=e.viewportBounds,a=r.width*n,l=r.height*n,h=Math.min(a/o.width,l/o.height),u=a/h,c=l/h;o.width<u&&(o.x-=(u-o.width)/2),o.height<c&&(o.y-=(c-o.height)/2)}e.zoomToRect(o,2)}else e.zoomToFit();this.S1=e.scale,this.M1=e.documentBounds.copy()}i.SM()}canZoomToFit(t){return this.a.allowZoom}WO(t,e,i){const s=this.a;t==="ArrowUp"?s.allowVerticalScroll&&(e?s.scroll("pixel","up"):s.scroll("line","up")):t==="ArrowDown"?s.allowVerticalScroll&&(e?s.scroll("pixel","down"):s.scroll("line","down")):t==="ArrowLeft"?s.allowHorizontalScroll&&(e?s.scroll("pixel","left"):s.scroll("line","left")):t==="ArrowRight"&&s.allowHorizontalScroll&&(e?s.scroll("pixel","right"):s.scroll("line","right"))}scrollToPart(t){t===void 0&&(t=null),t!==null&&y.se(t,ft,Et,"part");const e=this.a;if(e.ensureBounds(),t===null){try{this.Ho!==null&&(this.Ho.next()?t=this.Ho.value:this.Ho=null)}catch{this.Ho=null}t===null&&(e.highlighteds.count>0?this.Ho=e.highlighteds.iterator:e.selection.count>0&&(this.Ho=e.selection.iterator),this.Ho!==null&&this.Ho.next()&&(t=this.Ho.value))}if(t!==null){const i=e.animationManager;i.Gl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.ff(t,[t]);if(n.length===1)e.startTransaction(),e.centerRect(t.actualBounds),e.commitTransaction("Scroll To Part");else{const o=()=>{e.startTransaction();let a=n.pop();for(;n.length>0&&a instanceof W&&a.isTreeExpanded&&(!(a instanceof at)||a.isSubGraphExpanded);)a=n.pop();n.length>0?(a instanceof ft&&e.scrollToRect(a.actualBounds),a instanceof W&&!a.isTreeExpanded&&(a.isTreeExpanded=!0),a instanceof at&&!a.isSubGraphExpanded&&(a.isSubGraphExpanded=!0)):(a instanceof ft&&e.centerRect(a.actualBounds),e.removeDiagramListener("LayoutCompleted",r)),e.commitTransaction("Scroll To Part")},r=()=>{y.dn(o,(i.isEnabled?i.duration:0)+s)};e.addDiagramListener("LayoutCompleted",r),o()}}else{const n=e.position.copy();e.centerRect(t.actualBounds),n.equalsApprox(e.position)&&i.stopAnimation()}}}ff(t,e){if(t.isVisible())return e;if(t instanceof pt){const i=t.adornedPart;i!==null&&this.ff(i,e)}else if(t instanceof U){const i=t.fromNode;i!==null&&this.ff(i,e);const s=t.toNode;s!==null&&this.ff(s,e)}else{if(t instanceof W){const s=t.labeledLink;s!==null&&this.ff(s,e);const n=t.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&e.push(n),this.ff(n,e))}const i=t.containingGroup;i!==null&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&e.push(i),this.ff(i,e))}return e}canScrollToPart(t){if(t===void 0&&(t=null),t!==null&&!(t instanceof ft))return!1;const e=this.a;return e.selection.count===0&&e.highlighteds.count===0?!1:e.allowHorizontalScroll&&e.allowVerticalScroll}collapseTree(t){t===void 0&&(t=null);const e=this.a,i="Collapse Tree";try{e.startTransaction(i),e.animationManager.Gl(i);const s=new J;if(t!==null&&t.isTreeExpanded)t.collapseTree(),s.add(t);else if(t===null){const n=e.selection.iterator;for(;n.next();){const o=n.value;o instanceof W&&o.isTreeExpanded&&(o.collapseTree(),s.add(o))}}e.T("TreeCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseTree(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null){if(!(t instanceof W)||!t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof W){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(t){t===void 0&&(t=null);const e=this.a,i="Expand Tree";try{e.startTransaction(i),e.animationManager.Gl(i);const s=new J;if(t!==null&&!t.isTreeExpanded)t.expandTree(),s.add(t);else if(t===null){const n=e.selection.iterator;for(;n.next();){const o=n.value;o instanceof W&&(o.isTreeExpanded||(o.expandTree(),s.add(o)))}}e.T("TreeExpanded",s)}finally{e.commitTransaction(i)}}canExpandTree(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null){if(!(t instanceof W)||t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof W){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const t=this.a,e=t.model;if(!e.uf())return;const i=this.archetypeGroupData;if(i===null)return;let s=null;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Group");const n=new J,o=t.selection.iterator;for(;o.next();){const h=o.value;h.Di()&&h.canGroup()&&n.add(h)}const r=new J,a=n.iterator;for(;a.next();){const h=a.value;let u=!1;const c=n.iterator;for(;c.next();){const d=c.value;if(h.isMemberOf(d)){u=!0;break}}u||r.add(h)}const l=r.first();if(l!==null){let h=l.containingGroup;if(h!==null)for(;h!==null;){let u=!1;const c=r.iterator;for(;c.next();)if(!c.value.isMemberOf(h)){u=!0;break}if(u)h=h.containingGroup;else break}if(i instanceof at)i.It(),s=i.copy(),s!==null&&t.add(s);else if(e.isGroupForData(i)){const u=e.copyNodeData(i);e.addNodeData(u),s=t.findNodeForData(u)}if(s!==null){h!==null&&this.isValidMember(h,s)&&(s.containingGroup=h);const u=r.iterator;for(;u.next();){const c=u.value;this.isValidMember(s,c)&&(c.containingGroup=s)}t.clearSelection(!0),s.isSelected=!0}}t.T("SelectionGrouped",s)}finally{t.commitTransaction("Group"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canGroupSelection(){const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowGroup||!t.model.uf()||this.archetypeGroupData===null)return!1;const e=t.selection.iterator;for(;e.next();){const i=e.value;if(i.Di()&&i.canGroup())return!0}return!1}wN(t){const e=y.nt();if(Array.isArray(t))t.forEach(n=>{n instanceof U||n instanceof ft&&e.push(n)});else{const n=t.iterator;for(;n.next();){const o=n.value;o instanceof U||o instanceof ft&&e.push(o)}}const i=new K,s=e.length;for(let n=0;n<s;n++){const o=e[n];let r=!0;for(let a=0;a<s;a++)if(o.isMemberOf(e[a])){r=!1;break}r&&i.add(o)}return y.Z(e),i}isValidMember(t,e){if(e===null||t===e||e instanceof U)return!1;let i;return t!==null&&(t===e||t.isMemberOf(e)||(i=t.memberValidation,i!==null&&!i(t,e))||t.data===null&&e.data!==null||t.data!==null&&e.data===null)?!1:(i=this.memberValidation,i!==null?i(t,e):!0)}ungroupSelection(t){t===void 0&&(t=null);const e=this.a,i=e.model;if(i.uf())try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Ungroup");const s=new J;if(t!==null)s.add(t);else{const o=e.selection.iterator;for(;o.next();){const r=o.value;r instanceof at&&r.canUngroup()&&s.add(r)}}const n=new J;if(s.count>0){e.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const a=r.containingGroup,l=a!==null&&a.data!==null?i.getKeyForNodeData(a.data):void 0;n.addAll(r.memberParts);const h=n.iterator;for(;h.next();){const u=h.value;if(u.isSelected=!0,u instanceof U)continue;const c=u.data;c!==null?i.setGroupForData(c,l):u.containingGroup=a}e.remove(r)}}e.T("SelectionUngrouped",s,n)}finally{e.commitTransaction("Ungroup"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canUngroupSelection(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||!e.allowUngroup||!e.model.uf())return!1;if(t!==null){if(!(t instanceof at))return!1;if(t.canUngroup())return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof at&&s.canUngroup())return!0}}return!1}addTopLevelParts(t,e){const i=this.wN(t);let s=!0;const n=i.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!e||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(t){t===void 0&&(t=null);const e=this.a,i="Collapse SubGraph";try{e.startTransaction(i),e.animationManager.Gl(i);const s=new J;if(t!==null&&t.isSubGraphExpanded)t.collapseSubGraph(),s.add(t);else if(t===null){const n=e.selection.iterator;for(;n.next();){const o=n.value;o instanceof at&&o.isSubGraphExpanded&&(o.collapseSubGraph(),s.add(o))}}e.T("SubGraphCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseSubGraph(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null)return!(!(t instanceof at)||!t.isSubGraphExpanded);{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof at&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(t){t===void 0&&(t=null);const e=this.a,i="Expand SubGraph",s=new J;try{if(e.startTransaction(i),e.animationManager.Gl(i),t!==null&&!t.isSubGraphExpanded)t.expandSubGraph(),s.add(t);else if(t===null){const n=e.selection.iterator;for(;n.next();){const o=n.value;o instanceof at&&(o.isSubGraphExpanded||(o.expandSubGraph(),s.add(o)))}}e.T("SubGraphExpanded",s)}finally{for(const n of s)this.zT(e,n);t&&this.zT(e,t),e.commitTransaction(i)}}zT(t,e){for(const i of e.memberParts)i instanceof W&&t.Yc(i,e)}canExpandSubGraph(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null)return!(!(t instanceof at)||t.isSubGraphExpanded);{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof at&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(t){t===void 0&&(t=null),t!==null&&y.se(t,lt,Et,"editTextBlock");const e=this.a,i=e.toolManager.findTool("TextEditing");if(i!==null){if(t===null){let s=null;const n=e.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;t=s.findInVisualTree(o=>o instanceof lt&&o.editable)}t!==null&&(e.currentTool=null,i.textBlock=t,e.currentTool=i)}}canEditTextBlock(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowTextEdit||e.toolManager.findTool("TextEditing")===null)return!1;if(t!==null){if(!(t instanceof lt))return!1;const i=t.part;if(i!==null&&i.canEdit())return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&(t=s.findInVisualTree(n=>n instanceof lt&&n.editable),t!==null))return!0}}return!1}showContextMenu(t){const e=this.a,i=e.toolManager.findTool("ContextMenu");if(i===null)return;t===void 0&&(t=null),t===null&&(e.selection.count>0?t=e.selection.first():t=e);const s=i.findObjectWithContextMenu(t);if(s!==null){const n=e.lastInput;let o;if(s instanceof tt?o=s.getDocumentPoint(T.Center):e.viewportBounds.containsPoint(n.documentPoint)?o=P.mn:o=e.viewportBounds.center,o.isReal()){const r=new te;r.diagram=e,r.viewPoint=e.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,e.lastInput=r}e.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(t){const e=this.a,i=e.toolManager.findTool("ContextMenu");return!(i===null||(t===void 0&&(t=null),t===null&&(e.selection.count>0?t=e.selection.first():t=e),i.findObjectWithContextMenu(t)===null))}downloadSvg(t){const e=this.a,i={scale:1,background:e.div?e.div.style.backgroundColor:"white",name:this.JO("svg")};t&&Object.assign(i,t);const s=e.makeSvg(i);if(s!==null){const n=new XMLSerializer().serializeToString(s);this.$O(i.name,"image/svg+xml",n)}}downloadSVG(t){this.downloadSvg(t)}canDownloadSvg(t){return this.a!==null}$O(t,e,i){let s=null,n=null;try{const o=new Blob([i],{type:e});s=H.URL.createObjectURL(o),n=y.Ni("a"),n.style.display="none",n.href=s,n.download=t,H.document.body.appendChild(n),requestAnimationFrame(()=>{try{n!==null&&n.click()}finally{s!==null&&H.URL.revokeObjectURL(s),n!==null&&H.document.body.removeChild(n)}})}catch{s!==null&&H.URL.revokeObjectURL(s),n!==null&&H.document.body.removeChild(n)}}JO(t){const e="."+t;let i=this.diagram.model.name;return i?i.endsWith(e)&&(i=i.substring(0,i.length-e.length)):i="diagram",i+=e,i}get copiesClipboardData(){return this.j2}set copiesClipboardData(t){this.j2=!!t}get copiesConnectedLinks(){return this.q2}set copiesConnectedLinks(t){this.q2=!!t}get deletesConnectedLinks(){return this.W2}set deletesConnectedLinks(t){this.W2=!!t}get copiesTree(){return this.J2}set copiesTree(t){this.J2=!!t}get deletesTree(){return this.$2}set deletesTree(t){this.$2=!!t}get copiesParentKey(){return this.Z2}set copiesParentKey(t){this.Z2=!!t}get copiesGroupKey(){return this.Q2}set copiesGroupKey(t){this.Q2=!!t}get storageLocation(){return this._2}set storageLocation(t){t||(t="memory"),t!=="memory"&&t!=="sessionStorage"&&t!=="localStorage"&&t!=="systemClipboard"&&y.o("Invalid new value for CommandHandler.storageLocation: "+t),this._2=t}get archetypeGroupData(){return this.tN}set archetypeGroupData(t){t!==null&&y.xc(t,Et,"archetypeGroupData"),this.a,this.tN=t}get memberValidation(){return this.da}set memberValidation(t){t!==null&&y.S(t,Et,"memberValidation"),this.da=t}get defaultScale(){return this.diagram.defaultScale}set defaultScale(t){this.diagram.defaultScale=t}get zoomFactor(){return this.eN}set zoomFactor(t){t>1||y.o("zoomFactor must be larger than 1.0, not: "+t),this.eN=t}get isZoomToFitRestoreEnabled(){return this.iN}set isZoomToFitRestoreEnabled(t){this.iN=!!t}get scrollToPartPause(){return this.sN}set scrollToPartPause(t){this.sN=t}computeEffectiveCollection(t,e){const i=this.a,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;e===void 0&&(e=i.Tp());const o=new bt;if(t===null)return o;let r=t.iterator;for(;r.next();){const a=r.value;i.tl(o,a,n,e)}if(i.draggedLink!==null&&e.dragsLink)return o;for(r=t.iterator;r.next();){const a=r.value;if(a instanceof U){const l=a.fromNode;if(l!==null&&!o.has(l))o.delete(a);else{const h=a.toNode;h!==null&&!o.has(h)&&o.delete(a)}}}return o}static getModifierNames(){return Et.md}static setModifierNames(t){Et.md=t}static YO(t){let e="";return t&1&&(e+=Et.md[0]||""),t&4&&(e+=Et.md[1]||""),t&2&&(e+=Et.md[2]||""),t&8&&(e+=Et.md[3]||""),e}static GO(t){return t===1?Et.zO:t===2?Et.XO:Et.VT}static pN(t,e,i){var s=new P(i,0).rotate(t-e/2),n=new yt().add(new Lt(-i,-i)).add(new Lt(i,i)).add(new Lt(s.x,s.y).add(new dt(5,t-e/2,e,0,0,i,i)));return n.offset(i,i),n}KO(t){t.isTransactionFinished&&this.updateFocusBox()}HO(t){if(t.subject.scale===this.diagram.scale)return;const e=4/this.diagram.scale,i=this.focusBox.findObject("SHAPE");i!==null&&(i.strokeWidth=e);const s=this.focusBox.findObject("SHAPE2");s!==null&&(s.strokeWidth=e,s.strokeDashArray=[e,e]);const n=this.focusBox.placeholder;n!==null&&(n.padding=e)}jO(t){this.focus===null?y.dn(()=>{this.focus=this.findFirstFocus()},500):this.onFocusChanged(this.focus,this.focus)}qO(t){this.isVirtualPointerShown=!1}get isFocusEnabled(){return this.nN}set isFocusEnabled(t){t=!!t;const e=this.isFocusEnabled;t!==e&&(t||(this.isVirtualPointerShown=!1,this.dN=this.focus,this.focus=null),this.nN=t,t&&(this.focus=this.dN,this.updateFocusBox()))}get focusBox(){return this.Ip}set focusBox(t){if(!(t instanceof pt))return;const e=this.Ip;if(t!==e&&(this.Ip=t,e.adornedObject!==null)){const i=e.adornedPart;i!==null&&i.removeAdornment("Focus"),t.adornedObject=e.adornedObject,i!==null&&i.addAdornment("Focus",t)}}get focus(){return this.Ip.adornedObject}set focus(t){const e=this.focus;if(t!==e){const i=this.a;if(!i||!this.isFocusEnabled||t!==null&&t.diagram!==i)return;i.currentTool instanceof At||this.cancelVirtualPointer();const s=this.focusBox.adornedPart;s&&s.removeAdornment("Focus"),t===null?(this.gd=null,this.virtualPointerLocation=i.viewportBounds.center,this.focusBox.adornedObject=null):(this.virtualPointerLocation=t.getDocumentPoint(T.Center),this.focusBox.adornedObject=t,this.updateFocusBox()),this.onFocusChanged(e,t)}}onFocusChanged(t,e){const i=this.a;if(i&&(this.focusChanged!==null?this.focusChanged(t,e,this):this.ZO(this.describe(t,e)),e!==null&&e.part!==null)){const s=e.getDocumentBounds();i.viewportBounds.containsRect(s)||(e instanceof ft?i.commandHandler.scrollToPart(e):i.scrollToRect(s))}}get focusChanged(){return this.oN}set focusChanged(t){t!==null&&y.S(t,Et,"focusChanged"),this.oN=t}get liveElementId(){return this.N1||this.rN}set liveElementId(t){const e=this.N1;t!==e&&(this.N1=t,this.xN())}xN(){const t=this.diagram;if(!t||!X.isUsingDOM())return;const e=t.lt?.bt;if(!e)return;const i=this.liveElementId,s=H.document.getElementById(i);this.isUsingAriaLive?(e.removeAttribute("aria-labelledby"),s&&s.setAttribute("aria-live","polite")):(i&&e.setAttribute("aria-labelledby",i),s&&s.removeAttribute("aria-live"))}get isUsingAriaLive(){return this.C1}set isUsingAriaLive(t){const e=this.C1;t!==e&&(this.C1=t,this.xN())}ZO(t){const e=this.diagram;if(!e||!X.isUsingDOM()||!e.div)return;let i=this.liveElementId;if(!i){const n=y.Ni("span"),o=n.style;for(o.opacity="0",o.position="absolute",o.right="-9999px",o.bottom="-9999px",o.width="0px",o.height="0px",o.overflow="hidden",o.border="0",i=(e.div.id||"diagram")+"_aria";H.document.getElementById(i);)i+=Math.floor(Math.random()*10);n.id=i,this.rN=i,e.div.appendChild(n),this.xN()}const s=H.document.getElementById(i);s&&(s.textContent=t)}describe(t,e){let i="";e instanceof W?e instanceof at?i="Group":i="Node":e instanceof U?i="Link":e instanceof ft?i="Part":e&&(e.click?i="button":e instanceof lt&&e.editable&&(i="editable"),e.portId!==null&&(i&&(i+=" "),i+="port",e.portId&&(i+=" "+e.portId)));const s=this.bN(e);s&&(i+=" "+s);const n=e;if(t&&n instanceof U&&n.fromNode&&n.toNode){if(t instanceof W&&t.part===n.fromNode||t instanceof U&&t.fromNode===n.fromNode){i+=" to "+this.bN(n.toNode,!0);const o=n.toPort?.portId;o&&(i+=" port "+o)}else if(t instanceof W&&t.part===n.toNode||t instanceof U&&t.toNode===n.toNode){i+=" from "+this.bN(n.fromNode,!0);const o=n.fromPort?.portId;o&&(i+=" port "+o)}}return i}bN(t,e){if(e===void 0&&(e=!1),!t)return"";if(t instanceof lt&&t.text)return t.text;if(t instanceof j){let i="";return t instanceof ft&&t.text&&(i=t.text),e&&i||t.walkVisualTreeFrom(t,(s,n)=>{n.isVisibleObject()&&n instanceof lt&&n.text&&(!e||!i)&&i!==n.text&&(i+=" "+n.text)}),i}return""}updateFocusBox(){const t=this.focus;if(t!==null)if(t.diagram!==null&&(t instanceof ft?t.isVisible():t.isVisibleObject()&&t.part?.isVisible()))this.focusBox.adornedObject=t,t.part?.addAdornment("Focus",this.focusBox);else{let e=null;if(t instanceof ft||(e=t.part),e instanceof ft&&e.isVisible())this.focus=e;else{if(e instanceof W&&!e.isVisible()){const i=e.findTreeParentNode();if(i!==null)e=i;else{const s=e.labeledLink;s!==null&&(e=s)}}for(;e instanceof ft&&!e.isVisible();)e=e.containingGroup;e instanceof ft&&e.isVisible()?this.focus=e:this.focus=null}}}findFirstFocus(){const t=this.a;if(t===null||!t.isEnabled)return null;if(this.focus!==null)return this.focus;if(this.isFocusEnabled)if(t.selection.count>0)this.focus=t.selection.first();else{const e=this.XT(t.isTreePathToChildren).first();if(e!==null)return e}return null}get isVirtualPointerEnabled(){return this.lN}set isVirtualPointerEnabled(t){t=!!t;const e=this.isVirtualPointerEnabled;if(t!==e&&(this.lN=t,t)){const i=this.Vp;i&&(this.Vp=null,i.commandHandler.Ps=null,i.commandHandler.cancelVirtualPointer())}}get isVirtualPointerShown(){return this.aN}set isVirtualPointerShown(t){t=!!t;const e=this.isVirtualPointerShown;if(t!==e){const i=this.a;if(!i||!this.isVirtualPointerEnabled)return;this.aN=t;const s=this.focus;t?this.virtualPointerBox.diagram===null&&(this.virtualPointerLocation.isReal()||(s!==null?this.virtualPointerLocation=s.getDocumentPoint(T.Center):this.virtualPointerLocation=i.viewportBounds.center),i.add(this.virtualPointerBox),this.ma()):this.virtualPointerBox.diagram!==null&&(i.remove(this.virtualPointerBox),this.ma())}}cancelVirtualPointer(){const t=this.a;t&&(this.yN(),this.isVirtualPointerShown=!1,t.currentTool.doCancel(),this.isVirtualPointerDown=!1,this.kN())}kN(){const t=this.Ps;if(t!==null){this.Ps=null;const e=t.commandHandler;e.Ps=null,e.Vp=null,e.isVirtualPointerShown=!1,e.isVirtualPointerDown=!1,e.yN(),this.L1&&(e.isVirtualPointerEnabled=!1),this.L1=!1}}yN(){this.Oi.button=0,this.Oi.modifiers=0,this.Oi.clickCount=1,this.Oi.down=!1,this.ma()}ma(){this.virtualPointerChanged!==null&&this.virtualPointerChanged(this.virtualPointerBox,this),this.updateVirtualPointer()}updateVirtualPointer(){const t=this.virtualPointerBox.diagram;t&&(this.virtualPointerBox.scale=1/t.scale),this.virtualPointerBox.updateTargetBindings()}get virtualPointerBox(){return this.dd}set virtualPointerBox(t){if(!(t instanceof ft))return;const e=this.dd;t!==e&&(e!==null&&(t.location=e.location,e.diagram!==null&&e.diagram.remove(e)),this.dd=t,this.isVirtualPointerShown&&this.diagram&&(this.diagram.add(t),t.data=e.data),this.ma())}get virtualPointerChanged(){return this.hN}set virtualPointerChanged(t){t!==null&&y.S(t,Et,"virtualPointerChanged"),this.hN=t}get virtualPointerLocation(){return this.virtualPointerBox.location}set virtualPointerLocation(t){this.virtualPointerLocation.equals(t)||this.GT(t.x,t.y)}get isVirtualPointerDown(){return this.virtualPointerBox.data?this.virtualPointerBox.data.down:!1}set isVirtualPointerDown(t){t=!!t;const e=this.isVirtualPointerDown;if(t!==e){const i=this.a;if(!i||!this.isVirtualPointerEnabled||(this.virtualPointerBox.data===null&&(this.dd.data=this.Oi),this.virtualPointerBox.data.down=t,this.ma(),!this.isVirtualPointerShown))return;const s=i.lastInput,n=new te;n.diagram=i,this.YT(n,t),t?n.down=!0:n.up=!0,n.clickCount=1,n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,t&&(i.firstInput=n.copy()),this.pd(n,!0),t||this.Oi.clickCount===2&&(n.clickCount=2,n.down=!0,n.up=!1,this.pd(n,!0),n.down=!1,n.up=!0,this.pd(n,!0),this.KT(1)),i.lastInput=s}}get virtualPointerShiftMove(){return this.Ep}set virtualPointerShiftMove(t){this.Ep=t}get virtualPointerControlMove(){return this.Up}set virtualPointerControlMove(t){this.Up=t}Bp(t,e){this.GT(this.virtualPointerLocation.x+t,this.virtualPointerLocation.y+e)}GT(t,e){this.virtualPointerBox.moveTo(t,e,!0);const i=this.a;if(!i||!this.isVirtualPointerEnabled||!this.isVirtualPointerShown)return;i.ensureBounds();const s=i.lastInput,n=new te;n.diagram=i,this.YT(n,this.isVirtualPointerDown),n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,this.pd(n,!0),i.lastInput=s,this.isVirtualPointerDown&&(i.remove(this.virtualPointerBox),i.add(this.virtualPointerBox)),this.ma()}YT(t,e){const i=this.a;if(i){if(t.targetDiagram=i,t.documentPoint=this.virtualPointerLocation,i.allowDragOut){const s=i.div.getBoundingClientRect(),n=i.transformDocToView(this.virtualPointerLocation),o=s.x+n.x,r=s.y+n.y;let a=H.document.elementFromPoint(o,r)||null;a instanceof HTMLCanvasElement&&(a=a.parentElement),a!==null&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(o,r)||null,a instanceof HTMLCanvasElement&&(a=a.parentElement));let l=null;if(a instanceof HTMLElement&&(l=X.Wi.get(a))&&l!==i&&l.div){const h=l.div.getBoundingClientRect(),u=new P(n.x-(h.x-s.x),n.y-(h.y-s.y));this.Ps!==null&&this.Ps!==l&&this.kN(),t.targetDiagram=l,t.viewPoint=u,t.documentPoint=l.transformViewToDoc(u),t.viewPoint=l.transformDocToView(t.documentPoint),this.Ps=l;const c=l.commandHandler;this.L1=!c.isVirtualPointerEnabled,c.isVirtualPointerEnabled=!0,c.isVirtualPointerDown=e,c.virtualPointerLocation=t.documentPoint,c.isVirtualPointerShown=!0,c.Vp=i;return}}this.Ps!==null&&this.kN(),t.viewPoint=i.transformDocToView(t.documentPoint)}}pd(t,e){this.doVirtualPointerEvent(t,e)}doVirtualPointerEvent(t,e){const i=this.a;i&&(t.timestamp=Date.now(),i.lastInput=t,e&&(t.up?i.doMouseUp():t.down?i.doMouseDown():i.doMouseMove()),this.onVirtualPointerEvent(t,e))}onVirtualPointerEvent(t,e){const i=this.a;i&&(t.up?this.isVirtualPointerDown&&!i.viewportBounds.containsPoint(this.virtualPointerLocation)&&(this.virtualPointerLocation=this.focus instanceof tt?this.focus.getDocumentPoint(T.Center):i.viewportBounds.center):t.down)}doVirtualFocusKeyDown(){const t=this.a;if(!t)return!1;const e=t.lastInput,i=e.commandKey;if(this.isVirtualPointerEnabled&&(i==="ShiftLeft"||i==="ShiftRight"))return this.isVirtualPointerShown=!0,!0;if(this.BT.indexOf(i)>=0)if(e.shift&&this.isVirtualPointerShown){const s=this.A1(i),n=e.control||e.meta?this.Up:this.Ep;s===270?this.Bp(0,-n):s===90?this.Bp(0,n):s===180?this.Bp(-n,0):this.Bp(n,0)}else this.QO();else if(e.shift&&this.isVirtualPointerShown&&(i==="Numpad1"||i==="Numpad2"||i==="Numpad3"||i==="Numpad4"||i==="Numpad6"||i==="Numpad7"||i==="Numpad8"||i==="Numpad9")){const s=e.control||e.meta?this.Up:this.Ep;let n=0;i==="Numpad1"||i==="Numpad4"||i==="Numpad7"?n=-s:(i==="Numpad3"||i==="Numpad6"||i==="Numpad9")&&(n=s);let o=0;i==="Numpad7"||i==="Numpad8"||i==="Numpad9"?o=-s:(i==="Numpad1"||i==="Numpad2"||i==="Numpad3")&&(o=s),this.Bp(n,o)}else if(i==="Enter"||i==="NumpadEnter"||i==="Numpad5")e.shift&&this.isVirtualPointerShown?this.isVirtualPointerDown=!this.isVirtualPointerDown:this._O();else if(i==="Escape")this.tI();else if(i==="Space")this.eI();else if(i==="ContextMenu"||e.shift&&i==="F10"||(e.control||e.meta)&&e.shift&&i==="Backslash")this.iI();else if(e.shift&&i==="c")this.T1(1);else if(e.shift&&i==="a")this.T1(2);else if(e.shift&&i==="KeyS")this.T1(4);else if(e.shift&&i==="KeyM")this.T1(8);else if(e.shift&&i==="Digit1")this.D1(0);else if(e.shift&&i==="Digit2")this.D1(1);else if(e.shift&&i==="Digit3")this.D1(2);else if(e.shift&&i==="Numpad0"){const s=this.Oi.button;this.D1(s===2?0:2)}else if(e.shift&&(i==="KeyD"||i==="NumpadDecimal")){const s=this.Oi.clickCount;this.KT(s===2?1:2)}else if(e.shift&&i==="KeyF"){const s=this.nextFocusFormula;this.nextFocusFormula=s==="distance"?"linear":"distance"}else if(e.shift&&i==="y")this.isUsingAriaLive=!this.isUsingAriaLive;else return!1;return!0}doVirtualFocusKeyUp(){const t=this.a;if(!t)return!1;const e=t.lastInput.commandKey;return this.isVirtualPointerEnabled&&(e==="ShiftLeft"||e==="ShiftRight")&&(this.isVirtualPointerShown=!1),!0}A1(t){switch(t){case"ArrowDown":return 90;case"ArrowLeft":return 180;case"ArrowUp":return 270;default:return 0}}BT=["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"];T1(t){const e=this.Oi.modifiers;this.Oi.modifiers=e&t?e&~t:e|t,this.ma()}KT(t){this.Oi.clickCount=t,this.ma()}D1(t){this.Oi.button=t,this.ma()}QO(){const t=this.a;if(!t)return;const e=t.lastInput,i=this.focus;if(i===null){const s=this.XT(t.isTreePathToChildren).first();s!==null&&(this.focus=s)}else if(i instanceof U)this.sI(i);else if(i instanceof W)this.nI(i);else{i instanceof ft&&(this.gd=null);const s=this.A1(e.commandKey);s===270?this.focus=this.findNextFocus(270):s===90?this.focus=this.findNextFocus(90):s===180?this.focus=this.findNextFocus(180):this.focus=this.findNextFocus(0)}}sI(t){const e=this.a;if(!e)return;const i=e.lastInput,s=this.A1(i.commandKey);let n=null;const o=this.gd;if(o!==null){const r=this.mN;if(s===r)n=t.getOtherNode(o);else if(s===L.Ee(r+180))n=o;else{let a=r===0||r===180?90:0,l=r===0||r===180?270:180;if(s===a){const h=this.PN(o,r,!0),u=h.indexOf(t);u>=0&&u<h.count-1&&(this.focus=h.elt(u+1))}else if(s===l){const h=this.PN(o,r,!0),u=h.indexOf(t);u>0&&(this.focus=h.elt(u-1))}}}else{const r=t.fromNode,a=t.toNode;if(!r||!a)return;s===270?n=r.location.y<a.location.y?r:a:s==90?n=r.location.y>a.location.y?r:a:s===180?n=r.location.x<a.location.x?r:a:n=r.location.x>a.location.x?r:a}for(;n!==null&&!n.isVisible();)n=n.containingGroup;n!==null&&(this.focus=n)}nI(t){const e=this.a;if(!e)return;const i=e.lastInput,s=this.A1(i.commandKey);if(i.control||i.meta){const n=this.PN(t,s,!0).first();n&&(this.gd=t,this.mN=s,this.focus=n)}else this.gd=null,this.focus=this.findNextFocus(s)}PN(t,e,i){if(t===null)return new J;const s=t.actualBounds;if(!s.isReal())return new J;const n=new Set;(t instanceof at?t.findExternalLinksConnected():t.findLinksConnected()).each(r=>{if(!r.isVisible())return;let a=null;if(r.fromNode===t?a=r.toNode:r.toNode===t?a=r.fromNode:t instanceof at&&(r.fromNode?.isMemberOf(t)?a=r.toNode:r.toNode?.isMemberOf(t)&&(a=r.fromNode)),a===null||a.isMemberOf(t))return;for(;a!==null&&!a.isVisible();)a=a.containingGroup;if(a===null)return;const l=a.location;if(l.isReal()&&!(e===270&&(a!==t?l.y>=s.top:r.midPoint.y>=s.top))){if(e===90&&(a!==t?l.y<=s.bottom:r.midPoint.y<=s.bottom)||e===180&&(a!==t?l.x>=s.left:r.midPoint.x>=s.left)||e===0&&(a!==t?l.x<=s.right:r.midPoint.x<=s.right))return;i&&r.actualBounds.isReal()?n.add(r):n.add(a)}});const o=new J(n);return e===90||e===270?o.sort((r,a)=>r.actualBounds.centerX-a.actualBounds.centerX):o.sort((r,a)=>r.actualBounds.centerY-a.actualBounds.centerY),o}findNextFocus(t){t=L.Ee(t);const e=this.focus,i=e instanceof W?e.location:e.getDocumentPoint(T.Center);let s=1/0,n=e;const o=(r,a,l,h)=>{if(this.nextFocusFormula==="linear"){let u=1/0;t===0&&l>i.x||t===180&&l<i.x?u=Math.abs(l-i.x):(t===90&&h>i.y||t===270&&h<i.y)&&(u=Math.abs(h-i.y)),u<s&&(s=u,n=r)}else{if(t===0&&(a.right<i.x||(a.centerX-i.x)**2>s)||t===90&&(a.bottom<i.y||(a.centerY-i.y)**2>s)||t===180&&(a.x>i.x||(i.x-a.centerX)**2>s)||t===270&&(a.y>i.y||(i.y-a.centerY)**2>s))return;const u=i.direction(l,h),c=L.jF(t,u);if(t===90||t===270?c<=45:c<45){const d=i.distanceSquared(l,h);d<s&&(s=d,n=r)}}};if(e instanceof ft&&e.diagram!==null){const r=e.containingGroup;r!==null?r.memberParts.each(a=>{a===e||a instanceof U||!a.isVisible()||o(a,a.actualBounds,a.location.x,a.location.y)}):(e.diagram.nodes.each(a=>{a===e||!a.isTopLevel||!a.isVisible()||o(a,a.actualBounds,a.location.x,a.location.y)}),e.diagram.parts.each(a=>{a===e||!a.isTopLevel||!a.isVisible()||o(a,a.actualBounds,a.location.x,a.location.y)}))}else if(e.part!==null){const r=new I;this.SN(e.part).each(a=>{a!==e&&(a.getDocumentBounds(r),o(a,r,r.centerX,r.centerY))})}return n}get nextFocusFormula(){return this.gN}set nextFocusFormula(t){this.gN=t}_O(){const t=this.a;if(!t)return;const e=t.currentTool;if(e instanceof At){const n=e.currentObject;this.v1(this.focus),e.maybeStopTool(this.focus),t.currentTool instanceof At||(this.focus=n);return}const i=this.focus,s=t.lastInput;if(i===null)s.control||s.meta?this.v1(null):this.focus=this.findFirstFocus();else if(i instanceof ft)if(s.control||s.meta)this.v1(i);else{const n=this.SN(i);if(n.count>0)this.focus=n.first();else if(i instanceof U&&i.isLabeledLink){const o=i.labelNodes.first();o!==null&&o.isVisible()&&(this.focus=o)}else if(i instanceof at&&i.isSubGraphExpanded){const o=i.memberParts.first();o!==null&&o.isVisible()&&(this.focus=o)}}else this.v1(i)}XT(t){const e=new J,i=this.a;if(!i)return e;let s=0;for(;e.count===0&&s<i.nodes.count;){const n=i.nodes;for(;n.next();){const o=n.value;o.isTopLevel&&o.isVisible()&&(t?o.findNodesInto():o.findNodesOutOf()).count===s&&e.add(o)}s++}return e}SN(t){return t instanceof ft?this.Sn(t,new J):new J}Sn(t,e){return!(t instanceof ft)&&t.isVisibleObject()&&t.isEnabledObject()&&(t.contextMenu||t.click||t instanceof lt&&t.editable||t.part instanceof W&&t.portId!==null&&(t.portId!==""||t.part.ports.count>1)||t.toolTip)&&e.add(t),t instanceof j&&t.elements.each(i=>this.Sn(i,e)),e}v1(t){const e=this.a;if(!e)return;const i=e.lastInput,s=t instanceof tt?t:e;if(s.click){const n=new te;n.diagram=e,n.documentPoint=t instanceof tt?t.getDocumentPoint(T.Center):e.viewportBounds.center,n.viewPoint=e.transformDocToView(n.documentPoint),n.button=0,n.clickCount=1,n.targetObject=t,this.pd(n,!1),s instanceof tt?s.click(n,s):s.click(n),e.lastInput=i}else s instanceof lt&&s.editable?this.editTextBlock(s):this.HT(t)}tI(){const t=this.a;if(!t)return;const e=t.currentTool;if(e instanceof Ce&&e.currentToolTip!==null){e.hideToolTip();return}else if(e instanceof At){const i=e.currentObject;e.doKeyDown(),this.focus=i;return}if(this.focus instanceof ft){const i=this.focus;i instanceof W&&i.labeledLink!==null?this.focus=i.labeledLink:i.containingGroup!==null?this.focus=i.containingGroup:this.focus=null}else if(this.focus instanceof tt){const i=this.focus.part;if(i instanceof U&&i.isLabeledLink){const s=i.labelNodes.first();if(s!==null&&s.isVisible()){this.focus=s;return}}else if(i instanceof at&&i.isSubGraphExpanded){const s=i.memberParts.first();if(s!==null&&s.isVisible()){this.focus=s;return}}this.focus=i}else this.cancelVirtualPointer(),this.stopCommand()}eI(){const t=this.a;if(t)if(t.lastInput.shift&&this.isVirtualPointerShown){const e=t.findPartAt(this.virtualPointerLocation);e!==null&&(e===this.focus?this.jT():this.focus=e)}else this.jT()}jT(){const t=this.a;if(!t)return;const e=t.lastInput,i=this.focus;if(i instanceof ft){let s=i.part;if(e.control||e.meta){for(t.raiseDiagramEvent("ChangingSelection",t.selection);s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),t.raiseDiagramEvent("ChangedSelection",t.selection)}else if(e.shift){if(s!==null&&!s.isSelected){for(t.raiseDiagramEvent("ChangingSelection",t.selection);s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),t.raiseDiagramEvent("ChangedSelection",t.selection)}}else if(s!==null&&!s.isSelected){for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&t.select(s)}}this.HT(i),this.onFocusChanged(i,i)}HT(t){const e=this.a;if(!e)return;e.toolManager.hideToolTip();const i=e.lastInput;let s=t instanceof tt?t:e;for(;s instanceof tt&&!s.toolTip;)s=s.panel;if(s&&s.toolTip){const n=new te;n.diagram=e,n.documentPoint=t!==null?t.getDocumentPoint(T.Center):e.viewportBounds.center,n.viewPoint=e.transformDocToView(n.documentPoint),n.targetObject=t,this.pd(n,!1),e.toolManager.showToolTip(s.toolTip,t),e.lastInput=i}}iI(){const t=this.a;if(!t)return;const e=this.focus;if(this.canShowContextMenu(e)){this.showContextMenu(e);const i=t.toolManager.contextMenuTool.currentContextMenu;if(i instanceof pt){const s=this.SN(i);s.count>0&&(this.focus=s.first())}}}}var hi=(x=>(x[x.None=0]="None",x[x.Default=1]="Default",x[x.Vertical=4]="Vertical",x[x.Horizontal=5]="Horizontal",x[x.Fill=2]="Fill",x))(hi||{}),ui=(x=>(x[x.None=0]="None",x[x.Along=21]="Along",x[x.Plus90=22]="Plus90",x[x.Minus90=23]="Minus90",x[x.Opposite=24]="Opposite",x[x.Upright=25]="Upright",x[x.Plus90Upright=26]="Plus90Upright",x[x.Minus90Upright=27]="Minus90Upright",x[x.Upright45=28]="Upright45",x))(ui||{}),as=(x=>(x[x.None=0]="None",x[x.Vertical=1]="Vertical",x[x.Horizontal=2]="Horizontal",x[x.Both=3]="Both",x))(as||{});class tt{n;zp;Xp;pa;w;ya;ft;ct;hi;Zt;Gp;Zs;Lt;cs;il;wa;Se;Th;it;Xt;sl;De;Ke;yd;de;wd;Ot;he;nl;F1;xa;df;constructor(){K.Je(this),this.n=30723,this.Zt=1,this.Gp="",this.Zs=null,this.Lt=null,this.ct=new P(NaN,NaN).k(),this.cs=st.Zw,this.il=new wt,this.wa=new wt,this.Se=null,this.Th=1,this.it=1,this.Xt=0,this.sl=Mt.im,this.hi=new I(NaN,NaN,NaN,NaN).k(),this.De=new I(NaN,NaN,NaN,NaN).k(),this.Ke=new I(0,0,NaN,NaN).k(),this.yd=null,this.zp=null,this.ft=null,this.de=T.Default,this.wd=T.Default,this.Xp=0,this.pa=0,this.Ot=null,this.w=null,this.ya=null,this.he=null,this.F1=null,this.xa=null,this.nl=null,this.df=null}cloneProtected(t){t.n=(this.n|2048|4096)&-32769,t.Zt=this.Zt,t.Gp=this.Gp,t.Lt=this.Lt,t.ct.h(this.ct),t.cs=this.cs.N(),this.Se!==null?t.Se=this.Se.copy():t.Se=null,t.it=this.it,t.Xt=this.Xt,t.sl=this.sl.N(),t.hi.h(this.hi),t.De.h(this.De),t.Ke.h(this.Ke),t.zp=this.zp,this.ft!==null&&(t.ft=this.ft.copy()),t.de=this.de.N(),t.wd=this.wd.N(),t.Xp=this.Xp,t.pa=this.pa,this.Ot!==null&&(t.Ot=this.Ot.copy()),this.w!==null&&(this.w.me?t.w=this.w:t.w=this.w.copy()),this.ya!==null&&(t.ya=this.ya.slice()),this.he!==null&&(t.he=this.he.copy())}addCopyProperty(t){let e=this.ya;if(!Array.isArray(e))e=[],this.ya=e;else for(let i=0;i<e.length;i++)if(e[i]===t)return;e.push(t)}jo(t){t.yd=null,t.nl=null,t.c()}clone(){const t=new this.constructor;if(this.cloneProtected(t),this.ya!==null)for(let e=0;e<this.ya.length;e++){const i=this.ya[e];t[i]=this[i]}return t}copy(){return this.clone()}$S(){const t=this.ve;if(t!==null){this.ve=null;for(const e of t)e.xd()&&(e.isToData?this.themeData(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):e.isToObject?this.themeObject(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter,e.sourceName):e.isToModel?this.themeModel(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):this.theme(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter))}return this}fe(t){t in ui?this.segmentOrientation=t:t in hi?this.stretch=t:y.dr(this,t)}toString(){return y.Hn(this.constructor)+"#"+K.xs(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;ba(){this.w!==null&&(this.w.me=!0)}Yt(){return this.w===null?this.w=new Le:this.w.me&&(this.w=this.w.copy()),this.w}Ji(){if(this.ft===null){const t=new ti;t.Dh=T.None,t.vh=T.None,t.Fh=10,t.Rh=10,t.Oh=0,t.Ih=0,this.ft=t}return this.ft}raiseChangedEvent(t,e,i,s,n,o,r){const a=this.part;if(a!==null){a.gf(t,e,i,s,n,o,r),i===this&&t===2&&this.mf()&&this.Eh(a,e);const l=this.diagram;if(this.Ds!==null&&l!==null&&l.Qa&&!l.undoManager.isUndoingRedoing&&!l.animationManager.Uu){const h=this.Ds.get(e);if(h!==null&&l.animationManager.isEnabled&&!l.animationManager.isTicking){this.df===null&&(this.df=new bt);let u=l.undoManager.transactionLevel===0;if(h.startCondition===2?u=!0:h.startCondition===3&&(u=!1),u){const c=new ae;h.RR(c);const d=this.df.get(h);d!==null&&d.stop(),this.df.set(h,c),c.tb=this,c.DM=h,c.add(this,e,s,n),c.start()}else l.animationManager.getBundleAnimation().add(this,e,s,n)}}if(this instanceof j&&i===a&&a.MN()&&a.data!==null){const h=this.D.r,u=h.length;for(let c=0;c<u;c++){const d=h[c];d instanceof j&&d.Sn(f=>{f.data!==null&&f.MN()&&f.updateTargetBindings(e)})}}}}TR(t){this.df&&this.df.delete(t)}Yo(){if(this.diagram!==null&&this.findBindingPanel()===null&&this.ve!==null){const t=this.diagram.model,e=this.ve.iterator;for(;e.next();){const i=e.value;if(!i.isToTheme)continue;let s=null;const n=i.sourceName;i.isToObject&&(s=this.qT(n));let o=this;const r=i.targetId;r!==-1&&(o=this.Yp(r),o===null)||(n==="/"?s=o.part:n==="."?s=o:n===".."&&(s=o.panel),i.updateTarget(o,s,void 0,t))}}}Eh(t,e){const i=this.findBindingPanel();if(i!==null){const s=t.diagram,n=this.ve.iterator;for(;n.next();){const o=n.value;let r=null;if(o.isToObject){if(r=o.WT(i,this),r===null)continue;o.updateSource(this,r,e,null)}else if(o.isToModel)s!==null&&!s.wi&&o.updateSource(this,s.model.modelData,e,i);else if(!o.isToTheme){const a=i.data;if(a===null)continue;s!==null&&!s.wi&&o.updateSource(this,a,e,i)}if(r===this){const a=o.targetId,l=i.Yp(a);l!==null&&o.updateTarget(l,r,e,s?.model)}}}}Yp(t){return this.oo===t?this:null}qT(t){let e;return t===""?e=this:t==="/"?e=this:t==="."?e=this:t===".."?e=this:e=this.part.findObject(t),e}get oo(){return this.w!==null?this.w.oo:-1}set oo(t){this.oo!==t&&(this.w===null&&(this.w=new Le),this.w.oo=t)}get ve(){return this.w!==null?this.w.ve:null}set ve(t){this.ve!==t&&(this.w===null&&(this.w=new Le),this.w.ve=t)}get ro(){return this.w!==null?this.w.ro:null}set ro(t){this.ro!==t&&(this.w===null&&(this.w=new Le),this.w.ro=t)}raiseChanged(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}t(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}lo(t,e,i,s){const n=this.hi;if(n.e(t,e,i,s),this.it!==1||this.Xt!==0){this.Se===null&&(this.Se=new wt);const o=this.Se;o.Ue(),this.Kp(o,t,e,i,s),o.sm(n)}}JT(t,e,i){return this.pickable===!1?!1:(i.kc(this.v),e?this.intersectsRect(t,i):this.containedInRect(t,i))}$T(t,e,i){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=t.distanceSquaredPoint(e);return i?P.distanceLineSegmentSquared(t.x,t.y,0,0,0,s.height)<=n||P.distanceLineSegmentSquared(t.x,t.y,0,s.height,s.width,s.height)<=n||P.distanceLineSegmentSquared(t.x,t.y,s.width,s.height,s.width,0)<=n||P.distanceLineSegmentSquared(t.x,t.y,s.width,0,0,0)<=n:t.distanceSquared(0,0)<=n&&t.distanceSquared(0,s.height)<=n&&t.distanceSquared(s.width,0)<=n&&t.distanceSquared(s.width,s.height)<=n}Nn(){return!0}containsPoint(t){const e=P.l();e.h(t),this.v.gt(e);const i=this.actualBounds;if(!i.isReal())return P.i(e),!1;const s=this.diagram;if(s!==null&&s.pp){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),a=r/2,l=this.naturalBounds,h=this.getDocumentScale()*s.scale,u=1/h;if(l.width*h<o&&l.height*h<o){const c=I.contains(i.x-a*u,i.y-a*u,i.width+r*u,i.height+r*u,e.x,e.y);return P.i(e),c}}let n=!1;return(this instanceof pt||this instanceof et?I.contains(i.x-5,i.y-5,i.width+10,i.height+10,e.x,e.y):i.containsPoint(e))&&(this.he&&!this.he.containsPoint(e)?n=!1:this.Lt!==null&&this.Ke.containsPoint(t)?n=!0:n=this.ka(t)),P.i(e),n}ka(t){const e=this.naturalBounds;return I.contains(0,0,e.width,e.height,t.x,t.y)}containsRect(t){if(this.angle===0)return this.actualBounds.containsRect(t);const e=this.naturalBounds,i=I.z(0,0,e.width,e.height),s=this.v;let n=!1;const o=P.z(t.x,t.y);return i.containsPoint(s.Ci(o))&&(o.e(t.x,t.bottom),i.containsPoint(s.Ci(o))&&(o.e(t.right,t.bottom),i.containsPoint(s.Ci(o))&&(o.e(t.right,t.y),i.containsPoint(s.Ci(o))&&(n=!0)))),P.i(o),I.i(i),n}containedInRect(t,e){if(e===void 0)return t.containsRect(this.actualBounds);const i=this.naturalBounds,s=e;let n=!1;const o=P.z(0,0);return t.containsPoint(s.gt(o))&&(o.e(0,i.height),t.containsPoint(s.gt(o))&&(o.e(i.width,i.height),t.containsPoint(s.gt(o))&&(o.e(i.width,0),t.containsPoint(s.gt(o))&&(n=!0)))),P.i(o),n}intersectsRect(t,e){if(e===void 0&&(e=this.v,this.angle===0))return t.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=e,n=P.z(0,0),o=P.z(0,i.height),r=P.z(i.width,i.height),a=P.z(i.width,0);let l=!1;if(t.containsPoint(s.gt(n))||t.containsPoint(s.gt(o))||t.containsPoint(s.gt(r))||t.containsPoint(s.gt(a)))l=!0;else{const h=I.z(0,0,i.width,i.height),u=P.z(t.x,t.y);h.containsPoint(s.Ci(u))?l=!0:(u.e(t.x,t.bottom),h.containsPoint(s.Ci(u))?l=!0:(u.e(t.right,t.bottom),h.containsPoint(s.Ci(u))?l=!0:(u.e(t.right,t.y),h.containsPoint(s.Ci(u))&&(l=!0)))),P.i(u),I.i(h),l||(L.lx(t,n,o)||L.lx(t,o,r)||L.lx(t,r,a)||L.lx(t,a,n))&&(l=!0)}return P.i(n),P.i(o),P.i(r),P.i(a),l}getDocumentPoint(t,e){if(e===void 0&&(e=new P),t instanceof T){const i=t,s=this.naturalBounds;return e.e(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Js.gt(e),e}else return e.set(t),this.Js.gt(e),e}getDocumentBounds(t){t===void 0&&(t=new I);const e=this.naturalBounds,i=this.Js,s=P.z(0,0).v(i);return t.e(s.x,s.y,0,0),s.e(e.width,0).v(i),t.re(s.x,s.y,0,0),s.e(e.width,e.height).v(i),t.re(s.x,s.y,0,0),s.e(0,e.height).v(i),t.re(s.x,s.y,0,0),P.i(s),t}getDocumentAngle(){return this.Js.YF()}getDocumentScale(){if(this.Hp()===!1)return this.Th;const t=this.it;return this.panel!==null?t*this.panel.getDocumentScale():t}getLocalPoint(t,e){return e===void 0&&(e=new P),e.h(t),this.Js.Ci(e),e}getNearestIntersectionPoint(t,e,i){return this.pf(t.x,t.y,e.x,e.y,i)}pf(t,e,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,l=-o.m12*r,h=-o.m21*r,u=o.m11*r,c=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),f=t*a+e*h+c,m=t*l+e*u+d,g=i*a+s*h+c,p=i*l+s*u+d;n.e(0,0);const b=this.naturalBounds,v=L.Cl(0,0,b.width,b.height,f,m,g,p,n);return n.v(o),v}ht(t,e,i,s){if(this.Go()===!1)return;const n=this.sl,o=n.right+n.left,r=n.top+n.bottom;t=Math.max(t-o,0),e=Math.max(e-r,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-r,0);const a=this.angle;let l=0;const h=this.desiredSize,u=this.jp();a===90||a===270?(t=isFinite(h.height)?h.height+u:t,e=isFinite(h.width)?h.width+u:e):(t=isFinite(h.width)?h.width+u:t,e=isFinite(h.height)?h.height+u:e);let c=i||0,d=s||0;const f=this instanceof j;switch(this.Qs(!0)){case 0:c=0,d=0,f&&(t=1/0,e=1/0);break;case 2:isFinite(t)&&t>i&&(c=t),isFinite(e)&&e>s&&(d=e);break;case 5:isFinite(t)&&t>i&&(c=t),d=0,f&&(e=1/0);break;case 4:isFinite(e)&&e>s&&(d=e),c=0,f&&(t=1/0);break}const m=this.maxSize,g=this.minSize;c>m.width&&g.width<m.width&&(c=m.width),d>m.height&&g.height<m.height&&(d=m.height),i=Math.max(c,g.width),s=Math.max(d,g.height),m.width<i&&(i=Math.min(g.width,i)),m.height<s&&(s=Math.min(g.height,s)),t=Math.min(m.width,t),e=Math.min(m.height,e),t=Math.max(i,t),e=Math.max(s,e),(a===90||a===270)&&(l=t,t=e,e=l,l=i,i=s,s=l),this.hi.ce(),this.bd(t,e,i,s),this.hi.k(),this.hi.isReal()||y.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.hi.toString()),this.xi(!1)}bd(t,e,i,s){}_s(){return!1}Ut(t,e,i,s,n){this.yf();const o=I.l();o.h(this.De),this.De.ce(),this.as()===!1?this.De.e(t,e,i,s):this.Pa(t,e,i,s),this.De.k(),n===void 0?this.he=null:this.he=n;let r=!1;if(n!==void 0)r=!0;else{let a=this.panel;if(a!==null&&a.ol()&&(a=a.panel),a!==null){const l=a.Ke,h=this.measuredBounds,u=e+h.height,c=t+h.width;if(r=!(0<=t+.05&&c<=l.width+.05&&0<=e+.05&&u<=l.height+.05),this instanceof lt){const d=this.naturalBounds;(this.qp>d.height||this.pe>d.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.De.isReal()||y.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.De.toString()),this.kd(o,this.De),this.ao(!1),I.i(o)}Pa(t,e,i,s){}commonArrange(t,e,i,s){if(this.De.e(t,e,i,s),this.desiredSize.isReal())return;const n=this.hi,o=this.sl,r=o.right+o.left,a=o.top+o.bottom,l=n.width+r,h=n.height+a;i+=r,s+=a;let u=this.Qs(!0);switch(l===i&&h===s&&(u=0),u){case 0:(l>i||h>s)&&(this.xi(!0),this.ht(l>i?i:l,h>s?s:h,0,0));break;case 2:this.xi(!0),this.ht(i,s,0,0);break;case 5:this.xi(!0),this.ht(i,h,0,0);break;case 4:this.xi(!0),this.ht(l,s,0,0);break}}kd(t,e){const i=this.part;i!==null&&i.diagram!==null&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.NN(!0),this.C(),!t.equalsApproxClose(e)&&(i.Sa(),this.Wp(i)))}Wp(t){this.portId!==null&&(t.NN(!0),t instanceof W&&t.invalidateConnectedLinks(void 0,this))}get shadowVisible(){return this.w!==null?this.w.Jp:null}set shadowVisible(t){const e=this.shadowVisible;e!==t&&(this.Yt().Jp=t,this.$i(!0),this.C(),this.t("shadowVisible",e,t))}oI(t,e){const i=this.naturalBounds,s=this.wa,n=s.m11,o=s.m21,r=s.dx,a=s.m12,l=s.m22,h=s.dy;let u=0,c=0,d=u,f=c;u=d*n+f*o+r,c=d*a+f*l+h;let m=u,g=c,p=0,b=0;d=i.width+e,f=0,u=d*n+f*o+r,c=d*a+f*l+h;let v=Math.min(m,u),w=Math.min(g,c);p=Math.max(m+p,u)-v,b=Math.max(g+b,c)-w,m=v,g=w,d=i.width+e,f=i.height+e,u=d*n+f*o+r,c=d*a+f*l+h,v=Math.min(m,u),w=Math.min(g,c),p=Math.max(m+p,u)-v,b=Math.max(g+b,c)-w,m=v,g=w,d=0,f=i.height+e,u=d*n+f*o+r,c=d*a+f*l+h,v=Math.min(m,u),w=Math.min(g,c),p=Math.max(m+p,u)-v,b=Math.max(g+b,c)-w,m=v,g=w;const k=t.viewportBounds,S=k.x,N=k.y,D=k.width,A=k.height;return m>D+S||S>p+m||g>A+N||N>b+g}Ge(t,e){if(this.rI(t,e)||!this.visible)return;const i=this.opacity;if(i===0)return;let s=1;i!==1&&(s=t.globalAlpha,t.globalAlpha=s*i);let n="";this.filter!==""&&(n=t.filter,t.filter=this.filter);const o=this.v,r=this.panel;this.Hp()===!0&&this.R1();const a=this.part;let l=!1,h=0;if(a&&e.getRenderingHint("drawShadows")&&(l=a.isShadowed,l)){const g=a.shadowOffset;h=Math.max(g.y,g.x)*e.scale*e.$e}const u=this instanceof j&&this.ol(),c=this.De;if(u&&(this.ZT(l,t,!1,r),this.lI(t,e),this.QT(l,t,!1,r),this._T(l,t,!1)),u||!u&&(c.width===0||c.height===0||isNaN(c.x)||isNaN(c.y))){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}const d=this._s();if(!e.ph&&d&&this.oI(e,h)){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}let f=(this.n&256)!==0;if(t.clipInsteadOfFill&&(f=!1),this instanceof lt&&(t.font=this.font),f){const g=r.Nn()?r.naturalBounds:r.actualBounds;let p=Math.max(c.x,g.x),b=Math.max(c.y,g.y),v=Math.min(c.right,g.right)-p,w=Math.min(c.bottom,g.bottom)-b;const k=this.he;if(k!==null&&(p=k.x,b=k.y,v=k.width,w=k.height),p>c.width+c.x||c.x>g.width+g.x){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}t.save(),t.beginPath(),t.rect(p,b,v,w),t.clip()}if(d){if(!a.isVisible()){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}if(l){const g=a.shadowOffset;t.shadowsSet(g.x*e.scale*this.scale*e.$e,g.y*e.scale*this.scale*e.$e,a.shadowBlur),t.shadowsOn(),t.shadowColor=a.shadowColor}}const m=this.naturalBounds;if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.ZT(l,t,d,r),this.Lt!==null&&(t.commitTransform(),this.O1(t,m,c)),this.QT(l,t,d,r),this.Ma(t,e),this._T(l,t,d),f&&(t.restore(),t.clearContextCache(this instanceof j)),!o.RP()){const g=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*g,-o.m12*g,-o.m21*g,o.m11*g,g*(o.m21*o.dy-o.m22*o.dx),g*(o.m12*o.dx-o.m11*o.dy))}i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n)}ZT(t,e,i,s){t&&this.shadowVisible===!0?e.shadowsOn():t&&this.shadowVisible===!1&&e.shadowsOff(),t&&this.I1(s)&&this.shadowVisible===null&&e.shadowsOff()}QT(t,e,i,s){t&&(this.Lt!==null||this.I1(s))?(this.E1(!0),this.shadowVisible===null&&e.shadowsOff()):this.E1(!1)}_T(t,e,i){t&&this.CN()===!0&&e.shadowsOn(),i&&t&&e.shadowsOff()}aI(t,e,i){const s=this.part;let n=!1;s&&t.getRenderingHint("drawShadows")&&(n=s.isShadowed),e.clipInsteadOfFill&&(n=!1),this._s()&&n&&e.shadowsOn(),n&&this.shadowVisible===!0?e.shadowsOn():n&&this.shadowVisible===!1&&e.shadowsOff();const o=this.panel;if(n&&this.I1(o)&&this.shadowVisible===null&&e.shadowsOff(),e.rl){const r=t.computePixelRatio(),a=`drop-shadow(${e.shadowOffsetX/r}px ${e.shadowOffsetY/r}px ${e.shadowBlur/r/2}px ${e.shadowColor})`;this.background!==null&&i.Lt.setAttributeNS(null,"filter",a)}return n&&(this.Lt!==null||this.I1(o))?(this.E1(!0),this.shadowVisible===null&&e.shadowsOff()):this.E1(!1),n}hI(t,e,i,s){if(i.rl){const n=e.computePixelRatio(),o=`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`;this.LN(t,o)}s&&this.CN()===!0&&i.shadowsOn(),this._s()&&i.shadowsOff()}I1(t){return t===null?!1:(t.ol()&&(t=t.panel),t.CN()||(t.type===j.Auto||t.type===j.Spot)&&t.findMainElement()!==this)}LN(t,e){}O1(t,e,i){const s=this.jp(),n=e.x,o=e.y,r=e.width+s,a=e.height+s;this.kn(t,this.Lt,!0,!1,e,i),this.Lt instanceof R&&this.Lt.type===3?(t.beginPath(),t.rect(n-s/2,o-s/2,r,a),t.fillContext(this.Lt,!1,null)):t.fillRect(n-s/2,o-s/2,r,a)}tD(t,e){let i=t.cI(this);const s=t.xa!==null?t.xa:t.svg;if(s!==null&&i!==-1){for(;i!==0&&!t.elt(i-1).isVisibleObject();)i--;if(i===0)this.fI(t,e,s);else{const n=t.elt(i-1).svg;n!==null?n.after(e):s.appendChild(e)}}}fI(t,e,i){if(t.type===j.Table){const s=i.getElementsByClassName("gojs-ts"),n=s.length!==0?s[0]:null;n!==null&&n.after(e)}else i.Lt?i.Lt.after(e):i.prepend(e)}rI(t,e){if(!(t instanceof Wt))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const i=this.De;if(this._s()&&(!this.isVisible()||i.width===0||i.height===0||isNaN(i.x)||isNaN(i.y)))return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;t.setCurrentTransform(1,0,0,1,0,0);const s=this.panel,n=this.Pd(t);if(this.wf(t,e,n))return this.eD(this.svg),this.svg.parentElement!==null?(this._s()&&(t.lastDrawnPart=this.svg),!0):(this._s()?(t.lastDrawnPart!==null?t.lastDrawnPart.after(this.svg):t.diagramGroup.prepend(this.svg),t.lastDrawnPart=this.svg):s&&this.tD(s,this.svg),!0);if(this.$i(!1),this._s()&&this.isShadowed){const m=this.shadowOffset;t.shadowsSet(m.x*e.scale*this.scale*e.$e,m.y*e.scale*this.scale*e.$e,this.shadowBlur),t.shadowsOn(),t.shadowColor=this.shadowColor}this instanceof lt&&(t.font=this.font),t.currentElement=null;const o=this.v,r=this instanceof j,a=this instanceof j?this.ol():!1,l=this.svg;if(this.Hp()===!0&&this.R1(),t.outerGroup=!1,n)if(t.outerGroup=!0,r&&a)t.newGroup(1,0,0,1,0,0),this.svg=t.lastCreatedElement;else if(r&&this.isClipping){const m=this.findMainElement();let g=0,p=0;m!==null&&(g=m.actualBounds.x,p=m.actualBounds.y),t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+g,o.dy+p),this.svg=t.lastCreatedElement,m!==null&&t.createOrUpdateClipGroup(this,m.actualBounds),t.currentElement=t.lastCreatedElement}else r?(t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=t.lastCreatedElement):t.newGroup(1,0,0,1,0,0);const h=this.naturalBounds;r||t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.background!==null&&(r?(a&&t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(t,h,i),a&&t.setCurrentTransform(1,0,0,1,0,0)):(t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(t,h,i)),t.currentElement.Lt=t.lastCreatedElement,t.currentElement.prepend(t.lastCreatedElement));const u=this.aI(e,t,t.currentElement);this.Ma(t,e),r&&t.endGroup(),t.outerGroup&&t.endGroup();const c=t.surface.ud,d=r?this.svg:t.currentElement;if(l!==null&&l.parentNode!==null&&d!==l&&(this.panel===null||l.parentNode===this.panel.svg)){const m=this.svg.getAttribute("filter");return m!==null&&d.setAttribute("filter",m),this.filter!==""&&d.setAttributeNS(null,"filter",this.filter),l.replaceWith(d),this.svg=d,d!==null&&this.$p(t,s,i,d),!0}if(this.svg=d,c!==null&&d===null&&t.dummyGroup(),d===null)return!0;this.$p(t,s,i,d),this.hI(d,e,t,u);const f=this._s()?this.opacity*t.globalAlpha:this.opacity;if(f!==1&&d.setAttributeNS(null,"opacity",f.toString()),this.filter!==""&&d.setAttributeNS(null,"filter",this.filter),this._s()){if(l!==null&&d!==l&&l.parentNode===t.diagramGroup){const m=l.getAttribute("filter");m!==null&&d.setAttribute("filter",m),l.replaceWith(d)}else t.lastDrawnPart?t.lastDrawnPart.after(d):t.diagramGroup.prepend(d);t.lastDrawnPart=d}else s!==null&&this.tD(s,d);return c!==null&&c(this,d),this.eD(d),!0}eD(t){const e=this,i=t.dataset;e instanceof tt&&(e.portId!==null&&(i.portId=e.portId),e instanceof j&&(isNaN(e.itemIndex)||(i.itemIndex=e.itemIndex.toString()),e instanceof ft&&(i.className=y.Hn(e),e.key!==void 0&&(i.key=e.key.toString()),e.containingGroup!==null&&(i.group=e.containingGroup.key.toString()),e instanceof U&&(e.fromNode!==null&&e.fromNode.key!==void 0&&(i.fromKey=e.fromNode.key.toString()),e.fromPortId!==""&&(i.fromPortId=e.fromPortId),e.toNode!==null&&e.toNode.key!==void 0&&(i.toKey=e.toNode.key.toString()),e.toPortId!==""&&(i.toPortId=e.toPortId)))))}$p(t,e,i,s){let n=(this.n&256)!==0;if(t.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}const o=e.Nn()?e.naturalBounds:e.actualBounds;let r=Math.max(i.x,o.x),a=Math.max(i.y,o.y),l=Math.min(i.right,o.right)-r,h=Math.min(i.bottom,o.bottom)-a;const u=this.he;u!==null&&(r=u.x,a=u.y,l=u.width,h=u.height);const c=I.z(r,a,Math.max(l,0),Math.max(h,0));if(this instanceof j){const d=wt.l();d.set(this.v),d.ex(),d.sm(c),wt.i(d)}s.setAttributeNS(null,"clip-path",`path('      M ${c.x},${c.y}       L ${c.width+c.x} ${c.y}       L ${c.width+c.x} ${c.height+c.y}       L ${c.x} ${c.height+c.y} z') view-box`),I.i(c)}uI(){if(this.svg===null)return;const t=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),e=this.svg.ownerDocument;if(t!==null)for(const i of t){const s=e.getElementById(i.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}lI(t,e){const i=this.De,s=this.Ke,n=this.Lt;n!==null&&t.commitTransform(),n!==null&&(this.kn(t,n,!0,!1,s,i),n instanceof R&&n.type===3?(t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.fillContext(n,!1,null)):t.fillRect(i.x,i.y,i.width,i.height)),this.Ma(t,e)}Ma(t,e){}xf(){this.$i(!0)}wf(t,e,i){const s=this.svg;if(this.dI()){if(this.xf(),this.$i(!1),s===null)return!1;const u=s.getAttribute("clip-path");if(u!==null&&u.includes("url")){const c=t.svg.getElementById(u.split("#")[1].slice(0,-1));c!==null&&c.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&i||s.nodeName==="g"&&!i)return!1;const n=this.v,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof j,a=r?this.ol():!1;if(!(r&&a))if(this instanceof Tt){const u=this.U1;t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),u!==null&&t.amendImageTransform(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7]),i?s.lastElementChild.setAttributeNS(null,"transform",t.getCurrentTransform()):s.setAttributeNS(null,"transform",t.getCurrentTransform())}else if(i&&!r)if(this instanceof et){const u=s.getElementsByTagName("path");for(let c=0;c<u.length;c++)u[c].setAttributeNS(null,"transform",o)}else if(this instanceof lt){const u=s.getElementsByTagName("text"),c=typeof this.stroke=="string"?this.stroke:null;for(let d=0;d<u.length;d++)u[d].setAttributeNS(null,"transform",o),c&&u[d].setAttributeNS(null,"fill",c)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.xa){const u=this.findMainElement(),c=u!==null?u.actualBounds.x:0,d=u!==null?u.actualBounds.y:0;this.xa.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-c+", "+-d+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+c)+", "+(n.dy+d)+")")}else s.setAttributeNS(null,"transform",o);const l=this._s()?this.opacity*t.globalAlpha:this.opacity;l===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",l.toString()),t.setCurrentTransform(1,0,0,1,0,0);const h=this.xa?this.xa:this.F1;if(this.background!==null||h.Lt!==void 0){const u=h.Lt;if(this.background===null)t.removeOldGradient(this,h.Lt,"fill"),h.Lt.remove(),h.Lt=void 0;else{if((a||i&&!(this instanceof j))&&t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.O1(t,this.naturalBounds,this.actualBounds),h.Lt){t.removeOldGradient(this,h.Lt,"fill");const c=h.Lt.getAttribute("filter");c!==null&&t.lastCreatedElement.setAttribute("filter",c),h.Lt.replaceWith(t.lastCreatedElement)}else h.prepend(t.lastCreatedElement);h.Lt=t.lastCreatedElement}u&&t.removeOldGradient(this,u,"fill")}return this.$p(t,this.panel,this.actualBounds,s),!0}Pd(t){if(this.background!==null)return!0;let e=(this.n&256)!==0;return t.clipInsteadOfFill&&(e=!1),!!e}static UU(t,e,i,s,n,o,r){let a=.001;const l=o.length;t.moveTo(e,i);let h=s-e;const u=n-i;h===0&&(h=.001);const c=u/h;let d=Math.sqrt(h*h+u*u),f=0,m=!0;a=o[f%l];let g=r!==0;for(;d>=.1;){if(g){for(a=o[f++%l],a-=r;a<0;)a+=o[f++%l],m=!m;g=!1}else a=o[f++%l];a>d&&(a=d);let p=Math.sqrt(a*a/(1+c*c));h<0&&(p=-p),e+=p,i+=c*p,m?t.lineTo(e,i):t.moveTo(e,i),d-=a,m=!m}}kn(t,e,i,s,n,o){let r=1,a=1;if(typeof e=="string"){i?t.fillStyle=e:t.strokeStyle=e;return}else if(e.type===1){i?t.fillStyle=e.color:t.strokeStyle=e.color;return}let l;const h=this.jp();r=n.width,a=n.height,s?(r=o.width,a=o.height):i||(r+=h,a+=h);const u=t instanceof je;if(u&&e.Cn&&(e.type===4||e.bf===r&&e.V1===a))l=e.Cn;else{let c=0,d=0,f=0,m=0,g=0,p=0,b=0,v=0;if(s?(b=o.x,v=o.y):i||(b-=h/2,v-=h/2),c=e.start.x*r+e.start.offsetX+b,d=e.start.y*a+e.start.offsetY+v,f=e.end.x*r+e.end.offsetX+b,m=e.end.y*a+e.end.offsetY+v,e.type===2)l=t.createLinearGradient(c,d,f,m);else if(e.type===3)p=isNaN(e.endRadius)?Math.max(r,a)/2:e.endRadius,isNaN(e.startRadius)?(g=0,p=Math.max(r,a)/2):g=e.startRadius,l=t.createRadialGradient(c,d,g,f,m,p);else if(e.type===4)try{l=t.createPattern(e.pattern,"repeat")}catch{l=null}else y.si(e.type,"Brush type");if(e.type!==4){const w=e.colorStops;if(w!==null){const k=w.iterator;for(;k.next();)l.addColorStop(k.key,k.value)}}if(u&&(e.Cn=l,l!==null&&(e.bf=r,e.V1=a),l===null&&e.type===4&&e.bf!==-1)){e.bf=-1;const w=this.diagram;w!==null&&e.bf===-1&&y.dn(()=>{w.redraw()},600)}}i?t.fillStyle=l:t.strokeStyle=l}isContainedBy(t){return t instanceof j?this.gI(this,t):!1}gI(t,e){if(t===e||e===null)return!1;let i=t.panel;for(;i!==null;){if(i===e)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const t=this.panel;return t!==null?t.isVisibleObject():!0}isEnabledObject(){let t=this instanceof j?this:this.panel;for(;t!==null&&t.isEnabled;)t=t.panel;return t===null}get enabledChanged(){return this.w!==null?this.w.Zp:null}set enabledChanged(t){const e=this.enabledChanged;e!==t&&(t!==null&&y.S(t,tt,"enabledChanged"),this.Yt().Zp=t,this.t("enabledChanged",e,t))}R1(){if(this.B1()===!0){const t=this.il;if(t.Ue(),!this.De.isReal()||!this.hi.isReal()){this.Sd(!1);return}if(t.Gs(this.De.x-this.hi.x,this.De.y-this.hi.y),this.scale!==1||this.angle!==0){const e=this.naturalBounds;this.Kp(t,e.x,e.y,e.width,e.height)}this.Sd(!1),this.Uh(!0)}if(this.Hp()===!0){const t=this.panel;if(t===null)this.wa.set(this.il),this.Th=this.scale;else if(t.Js!==null){const e=this.wa;e.Ue(),t.Nn()?e.kc(t.wa):t.panel!==null&&e.kc(t.panel.wa),e.kc(this.il),this.Th=this.scale*t.Th}this.Uh(!1)}}Kp(t,e,i,s,n){if(this.it!==1&&t.it(this.it),this.Xt===0)return;const o=P.l();o.setSpot(e,i,s,n,T.Center),t.ks(this.Xt,o.x,o.y),P.i(o)}c(t){if(this.Go())return;t===void 0&&(t=!1),this.xi(!0),this.ao(!0);const e=this.panel;e!==null&&!t&&e.c()}kf(){this.Go()||(this.xi(!0),this.ao(!0))}Pf(t){if(this.as())return;const e=this.panel;!t&&e!==null&&e.c(),this.ao(!0)}yf(){this.B1()===!1&&(this.Sd(!0),this.Uh(!0))}AN(){this.Uh(!0)}C(){const t=this.part;t!==null&&t.C()}Qs(t){const e=this.stretch,i=this.panel;if(i===null)return this.qo(e===1?0:e,t);if(i.type===j.Table)return this.Qp(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),t);if(i.type===j.Auto&&i.findMainElement()===this)return this.qo(2,t);if(e===1){if(i.type===j.Spot&&i.findMainElement()===this)return this.qo(2,t);const s=i.defaultStretch;return s===1?this.qo(0,t):this.qo(s,t)}return this.qo(e,t)}Qp(t,e,i){const s=this.stretch;if(s!==1)return this.qo(s,i);let n=null,o=null;switch(t.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(e.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const r=this.panel.defaultStretch;return n===null&&(n=r===5||r===2),o===null&&(o=r===4||r===2),n===!0&&o===!0?this.qo(2,i):n===!0?this.qo(5,i):o===!0?this.qo(4,i):this.qo(0,i)}qo(t,e){if(e)return t;if(t===0)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(o!==90&&o!==270){if(t===5)return 0;if(t===2)return 4}else{if(t===4)return 0;if(t===2)return 5}if(n)if(o!==90&&o!==270){if(t===4)return 0;if(t===2)return 5}else{if(t===5)return 0;if(t===2)return 4}return t}get segmentOrientation(){return this.Ot!==null?this.Ot._p:0}set segmentOrientation(t){const e=this.segmentOrientation;e!==t&&(this.Ot===null&&(this.Ot=new we),this.Ot._p=t,this.c(),this.t("segmentOrientation",e,t),t===0&&(this.angle=0))}mI(){this.segmentOrientation=21}get segmentIndex(){return this.Ot!==null?this.Ot.t0:-1/0}set segmentIndex(t){t=Math.round(t);const e=this.segmentIndex;e!==t&&(this.Ot===null&&(this.Ot=new we),this.Ot.t0=t,this.c(),this.t("segmentIndex",e,t))}get segmentFraction(){return this.Ot!==null?this.Ot.e0:0}set segmentFraction(t){t<0?t=0:t>1&&(t=1);const e=this.segmentFraction;e!==t&&(this.Ot===null&&(this.Ot=new we),this.Ot.e0=t,this.c(),this.t("segmentFraction",e,t))}get segmentOffset(){return this.Ot!==null?this.Ot.i0:P.gn}set segmentOffset(t){const e=this.segmentOffset;e.equals(t)||(t=t.N(),this.Ot===null&&(this.Ot=new we),this.Ot.i0=t,this.c(),this.t("segmentOffset",e,t))}get stretch(){return this.w!==null?this.w.ho:1}set stretch(t){const e=this.stretch;e!==t&&(this.Yt().ho=t,this.c(),this.t("stretch",e,t))}get name(){return this.w!==null?this.w.Pt:""}set name(t){const e=this.name;e!==t&&(this.Yt().Pt=t,this.part!==null&&this.part.s0(),this.t("name",e,t))}get opacity(){return this.Zt}set opacity(t){t<0?t=0:t>1&&(t=1);const e=this.opacity;if(e!==t){this.Zt=t,this.t("opacity",e,t);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.hh(s.actualBounds))}}get filter(){return this.Gp}set filter(t){const e=this.filter;if(e!==t){this.Gp=t,this.$i(!0),this.t("filter",e,t);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.hh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(t){const e=(this.n&1)!==0;if(e!==t){this.n=this.n^1,this.xf(),this.t("visible",e,t);const i=this.panel;i!==null?i.c():this._s()&&this.Xe(t),this.C(),this.iD()}}get pickable(){return(this.n&2)!==0}set pickable(t){const e=(this.n&2)!==0;e!==t&&(this.n=this.n^2,this.t("pickable",e,t))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(t){const e=(this.n&4)!==0;e!==t&&(this.n=this.n^4,this.t("fromLinkableDuplicates",e,t))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(t){const e=(this.n&8)!==0;e!==t&&(this.n=this.n^8,this.t("fromLinkableSelfNode",e,t))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(t){const e=(this.n&16)!==0;e!==t&&(this.n=this.n^16,this.t("toLinkableDuplicates",e,t))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(t){const e=(this.n&32)!==0;e!==t&&(this.n=this.n^32,this.t("toLinkableSelfNode",e,t))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(t){const e=(this.n&64)!==0;e!==t&&(this.n=this.n^64,this.c(),this.t("isPanelMain",e,t))}get isActionable(){return(this.n&128)!==0}set isActionable(t){const e=(this.n&128)!==0;e!==t&&(this.n=this.n^128,this.t("isActionable",e,t))}get background(){return this.Lt}set background(t){const e=this.background;e!==t&&(t!==null&&R.Md(t,"GraphObject.background"),t instanceof R&&t.k(),this.Lt=t,this.C(),this.t("background",e,t))}CN(){return(this.n&512)!==0}E1(t){t?this.n|=512:this.n&=-513}mf(){return(this.n&1024)!==0}TN(t){t?this.n|=1024:this.n&=-1025}B1(){return(this.n&2048)!==0}Sd(t){t?this.n|=2048:this.n&=-2049}Hp(){return(this.n&4096)!==0}Uh(t){t?this.n|=4096:this.n&=-4097}Go(){return(this.n&8192)!==0}xi(t){t?this.n|=8192:this.n&=-8193}as(){return(this.n&16384)!==0}ao(t){t?this.n|=16384:this.n&=-16385}dI(){return(this.n&32768)!==0}$i(t){t?this.n|=32768:this.n&=-32769}get part(){if(this._s())return this;if(this.nl!==null)return this.nl;let t=this;for(t=t.panel;t;){if(t instanceof ft)return this.nl=t,t;t=t.panel}return null}get svg(){return this.F1}set svg(t){this.F1=t}Wc(){this.svg=null}get panel(){return this.Zs}Vh(t){this.Zs=t,this.svg!==null&&this.svg.remove()}get layer(){const t=this.part;return t!==null?t.layer:null}get diagram(){const t=this.part;return t!==null?t.diagram:null}get position(){return this.ct}set position(t){const e=t.x,i=t.y,s=this.position,n=s.x,o=s.y;n!==e&&(!isNaN(n)||!isNaN(e))||o!==i&&(!isNaN(o)||!isNaN(i))?(t=t.copy(),this.DN(t,n,o)&&this.t("position",new P(n,o),t.copy())):this.vN()}vN(){}DN(t,e,i){return this.ct=t,this.Pf(),!0}Uc(t,e,i){this.ct.x===t&&this.ct.y===e||(this.ct.e(t,e),this.yf())}get actualBounds(){return this.De}get scale(){return this.it}set scale(t){const e=this.scale;e!==t&&(t<=0&&y.o("GraphObject.scale for "+this+" must be greater than zero, not: "+t),this.it=t,this.c(),this.t("scale",e,t))}get angle(){return this.Xt}set angle(t){const e=this.angle;if(e!==t){if(t=t%360,t<0&&(t+=360),e===t)return;this.Xt=t,this.iD(),this.c(),this.t("angle",e,t)}}get desiredSize(){return this.cs}set desiredSize(t){const e=t.width,i=t.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==e&&(!isNaN(n)||!isNaN(e))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(t=t.N(),this.cs=t,this.c(),this instanceof et&&this.ai(),this.t("desiredSize",s,t),this.mf())){const r=this.part;r!==null&&(this.Eh(r,"width"),this.Eh(r,"height"))}}get width(){return this.cs.width}set width(t){const e=this.cs.width;if(e!==t&&(!isNaN(e)||!isNaN(t))){const i=this.cs,s=new st(t,this.cs.height).k();if(this.cs=s,this.c(),this instanceof et&&this.ai(),this.t("desiredSize",i,s),this.mf()){const n=this.part;n!==null&&this.Eh(n,"width")}}}get height(){return this.cs.height}set height(t){const e=this.cs.height;if(e!==t&&(!isNaN(e)||!isNaN(t))){const i=this.cs,s=new st(this.cs.width,t).k();if(this.cs=s,this.c(),this instanceof et&&this.ai(),this.t("desiredSize",i,s),this.mf()){const n=this.part;n!==null&&this.Eh(n,"height")}}}get minSize(){return this.w!==null?this.w.Cr:st.bc}set minSize(t){const e=this.minSize;e.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t.k(),this.Yt().Cr=t,this.c(),this.t("minSize",e,t))}get maxSize(){return this.w!==null?this.w.Lr:st.DP}set maxSize(t){const e=this.maxSize;e.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=1/0),isNaN(t.height)&&(t.height=1/0),t.k(),this.Yt().Lr=t,this.c(),this.t("maxSize",e,t))}get measuredBounds(){return this.hi}get naturalBounds(){return this.Ke}jp(){return 0}get margin(){return this.sl}set margin(t){typeof t=="number"&&(t=new Mt(t));const e=this.sl;e.equals(t)||(t=t.N(),this.sl=t,this.c(),this.t("margin",e,t))}get v(){return this.B1()===!0&&this.R1(),this.il}get Js(){return this.Hp()===!0&&this.R1(),this.wa}trigger(t,e,i){let s=null;return typeof t=="string"?s=new Xe(t,e,i):s=t,s.Ti=this,this.Ds===null&&(this.Ds=new bt),this.Ds.set(s.propertyName,s),this}get Ds(){return this.w!==null?this.w.Ds:null}set Ds(t){this.Ds!==t&&(this.Yt().Ds=t)}get Nr(){return this.w!==null?this.w.Nr:0}set Nr(t){this.Nr!==t&&(this.Yt().Nr=t)}get alignment(){return this.de}set alignment(t){const e=this.alignment;e.equals(t)||(t.isNoSpot()&&!t.isDefault()&&y.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+t),t=t.N(),this.de=t,this.Pf(),this.t("alignment",e,t))}get column(){return this.pa}set column(t){t=Math.round(t);const e=this.column;e!==t&&(t<0&&y.J(t,">= 0",tt,"column"),this.pa=t,this.c(),this.t("column",e,t),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.w!==null?this.w.o0:1}set columnSpan(t){t=Math.round(t);const e=this.columnSpan;e!==t&&(t<1&&y.J(t,">= 1",tt,"columnSpan"),this.Yt().o0=t,this.c(),this.t("columnSpan",e,t))}get row(){return this.Xp}set row(t){t=Math.round(t);const e=this.row;e!==t&&(t<0&&y.J(t,">= 0",tt,"row"),this.Xp=t,this.c(),this.t("row",e,t),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.w!==null?this.w.r0:1}set rowSpan(t){t=Math.round(t);const e=this.rowSpan;e!==t&&(t<1&&y.J(t,">= 1",tt,"rowSpan"),this.Yt().r0=t,this.c(),this.t("rowSpan",e,t))}get spanAllocation(){return this.w!==null?this.w.l0:null}set spanAllocation(t){const e=this.spanAllocation;e!==t&&(t!==null&&y.S(t,tt,"spanAllocation"),this.Yt().l0=t,this.c(),this.t("spanAllocation",e,t))}get alignmentFocus(){return this.wd}set alignmentFocus(t){const e=this.alignmentFocus;e.equals(t)||(t=t.N(),this.wd=t,this.c(),this.t("alignmentFocus",e,t))}get portId(){return this.zp}set portId(t){const e=this.portId;if(e!==t){const i=this.part;i!==null&&!(i instanceof W)&&y.o("Cannot set portID on a Link: "+t);const s=i;e!==null&&s!==null&&s.FN(this),this.zp=t,t!==null&&s!==null&&(s.Ln=!0,s.sD(this)),this.t("portId",e,t)}}Bh(){const t=this.part;if(t instanceof W&&(this.portId!==null||this===t.port)){const e=t.diagram;e!==null&&!e.undoManager.isUndoingRedoing&&t.invalidateConnectedLinks(void 0,this)}}iD(){const t=this.diagram;t===null||t.undoManager.isUndoingRedoing||(this instanceof j?this instanceof W?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,e=>{e.Bh()}):this.Bh())}get toSpot(){return this.ft!==null?this.ft.vh:T.None}set toSpot(t){const e=this.toSpot;e.equals(t)||(t=t.N(),this.Ji().vh=t,this.t("toSpot",e,t),this.Bh())}get toEndSegmentLength(){return this.ft!==null?this.ft.Rh:10}set toEndSegmentLength(t){const e=this.toEndSegmentLength;e!==t&&(t<0&&y.J(t,">= 0",tt,"toEndSegmentLength"),this.Ji().Rh=t,this.t("toEndSegmentLength",e,t),this.Bh())}get toShortLength(){return this.ft!==null?this.ft.Ih:0}set toShortLength(t){const e=this.toShortLength;e!==t&&(this.Ji().Ih=t,this.t("toShortLength",e,t),this.Bh())}get toLinkable(){return this.ft!==null?this.ft.a0:null}set toLinkable(t){const e=this.toLinkable;e!==t&&(this.Ji().a0=t,this.t("toLinkable",e,t))}get toMaxLinks(){return this.ft!==null?this.ft.h0:1/0}set toMaxLinks(t){const e=this.toMaxLinks;e!==t&&(t<0&&y.J(t,">= 0",tt,"toMaxLinks"),this.Ji().h0=t,this.t("toMaxLinks",e,t))}get fromSpot(){return this.ft!==null?this.ft.Dh:T.None}set fromSpot(t){const e=this.fromSpot;e.equals(t)||(t=t.N(),this.Ji().Dh=t,this.t("fromSpot",e,t),this.Bh())}get fromEndSegmentLength(){return this.ft!==null?this.ft.Fh:10}set fromEndSegmentLength(t){const e=this.fromEndSegmentLength;e!==t&&(t<0&&y.J(t,">= 0",tt,"fromEndSegmentLength"),this.Ji().Fh=t,this.t("fromEndSegmentLength",e,t),this.Bh())}get fromShortLength(){return this.ft!==null?this.ft.Oh:0}set fromShortLength(t){const e=this.fromShortLength;e!==t&&(this.Ji().Oh=t,this.t("fromShortLength",e,t),this.Bh())}get fromLinkable(){return this.ft!==null?this.ft.c0:null}set fromLinkable(t){const e=this.fromLinkable;e!==t&&(this.Ji().c0=t,this.t("fromLinkable",e,t))}get fromMaxLinks(){return this.ft!==null?this.ft.f0:1/0}set fromMaxLinks(t){const e=this.fromMaxLinks;e!==t&&(t<0&&y.J(t,">= 0",tt,"fromMaxLinks"),this.Ji().f0=t,this.t("fromMaxLinks",e,t))}get cursor(){return this.w!==null?this.w.Il:""}set cursor(t){const e=this.cursor;e!==t&&(y.s(t,"string",tt,"cursor"),this.Yt().Il=t,this.t("cursor",e,t))}get click(){return this.w!==null?this.w.Ur:null}set click(t){const e=this.click;e!==t&&(t!==null&&y.S(t,tt,"click"),this.Yt().Ur=t,this.t("click",e,t))}get doubleClick(){return this.w!==null?this.w.Vr:null}set doubleClick(t){const e=this.doubleClick;e!==t&&(t!==null&&y.S(t,tt,"doubleClick"),this.Yt().Vr=t,this.t("doubleClick",e,t))}get contextClick(){return this.w!==null?this.w.Br:null}set contextClick(t){const e=this.contextClick;e!==t&&(t!==null&&y.S(t,tt,"contextClick"),this.Yt().Br=t,this.t("contextClick",e,t))}get mouseEnter(){return this.w!==null?this.w.Kr:null}set mouseEnter(t){const e=this.mouseEnter;e!==t&&(t!==null&&y.S(t,tt,"mouseEnter"),this.Yt().Kr=t,this.t("mouseEnter",e,t))}get mouseLeave(){return this.w!==null?this.w.Hr:null}set mouseLeave(t){const e=this.mouseLeave;e!==t&&(t!==null&&y.S(t,tt,"mouseLeave"),this.Yt().Hr=t,this.t("mouseLeave",e,t))}get mouseOver(){return this.w!==null?this.w.zr:null}set mouseOver(t){const e=this.mouseOver;e!==t&&(t!==null&&y.S(t,tt,"mouseOver"),this.Yt().zr=t,this.t("mouseOver",e,t))}get mouseHover(){return this.w!==null?this.w.Xr:null}set mouseHover(t){const e=this.mouseHover;e!==t&&(t!==null&&y.S(t,tt,"mouseHover"),this.Yt().Xr=t,this.t("mouseHover",e,t))}get mouseHold(){return this.w!==null?this.w.Gr:null}set mouseHold(t){const e=this.mouseHold;e!==t&&(t!==null&&y.S(t,tt,"mouseHold"),this.Yt().Gr=t,this.t("mouseHold",e,t))}get mouseDragEnter(){return this.w!==null?this.w.u0:null}set mouseDragEnter(t){const e=this.mouseDragEnter;e!==t&&(t!==null&&y.S(t,tt,"mouseDragEnter"),this.Yt().u0=t,this.t("mouseDragEnter",e,t))}get mouseDragLeave(){return this.w!==null?this.w.d0:null}set mouseDragLeave(t){const e=this.mouseDragLeave;e!==t&&(t!==null&&y.S(t,tt,"mouseDragLeave"),this.Yt().d0=t,this.t("mouseDragLeave",e,t))}get mouseDrop(){return this.w!==null?this.w.Yr:null}set mouseDrop(t){const e=this.mouseDrop;e!==t&&(t!==null&&y.S(t,tt,"mouseDrop"),this.Yt().Yr=t,this.t("mouseDrop",e,t))}get actionDown(){return this.w!==null?this.w.g0:null}set actionDown(t){const e=this.actionDown;e!==t&&(t!==null&&y.S(t,tt,"actionDown"),this.Yt().g0=t,this.t("actionDown",e,t))}get actionMove(){return this.w!==null?this.w.m0:null}set actionMove(t){const e=this.actionMove;e!==t&&(t!==null&&y.S(t,tt,"actionMove"),this.Yt().m0=t,this.t("actionMove",e,t))}get actionUp(){return this.w!==null?this.w.p0:null}set actionUp(t){const e=this.actionUp;e!==t&&(t!==null&&y.S(t,tt,"actionUp"),this.Yt().p0=t,this.t("actionUp",e,t))}get actionCancel(){return this.w!==null?this.w.y0:null}set actionCancel(t){const e=this.actionCancel;e!==t&&(t!==null&&y.S(t,tt,"actionCancel"),this.Yt().y0=t,this.t("actionCancel",e,t))}get toolTip(){return this.w!==null?this.w.jr:null}set toolTip(t){const e=this.toolTip;e!==t&&(this.Yt().jr=t,this.t("toolTip",e,t))}get contextMenu(){return this.w!==null?this.w.qr:null}set contextMenu(t){const e=this.contextMenu;e!==t&&(this.Yt().qr=t,this.t("contextMenu",e,t))}findBindingPanel(){let t=this instanceof j?this:this.panel;for(;t!==null;){if(t.RN())return t;t=t.panel}return null}bind(t,e,i,s){return this.Sf(t,e,i,s),this}bindTwoWay(t,e,i,s){return this.Sf(t,e,i,s).makeTwoWay(),this}bindModel(t,e,i,s){return this.Sf(t,e,i,s).ofModel(),this}bindObject(t,e,i,s,n){return this.Sf(t,e,i,s).ofObject(n),this}theme(t,e,i,s,n){return this.Na(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.Na(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,o){return this.Na(t,e,i,s,n).ofObject(o),this}themeModel(t,e,i,s,n){return this.Na(t,e,i,s,n).ofModel(),this}Sf(t,e,i,s){let n=null;return typeof t=="string"?n=new Yt(t,e,i,s):n=t,this.w0(n),n}Na(t,e,i,s,n){let o=null;return typeof t=="string"?o=new Ee(t,e,i,s,n):o=t,this.w0(o),o}w0(t){t.Ti=this;const e=this.findBindingPanel();e!==null&&e.nD()&&y.o("Cannot add a Binding to a template that has already been copied: "+t),this.ve===null&&(this.ve=new J),this.ve.add(t)}set(t){return t?(Object.assign(this,t),this):this}attach(t){return tt.ON(this,t),this}apply(t,...e){return t.apply(this,[this,...e]),this}setProperties(t){return X.Ap(this,t),this}static make(t,...e){let i=arguments,s=null,n=null;if(y.st(t))n=t;else if(typeof t=="string"){const r=tt.z1.get(t);y.st(r)?(i=Array.prototype.slice.call(i),s=r(i),y.$(s)||y.o('GraphObject.make invoked object builder "'+t+'", but it did not return an Object')):n=H.go[t]}s===null&&((n==null||!n.constructor)&&y.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+t),s=new n);let o=1;if(s instanceof X&&i.length>1){const r=s,a=i[1];(typeof a=="string"||a instanceof HTMLDivElement)&&(r.p2(a),o++)}for(let r=o;r<i.length;r++){const a=i[r];a===void 0?y.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):s&&tt.ON(s,a)}return s}static ON(t,e){if(typeof e=="number")tt.pI(t,e);else if(typeof e=="string")tt.yI(t,e);else if(e instanceof tt)t instanceof j||y.o("A GraphObject can only be added to a Panel, not to: "+t),t.add(e);else if(e instanceof Dt){let i=null;e.isRow&&y.st(t.getRowDefinition)?i=t.getRowDefinition(e.index):!e.isRow&&y.st(t.getColumnDefinition)&&(i=t.getColumnDefinition(e.index)),i instanceof Dt?i.X1(e):y.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+t)}else if(e instanceof Pt){const i=t;i.type=e}else if(e instanceof Yt)t instanceof tt||t instanceof Dt?t.bind(e):y.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+t);else if(e instanceof Xe)t instanceof tt?t.trigger(e):y.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+t);else if(e instanceof Lt)t instanceof yt&&t.type===4?t.figures.add(e):y.o("A PathFigure can only be added to a Path Geometry, not to: "+t);else if(e instanceof dt)t instanceof Lt?t.segments.add(e):y.o("A PathSegment can only be added to a PathFigure, not to: "+t);else if(e instanceof Kt)t instanceof X||t instanceof at?t.layout=e:y.o("A Layout can only be assigned to a Diagram or a Group, not to: "+t);else if(Array.isArray(e))for(let i=0;i<e.length;i++){const s=e[i];tt.ON(t,s)}else y.$(e)?tt.wI(t,e):y.o('Unknown initializer "'+e+'" for object being constructed by GraphObject.make: '+t)}static yI(t,e){if(t instanceof lt)t.text=e;else if(t instanceof et)t.figure=e;else if(t instanceof Tt)t.source=e;else if(t instanceof j){const i=Pt.fs.get(e);i!==null&&(t.type=i)}else if(t instanceof R){const i=y.$a(be,e);i!==null?t.type=i:y.o("Unknown Brush type as an argument to GraphObject.make: "+e)}else if(t instanceof yt){const i=y.$a(Me,e);i!==null&&(t.type=i)}else if(t instanceof dt){const i=y.$a(Be,e);i!==null&&(t.type=i)}}static pI(t,e){y.st(t.fe)?t.fe(e):y.dr(t,e)}static wI(t,e){if(t instanceof R){const i=new Zt;for(const s in e){const n=parseFloat(s);isNaN(n)?i[s]=e[s]:t.addColorStop(n,e[s])}X.Ap(t,i)}else if(t instanceof Dt){if(e.row!==void 0){const s=e.row;(s==null||s===1/0||isNaN(s)||s<0)&&y.o("Must specify non-negative integer row for RowColumnDefinition "+e+", not: "+s),t.isRow=!0,t.index=s}else if(e.column!==void 0){const s=e.column;(s==null||s===1/0||isNaN(s)||s<0)&&y.o("Must specify non-negative integer column for RowColumnDefinition "+e+", not: "+s),t.isRow=!1,t.index=s}const i=new Zt;for(const s in e)s==="row"||s==="column"||(i[s]=e[s]);X.Ap(t,i)}else X.Ap(t,e)}static build(t,e,...i){const s=tt.z1.get(t);if(y.st(s)){const n=s([t].concat(i));if(n instanceof tt)return e&&n.setProperties(e),n}y.o('GraphObject.build invoked object builder "'+t+'", but it did not return an Object')}static defineBuilder(t,e){y.s(t,"string",tt,"defineBuilder:name"),y.S(e,tt,"defineBuilder:func"),t.toLowerCase(),tt.z1.set(t,e)}static isBuilderDefined(t){return tt.z1.has(t)}static takeBuilderArgument(t,e,i){i===void 0&&(i=null);const s=t[1];return(y.st(i)?i(s):typeof s=="string")?(t.splice(1,1),s):(e===void 0&&y.o("no "+(y.st(i)?"satisfactory":"string")+" argument for GraphObject builder "+t[0]),e)}static z1=new bt}tt.Vertical=4,tt.Horizontal=5,tt.defineBuilder("Button",x=>{const t="#f5f5f5",e="#737373",i="#d4d4d4",s="#737373",n="#a3a3a3",o=2.76142374915397,r=2.761423749153969,a=new j(j.Auto,{isActionable:!0,enabledChanged:(l,h)=>{if(l instanceof j){const u=l.findObject("ButtonBorder");if(u!==null)if(l._buttonFillNormal===void 0&&(l._buttonFillNormal=u.fill),h){let c=null;l.layer!==null&&l.diagram!==null&&l.isVisibleObject()&&(c=l.layer.findObjectAt(l.diagram.lastInput.documentPoint)),c===l||c!==null&&c.isContainedBy(l)?u.fill=l._buttonFillOver:u.fill=l._buttonFillNormal}else u.fill=l._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:i,_buttonStrokeOver:s,_buttonFillDisabled:n}).add(new et("RoundedRectangle",{name:"ButtonBorder",spot1:new T(0,0,o,r),spot2:new T(1,1,-o,-r),parameter1:2,fill:t,stroke:e}));return a.mouseEnter=(l,h,u)=>{if(!h.isEnabledObject()||!(h instanceof j))return;const c=h.findObject("ButtonBorder");c instanceof et&&(h._buttonFillNormal===void 0&&(h._buttonFillNormal=c.fill),c.fill=h._buttonFillOver,h._buttonStrokeNormal===void 0&&(h._buttonStrokeNormal=c.stroke),c.stroke=h._buttonStrokeOver)},a.mouseLeave=(l,h,u)=>{if(!h.isEnabledObject()||!(h instanceof j))return;const c=h.findObject("ButtonBorder");c instanceof et&&(h._buttonFillNormal!==void 0&&(c.fill=h._buttonFillNormal),h._buttonStrokeNormal!==void 0&&(c.stroke=h._buttonStrokeNormal))},a}),tt.defineBuilder("TreeExpanderButton",x=>{const t=tt.build("Button");return t.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),t.add(new et("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:st.Su}).bindObject("figure","isTreeExpanded",(e,i)=>{const s=i.panel;return e?s._treeExpandedFigure:s._treeCollapsedFigure})),t.bindObject("visible","isTreeLeaf",e=>!e),t.click=(e,i)=>{let s=i.part;if(s instanceof pt&&(s=s.adornedPart),!(s instanceof W))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isTreeExpanded){if(!o.canCollapseTree(s))return}else if(!o.canExpandTree(s))return;e.handled=!0,s.isTreeExpanded?o.collapseTree(s):o.expandTree(s)},t}),tt.defineBuilder("SubGraphExpanderButton",x=>{const t=tt.build("Button");return t.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),t.add(new et("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:st.Su}).bindObject("figure","isSubGraphExpanded",(e,i)=>{const s=i.panel;return e?s._subGraphExpandedFigure:s._subGraphCollapsedFigure})),t.click=(e,i)=>{let s=i.part;if(s instanceof pt&&(s=s.adornedPart),!(s instanceof at))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isSubGraphExpanded){if(!o.canCollapseSubGraph(s))return}else if(!o.canExpandSubGraph(s))return;e.handled=!0,s.isSubGraphExpanded?o.collapseSubGraph(s):o.expandSubGraph(s)},t}),tt.defineBuilder("ToolTip",x=>new pt(j.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new P(0,2),mouseOver:(t,e)=>{const i=t.diagram.toolManager;i.extendToolTip(i.toolTipDuration)}}).add(new et("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new T(0,0,4,6),spot2:new T(1,1,-4,-4)}))),tt.defineBuilder("ContextMenu",x=>new pt(j.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new P(0,2)}).bindObject("background","",t=>t.adornedPart!==null&&t.hasPlaceholder()?null:"#f5f5f5")),tt.defineBuilder("ContextMenuButton",x=>{const t=tt.build("Button");t.stretch=5;const e=t.findObject("ButtonBorder");return e instanceof et&&(e.figure="Rectangle",e.strokeWidth=0,e.spot1=new T(0,0,4,6),e.spot2=new T(1,1,-4,-4)),t}),tt.defineBuilder("PanelExpanderButton",x=>{const t=tt.takeBuilderArgument(x,"COLLAPSIBLE"),e=tt.build("Button");e.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),e.add(new et({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",s=>s?e._buttonExpandedFigure:e._buttonCollapsedFigure,void 0,t));const i=e.findObject("ButtonBorder");return i instanceof et&&(i.stroke=null,i.fill="rgba(0, 0, 0, 0)"),e.click=(s,n)=>{if(!(n instanceof j))return;const o=n.diagram;if(o===null||o.isReadOnly)return;let r=n.findBindingPanel();if(r===null&&(r=n.part),r!==null){const a=r.findObject(t);a!==null&&(s.handled=!0,o.startTransaction("Collapse/Expand Panel"),a.visible=!a.visible,o.commitTransaction("Collapse/Expand Panel"))}},e}),tt.defineBuilder("CheckBoxButton",x=>{const t=tt.takeBuilderArgument(x),e=tt.build("Button",{desiredSize:new st(14,14)});e.attach({"ButtonBorder.spot1":new T(0,0,1,1),"ButtonBorder.spot2":new T(1,1,-1,-1)});const i=new et({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return t!==""&&i.bindTwoWay("visible",t),e.add(i),e.click=(s,n)=>{if(!(n instanceof j))return;const o=s.diagram;if(o===null||o.isReadOnly||t!==""&&o.model.isReadOnly)return;s.handled=!0;const r=n.findObject("ButtonIcon");o.startTransaction("checkbox"),r!==null&&(r.visible=!r.visible),y.st(n._doClick)&&n._doClick(s,n),o.commitTransaction("checkbox")},e}),tt.defineBuilder("CheckBox",x=>{const t=tt.takeBuilderArgument(x),e=tt.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new Mt(0,1,0,0)},t),i=new j("Horizontal",{isActionable:!0,cursor:e.cursor,margin:new Mt(1),mouseEnter:e.mouseEnter,mouseLeave:e.mouseLeave,click:e.click}).attach({_buttonFillNormal:e._buttonFillNormal,_buttonStrokeNormal:e._buttonStrokeNormal,_buttonFillOver:e._buttonFillOver,_buttonStrokeOver:e._buttonStrokeOver,_buttonFillDisabled:e._buttonFillDisabled,_buttonClick:e.click});return i.add(e),e.mouseEnter=null,e.mouseLeave=null,e.click=null,i}),tt.defineBuilder("AutoRepeatButton",x=>{const t=tt.takeBuilderArgument(x,50,r=>typeof r=="number"),e=tt.takeBuilderArgument(x,500,r=>typeof r=="number");function i(r,a){n(r,a),a.click&&(a.Nd=y.dn(()=>s(r,a),e))}function s(r,a){a.Nd&&y.wc(a.Nd),a.click&&(a.Nd=y.dn(()=>{a.click&&(a.click(r,a),s(r,a))},t))}function n(r,a){a.Nd&&(y.wc(a.Nd),a.Nd=void 0)}const o=tt.build("Button");return o.actionDown=(r,a)=>i(r,a),o.actionUp=(r,a)=>n(r,a),o.actionCancel=(r,a)=>n(r,a),o}),tt.defineBuilder("ToggleSwitch",function(x){const t=tt.takeBuilderArgument(x);t||y.o("ToggleSwitch must be data-bound to a property name, not: "+t);const e=tt.takeBuilderArgument(x,!1,r=>typeof r=="boolean"),i="gray",s="transparent",n="white",o=new j("Auto",{width:e?15:28,height:e?28:15}).attach({_buttonFillOff:i,_buttonBorderOff:s,_buttonIconFillOff:n,_buttonFillOn:"green",_buttonBorderOn:"transparent",_buttonIconFillOn:"white"}).add(new et("Capsule",{name:"ButtonBorder",fill:i,stroke:s,strokeWidth:1}).bind("fill",t,(r,a)=>r?a.panel._buttonFillOn:a.panel._buttonFillOff).bind("stroke",t,(r,a)=>r?a.panel._buttonBorderOn:a.panel._buttonBorderOff)).add(new et("Circle",{name:"ButtonIcon",width:11,height:11,fill:n,stroke:null,alignment:e?T.Bottom:T.Left}).bind("fill",t,(r,a)=>r?a.panel._buttonIconFillOn:a.panel._buttonIconFillOff).bind("alignment",t,r=>r?e?T.Top:T.Right:e?T.Bottom:T.Left));return o.click=function(r,a){if(!a.isEnabledObject())return;const l=r.diagram;if(l===null||l.isReadOnly||t!==""&&l.model.isReadOnly)return;r.handled=!0;const h=a.findBindingPanel();h!==null&&(l.startTransaction("toggle switch"),l.model.set(h.data,t,!h.data[t]),typeof a._doClick=="function"&&a._doClick(r,a),l.commitTransaction("toggle switch"))},o}),tt.defineBuilder("Toggle",function(x){const t=tt.takeBuilderArgument(x),e=tt.build("ToggleSwitch",{name:"Button"},t),i=new j("Horizontal",{cursor:e.cursor,margin:1,mouseEnter:e.mouseEnter,mouseLeave:e.mouseLeave,click:e.click}).attach({_buttonClick:e.click}).add(e);return e.mouseEnter=null,e.mouseLeave=null,e.click=null,i});class Le{me;Pt;oo;ve;ro;vs;Il;Ur;Vr;Br;Kr;Hr;zr;Xr;Gr;u0;d0;Yr;g0;m0;p0;y0;jr;qr;Zp;l0;Ds;Cr;Lr;ho;r0;o0;Nr;Jp;x0;b0;constructor(){this.me=!1,this.Pt="",this.oo=-1,this.ve=null,this.ro=null,this.vs=null,this.Il="",this.Ur=null,this.Vr=null,this.Br=null,this.Kr=null,this.Hr=null,this.zr=null,this.Xr=null,this.Gr=null,this.u0=null,this.d0=null,this.Yr=null,this.g0=null,this.m0=null,this.p0=null,this.y0=null,this.jr=null,this.qr=null,this.Zp=null,this.l0=null,this.Ds=null,this.Cr=st.bc,this.Lr=st.DP,this.ho=1,this.r0=1,this.o0=1,this.Nr=0,this.Jp=null,this.x0=null,this.b0="category"}copy(){const t=new Le;return t.Pt=this.Pt,t.oo=this.oo,t.ve=this.ve,t.vs=this.vs,t.Il=this.Il,t.Ur=this.Ur,t.Vr=this.Vr,t.Br=this.Br,t.Kr=this.Kr,t.Hr=this.Hr,t.zr=this.zr,t.Xr=this.Xr,t.Gr=this.Gr,t.u0=this.u0,t.d0=this.d0,t.Yr=this.Yr,t.g0=this.g0,t.m0=this.m0,t.p0=this.p0,t.y0=this.y0,t.jr=this.jr,t.qr=this.qr,t.Zp=this.Zp,t.l0=this.l0,t.Ds=this.Ds,t.Cr=this.Cr.N(),t.Lr=this.Lr.N(),t.ho=this.ho,t.r0=this.r0,t.o0=this.o0,t.Nr=this.Nr,t.Jp=this.Jp,t.x0=this.x0,t.b0=this.b0,t}}class Qe{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){const t=new Qe;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}translate(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}scale(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}rotate(t,e,i){if(t=L.Ee(t),t===0)return;this.translate(e,i);let s=0,n=0;if(t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const h=t*Math.PI/180;s=Math.cos(h),n=Math.sin(h)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,a=this.m[0]*-n+this.m[2]*s,l=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=a,this.m[3]=l,this.translate(-e,-i)}}class Ye{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(t){this.type=t,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(t,e){this.colors.push({offset:t,color:e})}}class Ue{bt;_t;el;ud;IN;constructor(t,e,i){const s=e===void 0?H.document:e;this.el=s,this.IN="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.bt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.bt.setAttributeNS(n,"xmlns",this.IN),this.bt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.ud=null,this._t=new Wt(this,i)}resize(t,e,i,s){return this.width!==t||this.height!==e?(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",this.bt.setAttributeNS(null,"width",i+"px"),this.bt.setAttributeNS(null,"height",s+"px"),this.bt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._t.EN.firstElementChild.setAttributeNS(null,"width",i+"px"),this._t.EN.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(t,e,i){const s=this.el.createElementNS(this.IN,t);if(y.$(e))for(const n in e)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,e[n]);return i!==void 0&&(s.textContent=i),s}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return parseInt(this.bt.getAttribute("width")||"1")}set width(t){this.bt.setAttribute("width",t+"px")}get height(){return parseInt(this.bt.getAttribute("height")||"1")}set height(t){this.bt.setAttribute("height",t+"px")}dispose(){this.el=null}get style(){return this.bt.style}}class Wt{Mf;Nf;An;Fe;Zi;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;Cf;Lf;surface;svg;EN;oD;G1;Wo;Ca;zh;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;rl;Fr;filter;letterSpacing;wordSpacing;partClipRect;constructor(t,e){if(this.surface=t,this.svg=t.bt,this.Cf=[],this.Lf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.rl=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.Mf=0,this.Nf=0,this.An=0,this.lastCreatedElement=null,this.currentElement=null,this.Fe=[],this.pathAttributes={},this.G1=!1,this.Wo=null,this.Ca=0,this.oD={},this.Fr=!!e,this.filter="",this.partClipRect=null,this.Zi=new Qe,this.letterSpacing="0px",this.wordSpacing="0px",t.el===null||t.el===void 0)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=K.Ww++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:t.width,height:t.height};s.appendChild(this.makeElement("rect",n)),this.EN=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")")}setDiagramPosScale(t,e,i,s,n,o){this.diagramGroup===void 0?this.newGroup(t,e,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+t+", "+e+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(t,e,i,s,n,o,r,a){const l=2*Math.PI,h=1e-6,u=l-h,c=i*Math.cos(s),d=i*Math.sin(s),f=t+c,m=e+d,g=o?0:1;let p=o?s-n:n-s;(Math.abs(r-f)>h||Math.abs(a-m)>h)&&this.Fe.push(["L",f,+m]),p<0&&(p=p%l+l),p>u?(this.Fe.push(["A",i,i,0,1,g,t-c,e-d]),this.Fe.push(["A",i,i,0,1,g,f,m])):p>h&&this.Fe.push(["A",i,i,0,+(p>=Math.PI),g,t+i*Math.cos(n),e+i*Math.sin(n)])}beginPath(){this.Fe=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(t){this.xI(this.Fe,this.Zi,t||0)}bezierCurveTo(t,e,i,s,n,o){this.Fe.push(["C",t,e,i,s,n,o])}clearRect(t,e,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Fe.push(["z"])}createLinearGradient(t,e,i,s){const n=new Ye("linear");return n.x1=t,n.y1=e,n.x2=i,n.y2=s,n}createPattern(t,e){let i="";t instanceof HTMLCanvasElement&&(i=t.toDataURL()),t instanceof HTMLImageElement&&(i=t.getAttribute("src"));const s=this.oD;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+K.Ww++,o={width:t.width,height:t.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:t.width,height:t.height,href:i},a=this.makeElement("pattern",o);return a.appendChild(this.makeElement(X.img,r)),this.svg.appendChild(a),s[i]=n,"url(#"+n+")"}createRadialGradient(t,e,i,s,n,o){const r=new Ye("radial");return r.x1=t,r.y1=e,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(t,e,i,s,n,o,r,a){const l=r/i,h=a/s;(n!==0||o!==0)&&this.Zi.translate(n,o),(l!==1||h!==1)&&this.Zi.scale(l,h),(t!==0||e!==0)&&this.Zi.translate(-t,-e)}drawImage(t,e,i,s,n,o,r,a,l){let h="",u=t.width,c=t.height;typeof t.toDataURL=="function"?t.toDataURL():(h=t.getAttribute("src"),u=t.naturalWidth,c=t.naturalHeight),s===void 0&&(o=e,r=i,a=s=u,l=n=c),s=s||0,n=n||0,o=o||0,r=r||0,a=a||0,l=l||0,this.amendImageTransform(e,i,s,n,o,r,a,l);const d={x:0,y:0,width:u||s,height:c||n,href:h};!L.X(s,a)||!L.X(n,l)?d.preserveAspectRatio="none":h.toLowerCase().indexOf(".svg")===-1&&h.toLowerCase().indexOf("data:image/svg")===-1&&(d.preserveAspectRatio="xMidYMid slice"),(e!==0||i!==0||s!==u||n!==c)&&(s+=e,n+=i,d["clip-path"]=`path('M ${e},${i} L ${s} ${i} L ${s} ${n} L ${e} ${n} z')`),this.processCommon(X.img,d,this.Zi),this.Cd(X.img,d)}fill(t,e){t&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(t,e,i){this.clipInsteadOfFill?this.clip():this.fill(e,i)}createOrUpdateClipGroup(t,e){const i=this.newGroup(1,0,0,1,-e.x,-e.y);i.setAttributeNS(null,"class","spotClip"),t.xa=i}fillRect(t,e,i,s){this.addRect("fill",[t,e,i,s],this.Zi)}fillBackground(t,e,i,s){const n={x:t,y:e,width:i,height:s};this.processCommon("fill",n,this.Zi),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(t,e,i){this.addText("fill",[t,e,i],this.Zi)}lineTo(t,e){this.Fe.push(["L",t,e])}moveTo(t,e){this.Fe.push(["M",t,e])}quadraticCurveTo(t,e,i,s){this.Fe.push(["Q",t,e,i,s])}rect(t,e,i,s){this.Fe.push(["M",t,e],["L",t+i,e],["L",t+i,e+s],["L",t,e+s],["z"])}restore(){this.Zi=this.Cf.pop(),this.Fe=this.Cf.pop();const t=this.Cf.pop();this.fillStyle=t.fillStyle,this.font=t.font,this.globalAlpha=t.globalAlpha,this.lineCap=t.lineCap,this.lineDashOffset=t.lineDashOffset,this.lineJoin=t.lineJoin,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.shadowBlur=t.shadowBlur,this.shadowColor=t.shadowColor,this.shadowOffsetX=t.shadowOffsetX,this.shadowOffsetY=t.shadowOffsetY,this.strokeStyle=t.strokeStyle,this.textAlign=t.textAlign,this.partClipRect=t.partClipRect,this.letterSpacing=t.letterSpacing,this.wordSpacing=t.wordSpacing}save(){const t={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.Cf.push(t);const e=[];for(let i=0;i<this.Fe.length;i++)e.push(this.Fe[i]);this.Cf.push(e),this.Cf.push(this.Zi.copy())}setTransform(t,e,i,s,n,o){t===1&&e===0&&i===0&&s===1&&n===0&&o===0||this.newGroup(t,e,i,s,n,o)}setCurrentTransform(t,e,i,s,n,o){this.Zi.m=[t,e,i,s,n,o]}getCurrentTransform(){const t=this.Zi.m;return"matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}scale(t,e){this.Zi.scale(t,e)}translate(t,e){this.Zi.translate(t,e)}transform(t,e,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(t,e,i,s){this.addRect("stroke",[t,e,i,s],this.Zi)}makeElement(t,e,i){return this.surface.makeElement(t,e,i)}Cd(t,e,i){const s=this.makeElement(t,e,i);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(t,e,i){if(t==="fill"?this.setFill(e):t==="stroke"&&this.setStroke(e),i!==null){const s=i.m;e.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(t){if(this.fillStyle instanceof Ye){t.fill=this.addGradient(this.fillStyle,"fill");return}if(/^rgba\(/.test(this.fillStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.fill="rgb("+e[1]+","+e[2]+","+e[3]+")",t["fill-opacity"]=e[4]}else t.fill=this.fillStyle}setFillOrStrokeInPlace(t,e){const i=e?"fill":"stroke";if(this.fillStyle instanceof Ye){t.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,i));return}if(/^rgba\(/.test(this.fillStyle)){const s=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.setAttributeNS(null,i,"rgb("+s[1]+","+s[2]+","+s[3]+")"),t.setAttributeNS(null,i+"-opacity",s[4])}else t.setAttributeNS(null,i,this.fillStyle)}setStroke(t){if(this.strokeStyle instanceof Ye)t.stroke=this.addGradient(this.strokeStyle,"stroke");else if(/^rgba\(/.test(this.strokeStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);t.stroke="rgb("+e[1]+","+e[2]+","+e[3]+")",t["stroke-opacity"]=e[4]}else t.stroke=this.strokeStyle;t["stroke-width"]=this.lineWidth,t["stroke-linecap"]=this.lineCap,t["stroke-linejoin"]=this.lineJoin,t["stroke-miterlimit"]=this.miterLimit,this.G1&&(t["stroke-dasharray"]=this.Wo.toString(),t["stroke-dashoffset"]=this.Ca)}addGradient(t,e){let i="";const s=this.currentPath!==null?this.currentPath.getAttribute(e):null;if(s!==null&&s.indexOf("GRAD")!==-1){i=s.split("#")[1].slice(0,-1);const a=this.svg.getElementById(i);a!==null&&a.remove()}else i="GRAD"+K.Ww++;let n;if(t.type==="linear"){const a={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,id:i,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",a)}else if(t.type==="radial"){const a={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,r1:t.r1,r2:t.r2,id:i};n=this.makeElement("radialGradient",a)}else y.o("invalid gradient");const o=t.colors.sort((a,l)=>a.offset>l.offset?1:-1),r=o.length;for(let a=0;a<r;a++){const l=o[a],h=l.color;n.appendChild(this.makeElement("stop",{offset:l.offset,"stop-color":h}))}return this.svg.appendChild(n),"url(#"+i+")"}addRect(t,e,i){const s={x:e[0],y:e[1],width:e[2],height:e[3]};this.processCommon(t,s,i),this.Cd("rect",s)}addText(t,e,i){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:e[1],y:e[2],style:"font: "+this.font,"text-anchor":s};n["letter-spacing"]=this.letterSpacing,n["word-spacing"]=this.wordSpacing,this.processCommon(t,n,i),this.Cd("text",n,e[0])}xI(t,e,i){const s=this.bI(t),n=this.pathAttributes;if(n.clipPath){this.Lf.length>1&&this.Lf[this.Lf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,e),this.currentPath!==null){const o=this.currentPath;if(o.nodeName!=="g")for(const r in n)r!=="transform"&&o.setAttributeNS(null,r,n[r]);else{const r=o.getElementsByTagName("path");for(const a in n)a!=="transform"&&r[i].setAttributeNS(null,a,n[a])}}else this.Cd("path",n)}bI(t){const e=[];for(let i=0;i<t.length;i++){const s=t[i].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());e.push(n.join(" "))}return e.join(" ")}newGroup(t,e,i,s,n,o){const r=new Qe;r.m=[t,e,i,s,n,o];const a={};this.processCommon("g",a,r);const l=this.Cd("g",a);return this.Lf.push(l),l}newGroup2(t){const e={};t&&(e.class=t);const i=this.Cd("g",e);return this.Lf.push(i),i}endGroup(){return this.Lf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(t,e,i){this.Mf=t,this.Nf=e,this.An=i}shadowsOff(){this.rl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.rl=!0,this.shadowOffsetX=this.Mf,this.shadowOffsetY=this.Nf,this.shadowBlur=this.An}enableDash(t,e){this.G1=!0,this.Wo=t,this.Ca=e}disableDash(){this.G1=!1}clearContextCache(t){}setImageSmoothingEnabled(t){}rotate(t){this.Zi.rotate(t*57.2958,0,0)}getImageData(t,e,i,s){return null}measureText(t){return null}removeOldGradient(t,e,i){const s=e.getAttribute(i);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const r=new RegExp(o.id,"g");this.svg.innerHTML.match(r).length===1&&o.remove()}}removePartFromView(t){t.svg!==null&&t.svg.parentNode===this.diagramGroup&&t.svg.remove()}}class xe{bt;_t;el;ud;constructor(t,e,i,s){const n=e===void 0?H.document:e;this.el=n,this.ud=null;const o=n.createElement("canvas");o.tabIndex=0,this.bt=o,this._t=new je(o,i,s),t&&X.Wi.set(o,t)}resize(t,e,i,s){return this.width!==t||this.height!==e?(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",!0):!1}toDataURL(t,e){return this.bt.toDataURL(t,e)}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return this.bt.width}set width(t){this.bt.width=t}get height(){return this.bt.height}set height(t){this.bt.height=t}dispose(){X.Wi.delete(this.bt),this.el=null}get style(){return this.bt.style}}class je{F;Y1;K1;H1;clipInsteadOfFill;Mf;Nf;An;zh;rl;Fr;constructor(t,e,i){t.getContext||y.o("Browser does not support HTML Canvas Element"),this.F=t.getContext("2d",e),this.Y1="",this.K1="",this.H1="",this.clipInsteadOfFill=!1,this.Mf=0,this.Nf=0,this.An=0,this.rl=!1,this.zh=new wt,this.Fr=!!i}createOrUpdateClipGroup(t,e){}setImageSmoothingEnabled(t){this.F.imageSmoothingEnabled=t}get fillStyle(){return this.F.fillStyle}set fillStyle(t){this.H1!==t&&(this.F.fillStyle=t,this.H1=t)}get font(){return this.F.font}set font(t){this.Y1!==t&&(this.F.font=t,this.Y1=t)}get globalAlpha(){return this.F.globalAlpha}set globalAlpha(t){this.F.globalAlpha=t}get lineCap(){return this.F.lineCap}set lineCap(t){this.F.lineCap=t}get lineDashOffset(){return this.F.lineDashOffset}set lineDashOffset(t){this.F.lineDashOffset=t}get lineJoin(){return this.F.lineJoin}set lineJoin(t){this.F.lineJoin=t}get lineWidth(){return this.F.lineWidth}set lineWidth(t){this.F.lineWidth=t}get miterLimit(){return this.F.miterLimit}set miterLimit(t){this.F.miterLimit=t}get shadowBlur(){return this.F.shadowBlur}set shadowBlur(t){this.F.shadowBlur=t}get shadowColor(){return this.F.shadowColor}set shadowColor(t){this.F.shadowColor=t}get shadowOffsetX(){return this.F.shadowOffsetX}set shadowOffsetX(t){this.F.shadowOffsetX=t}get shadowOffsetY(){return this.F.shadowOffsetY}set shadowOffsetY(t){this.F.shadowOffsetY=t}get strokeStyle(){return this.F.strokeStyle}set strokeStyle(t){this.K1!==t&&(this.F.strokeStyle=t,this.K1=t)}get textAlign(){return this.F.textAlign}set textAlign(t){this.F.textAlign=t}get imageSmoothingEnabled(){return this.F.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.F.imageSmoothingEnabled=t}get filter(){return this.F.filter}set filter(t){t===""?this.F.filter="none":this.F.filter=t}get letterSpacing(){return this.F.letterSpacing}set letterSpacing(t){this.F.letterSpacing=t}get wordSpacing(){return this.F.wordSpacing}set wordSpacing(t){this.F.wordSpacing=t}arc(t,e,i,s,n,o,r,a){this.F.arc(t,e,i,s,n,o)}beginPath(){this.F.beginPath()}endPath(){}bezierCurveTo(t,e,i,s,n,o){this.F.bezierCurveTo(t,e,i,s,n,o)}clearRect(t,e,i,s){this.commitTransform(),this.F.clearRect(t,e,i,s)}clip(t){t?this.F.clip(t):this.F.clip()}closePath(){this.F.closePath()}createLinearGradient(t,e,i,s){return this.F.createLinearGradient(t,e,i,s)}createPattern(t,e){return this.F.createPattern(t,e)}createRadialGradient(t,e,i,s,n,o){return this.F.createRadialGradient(t,e,i,s,n,o)}drawImage(t,e,i,s,n,o,r,a,l){s===void 0?this.F.drawImage(t,e,i):this.F.drawImage(t,e,i,s,n,o,r,a,l)}fill(t,e){e?this.F.fill(e,t?"evenodd":"nonzero"):this.F.fill(t?"evenodd":"nonzero")}fillRect(t,e,i,s){this.F.fillRect(t,e,i,s)}fillBackground(t,e,i,s){this.F.fillRect(t,e,i,s)}fillText(t,e,i){this.F.fillText(t,e,i)}getImageData(t,e,i,s){return this.F.getImageData(t,e,i,s)}lineTo(t,e){this.F.lineTo(t,e)}measureText(t){return this.F.measureText(t)}moveTo(t,e){this.F.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this.F.quadraticCurveTo(t,e,i,s)}rect(t,e,i,s){this.F.rect(t,e,i,s)}restore(){this.F.restore()}save(){this.commitTransform(),this.F.save()}rotate(t){this.zh.ks(t*57.2958,0,0)}setTransform(t,e,i,s,n,o){this.zh.setTo(t,e,i,s,n,o)}scale(t,e){this.zh.it(t,e)}translate(t,e){this.zh.Gs(t,e)}stroke(t){t?this.F.stroke(t):this.F.stroke()}transform(t,e,i,s,n,o){if(t===1&&e===0&&i===0&&s===1&&n===0&&o===0)return;const r=this.zh,a=r.m11*t+r.m21*e,l=r.m12*t+r.m22*e,h=r.m11*i+r.m21*s,u=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=a,r.m12=l,r.m21=h,r.m22=u}commitTransform(){const t=this.zh;this.F.setTransform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy)}fillContext(t,e,i){this.radialFill(t,e,i)||this.fillOrClip(e,i)}radialFill(t,e,i){if(!(t instanceof R)||t.type!==3)return!1;const s=t.bf,n=t.V1;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(e,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(t,e){this.clipInsteadOfFill?this.clip(e):this.fill(t,e)}shadowsSet(t,e,i){this.Mf=t,this.Nf=e,this.An=i}shadowsOff(){this.rl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.rl=!0,this.shadowOffsetX=this.Mf,this.shadowOffsetY=this.Nf,this.shadowBlur=this.An}enableDash(t,e){const i=this.F;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}disableDash(){const t=this.F;t.setLineDash!==void 0&&(t.setLineDash(je.EmptyArray),t.lineDashOffset=0)}clearContextCache(t){t&&(this.Y1=""),this.K1="",this.H1=""}removePartFromView(t){}static EmptyArray=Object.freeze([])}var be=(x=>(x[x.Solid=1]="Solid",x[x.Linear=2]="Linear",x[x.Radial=3]="Radial",x[x.Pattern=4]="Pattern",x))(be||{}),ls=(x=>(x[x.Lab=1]="Lab",x[x.HSL=2]="HSL",x[x.Oklch=3]="Oklch",x))(ls||{});class Fe{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class R{f;W;Xh;ae;Cs;k0;P0;Jo;S0;Cn;bf;V1;constructor(t,e){if(K.Je(this),this.f=!1,t===void 0)this.W=1,this.Xh="black";else if(typeof t=="string"){const s=y.$a(be,t);s!==null?(this.W=s,this.Xh="black"):(this.W=1,this.Xh=t)}else Object.keys(be).hasOwnProperty(t)?(this.W=t,this.Xh="black"):typeof t=="object"&&(this.W=1,e=t);const i=this.W;if(i===2?(this.ae=T.TopCenter,this.Cs=T.BottomCenter):i===3?(this.ae=T.Center,this.Cs=T.Center):(this.ae=T.None,this.Cs=T.None),this.k0=0,this.P0=NaN,this.Jo=null,this.S0=null,this.Cn=null,this.bf=0,this.V1=0,e){const s={};for(const n in e)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),e[n]):s[n]=e[n];Object.assign(this,s)}}copy(){const t=new R;return t.W=this.W,t.Xh=this.Xh,t.ae=this.ae.N(),t.Cs=this.Cs.N(),t.k0=this.k0,t.P0=this.P0,this.Jo!==null&&(t.Jo=this.Jo.copy()),t.S0=this.S0,t}k(){return this.f=!0,this.Jo!==null&&this.Jo.k(),this}fe(t){t in be?this.type=t:y.dr(this,t)}toString(){let t="Brush(";if(this.type===1)t+=this.color;else if(this.type===2?t+="Linear ":this.type===3?t+="Radial ":this.type===4?t+="Pattern ":t+="(unknown) ",t+=this.start+" "+this.end,this.colorStops!==null){const e=this.colorStops.iterator;for(;e.next();){const i=e.key,s=e.value;t+=" "+i+":"+s}}return t+=")",t}addColorStop(t,e){return this.f&&y.L(this),(typeof t!="number"||!isFinite(t)||t>1||t<0)&&y.J(t,"0 <= loc <= 1",R,"addColorStop:loc"),y.s(e,"string",R,"addColorStop:color"),this.Jo===null&&(this.Jo=new bt),this.Jo.set(t,e),this.W===1&&(this.type=2),this.Cn=null,this}get type(){return this.W}set type(t){this.f&&y.L(this,t),this.W=t,this.start.isNoSpot()&&(t===2?this.start=T.TopCenter:t===3&&(this.start=T.Center)),this.end.isNoSpot()&&(t===2?this.end=T.BottomCenter:t===3&&(this.end=T.Center)),this.Cn=null}get color(){return this.Xh}set color(t){this.f&&y.L(this,t),this.Xh=t,this.Cn=null}get start(){return this.ae}set start(t){this.f&&y.L(this,t),this.ae=t.N(),this.Cn=null}get end(){return this.Cs}set end(t){this.f&&y.L(this,t),this.Cs=t.N(),this.Cn=null}get startRadius(){return this.k0}set startRadius(t){this.f&&y.L(this,t),t<0&&y.J(t,">= zero",R,"startRadius"),this.k0=t,this.Cn=null}get endRadius(){return this.P0}set endRadius(t){this.f&&y.L(this,t),t<0&&y.J(t,">= zero",R,"endRadius"),this.P0=t,this.Cn=null}get colorStops(){return this.Jo}set colorStops(t){this.f&&y.L(this,t),this.Jo=t,this.Cn=null}get pattern(){return this.S0}set pattern(t){this.f&&y.L(this,t),this.S0=t,this.Cn=null}static randomColor(t,e){t===void 0&&(t=128),e===void 0&&(e=Math.max(t,255));const i=Math.abs(e-t);let s=Math.floor(t+Math.random()*i).toString(16),n=Math.floor(t+Math.random()*i).toString(16),o=Math.floor(t+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(t){return H.CSS?H.CSS.supports("color",t):!0}static lighten(t){return R.lightenBy(t)}lightenBy(t,e){this.f&&y.L(this);const i=t===void 0||typeof t!="number"?.2:t,s=e===void 0?3:e;if(this.type===1)R.Uo(this.color),this.color=R.Ld(i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)R.Uo(n.value),this.addColorStop(n.key,R.Ld(i,s))}return this}static lightenBy(t,e,i){const s=e===void 0||typeof e!="number"?.2:e,n=i===void 0?3:i;return R.Uo(t),R.Ld(s,n)}static darken(t){return R.darkenBy(t)}darkenBy(t,e){this.f&&y.L(this);const i=t===void 0||typeof t!="number"?.2:t,s=e===void 0?3:e;if(this.type===1)R.Uo(this.color),this.color=R.Ld(-i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)R.Uo(n.value),this.addColorStop(n.key,R.Ld(-i,s))}return this}static darkenBy(t,e,i){const s=e===void 0||typeof e!="number"?.2:e,n=i===void 0?3:i;return R.Uo(t),R.Ld(-s,n)}static mix(t,e,i){R.Uo(t);const s=R.Y.n0,n=R.Y.n1,o=R.Y.n2,r=R.Y.n3;R.Uo(e),i===void 0&&(i=.5);const a=Math.round((R.Y.n0-s)*i+s),l=Math.round((R.Y.n1-n)*i+n),h=Math.round((R.Y.n2-o)*i+o),u=Math.round((R.Y.n3-r)*i+r);return`rgba(${a}, ${l}, ${h}, ${u})`}isDark(){if(this.type===1)return R.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const t=this.colorStops;if(this.type===3){const a=t.first();return a?R.isDark(a.value):!1}if(t.get(.5)!==null)return R.isDark(t.get(.5));if(t.count===2){const a=t.toArray();return R.isDark(R.mix(a[0].value,a[1].value))}const e=t.iterator;let i=-1,s=-1,n=1,o=1;for(;e.next();){const a=e.key,l=Math.abs(.5-e.key);n>o&&l<n?(i=a,n=l):o>=n&&l<o&&(s=a,o=l)}if(i>s){let a=i;i=s,s=a,a=n,n=o,o=a}const r=s-i;return R.isDark(R.mix(t.get(i),t.get(s),1-o/r))}return!1}static isDark(t){return t?t instanceof R?t.isDark():(R.Uo(t),(299*R.Y.n0+587*R.Y.n1+114*R.Y.n2)/1e3<128):!1}static Ld(t,e){switch(e){case 1:return R.kI(),R.co.n0=Math.min(100,Math.max(0,R.co.n0+100*t)),R.SI(),"rgba("+R.Y.n0+", "+R.Y.n1+", "+R.Y.n2+", "+R.Y.n3+")";case 2:return R.OM(),R.ze.n2=Math.min(100,Math.max(0,R.ze.n2+100*t)),"hsla("+R.ze.n0+", "+R.ze.n1+"%, "+R.ze.n2+"%, "+R.ze.n3+")";case 3:return R.MI(),R.fo.n0=Math.min(100,Math.max(0,R.fo.n0+100*t)),R.NI(),"rgba("+R.Y.n0+", "+R.Y.n1+", "+R.Y.n2+", "+R.Y.n3+")";default:y.o("Unknown color space: "+e)}}static Uo(t){R.M0===!1&&(R.M0=!0,R.us=X.isUsingDOM()?new xe(null,void 0,{willReadFrequently:!0})._t:null);const e=R.us;if(e===null)return;e.clearRect(0,0,1,1),e.fillStyle="#000000";const i=e.fillStyle;if(e.fillStyle=t,e.fillStyle!==i){e.fillRect(0,0,1,1);const s=e.getImageData(0,0,1,1).data;R.Y.n0=s[0],R.Y.n1=s[1],R.Y.n2=s[2],R.Y.n3=s[3]/255}else e.fillStyle="#FFFFFF",e.fillStyle,e.fillStyle=t,e.fillStyle,R.Y.n0=0,R.Y.n1=0,R.Y.n2=0,R.Y.n3=1}static OM(){const t=R.Y.n0/255,e=R.Y.n1/255,i=R.Y.n2/255,s=Math.max(t,e,i),n=Math.min(t,e,i),o=s-n;let r,a;const l=(s+n)/2;if(o===0)r=a=0;else{switch(s){case t:r=(e-i)/o%6;break;case e:r=(i-t)/o+2;break;case i:r=(t-e)/o+4;break;default:r=0;break}r*=60,r<0&&(r+=360),a=o/(1-Math.abs(2*l-1))}R.ze.n0=Math.round(r),R.ze.n1=Math.round(a*100),R.ze.n2=Math.round(l*100),R.ze.n3=R.Y.n3}static VU(){const t=R.ze.n0,e=R.ze.n1/100,i=R.ze.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*e,a=t/60,l=r*(1-Math.abs(a%2-1));a>=0&&a<1?(s=r,n=l,o=0):a>=1&&a<2?(s=l,n=r,o=0):a>=2&&a<3?(s=0,n=r,o=l):a>=3&&a<4?(s=0,n=l,o=r):a>=4&&a<5?(s=l,n=0,o=r):(s=r,n=0,o=l);const h=i-.5*r;s+=h,n+=h,o+=h,R.Y.n0=Math.round(s*255),R.Y.n1=Math.round(n*255),R.Y.n2=Math.round(o*255),R.Y.n3=R.ze.n3}static kI(){R.rD(),R.CI()}static SI(){R.LI(),R.lD()}static UN(t){return t/=255,t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}static VN(t){return t<=.0031308?t*12.92:1.055*Math.pow(t,1/2.4)-.055}static rD(){const t=R.UN(R.Y.n0),e=R.UN(R.Y.n1),i=R.UN(R.Y.n2);R.At.n0=.4124564*t+.3575761*e+.1804375*i,R.At.n1=.2126729*t+.7151522*e+.072175*i,R.At.n2=.0193339*t+.119192*e+.9503041*i,R.At.n3=R.Y.n3}static lD(){const t=3.2404542*R.At.n0+-1.5371385*R.At.n1+-.4985314*R.At.n2,e=-.969266*R.At.n0+1.8760108*R.At.n1+.041556*R.At.n2,i=.0556434*R.At.n0+-.2040259*R.At.n1+1.0572252*R.At.n2;R.Y.n0=R.VN(t)*255,R.Y.n1=R.VN(e)*255,R.Y.n2=R.VN(i)*255,R.Y.n3=R.At.n3,R.Y.n0=Math.round(R.Y.n0),R.Y.n0>255?R.Y.n0=255:R.Y.n0<0&&(R.Y.n0=0),R.Y.n1=Math.round(R.Y.n1),R.Y.n1>255?R.Y.n1=255:R.Y.n1<0&&(R.Y.n1=0),R.Y.n2=Math.round(R.Y.n2),R.Y.n2>255?R.Y.n2=255:R.Y.n2<0&&(R.Y.n2=0)}static BN=216/24389;static j1=24389/27;static Ad=[95.047,100,108.883];static zN(t){return t>R.BN?Math.pow(t,1/3):(R.j1*t+16)/116}static CI(){const t=R.zN(R.At.n0*100/R.Ad[0]),e=R.zN(R.At.n1*100/R.Ad[1]),i=R.zN(R.At.n2*100/R.Ad[2]);R.co.n0=116*e-16,R.co.n1=500*(t-e),R.co.n2=200*(e-i),R.co.n3=R.At.n3}static aD(t){const e=t*t*t;return e>R.BN?e:(116*t-16)/R.j1}static LI(){const t=(R.co.n0+16)/116,e=R.co.n1/500+t,i=t-R.co.n2/200;R.At.n0=R.Ad[0]/100*R.aD(e),R.At.n1=R.Ad[1]/100*(R.co.n0>R.j1*R.BN?Math.pow(t,3):R.co.n0/R.j1),R.At.n2=R.Ad[2]/100*R.aD(i),R.At.n3=R.co.n3}static AI(){let t=.8190224*R.At.n0+.3619062*R.At.n1+-.1288737*R.At.n2,e=.03298366*R.At.n0+.9292868*R.At.n1+.03614466*R.At.n2,i=.04817719*R.At.n0+.2642395*R.At.n1+.6335478*R.At.n2;t=Math.cbrt(t),e=Math.cbrt(e),i=Math.cbrt(i),R.ge.n0=.2104542*t+.7936177*e+-.004072046*i,R.ge.n1=1.977998*t+-2.428592*e+.4505937*i,R.ge.n2=.02590403*t+.7827717*e+-.8086757*i,R.ge.n3=R.At.n3,R.ge.n0*=100}static TI(){R.ge.n0/=100;let t=.9999999*R.ge.n0+.3963377*R.ge.n1+.2158037*R.ge.n2,e=1.000000009*R.ge.n0+-.1055613*R.ge.n1+-.06385417*R.ge.n2,i=1.00000005*R.ge.n0+-.08948418*R.ge.n1+-1.291485*R.ge.n2;t=t**3,e=e**3,i=i**3,R.At.n0=1.2268798*t+-.5578149*e+.281391*i,R.At.n1=-.04057576*t+1.112286*e+-.07171106*i,R.At.n2=-.07637294*t+-.4214933*e+1.586924*i,R.At.n3=R.ge.n3}static DI(){const t=Math.atan2(R.ge.n2,R.ge.n1)*180/Math.PI;R.fo.n0=R.ge.n0,R.fo.n1=Math.sqrt(R.ge.n1**2+R.ge.n2**2),R.fo.n2=t>=0?t:t+360,R.fo.n3=R.ge.n3}static vI(){R.ge.n0=R.fo.n0,R.ge.n1=R.fo.n1*Math.cos(R.fo.n2*Math.PI/180),R.ge.n2=R.fo.n1*Math.sin(R.fo.n2*Math.PI/180),R.ge.n3=R.fo.n3}static MI(){R.rD(),R.AI(),R.DI()}static NI(){R.vI(),R.TI(),R.lD()}static Md(t,e){typeof t=="string"||t instanceof R||y.o("Value for "+e+" must be a color string or a Brush, not "+t)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static us=null;static M0=!1;static Y=new Fe;static ze=new Fe;static At=new Fe;static co=new Fe;static ge=new Fe;static fo=new Fe}class Pt{Pt="Base";static fs=new bt;static Tn(t,e){e.name=t,Pt.fs.set(t,e)}get name(){return this.Pt}set name(t){this.Pt=t}constructor(){}get classType(){return j}measure(t,e,i,s,n,o,r){}measureElement(t,e,i,s,n){t.ht(e,i,s,n)}arrange(t,e,i){}arrangeElement(t,e,i,s,n,o){t.Ut(e,i,s,n,o)}remeasureObject(t){t.kf()}Ge(t,e,i){}}class Vs extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length,l=t.$o();for(let h=0;h<a;h++){const u=s[h];if(!u.visible&&u!==l)continue;const c=u.margin,d=c.right+c.left,f=c.top+c.bottom;u.ht(e,i,o,r);const m=u.measuredBounds,g=Math.max(m.width+d,0),p=Math.max(m.height+f,0);let b=u.position.x,v=u.position.y;if(isFinite(b)||(b=0),isFinite(v)||(v=0),u instanceof et&&u.isGeometryPositioned){const w=u.strokeWidth/2;b-=w,v-=w}n.re(b,v,g,p)}}arrange(t,e,i){const s=e.length,n=t.padding,o=i.x-n.left,r=i.y-n.top;for(let a=0;a<s;a++){const l=e[a],h=l.measuredBounds,u=l.margin,c=l.position.x,d=l.position.y;let f=isNaN(c)?-o:c-o,m=isNaN(d)?-r:d-r;if(l instanceof et&&l.isGeometryPositioned){const g=l.strokeWidth/2;f-=g,m-=g}l.visible&&l.Ut(f+u.left,m+u.top,h.width,h.height)}}}Pt.Tn("Position",new Vs);class zs extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length,l=y.nt(),h=t.$o();for(let c=0;c<a;c++){const d=s[c];if(!d.visible&&d!==h)continue;const f=d.Qs(!1);if(f!==0&&f!==5){l.push(d);continue}d.ht(1/0,i,0,r);const m=d.margin,g=d.measuredBounds,p=Math.max(g.width+m.right+m.left,0),b=Math.max(g.height+m.top+m.bottom,0);n.jn(n.width+p,Math.max(n.height,b))}const u=l.length;t.desiredSize.height?i=Math.min(t.desiredSize.height,t.maxSize.height):n.height!==0&&(i=Math.min(n.height,t.maxSize.height));for(let c=0;c<u;c++){const d=l[c];if(!d.visible&&d!==h)continue;const f=d.margin,m=f.right+f.left,g=f.top+f.bottom;d.ht(1/0,i,0,r);const p=d.measuredBounds,b=Math.max(p.width+m,0),v=Math.max(p.height+g,0);n.width+=b,n.height=Math.max(n.height,v)}y.Z(l)}arrange(t,e,i){const s=e.length,n=t.padding,o=n.top,r=t.isOpposite;let a=r?i.width:n.left;for(let l=0;l<s;l++){const h=o,u=e[l];if(!u.visible)continue;const c=u.measuredBounds,d=u.margin,f=d.top+d.bottom,m=o+n.bottom;let g=c.height;const p=u.Qs(!1);(isNaN(u.desiredSize.height)&&p===2||p===4)&&(g=Math.max(i.height-f-m,0));const b=g+f+m;let v=u.alignment;v.isDefault()&&(v=t.defaultAlignment),v.isSpot()||(v=T.Center),r&&(a-=c.width+d.left+d.right),u.Ut(a+v.offsetX+d.left,h+v.offsetY+d.top+(i.height*v.y-b*v.y),c.width,g),r||(a+=c.width+d.left+d.right)}}}Pt.Tn("Horizontal",new zs);class Xs extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length,l=y.nt(),h=t.$o();for(let c=0;c<a;c++){const d=s[c];if(!d.visible&&d!==h)continue;const f=d.Qs(!1);if(f!==0&&f!==4){l.push(d);continue}d.ht(e,1/0,o,0);const m=d.margin,g=d.measuredBounds,p=Math.max(g.width+m.right+m.left,0),b=Math.max(g.height+m.top+m.bottom,0);n.jn(Math.max(n.width,p),n.height+b)}const u=l.length;t.desiredSize.width?e=Math.min(t.desiredSize.width,t.maxSize.width):n.width!==0&&(e=Math.min(n.width,t.maxSize.width));for(let c=0;c<u;c++){const d=l[c];if(!d.visible&&d!==h)continue;const f=d.margin,m=f.right+f.left,g=f.top+f.bottom;d.ht(e,1/0,o,0);const p=d.measuredBounds,b=Math.max(p.width+m,0),v=Math.max(p.height+g,0);n.width=Math.max(n.width,b),n.height+=v}y.Z(l)}arrange(t,e,i){const s=e.length,n=t.padding,o=n.left,r=t.isOpposite;let a=r?i.height:n.top;for(let l=0;l<s;l++){const h=o,u=e[l];if(!u.visible)continue;const c=u.measuredBounds,d=u.margin,f=d.left+d.right,m=o+n.right;let g=c.width;const p=u.Qs(!1);(isNaN(u.desiredSize.width)&&p===2||p===5)&&(g=Math.max(i.width-f-m,0));const b=g+f+m;let v=u.alignment;v.isDefault()&&(v=t.defaultAlignment),v.isSpot()||(v=T.Center),r&&(a-=c.height+d.bottom+d.top),u.Ut(h+v.offsetX+d.left+(i.width*v.x-b*v.x),a+v.offsetY+d.top,g,c.height),r||(a+=c.height+d.bottom+d.top)}}}Pt.Tn("Vertical",new Xs);class _e extends Pt{constructor(){super()}static hD=!1;measure(t,e,i,s,n,o,r){const a=s.length;if(a===0)return;const l=t.findMainElement();let h=l.margin,u=0,c=0;const d=h.right+h.left,f=h.top+h.bottom;l.ht(e,i,o,r);let m=l.measuredBounds,g=m.width,p=m.height,b=Math.max(g+d,0),v=Math.max(p+f,0);const w=t.isClipping;w&&l.jp()!==0&&!_e.hD&&(_e.hD=!0,y.ne("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+t.toString()));const k=I.z(-h.left,-h.top,b,v);let S=I.z(0,0,g,p);this.XN(l,S,!0),g=S.width,p=S.height;let N=!0;const D=t.$o();let A;for(let M=0;M<a;M++){const C=s[M];let F=e,O=i;if(C===l||!C.visible&&C!==D)continue;h=C.margin;let E=h.left,B=h.top;switch(u=h.right+h.left,c=h.top+h.bottom,A=C.Qs(!1),A){case 2:F=g,O=p,u=0,c=0,E=0,B=0;break;case 5:F=g,u=0,E=0;break;case 4:O=p,c=0,B=0;break}C.ht(F,O,0,0),m=C.measuredBounds,b=Math.max(m.width+u,0),v=Math.max(m.height+c,0);let z=C.alignment;z.isDefault()&&(z=t.defaultAlignment),z.isSpot()||(z=T.Center);let V=C.alignmentFocus;V.isDefault()&&(V=T.Center);let Y=null;C instanceof j&&C.uo!==""&&(Y=C.findObject(C.uo),Y===C&&(Y=null));let _=S.x-E,nt=S.y-B;if(Y!==null){C.Ut(0,0,m.width,m.height);const $=Y.actualBounds,it=P.z($.x+(V.x*$.width-V.offsetX),$.y+(V.y*$.height-V.offsetY));for(Y=Y.panel;Y!==null&&Y!==C;)Y.v.gt(it),Y=Y.panel;_+=z.x*g+z.offsetX-it.x,nt+=z.y*p+z.offsetY-it.y,P.i(it)}else _+=z.x*g+z.offsetX-(V.x*m.width+V.offsetX),nt+=z.y*p+z.offsetY-(V.y*m.height+V.offsetY);N?(N=!1,n.e(_,nt,b,v)):n.re(_,nt,b,v)}switch(N?n.h(k):w?n.intersect(S.x,S.y,S.width,S.height):n.re(k.x,k.y,k.width,k.height),I.i(k),I.i(S),A=l.stretch,A===1&&(A=l.Qs(!1)),A){case 0:return;case 2:if(!isFinite(e)&&!isFinite(i))return;break;case 5:if(!isFinite(e))return;break;case 4:if(!isFinite(i))return;break}m=l.measuredBounds,g=m.width,p=m.height,b=Math.max(g+d,0),v=Math.max(p+f,0),h=l.margin,S=I.z(-h.left,-h.top,b,v),this.XN(l,S,!0),g=S.width,p=S.height;for(let M=0;M<a;M++){const C=s[M];if(C===l||!C.visible&&C!==D)continue;h=C.margin,u=h.right+h.left,c=h.top+h.bottom,m=C.measuredBounds,b=Math.max(m.width+u,0),v=Math.max(m.height+c,0);let F=C.alignment;F.isDefault()&&(F=t.defaultAlignment),F.isSpot()||(F=T.Center);let O=C.alignmentFocus;O.isDefault()&&(O=T.Center),N?(N=!1,n.e(F.x*g+F.offsetX-(O.x*m.width+O.offsetX)-h.left,F.y*p+F.offsetY-(O.y*m.height+O.offsetY)-h.top,b,v)):n.re(F.x*g+F.offsetX-(O.x*m.width+O.offsetX)-h.left,F.y*p+F.offsetY-(O.y*m.height+O.offsetY)-h.top,b,v)}N?n.h(k):w?n.intersect(S.x,S.y,S.width,S.height):n.re(k.x,k.y,k.width,k.height),I.i(S)}arrange(t,e,i){const s=e.length;if(s===0)return;const n=t.findMainElement(),o=n.measuredBounds,r=o.width,a=o.height,l=t.padding,h=l.left,u=l.top;let c=h-i.x,d=u-i.y;n.Ut(c,d,r,a);const f=I.z(0,0,r,a);this.XN(n,f,!1);for(let m=0;m<s;m++){const g=e[m];if(g===n)continue;const p=g.measuredBounds,b=p.width,v=p.height;let w=g.alignment;w.isDefault()&&(w=t.defaultAlignment),w.isSpot()||(w=T.Center);let k=g.alignmentFocus;k.isDefault()&&(k=T.Center);let S=null;if(g instanceof j&&g.uo!==""&&(S=g.findObject(g.uo),S===g&&(S=null)),S!==null){const N=S.actualBounds,D=P.z(N.x+(k.x*N.width-k.offsetX),N.y+(k.y*N.height-k.offsetY));for(S=S.panel;S!==null&&S!==g;)S.v.gt(D),S=S.panel;c=w.x*f.width+w.offsetX-D.x,d=w.y*f.height+w.offsetY-D.y,P.i(D)}else c=w.x*f.width+w.offsetX-(k.x*b+k.offsetX),d=w.y*f.height+w.offsetY-(k.y*v+k.offsetY);c+=f.x-i.x,d+=f.y-i.y,g.visible&&g.Ut(h+c,u+d,b,v)}I.i(f)}XN(t,e,i){let s=null;if(t instanceof j&&t.uo!==""&&(s=t.findObject(t.uo),s===t&&(s=null)),s!==null)for(i&&t.Ut(0,0,e.width,e.height),e.h(s.actualBounds),s=s.panel;s!==null&&s!==t;)s.v.sm(e),s=s.panel}}Pt.Tn("Spot",new _e);class Ks extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length;if(a===0)return;const l=t.findMainElement();let h=l.margin,u=e,c=i;const d=h.right+h.left,f=h.top+h.bottom;l.ht(e,i,o,r);let m=l.measuredBounds,g=0,p=null;l instanceof et&&(p=l,g=p.strokeWidth*p.scale);let b=Math.max(m.width+d,0),v=Math.max(m.height+f,0),w=t.GN(l);const k=w.x*b+w.offsetX,S=w.y*v+w.offsetY;let N=t.YN(l);const D=N.x*b+N.offsetX,A=N.y*v+N.offsetY;isFinite(e)&&(u=Math.max(Math.abs(k-D)-g,0)),isFinite(i)&&(c=Math.max(Math.abs(S-A)-g,0));let M=0,C=0;o>0&&(M=Math.max(Math.abs(w.x*o+w.offsetX-(N.x*o+N.offsetX))-g,0)),r>0&&(C=Math.max(Math.abs(w.y*r+w.offsetY-(N.y*r+N.offsetY))-g,0));const F=st.l();F.e(0,0);const O=t.$o();for(let V=0;V<a;V++){const Y=s[V];if(Y===l||!Y.visible&&Y!==O)continue;h=Y.margin;const _=h.right+h.left,nt=h.top+h.bottom;Y.ht(u,c,M,C),m=Y.measuredBounds,b=Math.max(m.width+_,0),v=Math.max(m.height+nt,0),F.e(Math.max(b,F.width),Math.max(v,F.height))}if(a===1){m=l.measuredBounds,n.width=b,n.height=v,st.i(F);return}w=t.GN(l),N=t.YN(l);let E=0,B=0;N.x!==w.x&&N.y!==w.y&&(E=F.width/Math.abs(N.x-w.x),B=F.height/Math.abs(N.y-w.y)),st.i(F),g=0,p!==null&&(g=p.strokeWidth*p.scale,p._S()===6&&(E=B=Math.max(E,B))),E+=Math.abs(w.offsetX)+Math.abs(N.offsetX)+g,B+=Math.abs(w.offsetY)+Math.abs(N.offsetY)+g;let z=l.stretch;switch(z===1&&(z=l.Qs(!1)),z){case 0:o=0,r=0;break;case 2:isFinite(e)&&(E=e),isFinite(i)&&(B=i);break;case 5:isFinite(e)&&(E=e),r=0;break;case 4:o=0,isFinite(i)&&(B=i);break}l.kf(),l.ht(E,B,o,r),n.width=l.measuredBounds.width+d,n.height=l.measuredBounds.height+f}arrange(t,e,i){const s=e.length;if(s===0)return;const n=t.findMainElement(),o=n.measuredBounds,r=I.l();r.e(0,0,1,1);let a=n.margin;const l=a.left,h=a.top,u=t.padding,c=u.left,d=u.top;let f=l,m=h,g=o.width,p=o.height;n.Ut(c+f,d+m,g,p);const b=t.GN(n),v=t.YN(n),w=0+b.x*o.width+b.offsetX,k=0+b.y*o.height+b.offsetY,S=0+v.x*o.width+v.offsetX,N=0+v.y*o.height+v.offsetY;r.x=w,r.y=k,r.re(S,N,0,0),r.x+=l+c,r.y+=h+d;for(let D=0;D<s;D++){const A=e[D];if(A===n)continue;const M=A.measuredBounds;a=A.margin;const C=Math.max(M.width+a.right+a.left,0),F=Math.max(M.height+a.top+a.bottom,0);let O=A.alignment;O.isDefault()&&(O=t.defaultAlignment),O.isSpot()||(O=T.Center),f=r.width*O.x+O.offsetX-C*O.x+a.left+r.x,m=r.height*O.y+O.offsetY-F*O.y+a.top+r.y,g=r.width,p=r.height,A.visible&&(I.contains(r.x,r.y,r.width,r.height,f,m,M.width,M.height)?A.Ut(f,m,M.width,M.height):A.Ut(f,m,M.width,M.height,new I(r.x,r.y,r.width,r.height)))}I.i(r)}}Pt.Tn("Auto",new Ks);class Ys extends Pt{constructor(){super(),this.name="Table"}measure(t,e,i,s,n,o,r){let a=s.length;const l=y.nt(),h=y.nt();for(let ot=0;ot<a;ot++){const q=s[ot],ct=q instanceof j?q:null;if(ct!==null&&ct.ol()&&q.visible){h.push(ct);const kt=ct.D.r,Vt=kt.length;for(let Rt=0;Rt<Vt;Rt++){const It=kt[Rt];ct.type===j.TableRow?It.row=q.row:ct.type===j.TableColumn&&(It.column=q.column),l.push(It)}}else l.push(q)}a=l.length,a===0&&(t.getRowDefinition(0),t.getColumnDefinition(0));const u=[];for(let ot=0;ot<a;ot++){const q=l[ot];q.visible&&(q.xi(!0),q.ao(!0),u[q.row]||(u[q.row]=[]),u[q.row][q.column]||(u[q.row][q.column]=[]),u[q.row][q.column].push(q))}y.Z(l);const c=y.nt(),d=y.nt(),f=y.nt(),m={count:0},g={count:0};let p=e,b=i;const v=t.Qi,w=t._i;let k;a=v.length;for(let ot=0;ot<a;ot++)k=v[ot],k!==void 0&&(k.actual=0,k.Re=0);a=w.length;for(let ot=0;ot<a;ot++)k=w[ot],k!==void 0&&(k.actual=0,k.Re=0);let S=u.length,N=0;for(let ot=0;ot<S;ot++)u[ot]&&(N=Math.max(N,u[ot].length));const D=Math.min(t.topIndex,S-1),A=Math.min(t.leftIndex,N-1);let M=0,C;S=u.length;const F=t.$o();for(let ot=0;ot<S;ot++){if(!u[ot])continue;N=u[ot].length;const q=t.getRowDefinition(ot);q.actual=0,q.Re=0;for(let ct=0;ct<N;ct++){if(!u[ot][ct])continue;const kt=t.getColumnDefinition(ct);c[ct]===void 0&&(kt.actual=0,kt.Re=0,c[ct]=!0);const Vt=u[ot][ct],Rt=Vt.length;for(let It=0;It<Rt;It++){const Bt=Vt[It];if(!Bt.visible&&Bt!==F)continue;const ue=Bt.rowSpan>1,$t=Bt.columnSpan>1;(ue||$t)&&!(ot<D)&&!(ct<A)&&d.push(Bt);const _t=Bt.margin,zt=_t.right+_t.left,Xt=_t.top+_t.bottom;C=Bt.Qp(q,kt,!1);const se=Bt.desiredSize,Nt=!isNaN(se.width),ge=!isNaN(se.height);if(C!==0&&!(Nt&&ge)&&!(ot<D)&&!(ct<A)&&(!$t&&m[ct]===void 0&&(C===2||C===5)&&(m[ct]=-1,m.count++),!ue&&g[ot]===void 0&&(C===2||C===4)&&(g[ot]=-1,g.count++),!ue&&!$t&&f.push(Bt)),Bt.ht(1/0,1/0,0,0),ot<D||ct<A)continue;const Gt=Bt.measuredBounds,ce=Math.max(Gt.width+zt,0),pe=Math.max(Gt.height+Xt,0);if(Bt.rowSpan===1&&(C===0||C===5)){k=t.getRowDefinition(ot);const de=k.computeEffectiveSpacing(),He=k.j===0;M=Math.max(pe-k.actual,0),M+(He?de:0)>b&&(M=Math.max(b-de,0)),k.Re=k.Re+M,k.actual=k.j+M,b=Math.max(b-(M+(He?de:0)),0)}if(Bt.columnSpan===1&&(C===0||C===4)){k=t.getColumnDefinition(ct);const de=k.computeEffectiveSpacing(),He=k.j===0;M=Math.max(ce-k.actual,0),M+(He?de:0)>p&&(M=Math.max(p-de,0)),k.Re=k.Re+M,k.actual=k.j+M,p=Math.max(p-(M+(He?de:0)),0)}(ue||$t)&&Bt.kf()}}}y.Z(c);let O=0,E=0;a=t.columnCount;for(let ot=0;ot<a;ot++){const q=w[ot];q!==void 0&&(O+=isNaN(q.ki)?q.Re:q.ki,q.Re!==0&&(O+=q.computeEffectiveSpacing()))}a=t.rowCount;for(let ot=0;ot<a;ot++){const q=v[ot];q!==void 0&&(E+=isNaN(q.ki)?q.Re:q.ki,q.Re!==0&&(E+=q.computeEffectiveSpacing()))}p=Math.max(e-O,0),b=Math.max(i-E,0);let B=b,z=p;a=f.length;for(let ot=0;ot<a;ot++){const q=f[ot],ct=t.getRowDefinition(q.row),kt=t.getColumnDefinition(q.column),Vt=q.measuredBounds,Rt=q.margin,It=Rt.right+Rt.left,Bt=Rt.top+Rt.bottom;kt.Re===0&&m[q.column]!==void 0?m[q.column]=Math.max(Vt.width+It,m[q.column]):m[q.column]=null,ct.Re===0&&g[q.row]!==void 0?g[q.row]=Math.max(Vt.height+Bt,g[q.row]):g[q.row]=null}let V=0,Y=0,_;for(_ in g)_!=="count"&&(V+=g[_]);for(_ in m)_!=="count"&&(Y+=m[_]);const nt=st.l();for(let ot=0;ot<a;ot++){const q=f[ot];if(!q.visible&&q!==F)continue;const ct=t.getRowDefinition(q.row),kt=t.getColumnDefinition(q.column);let Vt=0;isFinite(kt.width)?Vt=kt.width:(isFinite(p)&&m[q.column]!==null?Y===0?Vt=kt.actual+p:Vt=m[q.column]/Y*z:m[q.column]!==null?Vt=p:Vt=kt.actual||p,Vt=Math.max(0,Vt-kt.computeEffectiveSpacing()));let Rt=0;switch(isFinite(ct.height)?Rt=ct.height:(isFinite(b)&&g[q.row]!==null?V===0?Rt=ct.actual+b:Rt=g[q.row]/V*B:g[q.row]!==null?Rt=b:Rt=ct.actual||b,Rt=Math.max(0,Rt-ct.computeEffectiveSpacing())),nt.e(Math.max(kt.minimum,Math.min(Vt,kt.maximum)),Math.max(ct.minimum,Math.min(Rt,ct.maximum))),C=q.Qp(ct,kt,!1),C){case 5:nt.height=Math.max(nt.height,ct.actual+b);break;case 4:nt.width=Math.max(nt.width,kt.actual+p);break}const It=q.margin,Bt=It.right+It.left,ue=It.top+It.bottom;q.kf();let $t=kt.minimum,_t=ct.minimum;const zt=q.measuredBounds;zt.width===0&&m[q.column]!==null&&($t=Math.max($t,m[q.column])),zt.height===0&&g[q.row]!==null&&(_t=Math.max($t,g[q.row])),q.ht(nt.width,nt.height,$t,_t);const Xt=q.measuredBounds;let se=Math.max(Xt.width+Bt,0),Nt=Math.max(Xt.height+ue,0);isFinite(p)&&(se=Math.min(se,nt.width)),isFinite(b)&&(Nt=Math.min(Nt,nt.height));let ge=0;ge=ct.actual,ct.actual=Math.max(ct.actual,Nt),ct.Re=Math.max(ct.Re,Nt),M=ct.actual-ge,b=Math.max(b-M,0),g[q.row]===null&&(B=Math.max(B-M,0)),ge=kt.actual,kt.actual=Math.max(kt.actual,se),kt.Re=Math.max(kt.Re,se),M=kt.actual-ge,p=Math.max(p-M,0),m[q.column]===null&&(z=Math.max(z-M,0))}y.Z(f);const $=st.l(),it=y.nt(),Q=y.nt();if(a=d.length,a!==0)for(let ot=0;ot<S;ot++){if(!u[ot])continue;N=u[ot].length;const q=t.getRowDefinition(ot);it[ot]=q.actual;for(let ct=0;ct<N;ct++){if(!u[ot][ct])continue;const kt=t.getColumnDefinition(ct);Q[ct]=kt.actual}}for(let ot=0;ot<a;ot++){const q=d[ot];if(!q.visible&&q!==F)continue;const ct=t.getRowDefinition(q.row),kt=t.getColumnDefinition(q.column);switch(nt.e(Math.max(kt.minimum,Math.min(e,kt.maximum)),Math.max(ct.minimum,Math.min(i,ct.maximum))),C=q.Qp(ct,kt,!1),C){case 2:Q[kt.index]!==0&&(nt.width=Math.min(nt.width,Q[kt.index])),it[ct.index]!==0&&(nt.height=Math.min(nt.height,it[ct.index]));break;case 5:Q[kt.index]!==0&&(nt.width=Math.min(nt.width,Q[kt.index]));break;case 4:it[ct.index]!==0&&(nt.height=Math.min(nt.height,it[ct.index]));break}isFinite(kt.width)&&(nt.width=kt.width),isFinite(ct.height)&&(nt.height=ct.height),$.e(0,0);let Vt=kt.minimum,Rt=ct.minimum;for(let Nt=1;Nt<q.rowSpan&&!(q.row+Nt>=t.rowCount);Nt++){if(k=t.getRowDefinition(q.row+Nt),M=0,C===2||C===4){if(k.j===0)continue;M=Math.max(k.minimum,k.j===0?k.maximum:Math.min(k.j,k.maximum))}else M=Math.max(k.minimum,isNaN(k.ki)?k.maximum:Math.min(k.ki,k.maximum));$.height+=M,Rt+=k.minimum}for(let Nt=1;Nt<q.columnSpan&&!(q.column+Nt>=t.columnCount);Nt++){if(k=t.getColumnDefinition(q.column+Nt),M=0,C===2||C===5){if(k.j===0)continue;M=Math.max(k.minimum,k.j===0?k.maximum:Math.min(k.j,k.maximum))}else M=Math.max(k.minimum,isNaN(k.ki)?k.maximum:Math.min(k.ki,k.maximum));$.width+=M,Vt+=k.minimum}nt.width+=$.width,nt.height+=$.height;const It=q.margin,Bt=It.right+It.left,ue=It.top+It.bottom;q.ht(nt.width,nt.height,Vt,Rt);const $t=q.measuredBounds,_t=Math.max($t.width+Bt,0),zt=Math.max($t.height+ue,0);let Xt=0;for(let Nt=0;Nt<q.rowSpan&&!(q.row+Nt>=t.rowCount);Nt++)k=t.getRowDefinition(q.row+Nt),Xt+=k.total||0;if(Xt<zt){let Nt=zt-Xt;const ge=zt-Xt;if(q.spanAllocation!==null){const Gt=q.spanAllocation;for(let ce=0;ce<q.rowSpan&&!(Nt<=0||q.row+ce>=t.rowCount);ce++){k=t.getRowDefinition(q.row+ce);const pe=k.j||0,de=Gt(q,k,ge);k.actual=Math.min(k.maximum,pe+de),k.j!==pe&&(Nt-=k.j-pe)}}for(;Nt>0&&k!==void 0;){const Gt=k.j||0;if(isNaN(k.height)&&k.maximum>Gt&&(k.actual=Math.min(k.maximum,Gt+Nt),k.j!==Gt&&(Nt-=k.j-Gt)),k.index===0)break;k=t.getRowDefinition(k.index-1)}}let se=0;for(let Nt=0;Nt<q.columnSpan&&!(q.column+Nt>=t.columnCount);Nt++)k=t.getColumnDefinition(q.column+Nt),se+=k.total||0;if(se<_t){let Nt=_t-se;const ge=_t-se;if(q.spanAllocation!==null){const Gt=q.spanAllocation;for(let ce=0;ce<q.columnSpan&&!(Nt<=0||q.column+ce>=t.columnCount);ce++){k=t.getColumnDefinition(q.column+ce);const pe=k.j||0,de=Gt(q,k,ge);k.actual=Math.min(k.maximum,pe+de),k.j!==pe&&(Nt-=k.j-pe)}}for(;Nt>0&&k!==void 0;){const Gt=k.j||0;if(isNaN(k.width)&&k.maximum>Gt&&(k.actual=Math.min(k.maximum,Gt+Nt),k.j!==Gt&&(Nt-=k.j-Gt)),k.index===0)break;k=t.getColumnDefinition(k.index-1)}}}y.Z(d),st.i($),st.i(nt),it!==void 0&&y.Z(it),Q!==void 0&&y.Z(Q);let rt=0,ut=0;const gt=t.desiredSize,vt=t.maxSize;C=t.Qs(!0),O=0,E=0;let Z=0,xt=0;a=t.columnCount;for(let ot=0;ot<a;ot++)if(w[ot]!==void 0){if(k=t.getColumnDefinition(ot),isFinite(k.width)){Z+=k.width,Z+=k.computeEffectiveSpacing();continue}else if(k.q1()===2){Z+=k.j,Z+=k.computeEffectiveSpacing();continue}k.j!==0&&(O+=k.j,O+=k.computeEffectiveSpacing())}isFinite(gt.width)?rt=Math.min(gt.width,vt.width):C!==0&&isFinite(e)?rt=e:rt=O,rt=Math.max(rt,isFinite(e)?Math.min(o,e):o),rt=Math.max(rt-Z,0);const mt=O===0?1:Math.max(rt/O,1);for(let ot=0;ot<a;ot++)w[ot]!==void 0&&(k=t.getColumnDefinition(ot),!isFinite(k.width)&&k.q1()!==2&&(k.actual=k.j*mt),k.position=n.width,k.j!==0&&(n.width+=k.j,n.width+=k.computeEffectiveSpacing()));a=t.rowCount;for(let ot=0;ot<a;ot++)if(v[ot]!==void 0){if(k=t.getRowDefinition(ot),isFinite(k.height)){xt+=k.height,xt+=k.computeEffectiveSpacing();continue}else if(k.q1()===2){xt+=k.j,xt+=k.computeEffectiveSpacing();continue}k.j!==0&&(E+=k.j,E+=k.computeEffectiveSpacing())}isFinite(gt.height)?ut=Math.min(gt.height,vt.height):C!==0&&isFinite(i)?ut=i:ut=E,ut=Math.max(ut,isFinite(i)?Math.min(r,i):r),ut=Math.max(ut-xt,0);const Ft=E===0?1:Math.max(ut/E,1);for(let ot=0;ot<a;ot++)v[ot]!==void 0&&(k=t.getRowDefinition(ot),!isFinite(k.height)&&k.q1()!==2&&(k.actual=k.j*Ft),k.position=n.height,k.j!==0&&(n.height+=k.j,n.height+=k.computeEffectiveSpacing()));a=h.length;for(let ot=0;ot<a;ot++){const q=h[ot];let ct=0,kt=0;q.type===j.TableRow?(ct=n.width,k=t.getRowDefinition(q.row),kt=k.actual):(k=t.getColumnDefinition(q.column),ct=k.actual,kt=n.height),q.measuredBounds.e(0,0,ct,kt),q.xi(!1)}y.Z(h),t.La=u}arrange(t,e,i){const s=e.length,n=t.padding,o=n.left,r=n.top,a=t.La;if(a===null)return;let l=0,h=0;const u=a.length;let c=0;for(let A=0;A<u;A++)a[A]&&(c=Math.max(c,a[A].length));const d=t.Qi,f=t._i;let m=0,g=0,p=Math.min(t.topIndex,u-1);if(d.length>0){for(;p!==u&&(d[p]===void 0||d[p].j===0);)p++;p=Math.max(Math.min(p,u-1),0),m=-d[p].position}let b=Math.min(t.leftIndex,c-1);if(f.length>0){for(;b!==c&&(f[b]===void 0||f[b].j===0);)b++;b=Math.max(Math.min(b,c-1),0),g=-f[b].position}let v=0,w=0;for(;v!==u&&d[v]===void 0;)v++;for(;w!==u&&f[w]===void 0;)w++;const k=t.part;let S=t.getRowDefinition(v),N=t.getColumnDefinition(w);for(let A=0;A<e.length;A++){const M=e[A];if(!(M instanceof j&&M.visible&&M.ol()))continue;M.type===j.TableRow?(S=t.getRowDefinition(M.row),N=t.getColumnDefinition(w)):(S=t.getRowDefinition(v),N=t.getColumnDefinition(M.column)),h=S.position+m+r,S.j!==0&&(h+=S.computeEffectiveSpacingTop(Math.max(v,p))),l=N.position+g+o,N.j!==0&&(l+=N.computeEffectiveSpacingTop(Math.max(w,b)));const C=M.measuredBounds;M.yf(),M.actualBounds.ce();const F=M.actualBounds,O=I.z(F.x,F.y,F.width,F.height);if(F.x=M.type===j.TableRow?o:l,F.y=M.type===j.TableColumn?r:h,F.width=C.width,F.height=C.height,M.actualBounds.k(),M.ao(!1),O.equalsApproxClose(F)){I.i(O);continue}k!==null&&(k.Sa(),M.Wp(k)),I.i(O)}const D=st.l();for(let A=0;A<u;A++){if(!a[A])continue;c=a[A].length;const M=t.getRowDefinition(A);h=M.position+m+r,M.j!==0&&(h+=M.computeEffectiveSpacingTop(Math.max(v,p)));for(let C=0;C<c;C++){if(!a[A][C])continue;const F=t.getColumnDefinition(C);l=F.position+g+o,F.j!==0&&(l+=F.computeEffectiveSpacingTop(Math.max(w,b)));const O=a[A][C],E=O.length;for(let B=0;B<E;B++){const z=O[B],V=z.measuredBounds;D.e(0,0);for(let zt=1;zt<z.rowSpan&&!(A+zt>=t.rowCount);zt++){const Xt=t.getRowDefinition(A+zt);Xt.j!==0&&(D.height+=Xt.total)}for(let zt=1;zt<z.columnSpan&&!(C+zt>=t.columnCount);zt++){const Xt=t.getColumnDefinition(C+zt);Xt.j!==0&&(D.width+=Xt.total)}const Y=F.j+D.width,_=M.j+D.height;let nt=l,$=h;const it=Y,Q=_,rt=l,ut=h;let gt=Y,vt=_;l+Y>i.width&&(gt=Math.max(i.width-l,0)),h+_>i.height&&(vt=Math.max(i.height-h,0));let Z=z.alignment,xt=0,mt=0,Ft=0,ot=0;if(Z.isDefault()){Z=t.defaultAlignment,Z.isSpot()||(Z=T.Center),xt=Z.x,mt=Z.y,Ft=Z.offsetX,ot=Z.offsetY;const zt=F.alignment,Xt=M.alignment;zt.isSpot()&&(xt=zt.x,Ft=zt.offsetX),Xt.isSpot()&&(mt=Xt.y,ot=Xt.offsetY)}else xt=Z.x,mt=Z.y,Ft=Z.offsetX,ot=Z.offsetY;(isNaN(xt)||isNaN(mt))&&(xt=.5,mt=.5,Ft=0,ot=0);let q=V.width,ct=V.height;const kt=z.margin,Vt=kt.left+kt.right,Rt=kt.top+kt.bottom,It=z.Qp(M,F,!1);isNaN(z.desiredSize.width)&&(It===2||It===5)&&(q=Math.max(Y-Vt,0)),isNaN(z.desiredSize.height)&&(It===2||It===4)&&(ct=Math.max(_-Rt,0));const Bt=z.maxSize,ue=z.minSize;q=Math.min(Bt.width,q),ct=Math.min(Bt.height,ct),q=Math.max(ue.width,q),ct=Math.max(ue.height,ct);const $t=q+Vt,_t=ct+Rt;nt+=it*xt-$t*xt+Ft+kt.left,$+=Q*mt-_t*mt+ot+kt.top,z.visible&&(I.contains(rt,ut,gt,vt,nt,$,V.width,V.height)?z.Ut(nt,$,q,ct):z.Ut(nt,$,q,ct,new I(rt,ut,gt,vt)))}}}st.i(D);for(let A=0;A<s;A++){const M=e[A],C=M instanceof j?M:null;if(C!==null&&C.ol()){const F=M.actualBounds;M.naturalBounds.ce(),M.naturalBounds.e(0,0,F.width,F.height),M.naturalBounds.k()}}}}Pt.Tn("Table",new Ys);class Us extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){}arrange(t,e,i){}}Pt.Tn("TableRow",new Us);class js extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){}arrange(t,e,i){}}Pt.Tn("TableColumn",new js);class Gs extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){s.length!==1&&y.o("Viewbox Panel must contain exactly one GraphObject.");const a=s[0];a.it=1,a.kf(),a.ht(1/0,1/0,o,r);let l=a.measuredBounds;const h=a.margin,u=h.right+h.left,c=h.top+h.bottom;if(isFinite(e)||isFinite(i)){const d=a.scale,f=l.width,m=l.height,g=Math.max(e-u,0),p=Math.max(i-c,0);let b=1;t.viewboxStretch===6?(f!==0&&m!==0&&(b=Math.min(g/f,p/m)),b===0&&(b=1e-4),a.it*=b):(f!==0&&m!==0&&(b=Math.max(g/f,p/m)),b===0&&(b=1e-4),a.it*=b),d!==a.scale&&(a.xi(!0),a.ht(1/0,1/0,o,r))}l=a.measuredBounds,n.width=isFinite(e)?e:Math.max(l.width+u,0),n.height=isFinite(i)?i:Math.max(l.height+c,0)}arrange(t,e,i){const s=e[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,a=o.top+o.bottom,l=Math.max(n.width+r,0),h=Math.max(n.height+a,0);let u=s.alignment;u.isDefault()&&(u=t.defaultAlignment),u.isSpot()||(u=T.Center),s.Ut(i.width*u.x-l*u.x+u.offsetX,i.height*u.y-h*u.y+u.offsetY,n.width,n.height)}}Pt.Tn("Viewbox",new Gs);class qs extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){t.Pe===null&&(t.Pe=new Oe),this.FI(t),this.RI(t)}arrange(t,e,i){}Ge(t,e,i){const s=t.naturalBounds;e.save(),e.beginPath(),e.rect(0,0,s.width,s.height),e.clip(),e.endPath(),this.OI(t,e,i),e.restore(),e.clearContextCache(!1)}OI(t,e,i){let s=t.getDocumentScale()*i.scale;s<=0&&(s=1);const n=t.gridCellSize,o=n.width,r=n.height,a=t.naturalBounds,l=t.actualBounds,h=a.width,u=a.height,c=Math.ceil(h/o),d=Math.ceil(u/r),f=t.gridOrigin,m=f.x,g=f.y,p=t.Pe.N0,b=t.D.r,v=b.length;for(let w=0;w<v;w++){const k=b[w];if(!k.visible)continue;const S=k.interval||1,N=Math.abs(S);if(o*N*s<2)continue;let D=k.segmentIndex;(!isFinite(D)||isNaN(D))&&(D=0),D<0&&(D=N-Math.min(-D,N)),D=Math.round(D%N);const A=k.opacity;let M=1;if(A!==1){if(A===0)continue;M=e.globalAlpha,e.globalAlpha=M*A}const C=p[w];let F=!1;const O=k.strokeDashArray;if(O!==null&&(F=!0,e.enableDash(O,k.strokeDashOffset)),k.stroke!==null&&k.strokeWidth>0&&(k.figure==="LineV"||k.figure==="LineH")){if(e.lineWidth=k.strokeWidth,t.kn(e,k.stroke,!1,!1,a,l),e.beginPath(),k.figure==="LineV"){const E=Math.floor((m-o)/o);for(let B=E;B<=E+c;B++){const z=B*o+m;0<=z&&z<=h&&this.W1(B,S,D,C)&&(e.moveTo(z,0),e.lineTo(z,u))}}else if(k.figure==="LineH"){const E=Math.floor((g-r)/r);for(let B=E;B<=E+d;B++){const z=B*r+g;0<=z&&z<=u&&this.W1(B,S,D,C)&&(e.moveTo(0,z),e.lineTo(h,z))}}e.stroke(),e.endPath()}else if(k.fill!==null){if(t.kn(e,k.fill,!0,!1,a,l),k.figure==="BarV"){let E=k.width;isNaN(E)&&(E=o);const B=Math.floor((m-o)/o);for(let z=B;z<=B+c;z++){const V=z*o+m;0<=V+E&&V<=h&&this.W1(z,S,D,C)&&e.fillRect(V,0,E,u)}}else if(k.figure==="BarH"){let E=k.height;isNaN(E)&&(E=r);const B=Math.floor((g-r)/r);for(let z=B;z<=B+d;z++){const V=z*r+g;0<=V+E&&V<=u&&this.W1(z,S,D,C)&&e.fillRect(0,V,h,E)}}}F&&e.disableDash(),A!==1&&(e.globalAlpha=M)}}W1(t,e,i,s){if(e<0)return t%e===i;if(t%e!==i)return!1;const n=s.length;for(let o=0;o<n;o++){const r=s[o];if(t%r===i)return!1}return!0}RI(t){const e=[],i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(e.push(r),!o.visible)continue;const a=o.interval;if(a<0)continue;const l=o.figure,h=this.KN(l);for(let u=0;u<s;u++){if(u===n)continue;const c=i[u];if(!c.visible)continue;const d=c.figure;if(this.KN(d)!==h)continue;const f=c.interval;f>a&&r.push(f)}}t.Pe.N0=e}KN(t){return t==="LineV"||t==="BarV"}FI(t){let e=1,i=1;const s=t.D.r,n=s.length;for(let a=0;a<n;a++){const l=s[a],h=Math.abs(l.interval);h<2||(this.KN(l.figure)?i=i*h/L.HL(i,h):e=e*h/L.HL(e,h))}const o=t.gridCellSize,r=t.Pe;r.af.isReal()?r.af.e(i*o.width,e*o.height):r.af=new st(i*o.width,e*o.height)}}Pt.Tn("Grid",new qs);class Hs extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length;if(!(t instanceof pt||t instanceof U))return;let l=null,h=null;if(t instanceof U&&(l=t),t instanceof pt&&(h=t,l=h.adornedPart,t.Af===null&&(t.Af=[])),!(l instanceof U))return;const u=l;if(a===0){t.naturalBounds.jn(0,0),t.measuredBounds.e(0,0,0,0);return}const c=t instanceof pt?null:l.path,d=l.routeBounds,f=t.Zo;f.e(0,0,d.width,d.height);const m=u.points,g=l.pointsCount;h!==null?h.Td(!1):l!==null&&l.Td(!1);const p=d.width,b=d.height,v=t.Af;if(v.length=0,c!==null){this.measureLinkPath(t,p,b,c);const N=c.measuredBounds;f.unionRect(N),v.push(N)}const w=wt.l(),k=P.l(),S=P.l();for(let N=0;N<a;N++){const D=s[N];if(D===c)continue;let A=D.measuredBounds;if(D.isPanelMain&&D instanceof et){this.measureLinkPath(t,p,b,D),A=D.measuredBounds,f.unionRect(A),v.push(A);continue}if(g<2){D.ht(1/0,1/0,0,0),A=D.measuredBounds,f.unionRect(A),v.push(A);continue}const M=D.segmentIndex,C=D.segmentFraction;let F=D.alignmentFocus;F.isNoSpot()&&(F=T.Center);const O=D.segmentOrientation,E=D.segmentOffset;let B=0,z=0,V=0,Y=0;if(isNaN(M)){const Z=u.ut,xt=y.nt();Z.getPointAndAngleAlongPath(C,xt);const mt=P.z(xt[0],xt[1]);Y=xt[2],O!==0&&(V=u.computeAngle(D,O,Y),D.Xt=V,D.xi(!0),D.ao(!0)),B=mt.x,z=mt.y,P.i(mt),y.Z(xt)}else if(M<-g||M>=g){const Z=P.l();u.HN(Z),Y=u.midAngle,O!==0&&(V=u.computeAngle(D,O,Y),D.Xt=V,D.xi(!0),D.ao(!0)),B=Z.x-d.x,z=Z.y-d.y,P.i(Z)}else{let Z,xt,mt=0;if(M>=0?(Z=m.elt(M),xt=M<g-1?m.elt(M+1):Z):(mt=g+M,Z=m.elt(mt),xt=mt>0?m.elt(mt-1):Z),Z.equalsApprox(xt)){let Ft,ot;M>=0?(Ft=M>0?m.elt(M-1):Z,ot=M<g-2?m.elt(M+2):xt):(Ft=mt<g-1?m.elt(mt+1):Z,ot=mt>1?m.elt(mt-2):xt);const q=Ft.distanceSquaredPoint(Z),ct=xt.distanceSquaredPoint(ot);q>ct+10?Y=M>=0?Ft.directionPoint(Z):Z.directionPoint(Ft):ct>q+10?Y=M>=0?xt.directionPoint(ot):ot.directionPoint(xt):Y=M>=0?Ft.directionPoint(ot):ot.directionPoint(Ft)}else Y=M>=0?Z.directionPoint(xt):xt.directionPoint(Z);O!==0&&(V=u.computeAngle(D,O,Y),D.Xt=V,D.xi(!0),D.ao(!0)),B=Z.x+(xt.x-Z.x)*C-d.x,z=Z.y+(xt.y-Z.y)*C-d.y}D.ht(1/0,1/0,0,0),A=D.measuredBounds;const _=D.naturalBounds;let nt=0;D instanceof et&&(nt=D.strokeWidth);const $=_.width+nt,it=_.height+nt;w.Ue(),w.Gs(-A.x,-A.y),w.it(D.scale,D.scale),w.ks(O===0?D.angle:Y,$/2,it/2),(O===22||O===26)&&w.ks(90,$/2,it/2),(O===23||O===27)&&w.ks(-90,$/2,it/2),O===28&&(Y>45&&Y<135||Y>225&&Y<315)&&w.ks(-Y,$/2,it/2);const Q=new I(0,0,$,it);k.setRectSpot(Q,F),w.gt(k);const rt=-k.x+nt/2*D.scale,ut=-k.y+nt/2*D.scale;S.h(E);const gt=isNaN(E.x),vt=isNaN(E.y);if(gt||vt){const Z=$/2+U.J1,xt=it/2+U.J1,mt=Y>=45&&Y<=135,Ft=Y>=225&&Y<=315;O===0&&(mt||Ft)?(S.x=vt?Z:E.y,S.y=gt?xt:E.x,mt?M>=0||isNaN(M)&&C<.5||gt&&(S.y=-xt):Ft&&((M>=0||isNaN(M)&&C<.5)&&gt&&(S.y=-xt),vt&&(S.x=-Z))):(gt&&(M>=0||isNaN(M)&&C<.5?S.x=Z:S.x=-Z),vt&&(S.y=-xt),S.rotate(Y))}else S.rotate(Y);B+=S.x,z+=S.y,Q.e(B+rt,z+ut,A.width,A.height),v.push(Q),f.unionRect(Q)}if(l!==null){const N=l.labelNodes;for(;N.next();)N.value.ht(1/0,1/0)}t.Zo=f,t.position.e(d.x+f.x,d.y+f.y),n.jn(f.width||0,f.height||0),wt.i(w),P.i(k),P.i(S)}arrange(t,e,i){const s=e.length;if(!(t instanceof pt||t instanceof U))return;let n=t,o=null;t instanceof pt&&(o=t,n=o.adornedPart);const r=t,a=t instanceof pt?null:n.path,l=t.Af;if(l.length!==0){let d=0;if(a!==null&&d<l.length){const f=l[d];d++,a.Ut(f.x-r.Zo.x,f.y-r.Zo.y,f.width,f.height)}for(let f=0;f<s;f++){const m=e[f];if(m!==a&&d<l.length){const g=l[d];d++,m.Ut(g.x-r.Zo.x,g.y-r.Zo.y,g.width,g.height)}}}const h=n.points,u=h.count;if(u>=2&&r instanceof U){const d=r.labelNodes;for(;d.next();){const f=d.value;r.II(f,u,h)}}o!==null?o.Td(!1):n.Td(!1);const c=t.cD(P.l());t.location.e(t.position.x+c.x,t.position.y+c.y),P.i(c)}measureLinkPath(t,e,i,s){if(s.Go()===!1)return;let n=s.strokeWidth;if(n===0&&t instanceof pt&&t.type===j.Link&&t.adornedObject instanceof et&&(n=t.adornedObject.strokeWidth),n=n*s.it,t instanceof U&&t.ut!==null){const o=t.geometry.bounds;s.lo(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(t instanceof pt&&t.adornedPart.ut!==null){const o=t.adornedPart.ut.bounds;s.lo(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.lo(-(n/2),-(n/2),e+n,i+n);s.EI(),s.xi(!1)}}Pt.Tn("Link",new Hs);class Ws extends Pt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=t.findMainElement();if(!(a instanceof et))return;t.ts=[];const l=a.margin,h=l.right+l.left,u=l.top+l.bottom;a.ht(e,i,o,r);const c=a.measuredBounds,d=c.width,f=c.height,m=Math.max(d+h,0),g=Math.max(f+u,0),p=new I(-l.left,-l.top,m,g);t.ts.push(p),n.h(p),this.determineGraduatedMarks(t,a);const b=t.Fs;if(b===null)return;const v=s.length;for(let w=0;w<v;w++){const k=s[w],S=b[w];!k.visible||k===a||S.length===0||(k instanceof et?this.measureGraduatedTicks(t,k,S,n):k instanceof lt&&this.measureGraduatedLabels(t,k,S,n),k.xi(!1))}}arrange(t,e,i){if(t.ts===null)return;const s=t.findMainElement(),n=t.Fs;if(n===null)return;const o=t.ts;let r=0,a=o[r];r++,s!==null&&s.Ut(a.x-i.x,a.y-i.y,a.width,a.height);const l=e.length;for(let h=0;h<l;h++){const u=e[h],c=n[h];!u.visible||u===s||c.length===0||(a=o[r],r++,u.Ut(a.x-i.x,a.y-i.y,a.width,a.height))}t.ts=null}measureGraduatedTicks(t,e,i,s){let n=e.alignmentFocus;n.isNoSpot()&&(n=T.TopCenter);const o=e.angle;e.Xt=0,e.ht(1/0,1/0,0,0),e.Xt=o;const r=e.measuredBounds,a=r.width,l=r.height,h=I.z(0,0,a,l),u=P.l();u.setRectSpot(h,n),I.i(h);const c=-u.x,d=-u.y,f=new I,m=i.length;for(let g=0;g<m;g++){const p=i[g],b=p.pt.x,v=p.pt.y,w=p.angle;for(let k=0;k<4;k++){switch(k){case 0:u.e(c,d);break;case 1:u.e(c+a,d);break;case 2:u.e(c,d+l);break;case 3:u.e(c+a,d+l);break}u.rotate(w+e.angle),u.offset(b,v),g===0&&k===0?f.e(u.x,u.y,0,0):f.unionPoint(u),u.offset(-b,-v),u.rotate(-w-e.angle)}}P.i(u),t.ts!==null&&t.ts.push(f),s.re(f.x,f.y,f.width,f.height)}measureGraduatedLabels(t,e,i,s){t.vi===null&&(t.vi=new lt);const n=t.vi;this.fD(e,n);let o=e.alignmentFocus;o.isNoSpot()&&(o=T.TopCenter);const r=e.segmentOrientation,a=e.segmentOffset,l=new I;let h=0,u=0,c=0,d=0,f=0;const m=i.length;for(let g=0;g<m;g++){const p=i[g];h=p.pt.x,u=p.pt.y,c=p.angle,d=e.angle,f=e.angle,r!==0&&(r===21||r===25?f=c+e.angle:f=c,d=U.computeAngle(r,f)),n.Xt=d,n.text=p.text||"",n.ht(1/0,1/0,0,0);const b=n.measuredBounds,v=n.naturalBounds,w=v.width,k=v.height,S=wt.l();S.Ue(),S.Gs(-b.x,-b.y),S.it(n.scale,n.scale),S.ks(f,w/2,k/2),(r===22||r===26)&&S.ks(90,w/2,k/2),(r===23||r===27)&&S.ks(-90,w/2,k/2),r===28&&(c>45&&c<135||c>225&&c<315)&&S.ks(-c,w/2,k/2);const N=I.z(0,0,w,k),D=P.l();D.setRectSpot(N,o),S.gt(D);const A=-D.x,M=-D.y,C=P.l();C.h(a),isNaN(C.x)&&(C.x=w/2+3),isNaN(C.y)&&(C.y=-(k/2+3)),C.rotate(c),h+=C.x+A,u+=C.y+M;const F=new I(h,u,b.width,b.height),O=new I(b.x,b.y,b.width,b.height),E=new I(v.x,v.y,v.width,v.height);p.labelAngle=d,p.lineCount=n.lineCount,p.lines=n.getMetrics(),p.actualBounds=F,p.measuredBounds=O,p.naturalBounds=E,g===0?l.h(F):l.unionRect(F),P.i(C),P.i(D),I.i(N),wt.i(S)}t.ts!==null&&t.ts.push(l),s.re(l.x,l.y,l.width,l.height)}determineGraduatedMarks(t,e){const i=e.geometry,s=e.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,r=i.flattenedTotalLength,a=n.length;let l=0,h=0;const u=y.nt();for(let v=0;v<a;v++){const w=n[v],k=[];l=0,h=0;const S=w.length;for(let N=0;N<S;N+=2){const D=w[N],A=w[N+1];if(N===0){l=D,h=A;continue}let M=Math.atan2(A-h,D-l)*180/Math.PI;M<0&&(M+=360),k.push(M),l=D,h=A}u.push(k)}const c=this.UI(t),d=t.D.r,f=d.length;let m=0,g=0,p=r;t.Fs=[];let b;for(let v=0;v<f;v++){const w=d[v];if(b=[],!w.visible||w===e){t.Fs.push(b);continue}const k=Math.abs(w.interval),S=t.graduatedTickUnit;if(S*k*r/t.graduatedRange<2&&w.graduatedSkip===null){t.Fs.push(b);continue}let N=o[0][0],D=0,A=0;g=r*w.graduatedStart-1e-4,p=r*w.graduatedEnd+1e-4;const M=S*k;let C=t.graduatedTickBase;if(C<t.graduatedMin){let B=(t.graduatedMin-C)/M;B=B%1===0?B:Math.floor(B+1),C+=B*M}else if(C>t.graduatedMin+M){const B=Math.floor((C-t.graduatedMin)/M);C-=B*M}const F=c[v],O=C,E=t.graduatedMax*1e-6;for(let B=1;C<=t.graduatedMax+E;B++){if(this.VI(t,C-t.graduatedTickBase,F)&&(C>t.graduatedMax&&(C=t.graduatedMax),(w.graduatedSkip===null||w instanceof lt&&!w.graduatedSkip(C,w)||w instanceof et&&!w.graduatedSkip(C,w))&&(m=(C-t.graduatedMin)*r/t.graduatedRange,m>r&&(m=r),g<=m&&m<=p))){let z=u[D][A],V=o[D][A];for(;D<o.length;){for(;m>N&&A<o[D].length-1;)A++,z=u[D][A],V=o[D][A],N+=V;if(m<=N)break;D++,A=0,z=u[D][A],V=o[D][A],N+=V}const Y=n[D],_=Y[A*2],nt=Y[A*2+1],$=Y[A*2+2],it=Y[A*2+3],Q=(m-(N-V))/V,rt=new P(_+($-_)*Q+s/2-i.bounds.x,nt+(it-nt)*Q+s/2-i.bounds.y);if(rt.scale(e.scale,e.scale),z=this.BI(z,Q,Y,u[D],A),w instanceof lt){let ut="";w.graduatedFunction!==null?(ut=w.graduatedFunction(C,w),ut=ut!=null?ut.toString():""):ut=(+C.toFixed(2)).toString(),ut!==""&&b.push({pt:rt,angle:z,text:ut})}else b.push({pt:rt,angle:z})}C=O+B*M}t.Fs.push(b)}y.Z(u)}BI(t,e,i,s,n){if(e<.5005&&e>.4995)return t;let o=t;if(e<.5?n>0?o=s[n-1]:L.X(i[0],i[i.length-2])&&L.X(i[1],i[i.length-1])&&(o=s[s.length-1]):e>.5&&(n+1<s.length?o=s[n+1]:L.X(i[0],i[i.length-2])&&L.X(i[1],i[i.length-1])&&(o=s[0])),t!==o){let r=Math.abs(t-o);if(r>180&&(t<o?t+=360:o+=360,r=Math.abs(t-o)),e<5e-4||e>.9995)return(t+o)/2%360;if(r<10){const a=1-Math.abs(.5-e);return(t*a+o*(1-a))%360}}return t}UI(t){if(t.ds===null){const e=[],i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(e.push(r),!o.visible)continue;const a=o.interval;if(!(a<0))for(let l=0;l<s;l++){if(l===n)continue;const h=i[l];if(!h.visible||o.constructor!==h.constructor)continue;const u=h.interval;u>a&&r.push(u)}}t.ds=e}return t.ds}VI(t,e,i){const s=i.length;for(let n=0;n<s;n++){const o=i[n]*t.graduatedTickUnit,r=e%o,a=t.graduatedTickUnit*1e-6;if(r<a&&r>-a)return!1}return!0}Ge(t,e,i){const s=i.ph;i.ph=!0;const n=t.naturalBounds,o=n.width,r=n.height,a=e instanceof Wt;e.save(),e.beginPath(),e.rect(-1,-1,o+1,r+1),e.clip(),e.endPath();const l=t.findMainElement();l.Ge(e,i);let h=t.getDocumentScale()*i.scale;h<=0&&(h=1);const u=l.actualBounds,c=t.D.r,d=t.Fs,f=c.length;for(let m=0;m<f;m++){const g=c[m],p=d[m],b=p.length;if(!(!g.visible||g===l||p.length===0)){if(g instanceof et){if(t.graduatedTickUnit*g.interval*l.geometry.flattenedTotalLength/t.graduatedRange*h<2&&g.graduatedSkip===null)continue;const v=g.measuredBounds,w=g.strokeWidth*g.scale;let k=g.alignmentFocus;k.isNoSpot()&&(k=T.TopCenter);for(let S=0;S<b;S++){const N=p[S].pt,D=p[S].angle;this.zI(g,N,u,D,v,w,k),g.Ge(e,i),a&&(t.svg.appendChild(g.svg),g.svg=null),g.il.Ue()}}else if(g instanceof lt){t.vi===null&&(t.vi=new lt);const v=t.vi;this.fD(g,v),v.jN=!0;for(let w=0;w<b;w++){const k=p[w];if(k.actualBounds&&k.measuredBounds&&k.naturalBounds){v.XI(k);const S=k.actualBounds;v.Ut(S.x,S.y,S.width,S.height),this.GI(v,u,S,k.measuredBounds,k.naturalBounds),v.nl=g.part,v.Zs=g.panel,v.Ge(e,i),v.Zs=null,v.nl=null,a&&(t.svg.appendChild(v.svg),v.svg=null)}}}}}i.ph=s,e.restore(),e.clearContextCache(!0)}zI(t,e,i,s,n,o,r){const a=t.il;a.Ue(),a.Gs(e.x+i.x,e.y+i.y),a.ks(s+t.angle,0,0),a.Gs(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),a.it(t.scale,t.scale),t.Sd(!1),t.wa.set(t.il),t.Th=t.scale,t.Uh(!1)}GI(t,e,i,s,n){const o=t.il;o.Ue(),o.Gs(i.x+e.x,i.y+e.y),o.Gs(-s.x,-s.y),t.Kp(o,n.x,n.y,n.width,n.height),t.Sd(!1),t.wa.set(t.il),t.Th=t.scale,t.Uh(!1)}fD(t,e){e.YI(t)}}Pt.Tn("Graduated",new Ws);var hs=(x=>(x[x.Uniform=6]="Uniform",x[x.UniformToFill=7]="UniformToFill",x))(hs||{});class j extends tt{W;D;Qt;Dd;Qn;ll;uo;Zo;qN;O;vd;ot;Pe;te;Fd;Aa;tn;constructor(t,e){if(super(),t===void 0)this.W=j.Position;else if(typeof t=="string"){const i=Pt.fs.get(t);i!==null?this.W=i:y.o("PanelLayout not loaded: "+t)}else t instanceof Pt?this.W=t:(this.W=j.Position,t&&(e=t));this.n|=4194304|(this.W===j.Grid?1048576:0),this.D=new J,this.Qt=Mt.im,this.Dd=T.Default,this.Qn=1,this.ll=null,this.uo="",this.Zo=new I(NaN,NaN,NaN,NaN),this.qN=null,this.O=null,this.vd=6,this.Pe=null,this.ot=null,this.te=null,this.Fd=NaN,this.Aa=null,this.tn=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.W=this.W,t.Qt=this.Qt.N(),t.Dd=this.Dd.N(),t.Qn=this.Qn,t.uo=this.uo,t.Zo.h(this.Zo),this.O!==null&&(t.O=this.O.copy(t)),t.vd=this.vd,this.ot!==null&&(t.ot=this.ot.copy()),this.Pe!==null&&(t.Pe=this.Pe.copy()),t.te=this.te,t.Fd=this.Fd,t.Aa=this.Aa}jo(t){super.jo(t),t.D=this.D;const e=t.D.r,i=e.length;for(let s=0;s<i;s++){const n=e[s];n.Zs=t}t.ll=null}copy(){const t=super.copy(),e=this.D.r,i=e.length;for(let s=0;s<i;s++){const n=e[s].copy();t.KI(n)}return t}toString(){return"Panel("+this.type.name+")#"+K.xs(this)}get type(){return this.W}set type(t){const e=this.W;e!==t&&(this.W=t,this.Tf=this.W===j.Grid,this.c(),this.t("type",e,t))}get elements(){return this.D.iterator}get naturalBounds(){return this.Ke}get padding(){return this.Qt}set padding(t){typeof t=="number"?(t<0&&y.J(t,">= 0",j,"padding"),t=new Mt(t)):(t.left<0&&y.J(t.left,">= 0",j,"padding:value.left"),t.right<0&&y.J(t.right,">= 0",j,"padding:value.right"),t.top<0&&y.J(t.top,">= 0",j,"padding:value.top"),t.bottom<0&&y.J(t.bottom,">= 0",j,"padding:value.bottom"));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.c(),this.t("padding",e,t))}get defaultAlignment(){return this.Dd}set defaultAlignment(t){const e=this.Dd;e.equals(t)||(t=t.N(),this.Dd=t,this.c(),this.t("defaultAlignment",e,t))}get defaultStretch(){return this.Qn}set defaultStretch(t){const e=this.Qn;e!==t&&(this.Qn=t,this.c(),this.t("defaultStretch",e,t))}get defaultSeparatorPadding(){return this.O!==null?this.O.C0:Mt.im}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new Mt(t));const e=this.defaultSeparatorPadding;e.equals(t)||(t=t.N(),this.O===null&&(this.O=new jt),this.O.C0=t,this.c(),this.t("defaultSeparatorPadding",e,t))}get defaultRowSeparatorStroke(){return this.O!==null?this.O.L0:null}set defaultRowSeparatorStroke(t){const e=this.defaultRowSeparatorStroke;e!==t&&(t===null||typeof t=="string"||t instanceof R)&&(t instanceof R&&t.k(),this.O===null&&(this.O=new jt),this.O.L0=t,this.C(),this.t("defaultRowSeparatorStroke",e,t))}get defaultRowSeparatorStrokeWidth(){return this.O!==null?this.O.A0:1}set defaultRowSeparatorStrokeWidth(t){const e=this.defaultRowSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new jt),this.O.A0=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",e,t))}get defaultRowSeparatorDashArray(){return this.O!==null?this.O.T0:null}set defaultRowSeparatorDashArray(t){const e=this.defaultRowSeparatorDashArray;if(e!==t){if(t!==null&&!Array.isArray(t)&&y.si(t,"Array",j,"defaultRowSeparatorDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&y.o("defaultRowSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.O===null&&(this.O=new jt),this.O.T0=t,this.C(),this.t("defaultRowSeparatorDashArray",e,t)}}get defaultColumnSeparatorStroke(){return this.O!==null?this.O.D0:null}set defaultColumnSeparatorStroke(t){const e=this.defaultColumnSeparatorStroke;e!==t&&(t===null||typeof t=="string"||t instanceof R)&&(t instanceof R&&t.k(),this.O===null&&(this.O=new jt),this.O.D0=t,this.C(),this.t("defaultColumnSeparatorStroke",e,t))}get defaultColumnSeparatorStrokeWidth(){return this.O!==null?this.O.v0:1}set defaultColumnSeparatorStrokeWidth(t){const e=this.defaultColumnSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new jt),this.O.v0=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",e,t))}get defaultColumnSeparatorDashArray(){return this.O!==null?this.O.F0:null}set defaultColumnSeparatorDashArray(t){const e=this.defaultColumnSeparatorDashArray;if(e!==t){if(t!==null&&!Array.isArray(t)&&y.si(t,"Array",j,"defaultColumnSeparatorDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&y.o("defaultColumnSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.O===null&&(this.O=new jt),this.O.F0=t,this.C(),this.t("defaultColumnSeparatorDashArray",e,t)}}get La(){return this.O!==null?this.O.La:null}set La(t){this.O===null&&(this.O=new jt),this.O.La=t}get viewboxStretch(){return this.vd}set viewboxStretch(t){const e=this.vd;e!==t&&(this.vd=t,this.c(),this.t("viewboxStretch",e,t))}get gridCellSize(){return this.Pe!==null?this.Pe.Rd:st.OL}set gridCellSize(t){this.Pe===null&&(this.Pe=new Oe);const e=this.Pe.Rd;if(!e.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&y.o("Invalid Panel.gridCellSize: "+t),this.Pe.Rd=t.N();const i=this.diagram;i!==null&&this===i.grid&&i.ca(),this.C(),this.t("gridCellSize",e,t)}}get gridOrigin(){return this.Pe!==null?this.Pe.Od:P.gn}set gridOrigin(t){this.Pe===null&&(this.Pe=new Oe);const e=this.Pe.Od;if(!e.equals(t)){t.isReal()||y.o("Invalid Panel.gridOrigin: "+t),this.Pe.Od=t.N();const i=this.diagram;i!==null&&this===i.grid&&i.ca(),this.C(),this.t("gridOrigin",e,t)}}get graduatedMin(){return this.ot!==null?this.ot.R0:0}set graduatedMin(t){const e=this.graduatedMin;if(e!==t&&(this.ot===null&&(this.ot=new fe),this.ot.R0=t,this.c(),this.t("graduatedMin",e,t),this.mf())){const i=this.part;i!==null&&this.Eh(i,"graduatedRange")}}get graduatedMax(){return this.ot!==null?this.ot.O0:100}set graduatedMax(t){const e=this.graduatedMax;if(e!==t&&(this.ot===null&&(this.ot=new fe),this.ot.O0=t,this.c(),this.t("graduatedMax",e,t),this.mf())){const i=this.part;i!==null&&this.Eh(i,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.ot!==null?this.ot.I0:10}set graduatedTickUnit(t){const e=this.graduatedTickUnit;e!==t&&t>0&&(this.ot===null&&(this.ot=new fe),this.ot.I0=t,this.c(),this.t("graduatedTickUnit",e,t))}get graduatedTickBase(){return this.ot!==null?this.ot.E0:0}set graduatedTickBase(t){const e=this.graduatedTickBase;e!==t&&(this.ot===null&&(this.ot=new fe),this.ot.E0=t,this.c(),this.t("graduatedTickBase",e,t))}get Fs(){return this.ot!==null?this.ot.Fs:null}set Fs(t){this.ot!==null?this.ot.Fs=t:t!==null&&(this.ot=new fe,this.ot.Fs=t)}get ts(){return this.ot!==null?this.ot.ts:null}set ts(t){this.ot!==null?this.ot.ts=t:t!==null&&(this.ot=new fe,this.ot.ts=t)}get ds(){return this.ot!==null?this.ot.ds:null}set ds(t){this.ot!==null?this.ot.ds=t:t!==null&&(this.ot=new fe,this.ot.ds=t)}get vi(){return this.ot!==null?this.ot.vi:null}set vi(t){this.ot!==null?this.ot.vi=t:t!==null&&(this.ot=new fe,this.ot.vi=t)}Wp(t){super.Wp(t);const e=this.D.r,i=e.length;for(let s=0;s<i;s++)e[s].Wp(t)}Ma(t,e){if(this.W===j.Grid){t.commitTransform(),this.W.Ge(this,t,e);return}if(this.W===j.Graduated){t.commitTransform(),this.W.Ge(this,t,e);return}if(this.W===j.Table)if(t.commitTransform(),t instanceof Wt){const r=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.WN(t,e),t.endGroup(),t.currentElement=r}else this.WN(t,e);const i=this.isClipping&&this.W===j.Spot;i&&t.save();const s=this.findMainElement(),n=this.D.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];i&&a===s&&(t.clipInsteadOfFill=!0),a.Ge(t,e),i&&a===s&&(t.clipInsteadOfFill=!1)}i&&(t.restore(),t.clearContextCache(!0))}WN(t,e){t.lineCap="butt";const i=this.rowCount>0?this.Qi:null,s=this.columnCount>0?this._i:null;i!==null&&this.$1(t,e,!0,i,!0),s!==null&&this.$1(t,e,!1,s,!0),i!==null&&this.uD(t,!0,i),s!==null&&this.uD(t,!1,s),i!==null&&this.$1(t,e,!0,i,!1),s!==null&&this.$1(t,e,!1,s,!1)}uD(t,e,i){const s=i.length,n=this.actualBounds,o=this.naturalBounds;let r=!0;for(let a=0;a<s;a++){const l=i[a];if(l===void 0||l.actual===0)continue;if(r){r=!1;continue}if(e){if(l.position>o.height)continue}else if(l.position>o.width)continue;let h=l.separatorStrokeWidth;isNaN(h)&&(h=e?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let u=l.separatorStroke;if(u===null&&(u=e?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),h===0||u===null)continue;this.kn(t,u,!1,!1,o,n);let c=!1,d=l.separatorDashArray;d===null&&(d=e?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),d!==null&&(c=!0,t.enableDash(d,0)),t.beginPath();const f=l.position+h;e?f>o.height&&(h-=f-o.height):f>o.width&&(h-=f-o.width);let m=l.position+h/2;t.lineWidth=h;const g=this.Qt;if(e){m+=g.top;const p=g.left,b=o.width-g.right;t.moveTo(p,m),t.lineTo(b,m)}else{m+=g.left;const p=g.top,b=o.height-g.bottom;t.moveTo(m,p),t.lineTo(m,b)}t.stroke(),t.endPath(),c&&t.disableDash()}}$1(t,e,i,s,n){const o=s.length,r=this.actualBounds,a=this.naturalBounds,l=this.dD(!0),h=this.dD(!1);for(let u=0;u<o;u++){const c=s[u];if(c===void 0||c.background===null||c.coversSeparators===n||c.actual===0)continue;const d=i?r.height:r.width;if(c.position>d)continue;let f=c.computeEffectiveSpacing(),m=c.separatorStrokeWidth;isNaN(m)&&(m=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let g=c.separatorStroke;g===null&&(g=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(g===null||c.index===(i?l:h))&&(m=0),f-=m;const p=c.position+m;let b=f+c.actual;if(p+b>d&&(b=d-p),b<=0)continue;const v=this.Qt;this.kn(t,c.background,!0,!1,a,r),i?t.fillRect(v.left,p+v.top,r.width-(v.left+v.right),b):t.fillRect(p+v.left,v.top,b,r.height-(v.top+v.bottom))}}dD(t){const e=t?this.rowCount:this.columnCount;for(let i=0;i<e;i++){const s=t?this.Qi[i]:this._i[i];if(s!==void 0)return s.index}return 0}xf(){const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].xf();this.$i(!0)}wf(t,e,i){const s=this.svg;if(s===null)return!1;if(this.type===j.Table){const r=s.getElementsByClassName("gojs-ts"),a=r.length!==0?r[0]:null;a!==null&&(a.innerHTML=""),t.currentElement=a,this.WN(t,e),t.currentElement=null}else{if(this.W===j.Grid||this.W===j.Graduated)return s.innerHTML="",s.remove(),!1;if(this.W===j.Spot&&this.isClipping)return s.innerHTML="",s.remove(),this.xa=null,this.xf(),!1}if(!super.wf(t,e,i))return!1;const n=this.D.r,o=n.length;for(let r=0;r<o;r++)n[r].Ge(t,e);return!0}Pd(t){return!0}$p(t,e,i,s){if(!this.isClipping){if(this._s()&&t.partClipRect!==null){const n=t.partClipRect,o=this.D.r;let r=0,a=0;for(let l=0;l<o.length;l++){if(!o[l].isVisibleObject())continue;const h=o[l].actualBounds;r=l===0?h.x:Math.min(h.x,r),a=l===0?h.y:Math.min(h.y,a)}s.setAttributeNS(null,"clip-path",`path('M ${n.x-i.x-r},${n.y-i.y-a} l ${n.width} 0 l 0 ${n.height} l -${n.width} 0 z')`);return}super.$p(t,e,i,s)}}pf(t,e,i,s,n){const o=this.Nn(),r=this.v,a=1/(r.m11*r.m22-r.m12*r.m21);let l=r.m22*a,h=-r.m12*a,u=-r.m21*a,c=r.m11*a,d=a*(r.m21*r.dy-r.m22*r.dx),f=a*(r.m12*r.dx-r.m11*r.dy);if(this.background!==null){const m=t*l+e*u+d,g=t*h+e*c+f,p=i*l+s*u+d,b=i*h+s*c+f;n.e(0,0);const v=this.naturalBounds,w=L.Cl(0,0,v.width,v.height,m,g,p,b,n);return n.v(r),w}else{o||(l=1,h=0,u=0,c=1,d=0,f=0);const m=t*l+e*u+d,g=t*h+e*c+f,p=i*l+s*u+d,b=i*h+s*c+f;n.e(p,b);let v=(p-m)**2+(b-g)**2,w=!1;const k=this.D.r,S=k.length,N=P.l();let D=null,A=1/0,M=null;const C=this.isClipping&&this.W===j.Spot;C&&(M=P.l(),D=this.findMainElement(),w=D.pf(m,g,p,b,M),w&&(A=(m-M.x)**2+(g-M.y)**2));for(let F=0;F<S;F++){const O=k[F];if(!O.visible||O===D||!O.pf(m,g,p,b,N))continue;w=!0;const E=(m-N.x)**2+(g-N.y)**2;E<v&&(v=E,n.set(N))}return C&&(A>v&&n.set(M),P.i(M)),P.i(N),o&&n.v(r),w}}Wc(){const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].Wc();super.Wc()}c(t){if(this.Go())return;super.c(t);let e=null;(this.W===j.Auto||this.W===j.Link)&&(e=this.findMainElement());const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if((o===e||o.isPanelMain)&&o.c(!0),o.desiredSize.isReal()||!o.visible)continue;const r=o.Qs(!1);!(o instanceof Jt)&&!(o instanceof j)&&!(o instanceof lt)&&r===0||o.c(!0)}}kf(){if(this.Go())return;this.xi(!0),this.ao(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].kf()}yf(){if(this.B1()===!1){this.Sd(!0),this.Uh(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].AN()}}AN(){this.Uh(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].AN()}bd(t,e,i,s){const n=this.Zo;n.e(0,0,0,0);const o=this.desiredSize,r=this.minSize;i===void 0&&(i=r.width,s=r.height),i=Math.max(i,r.width),s=Math.max(s,r.height);const a=this.maxSize;isNaN(o.width)||(t=Math.min(o.width,a.width)),isNaN(o.height)||(e=Math.min(o.height,a.height)),t=Math.max(i,t),e=Math.max(s,e);const l=this.Qt;t=Math.max(t-l.left-l.right,0),e=Math.max(e-l.top-l.bottom,0);const h=this.D.r;this.W.measure(this,t,e,h,n,i,s);let u=n.width+l.left+l.right,c=n.height+l.top+l.bottom;isFinite(o.width)&&(u=o.width),isFinite(o.height)&&(c=o.height),u=Math.min(a.width,u),c=Math.min(a.height,c),u=Math.max(r.width,u),c=Math.max(r.height,c),u=Math.max(i,u),c=Math.max(s,c),n.jn(u,c),this.naturalBounds.jn(u,c),this.lo(0,0,u,c)}findMainElement(){if(this.ll===null){const t=this.D.r,e=t.length;if(e===0)return null;for(let i=0;i<e;i++){const s=t[i];if(s.isPanelMain===!0)return this.ll=s,s}this.ll=t[0]}return this.ll}$o(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.qN}set panelLayoutState(t){this.qN=t}Pa(t,e,i,s){const n=this.D.r;if(this.actualBounds.e(t,e,i,s),!this.desiredSize.isReal()){let o=this.Qs(!0);const r=this.measuredBounds,a=r.width,l=r.height,h=this.sl,u=h.left+h.right,c=h.top+h.bottom;switch(a===i&&l===s&&(o=0),o){case 0:(a>i||l>s)&&(this.c(),this.ht(a>i?i:a,l>s?s:l,0,0));break;case 2:this.c(!0),this.ht(i+u,s+c,0,0);break;case 5:this.c(!0),this.ht(i+u,l+c,0,0);break;case 4:this.c(!0),this.ht(a+u,s+c,0,0);break}}this.W.arrange(this,n,this.Zo)}ka(t){const e=this.naturalBounds,i=this.$o();if(I.contains(0,0,e.width,e.height,t.x,t.y)){const s=this.D.r,n=s.length,o=P.z(0,0);for(let r=n;r--;){const a=s[r];if(!(!a.visible&&a!==i)&&(o.set(t).Ki(a.v),a.containsPoint(o)))return P.i(o),!0}return P.i(o),this.Lt!==null}return!1}Yp(t){if(this.oo===t)return this;const e=this.D.r,i=e.length;for(let s=0;s<i;s++){const n=e[s].Yp(t);if(n!==null)return n}return null}walkVisualTreeFrom(t,e){if(e(this,t),t instanceof j){const i=t.D.r,s=i.length;for(let n=0;n<s;n++)this.walkVisualTreeFrom(i[n],e)}}Sn(t){this.gD(this,t)}gD(t,e){e(t);const i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof j&&this.gD(o,e)}}HI(t){this.mD(this,t)}mD(t,e){if(e(t),t instanceof j){const i=t.D.r,s=i.length;for(let n=0;n<s;n++)this.mD(i[n],e)}}findInVisualTree(t){return this.pD(this,t)}pD(t,e){if(e(t))return t;if(t instanceof j){const i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=this.pD(i[n],e);if(o!==null)return o}}return null}findObject(t){if(this.name===t)return this;const e=this.D.r;let i=e.length;this.jI()&&(i=this.U0());for(let s=0;s<i;s++){const n=e[s];if(n instanceof j){const o=n.findObject(t);if(o!==null)return o}if(n.name===t)return n}return null}yD(){const t=this.D.r,e=t.length;let i=0;for(let s=0;s<e;s++){const n=t[s];n instanceof j?i=Math.max(i,n.yD()):n instanceof et&&(i=Math.max(i,n.qI()))}return i}Nn(){return!(this.type===j.TableRow||this.type===j.TableColumn)}ol(){return this.type===j.TableRow||this.type===j.TableColumn}BA(t,e,i){if(this.pickable===!1||(e===void 0&&(e=null),i===void 0&&(i=null),this.as()))return null;const s=this.naturalBounds,n=1/this.getDocumentScale(),o=this.Nn(),r=o?t:P.z(t.x,t.y).Ki(this.v),a=this.diagram;let l=10,h=5;if(a!==null&&(l=a.getInputOption("extraTouchArea"),h=l/2),I.contains(-(h*n),-(h*n),s.width+l*n,s.height+l*n,r.x,r.y)){if(!this.Tf){const c=this.D.r,d=c.length,f=P.l(),m=this.isClipping&&this.W===j.Spot,g=m?this.findMainElement():null;if(m&&g&&(g.Nn()?f.set(t).Ki(g.v):f.set(t),!g.containsPoint(f)))return P.i(f),o||P.i(r),null;const p=this.$o();for(let b=d;b--;){const v=c[b];if(!v.visible&&v!==p||(v.Nn()?f.set(t).Ki(v.v):f.set(t),m&&v===g))continue;let w=null;if(v instanceof j?w=v.BA(f,e,i):v.pickable===!0&&v.containsPoint(f)&&(w=v),w!==null&&(e!==null&&(w=e(w)),w!==null&&(i===null||i(w))))return P.i(f),o||P.i(r),w}P.i(f)}if(this.background===null)return o||P.i(r),null;const u=I.contains(0,0,s.width,s.height,r.x,r.y)?this:null;return o||P.i(r),u}return o||P.i(r),null}zA(t,e,i,s){if(this.pickable===!1)return!1;e===void 0&&(e=null),i===void 0&&(i=null);const n=this.naturalBounds,o=this.Nn(),r=o?t:P.z(t.x,t.y).Ki(this.v),a=this.ol(),l=I.contains(0,0,n.width,n.height,r.x,r.y);if(a||l){if(!this.Tf){const h=this.D.r,u=h.length,c=P.l(),d=this.$o();for(let f=u;f--;){const m=h[f];if(!m.visible&&m!==d)continue;m.Nn()?c.set(t).Ki(m.v):c.set(t);let g=m;const p=m instanceof j?m:null;if(p!==null?p.zA(c,e,i,s):g.containsPoint(c)){if(g.pickable===!1)continue;e!==null&&(g=e(g)),g!==null&&(i===null||i(g))&&s.add(g)}}P.i(c)}return o||P.i(r),l&&this.background!==null}return o||P.i(r),!1}Zm(t,e,i,s,n,o){if(this.pickable===!1)return!1;e===void 0&&(e=null),i===void 0&&(i=null);let r=o;if(r===void 0&&(r=wt.l(),r.Ue()),r.kc(this.v),this.containedInRect(t,r))return this.JN(e,i,n),o===void 0&&wt.i(r),!0;if(this.intersectsRect(t,r)){if(!this.Tf){const a=this.$o(),l=this.D.r,h=l.length;for(let u=h;u--;){const c=l[u];if(!c.visible&&c!==a)continue;const d=c.actualBounds,f=this.naturalBounds;if(d.x>f.width||d.y>f.height||d.x+d.width<0||d.y+d.height<0)continue;let m=c;const g=c instanceof j?c:null,p=wt.l();p.set(r),(g!==null?g.Zm(t,e,i,s,n,p):m.JT(t,s,p))&&(e!==null&&(m=e(m)),m!==null&&(i===null||i(m))&&n.add(m)),wt.i(p)}}return o===void 0&&wt.i(r),s}return o===void 0&&wt.i(r),!1}JN(t,e,i){const s=this.D.r,n=s.length;for(let o=n;o--;){const r=s[o];if(!r.visible)continue;const a=r.actualBounds,l=this.naturalBounds;if(a.x>l.width||a.y>l.height||a.x+a.width<0||a.y+a.height<0)continue;r instanceof j&&r.JN(t,e,i);let h=r;t!==null&&(h=t(h)),h!==null&&(e===null||e(h))&&i.add(h)}}XA(t,e,i,s,n,o){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);const r=this.naturalBounds,a=this.Nn(),l=a?t:P.z(t.x,t.y).Ki(this.v),h=a?e:P.z(e.x,e.y).Ki(this.v),u=l.distanceSquaredPoint(h),c=l.x>0&&l.x<r.width&&l.y>0&&l.y<r.height||P.distanceLineSegmentSquared(l.x,l.y,0,0,0,r.height)<=u||P.distanceLineSegmentSquared(l.x,l.y,0,r.height,r.width,r.height)<=u||P.distanceLineSegmentSquared(l.x,l.y,r.width,r.height,r.width,0)<=u||P.distanceLineSegmentSquared(l.x,l.y,r.width,0,0,0)<=u,d=l.distanceSquared(0,0)<=u&&l.distanceSquared(0,r.height)<=u&&l.distanceSquared(r.width,0)<=u&&l.distanceSquared(r.width,r.height)<=u;if(a||(P.i(l),P.i(h)),c){if(!this.Tf){const f=P.l(),m=P.l(),g=this.$o(),p=this.D.r,b=p.length;for(let v=b;v--;){const w=p[v];if(!w.visible&&w!==g)continue;const k=w.actualBounds,S=this.naturalBounds;if(a&&(k.x>S.width||k.y>S.height||k.x+k.width<0||k.y+k.height<0))continue;if(w.Nn()){const A=w.v;f.set(t).Ki(A),m.set(e).Ki(A)}else f.set(t),m.set(e);let N=w;const D=w instanceof j?w:null;(D!==null?D.XA(f,m,i,s,n,o):N.$T(f,m,n))&&(i!==null&&(N=i(N)),N!==null&&(s===null||s(N))&&o.add(N))}P.i(f),P.i(m)}return n?c:d}return!1}GN(t){let e=null;if(t instanceof et){e=t.spot1,e===T.Default&&(e=null);const i=t.geometry;i!==null&&e===null&&(e=i.spot1)}return e===null&&(e=T.TopLeft),e}YN(t){let e=null;if(t instanceof et){e=t.spot2,e===T.Default&&(e=null);const i=t.geometry;i!==null&&e===null&&(e=i.spot2)}return e===null&&(e=T.BottomRight),e}add(...t){for(let e=0;e<t.length;e++)this.insertAt(this.D.count,t[e]);return this}elt(t){return this.D.elt(t)}insertAt(t,e){e instanceof ft&&y.o("Cannot add a Part to a Panel: "+e+"; use a Panel instead"),(this===e||this.isContainedBy(e))&&(this===e&&y.o("Cannot make a Panel contain itself: "+this.toString()),y.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+e.toString()));const i=e.panel;if(i!==null&&i!==this&&y.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+e.toString()+", already contained by "+i.toString()+", cannot be shared by this Panel: "+this.toString()),this.W===j.Grid&&!(e instanceof et)&&y.o("Can only add Shapes to a Grid Panel, not: "+e),this.W===j.Graduated&&!(e instanceof et||e instanceof lt)&&y.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+e),e.Vh(this),e.nl=null,this.itemArray!==null){const r=e.data;y.$(r)&&(this.tn===null&&(this.tn=new bt),this.tn.set(r,e))}const s=this.D;let n=-1;if(i===this){let r=-1;const a=this.D.r,l=a.length;for(let h=0;h<l;h++)if(a[h]===e){r=h;break}if(r!==-1){if(r===t||r+1>=s.count&&t>=s.count)return;s.removeAt(r),n=r}else y.o("element "+e.toString()+" has panel "+i.toString()+" but is not contained by it.")}(t<0||t>s.count)&&(t=s.count),s.insertAt(t,e),(t===0||e.isPanelMain)&&(this.ll=null),this.Go()||this.c(),e.c(!1),e.portId!==null?this.Ln=!0:e instanceof j&&e.Ln===!0&&(this.Ln=!0),this.ds=null,this.isEnabledObject()||this.Z1(e,!1);const o=this.part;if(o!==null){o.s0(),o.Df(),this.Ln&&o instanceof W&&(o.Ln=!0),o.Ln&&o instanceof W&&(o.ci=null);const r=this.diagram;if(r!==null&&r.undoManager.isUndoingRedoing)return;n!==-1&&o.raiseChangedEvent(4,"elements",this,e,null,n,null),o.raiseChangedEvent(3,"elements",this,null,e,null,t)}}get Ln(){return(this.n&8388608)!==0}set Ln(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}MN(){return(this.n&16777216)!==0}$N(t){t?this.n|=16777216:this.n&=-16777217}KI(t){t.Vh(this),t.nl=null;const e=this.D,i=e.count;e.insertAt(i,t);const s=this.part;if(s!==null){s.s0(),t.portId!==null&&s instanceof W&&(s.Ln=!0);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s.raiseChangedEvent(3,"elements",this,null,t,null,i)}}cI(t){const e=this.D.r,i=e.length;let s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}return s}remove(t){const e=this.D.r,i=e.length;let s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}s!==-1&&this.ri(s,!0)}removeAt(t){t>=0&&this.ri(t,!0)}ri(t,e){const i=this.D,s=i.elt(t);if(s.nl=null,s.Vh(null),this.tn!==null){const o=s.data;y.$(o)&&this.tn.delete(o)}i.removeAt(t),this.xi(!1),this.c(),this.ll===s&&(this.ll=null),this.ds=null;const n=this.part;if(n!==null){n.s0(),n.Df(),n.invalidateAdornments(),n instanceof W&&(s instanceof j?s.walkVisualTreeFrom(s,(r,a)=>n.FN(a,e)):n.FN(s,e));const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(4,"elements",this,s,null,t,null)}}get Qi(){return this.O===null&&(this.O=new jt),this.O.Qi}get rowCount(){return this.O===null?0:this.Qi.length}getRowDefinition(t){t<0&&y.J(t,">= 0",j,"getRowDefinition:idx"),t=Math.round(t);const e=this.Qi;if(e[t]===void 0){const i=new Dt;i.Vh(this),i.isRow=!0,i.index=t,e[t]=i,this.raiseChangedEvent(3,"rowdefs",this,null,i,null,t)}return e[t]}removeRowDefinition(t){if(t<0&&y.J(t,">= 0",j,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const e=this.Qi,i=e[t];if(i){e[t]=void 0;let s=e.length-1;for(;s>=0&&e[s--]===void 0;)e.length--;this.raiseChangedEvent(4,"rowdefs",this,i,null,t,null),this.c()}}xT(t,e){const i=this.Qi;if(!(t<0)){if(i[t]=e instanceof Dt?e:void 0,!e){let s=i.length-1;for(;s>=0&&i[s--]===void 0;)i.length--}this.c()}}get _i(){return this.O===null&&(this.O=new jt),this.O._i}get columnCount(){return this.O===null?0:this._i.length}getColumnDefinition(t){t<0&&y.J(t,">= 0",j,"getColumnDefinition:idx"),t=Math.round(t);const e=this._i;if(e[t]===void 0){const i=new Dt;i.Vh(this),i.isRow=!1,i.index=t,e[t]=i,this.raiseChangedEvent(3,"coldefs",this,null,i,null,t)}return e[t]}removeColumnDefinition(t){if(t<0&&y.J(t,">= 0",j,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const e=this._i,i=e[t];if(i){e[t]=void 0;let s=e.length-1;for(;s>=0&&e[s--]===void 0;)e.length--;this.raiseChangedEvent(4,"coldefs",this,i,null,t,null),this.c()}}bT(t,e){const i=this._i;if(!(t<0)){if(i[t]=e instanceof Dt?e:void 0,!e){let s=i.length-1;for(;s>=0&&i[s--]===void 0;)i.length--}this.c()}}addRowColumnDefinition(t){let e=null;return t.isRow?e=this.getRowDefinition(t.index):t.isRow||(e=this.getColumnDefinition(t.index)),e&&e.X1(t),this}addRowDefinition(t,e){const i=this.getRowDefinition(t);return i&&i.X1(new Dt(e)),this}addColumnDefinition(t,e){const i=this.getColumnDefinition(t);return i&&i.X1(new Dt(e)),this}get rowSizing(){return this.O!==null?this.O.V0:3}set rowSizing(t){const e=this.rowSizing;e!==t&&(this.O===null&&(this.O=new jt),this.O.V0=t,this.c(),this.t("rowSizing",e,t))}get columnSizing(){return this.O!==null?this.O.B0:3}set columnSizing(t){const e=this.columnSizing;e!==t&&(this.O===null&&(this.O=new jt),this.O.B0=t,this.c(),this.t("columnSizing",e,t))}get topIndex(){return this.O!==null?this.O.z0:0}set topIndex(t){const e=this.topIndex;e!==t&&((!isFinite(t)||t<0)&&y.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new jt),this.O.z0=t,this.c(),this.t("topIndex",e,t))}get leftIndex(){return this.O!==null?this.O.X0:0}set leftIndex(t){const e=this.leftIndex;e!==t&&((!isFinite(t)||t<0)&&y.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new jt),this.O.X0=t,this.c(),this.t("leftIndex",e,t))}findRowForLocalY(t){if(t<0||this.type!==j.Table||this.rowCount===0)return-1;let e=0;const i=this.Qi,s=i.length;let n=this.topIndex;for(;n<s;n++){const o=i[n];if(o!==void 0&&(e+=o.total,t<e))return n}return n}findColumnForLocalX(t){if(t<0||this.type!==j.Table||this.columnCount===0)return-1;let e=0;const i=this._i,s=i.length;let n=this.leftIndex;for(;n<s;n++){const o=i[n];if(o!==void 0&&(e+=o.total,t<e))return n}return n}graduatedPointForValue(t,e){if(e===void 0&&(e=new P(NaN,NaN)),this.type!==j.Graduated)return e.e(NaN,NaN),e;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const i=this.findMainElement();return i.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,e),i.v.gt(e)}graduatedValueForPoint(t){if(this.type!==j.Graduated)return NaN;const e=this.findMainElement();return e.v.Ci(t),e.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this.te}set data(t){const e=this.te;if(e!==t){const i=this instanceof ft&&!(this instanceof pt);i&&y.s(t,"object",j,"data"),this.It(),this.te=t;const s=this.diagram;if(s!==null)if(i){s.partManager.WI(this,e,t);let n=this.adornments;for(;n.next();){const o=n.value,r=o.adornedObject;if(r!==null){const a=r.findBindingPanel();a!==null&&(o.data=a.data)}}}else{const n=this.panel;n!==null&&n.tn!==null&&(e!==null&&n.tn.delete(e),t!==null&&n.tn.set(t,this))}if(this.t("data",e,t),s!==null&&s.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.Fd}set itemIndex(t){const e=this.Fd;e!==t&&(this.Fd=t,this.t("itemIndex",e,t))}get vs(){return this.w!==null?this.w.vs:null}set vs(t){this.ve!==t&&(this.w===null&&(this.w=new Le),this.w.vs=t)}RN(){return this.vs!==null}nD(){const t=this.vs;return t!==null&&t.f}freezeBindings(){return this.It()}It(){let t=this.vs;if(t===null)this.data!==null&&y.o("Template cannot have .data be non-null: "+this),this.vs=t=new J;else if(t.f)return this;const e=new J;this.$N(!1),this.walkVisualTreeFrom(this,(n,o)=>{o.ba();const r=o.ve;if(r!==null){o.TN(!1);const a=r.iterator;for(;a.next();){const l=a.value;l.mode===2&&o.TN(!0);const h=l.sourceName;if(l.isToObject){h==="/"&&n.$N(!0);const u=l.WT(n,o);u!==null&&(e.add(u),u.ro===null&&(u.ro=new J),u.ro.add(l))}t.add(l)}}if(o instanceof j&&o.type===j.Table){if(o.rowCount>0){const a=o.Qi,l=a.length;for(let h=0;h<l;h++){const u=a[h];if(u!==void 0&&u.Rs!==null){const c=u.Rs.iterator;for(;c.next();){const d=c.value;d.Ti=u,d.Id=2,d.vf=u.index,t.add(d)}}}}if(o.columnCount>0){const a=o._i,l=a.length;for(let h=0;h<l;h++){const u=a[h];if(u!==void 0&&u.Rs!==null){const c=u.Rs.iterator;for(;c.next();){const d=c.value;d.Ti=u,d.Id=1,d.vf=u.index,t.add(d)}}}}}});const i=e.iterator;for(;i.next();){const n=i.value;if(n.ro!==null){n.TN(!0);const o=n.ro.iterator;for(;o.next();){const r=o.value;n.ve===null&&(n.ve=new J),n.ve.add(r)}}n.ro=null}let s=t.iterator;for(;s.next();){const n=s.value;let o=n.Ti;if(o!==null){n.Ti=null;const r=n.targetProperty,a=r.indexOf(".");if(a>0&&o instanceof j){const l=r.substring(0,a),h=r.substring(a+1),u=o.findObject(l);u!==null?(o=u,n.targetProperty=h):(y.ne('Warning: unable to find GraphObject named "'+l+'" for Binding: '+n.toString()),o=null)}if(o instanceof Dt){const l=K.xs(o.panel);n.targetId=l===void 0?-1:l,o.panel.oo=n.targetId}else if(o instanceof tt){const l=K.xs(o);n.targetId=l===void 0?-1:l,o.oo=n.targetId}else y.o("Unknown type of binding target: "+o);n.check(o)}}return t.k(),this instanceof ft&&this.Di()&&this.ensureBounds(),this}static BU=!1;copyTemplate(t){t===void 0&&(t=!1);const e=this.copy();return e.HI(i=>{i instanceof j&&(i.vs=null,i.te=null);const s=i.ve;s!==null&&(i.ve=null,s.each(o=>i.bind(o.copy())));const n=i.Ds;n!==null&&(i.Ds=null,n.each(o=>i.trigger(o.value.copy())))}),t&&e.It(),e}updateTargetBindings(t){const e=this.vs;if(e===null)return;t===void 0&&(t="");const i=this.diagram?.model,s=e.iterator;for(;s.next();){const n=s.value,o=this.ZN(n,t);if(o===null)continue;const{data:r,elt:a}=o;n.isToTheme&&this.diagram===null||a!==void 0&&n.updateTarget(a,r,void 0,i)}}JI(t){if(t===""){this.updateTargetBindings(t);return}const e=this.vs;if(e===null)return;const i=this.diagram?.model,s=e.iterator;for(;s.next();){const n=s.value;if(n.isToData&&n.sourceProperty!=="")continue;const o=this.ZN(n,"");if(o===null)continue;const{data:r,elt:a}=o;a!==void 0&&n.updateTarget(a,r,void 0,i)}}Yo(){if(this.diagram!==null)if(this.RN()){const t=this.diagram.model,e=this.vs.iterator;for(;e.next();){const i=e.value;if(!i.isToTheme)continue;const s=this.ZN(i);if(s===null)continue;const{data:n,elt:o}=s;o!==void 0&&i.updateTarget(o,n,void 0,t)}}else{const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].Yo()}}ZN(t,e=""){const i=t.sourceProperty;if(e!==""&&i!==""&&i!==e)return null;const s=t.targetProperty;if(t.converter===null&&s==="")return null;let n=this.data;const o=t.sourceName;if(t.isToObject){if(n=this.qT(o),n===null)return null}else if(t.isToModel){const h=this.diagram;if(h===null)return null;n=h.model.modelData}let r=this;const a=t.targetId;if(a!==-1){if(r=this.Yp(a),r===null)return null}else t.Ti!==null&&(r=t.Ti);o==="/"?n=r.part:o==="."?n=r:o===".."&&(n=r.panel);const l=t.Id;if(l!==0){if(!(r instanceof j))return null;l===1?r=r.getColumnDefinition(t.vf):l===2&&(r=r.getRowDefinition(t.vf))}return{data:n,elt:r}}get itemArray(){return this.Aa}set itemArray(t){const e=this.Aa;if(e!==t||t!==null&&this.$I(t)){const i=this.diagram;if(e!==t&&(i!==null&&e!==null&&i.partManager.C2(this,i),this.Aa=t,i!==null&&t!==null&&i.partManager.N2(this,i)),this.t("itemArray",e,t),i!==null&&i.undoManager.isUndoingRedoing)return;this.wD(e,t)}}findItemPanelForData(t){return t==null||this.tn===null?null:(y.xc(t,j,"findItemPanelForData"),this.tn.get(t))}$I(t){const e=this.D.r,i=e.length,s=t.length;let n=0,o=null;for(;n<i&&(o=e[n],!(o instanceof j)||o.data===null);)n++,o=e[n];if(i-n!==s)return!0;if(o===null)return s>0;let r=0;for(;n<i&&r<s;){if(o=e[n],!(o instanceof j)||o.data!==t[r])return!0;n++,r++}return!1}U0(){if(this.type===j.Spot||this.type===j.Auto)return Math.min(this.D.length,1);if(this.type===j.Link){const t=this.D,e=t.length;let i=0;for(;i<e;i++){const s=t.elt(i);if(!(s instanceof et)||!s.isPanelMain)return i}return i}if(this.type===j.Table&&this.D.length>0){const t=this.D.elt(0);if(t.isPanelMain&&t instanceof j&&t.ol())return 1}return 0}rebuildItemElements(){const t=this.U0();for(;this.D.length>t;)this.ri(this.D.length-1,!1);this.wD(null,this.itemArray)}wD(t,e){const i=this.U0(),s=e;if(s===null||s.length===0){for(;this.D.length>i;)this.ri(this.D.length-1,!1);return}if(this.D.length<=i){const n=s.length;for(let o=0;o<n;o++)this.Q1(s[o],o,!0)}else{let n=i;for(let r=0;r<s.length;r++,n++){const a=s[r],l=n<this.D.length?this.D.elt(n):null;if(l instanceof j){if(l.data!==a){const h=this.QN(l.data,r),u=this.QN(a,r);let c=u!==h;if(!c){const d=this._N(l.data,r,h);c=this._N(a,r,u)!==d}c?(this.ri(n,!1),this.Q1(a,r,!1)):l.data=a}}else this.Q1(a,r,!1)}for(;n<this.D.length;)this.ri(n,!1);this.ll=null,this.tC(i,0),this.Go()||this.c(),this.ds=null,this.isEnabledObject()||this.Z1(this,!1);const o=this.part;o!==null&&(o.s0(),o.Df(),this.Ln&&o instanceof W&&(o.Ln=!0),o.Ln&&o instanceof W&&(o.ci=null))}}Q1(t,e,i){if(t==null||e<0)return;const s=this.QN(t,e),n=this._N(t,e,s);if(n!==null){n.It();const o=n.copy();if(o.MN()){const a=this.findBindingPanel();a!==null&&a.$N(!0)}y.$(t)&&(this.tn===null&&(this.tn=new bt),this.tn.set(t,o));const r=e+this.U0();this.insertAt(r,o),i&&(o.te=t,this.tC(r,e),o.te=null),o.data=t}}ZI(t){if(t<0)return;const e=t+this.U0();this.ri(e,!0),this.tC(e,t)}tC(t,e){const i=this.D;let s=t,n=e;for(;s<i.length;){const o=i.elt(s);o instanceof j&&o.QI(s,n),s++,n++}}QI(t,e){this.type===j.TableRow?this.row=t:this.type===j.TableColumn&&(this.column=t),this.itemIndex=e}jI(){return this.Aa!==null||this.itemTemplateMap!==null}get itemTemplate(){const t=this.itemTemplateMap;if(t!==null){const e=t.get("");if(e)return e}return j.xD()}set itemTemplate(t){const e=this.itemTemplate;if(e!==t){(t instanceof ft||t.isPanelMain)&&y.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap===null&&(this.itemTemplateMap=new bt),this.itemTemplateMap.set("",t),this.t("itemTemplate",e,t);const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.w!==null?this.w.x0:null}set itemTemplateMap(t){const e=this.itemTemplateMap;if(e!==t){const i=t.iterator;for(;i.next();)i.value;this.Yt().x0=t,this.t("itemTemplateMap",e,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.w!==null?this.w.b0:"category"}set itemCategoryProperty(t){const e=this.itemCategoryProperty;e!==t&&(typeof t!="string"&&!y.st(t)&&y.si(t,"string or function",j,"itemCategoryProperty"),this.Yt().b0=t,this.t("itemCategoryProperty",e,t))}QN(t,e){if(t===null)return"";const i=this.itemCategoryProperty;let s="";if(y.st(i))s=i(t);else if(typeof i=="string"&&y.$(t)){if(i==="")return"";const n=this.diagram,o=n!==null?n.model:null;o?s=o.St(t,i):s=ht.St(t,i)}else return"";if(s===void 0)return"";if(typeof s=="string")return s;y.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+s)}static bD=!1;static eC;static xD(){return j.eC||(j.eC=new j().add(new lt().bind("text","",y.toString).theme("stroke","text"))),j.eC}_N(t,e,i){let s=null;const n=this.itemTemplateMap;return n!==null&&(s=n.get(i),s===null&&(s=n.get(""))),s===null&&(j.bD||(j.bD=!0,y.ne('No item template Panel found for category "'+i+'" on '+this),y.ne("  Using default item template.")),s=j.xD()),s}get Tf(){return(this.n&1048576)!==0}set Tf(t){const e=(this.n&1048576)!==0;e!==t&&(y.s(t,"boolean",j,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",e,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const e=(this.n&2097152)!==0;e!==t&&(this.xf(),this.n=this.n^2097152,this instanceof at&&(this.he=null),this.c(),this.t("isClipping",e,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const e=(this.n&33554432)!==0;e!==t&&(this.n=this.n^33554432,this.c(),this.t("isOpposite",e,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const e=(this.n&4194304)!==0;if(e!==t){const i=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",e,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;i&&this.Z1(this,t)}}Z1(t,e){const i=t.enabledChanged;if(i!==null&&i(t,e),t instanceof j){const s=t.D.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];e&&r instanceof j&&!r.isEnabled||this.Z1(r,e)}}}get alignmentFocusName(){return this.uo}set alignmentFocusName(t){const e=this.uo;e!==t&&(this.uo=t,this.c(),this.t("alignmentFocusName",e,t))}static definePanelLayout(t,e){Pt.Tn(t,e)}static isLayoutDefined(t){return Pt.fs.has(t)}static Position=Pt.fs.get("Position");static Horizontal=Pt.fs.get("Horizontal");static Vertical=Pt.fs.get("Vertical");static Spot=Pt.fs.get("Spot");static Auto=Pt.fs.get("Auto");static Table=Pt.fs.get("Table");static Viewbox=Pt.fs.get("Viewbox");static TableRow=Pt.fs.get("TableRow");static TableColumn=Pt.fs.get("TableColumn");static Link=Pt.fs.get("Link");static Grid=Pt.fs.get("Grid");static Graduated=Pt.fs.get("Graduated")}j.definePanelLayout=j.definePanelLayout;class fe{R0;O0;I0;E0;Fs;ts;ds;vi;constructor(){this.R0=0,this.O0=100,this.I0=10,this.E0=0,this.Fs=null,this.ts=null,this.ds=null,this.vi=null}copy(){const t=new fe;return t.R0=this.R0,t.O0=this.O0,t.I0=this.I0,t.E0=this.E0,t.Fs=this.Fs,t.ts=this.ts,t.ds=this.ds,t.vi=this.vi,t}}class Oe{Rd;Od;af;N0;constructor(){this.Rd=st.OL,this.Od=P.gn,this.af=st.Zw,this.N0=[]}copy(){const t=new Oe;return t.Rd=this.Rd.copy(),t.Od=this.Od.copy(),t.af=this.af.copy(),t.N0=this.N0,t}}class jt{Qi;_i;V0;B0;z0;X0;C0;A0;L0;T0;v0;D0;F0;La;constructor(){this.Qi=[],this._i=[],this.V0=3,this.B0=3,this.z0=0,this.X0=0,this.C0=Mt.im,this.A0=1,this.L0=null,this.T0=null,this.v0=1,this.D0=null,this.F0=null,this.La=null}copy(t){const e=new jt,i=this.Qi,s=i.length,n=e.Qi;for(let l=0;l<s;l++){const h=i[l];if(h===void 0)continue;const u=h.copy();u.Vh(t),n[l]=u}const o=this._i,r=o.length,a=e._i;for(let l=0;l<r;l++){const h=o[l];if(h===void 0)continue;const u=h.copy();u.Vh(t),a[l]=u}return e.V0=this.V0,e.B0=this.B0,e.z0=this.z0,e.X0=this.X0,e.C0=this.C0.N(),e.A0=this.A0,e.L0=this.L0,e.T0=this.T0,e.v0=this.v0,e.D0=this.D0,e.F0=this.F0,e.La=this.La,e}}var ci=(x=>(x[x.Default=1]="Default",x[x.None=2]="None",x[x.ProportionalExtra=3]="ProportionalExtra",x))(ci||{});class Dt{Zs;G0;Tt;Gh;Yh;de;ct;Ed;ho;al;Ud;Vd;Kh;Lt;Bd;Rs;j;Re;ki;constructor(t){K.Je(this),this.Zs=null,this.G0=!0,this.Tt=0,this.ki=NaN,this.Gh=0,this.Yh=1/0,this.de=T.Default,this.j=0,this.Re=0,this.ct=0,this.Rs=null,this.Ed=1,this.ho=1,this.al=null,this.Ud=null,this.Vd=NaN,this.Kh=null,this.Lt=null,this.Bd=!1,t&&(Object.assign(this,t),t.column!==void 0?(this.isRow=!1,this.index=t.column):t.row!==void 0&&(this.isRow=!0,this.index=t.row))}copy(){const t=new Dt;return t.G0=this.G0,t.Tt=this.Tt,t.ki=this.ki,t.Gh=this.Gh,t.Yh=this.Yh,t.de=this.de,t.j=this.j,t.Re=this.Re,t.ct=this.ct,t.ho=this.ho,t.Ed=this.Ed,this.al===null?t.al=null:t.al=this.al.N(),t.Ud=this.Ud,t.Vd=this.Vd,t.Kh=null,this.Kh!==null&&(t.separatorDashArray=this.Kh.slice()),t.Lt=this.Lt,t.Bd=this.Bd,t.Rs=this.Rs,t}X1(t){t.isRow?t.height!==void 0&&(this.height=t.height):t.width!==void 0&&(this.width=t.width),t.minimum!==void 0&&(this.minimum=t.minimum),t.maximum!==void 0&&(this.maximum=t.maximum),t.alignment!==void 0&&(this.alignment=t.alignment),t.stretch!==void 0&&(this.stretch=t.stretch),t.sizing!==void 0&&(this.sizing=t.sizing),t.separatorPadding!==void 0&&(this.separatorPadding=t.separatorPadding),t.separatorStroke!==void 0&&(this.separatorStroke=t.separatorStroke),t.separatorStrokeWidth!==void 0&&(this.separatorStrokeWidth=t.separatorStrokeWidth),t.separatorDashArray!==void 0&&(this.Kh=t.separatorDashArray),t.background!==void 0&&(this.background=t.background),t.coversSeparators!==void 0&&(this.coversSeparators=t.coversSeparators),t.Rs!==void 0&&(this.Rs=t.Rs)}fe(t){t in ci?this.sizing=t:y.dr(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+K.xs(this)}static Default=1;static None=2;static ProportionalExtra=3;Vh(t){this.Zs=t}computeEffectiveSpacingTop(t){let e=0;const i=this.Zs;if(this.index!==t){let n=this.separatorStroke;n===null&&i!==null&&(n=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),n!==null&&(e=this.separatorStrokeWidth,isNaN(e)&&(i!==null?e=this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:e=0))}let s=this.al;if(s===null)if(i!==null)s=i.defaultSeparatorPadding;else return e;return e+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let t=0;const e=this.Zs;let i=0;const s=this.isRow;if(e!==null&&e.type===j.Table){const o=s?e.Qi.length:e._i.length;for(let r=0;r<o;r++){const a=s?e.Qi[r]:e._i[r];if(a!==void 0&&a.j!==0){i=a.index;break}}}if(this.index!==i){let o=this.separatorStroke;o===null&&e!==null&&(o=s?e.defaultRowSeparatorStroke:e.defaultColumnSeparatorStroke),o!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(e!==null?t=s?e.defaultRowSeparatorStrokeWidth:e.defaultColumnSeparatorStrokeWidth:t=0))}let n=this.al;if(n===null)if(e!==null)n=e.defaultSeparatorPadding;else return t;return t+(this.isRow?n.top+n.bottom:n.left+n.right)}t(t,e,i,s,n){const o=this.Zs;if(o!==null&&(o.raiseChangedEvent(2,t,this,e,i,s,n),this.Rs!==null)){const r=o.diagram;if(r!==null&&!r.wi){const a=o.findBindingPanel();if(a!==null){const l=a.data;if(l!==null){const h=this.Rs.iterator;for(;h.next();)h.value.updateSource(this,l,t,a)}}}}}get panel(){return this.Zs}get isRow(){return this.G0}set isRow(t){this.G0=t}get index(){return this.Tt}set index(t){this.Tt=t}get height(){return this.ki}set height(t){const e=this.ki;e!==t&&(t<0&&y.J(t,">= 0",Dt,"height"),this.ki=t,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("height",e,t))}get width(){return this.ki}set width(t){const e=this.ki;e!==t&&(t<0&&y.J(t,">= 0",Dt,"width"),this.ki=t,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("width",e,t))}get minimum(){return this.Gh}set minimum(t){const e=this.Gh;e!==t&&((t<0||!isFinite(t))&&y.J(t,">= 0",Dt,"minimum"),this.Gh=t,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("minimum",e,t))}get maximum(){return this.Yh}set maximum(t){const e=this.Yh;e!==t&&(t<0&&y.J(t,">= 0",Dt,"maximum"),this.Yh=t,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("maximum",e,t))}get alignment(){return this.de}set alignment(t){const e=this.de;e.equals(t)||(this.de=t.N(),this.panel!==null&&this.panel.c(),this.t("alignment",e,t))}get stretch(){return this.ho}set stretch(t){const e=this.ho;e!==t&&(this.ho=t,this.panel!==null&&this.panel.c(),this.t("stretch",e,t))}get separatorPadding(){return this.al}set separatorPadding(t){typeof t=="number"&&(t=new Mt(t));const e=this.al;(t===null||e===null||!e.equals(t))&&(t!==null&&(t=t.N()),this.al=t,this.panel!==null&&this.panel.c(),this.t("separatorPadding",e,t))}get separatorStroke(){return this.Ud}set separatorStroke(t){const e=this.Ud;e!==t&&(t!==null&&R.Md(t,"RowColumnDefinition.separatorStroke"),t instanceof R&&t.k(),this.Ud=t,this.panel!==null&&this.panel.c(),this.t("separatorStroke",e,t))}get separatorStrokeWidth(){return this.Vd}set separatorStrokeWidth(t){const e=this.Vd;e!==t&&(this.Vd=t,this.panel!==null&&this.panel.c(),this.t("separatorStrokeWidth",e,t))}get separatorDashArray(){return this.Kh}set separatorDashArray(t){const e=this.Kh;if(e!==t){if(t!==null&&!Array.isArray(t)&&y.si(t,"Array",Dt,"separatorDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&y.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.Kh=t,this.panel!==null&&this.panel.C(),this.t("separatorDashArray",e,t)}}get background(){return this.Lt}set background(t){const e=this.Lt;e!==t&&(t!==null&&R.Md(t,"RowColumnDefinition.background"),t instanceof R&&t.k(),this.Lt=t,this.panel!==null&&this.panel.C(),this.t("background",e,t))}get coversSeparators(){return this.Bd}set coversSeparators(t){const e=this.Bd;e!==t&&(y.s(t,"boolean",Dt,"coversSeparators"),this.Bd=t,this.panel!==null&&this.panel.C(),this.t("coversSeparators",e,t))}get sizing(){return this.Ed}set sizing(t){const e=this.Ed;e!==t&&(this.Ed=t,this.panel!==null&&this.panel.c(),this.t("sizing",e,t))}q1(){if(this.sizing===1){const t=this.Zs;return t===null?2:this.isRow?t.rowSizing:t.columnSizing}return this.sizing}get actual(){return this.j}set actual(t){isNaN(this.ki)?this.j=Math.max(Math.min(this.Yh,t),this.Gh):this.j=Math.max(Math.min(this.Yh,this.ki),this.Gh)}get measured(){return this.Re}set measured(t){this.Re=t}get total(){return this.j+this.computeEffectiveSpacing()}get position(){return this.ct}set position(t){this.ct=t}bind(t,e,i,s){return this.Sf(t,e,i,s),this}bindTwoWay(t,e,i,s){const n=this.Sf(t,e,i,s);return s===void 0&&n.makeTwoWay(),this}theme(t,e,i,s,n){return this.Na(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.Na(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,o){return this.Na(t,e,i,s,n).ofObject(o),this}themeModel(t,e,i,s,n){return this.Na(t,e,i,s,n).ofModel(),this}Sf(t,e,i,s){let n;return typeof t=="string"?n=new Yt(t,e,i,s):n=t,this.w0(n),n}Na(t,e,i,s,n){let o;return typeof t=="string"?o=new Ee(t,e,i,s,n):o=t,this.w0(o),o}w0(t){t.Ti=this;const e=this.panel;if(e!==null){const i=e.findBindingPanel();i!==null&&i.nD()&&y.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+e)}this.Rs===null&&(this.Rs=new J),this.Rs.add(t)}}class et extends tt{ut;en;zd;Hh;Qe;Qo;Wo;Kt;Xd;Gd;K;constructor(t,e){super(),this.ut=null,this.en=null,this.zd="None",this.Hh="black",this.Qe="black",this.Qo=1,this.Wo=null,this.Kt=null,this.Xd=NaN,this.Gd=NaN,this.K=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.ut=this.ut,t.en=this.en,t.zd=this.zd,t.Hh=this.Hh,t.Qe=this.Qe,t.Qo=this.Qo,this.Wo!==null&&(t.Wo=this.Wo.slice()),this.Kt!==null&&(this.Kt.me?t.Kt=this.Kt:t.Kt=this.Kt.copy()),t.Xd=this.Xd,t.Gd=this.Gd,this.K!==null&&(t.K=this.K.copy())}jh(){return this.Kt===null?this.Kt=new di:this.Kt.me&&(this.Kt=this.Kt.copy()),this.Kt}ba(){super.ba(),this.Kt!==null&&(this.Kt.me=!0)}fe(t){t in oi?this.geometryStretch=t:super.fe(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+K.xs(this)}_I(t,e){const i=this.pathPattern;if(i===null)return;i.ht(1/0,1/0);const s=i.measuredBounds;i.Ut(0,0,s.width,s.height);const n=this.geometry;if(n===null)return;t.save(),t.beginPath();const o=y.nt();if(n.type===1)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.endY),this.Yd(t,e,o,i);else if(n.type===4){const r=n.figures.iterator;for(;r.next();){const a=r.value;o.length=0,o.push(a.startX),o.push(a.startY);let l=a.startX,h=a.startY,u=l,c=h;const d=a.segments.r,f=d.length;for(let m=0;m<f;m++){const g=d[m];switch(g.type){case 1:this.Yd(t,e,o,i),o.length=0,o.push(g.endX),o.push(g.endY),l=g.endX,h=g.endY,u=l,c=h;break;case 2:o.push(g.endX),o.push(g.endY),l=g.endX,h=g.endY;break;case 3:L.Wn(l,h,g.point1X,g.point1Y,g.point2X,g.point2Y,g.endX,g.endY,.5,o),l=g.endX,h=g.endY;break;case 4:L.nm(l,h,g.point1X,g.point1Y,g.endX,g.endY,.5,o),l=g.endX,h=g.endY;break;case 5:{const p=g.Fo(a),b=p.length;if(b===0){o.push(g.centerX),o.push(g.centerY),l=g.centerX,h=g.centerY;break}for(let v=0;v<b;v++){const w=p[v];L.Wn(l,h,w[2],w[3],w[4],w[5],w[6],w[7],.5,o),l=w[6],h=w[7]}break}case 6:{const p=g.Za(a,l,h),b=p.length;if(b===0){o.push(g.endX),o.push(g.endY),l=g.endX,h=g.endY;break}for(let v=0;v<b;v++){const w=p[v];L.Wn(l,h,w[2],w[3],w[4],w[5],w[6],w[7],.5,o),l=w[6],h=w[7]}break}default:y.o("Segment not of valid type: "+g.type)}g.isClosed&&(o.push(u),o.push(c),this.Yd(t,e,o,i))}this.Yd(t,e,o,i)}}else if(n.type===2)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.startY),o.push(n.endX),o.push(n.endY),o.push(n.startX),o.push(n.endY),o.push(n.startX),o.push(n.startY),this.Yd(t,e,o,i);else if(n.type===3){const r=new Lt;r.startX=n.endX,r.startY=(n.startY+n.endY)/2;const a=new dt(5);a.startAngle=0,a.sweepAngle=360,a.centerX=(n.startX+n.endX)/2,a.centerY=(n.startY+n.endY)/2,a.radiusX=Math.abs(n.startX-n.endX)/2,a.radiusY=Math.abs(n.startY-n.endY)/2,r.add(a);const l=a.Fo(r),h=l.length;if(h===0)o.push(a.centerX),o.push(a.centerY);else{let u=r.startX,c=r.startY;for(let d=0;d<h;d++){const f=l[d];L.Wn(u,c,f[2],f[3],f[4],f[5],f[6],f[7],.5,o),u=f[6],c=f[7]}}this.Yd(t,e,o,i)}y.Z(o),t.restore(),t.clearContextCache(!1)}tE(t){let e=t.measuredBounds.width;return t instanceof et&&(e-=t.strokeWidth),e<1&&(e=1),e}Yd(t,e,i,s){const n=i.length;if(n<4)return;const o=s.measuredBounds,r=Math.max(1,o.width),a=o.height;let l=i[0],h=i[1],u=0,c=0,d=0,f=0,m=0,g=0,p=0,b=0;const v=y.nt();for(let C=2;C<n;C+=2)u=i[C],c=i[C+1],d=u-l,f=c-h,d===0&&(d=.001),m=f/d,g=Math.atan2(f,d),p=Math.sqrt(d*d+f*f),v.push([d,g,m,p]),b+=p,l=u,h=c;l=i[0],h=i[1];const w=this.tE(s);let k=w;const S=r/2;let N=S!==0,D=0,A=v[D];d=A[0],g=A[1],m=A[2],p=A[3];let M=0;for(;b>=.1;){if(M===0&&(N?(k=w,k-=S,b-=S,N=!1):k=w,k===0&&(k=1)),k>b){k=b,y.Z(v);return}k>p?(M=k-p,k=p):M=0;let C=Math.sqrt(k*k/(1+m*m));if(d<0&&(C=-C),l+=C,h+=m*C,t.translate(l,h),t.rotate(g),t.translate(-(r/2),-(a/2)),M===0&&s.Ma(t,e),t.translate(r/2,a/2),t.rotate(-g),t.translate(-l,-h),b-=k,p-=k,M!==0){if(D++,D===v.length){y.Z(v);return}A=v[D],d=A[0],g=A[1],m=A[2],p=A[3],k=M}}y.Z(v)}Ma(t,e){const i=t instanceof Wt;let s=this.Qe;const n=this.Hh;if(s===null&&n===null)return;const o=this.ut;if(o===null)return;t.commitTransform();const r=this.actualBounds,a=this.naturalBounds;n!==null&&this.kn(t,n,!0,!1,a,r);const l=this.part;let h=this.Qo;s!==null&&h===0&&l!==null&&(this.isPanelMain||l.findMainElement()===this)&&(h=l.eE()),h===0&&(s=null),s!==null&&h!==0&&(this.kn(t,s,!1,!1,a,r),t.lineWidth=h,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let u=!1;l&&e.getRenderingHint("drawShadows")&&(u=l.isShadowed),t.rl===!1&&(u=!1);let c=!0;s!==null&&(n===null||n==="transparent")&&(c=!1);let d=!1;const f=this.strokeDashArray;if(f!==null&&(d=!0,t.enableDash(f,this.strokeDashOffset)),o.type===1)t.beginPath(),t.moveTo(o.startX,o.startY),t.lineTo(o.endX,o.endY),s!==null&&t.strokeContext(),t.endPath();else if(o.type===2){const m=o.startX,g=o.startY,p=o.endX,b=o.endY,v=Math.min(m,p),w=Math.min(g,b),k=Math.abs(p-m),S=Math.abs(b-g);t.beginPath(),t.rect(v,w,k,S),n!==null&&t.fillContext(n,!1,null),s!==null&&(c&&u&&t.shadowsOff(),t.strokeContext(),c&&u&&t.shadowsOn()),t.endPath()}else if(o.type===3){const m=o.startX,g=o.startY,p=o.endX,b=o.endY,v=Math.abs(p-m)/2,w=Math.abs(b-g)/2,k=Math.min(m,p)+v,S=Math.min(g,b)+w;t.beginPath(),t.moveTo(k,S-w),t.bezierCurveTo(k+L.qn*v,S-w,k+v,S-L.qn*w,k+v,S),t.bezierCurveTo(k+v,S+L.qn*w,k+L.qn*v,S+w,k,S+w),t.bezierCurveTo(k-L.qn*v,S+w,k-v,S+L.qn*w,k-v,S),t.bezierCurveTo(k-v,S-L.qn*w,k-L.qn*v,S-w,k,S-w),t.closePath(),n!==null&&t.fillContext(n,!1,null),s!==null&&(c&&u&&t.shadowsOff(),t.strokeContext(),c&&u&&t.shadowsOn()),t.endPath()}else if(o.type===4){const m=o.figures,g=m.length;for(let p=0;p<g;p++){const b=m.r[p];i?(t.beginPath(),this.kD(t,b)):b.ji===null&&(b.ji=new Path2D,this.kD(b.ji,b));const v=b.isFilled;u?b.isShadowed?(v===!0&&n!=="transparent"&&n!==null&&t.fillContext(n,b.isEvenOdd,b.ji),s!==null&&(v&&c&&t.shadowsOff(),t.stroke(b.ji),v&&c&&t.shadowsOn())):(t.shadowsOff(),v&&n!=="transparent"&&n!==null&&t.fillContext(n,b.isEvenOdd,b.ji),s!==null&&t.stroke(b.ji),t.shadowsOn()):(v&&n!==null&&t.fillContext(n,b.isEvenOdd,b.ji),s!==null&&t.stroke(b.ji)),t.endPath(p)}}d&&t.disableDash(),this._I(t,e)}kD(t,e){t.moveTo(e.startX,e.startY);const i=e.segments.r,s=i.length;let n=null;for(let o=0;o<s;o++){const r=i[o];switch(r.type){case 1:t.moveTo(r.endX,r.endY);break;case 2:t.lineTo(r.endX,r.endY);break;case 3:t.bezierCurveTo(r.point1X,r.point1Y,r.point2X,r.point2Y,r.endX,r.endY);break;case 4:t.quadraticCurveTo(r.point1X,r.point1Y,r.endX,r.endY);break;case 5:if(r.radiusX===r.radiusY){const a=n!==null?n.endX:e.startX,l=n!==null?n.endY:e.startY,h=Math.PI/180;t.arc(r.point1X,r.point1Y,r.radiusX,r.startAngle*h,(r.startAngle+r.sweepAngle)*h,r.sweepAngle<0,a,l)}else{const a=r.Fo(e),l=a.length;if(l===0){t.lineTo(r.centerX,r.centerY);break}for(let h=0;h<l;h++){const u=a[h];h===0&&t.lineTo(u[0],u[1]),t.bezierCurveTo(u[2],u[3],u[4],u[5],u[6],u[7])}}break;case 6:{let a=0,l=0,h;if(n!==null&&n.type===5){h=n.Fo(e);const c=h.length;if(c===0){t.lineTo(r.endX,r.endY);break}const d=h[c-1]||null;d!==null&&(a=d[6],l=d[7])}else a=n!==null?n.endX:e.startX,l=n!==null?n.endY:e.startY;h=r.Za(e,a,l);const u=h.length;if(u===0){t.lineTo(r.endX,r.endY);break}for(let c=0;c<u;c++){const d=h[c];t.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}break}}r.isClosed&&t.closePath(),n=r}}wf(t,e,i){if(!super.wf(t,e,i)||this.Qe===null&&this.Hh===null||this.ut===null||this.pathPattern!==null)return!1;const s=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==s.length?!1:(t.currentPath=this.svg,this.Ma(t,e),t.currentPath=null,!0)}Pd(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.Pd(t)}LN(t,e){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",e);else{const i=t.getElementsByTagName("path");for(let s=0;s<i.length;s++)i[s].setAttributeNS(null,"filter",e)}}getDocumentPoint(t,e){if(e===void 0&&(e=new P),t instanceof T){const i=t;i.isNoSpot()&&y.o("getDocumentPoint Spot must be a real, specific Spot, not: "+i.toString());const s=this.naturalBounds,n=this.strokeWidth;return e.e(i.x*(s.width+n)-n/2+s.x+i.offsetX,i.y*(s.height+n)-n/2+s.y+i.offsetY),this.Js.gt(e),e}else return e.set(t),this.Js.gt(e),e}getDocumentBounds(t){t===void 0&&(t=new I);const e=this.naturalBounds,i=this.Js,s=I.z(e.x,e.y,e.width,e.height),n=this.strokeWidth;s.inflate(n/2,n/2);const o=P.z(s.x,s.y).v(i);return t.e(o.x,o.y,0,0),o.e(s.right,s.y).v(i),t.re(o.x,o.y,0,0),o.e(s.right,s.bottom).v(i),t.re(o.x,o.y,0,0),o.e(s.x,s.bottom).v(i),t.re(o.x,o.y,0,0),I.i(s),P.i(o),t}ka(t,e){const i=this.geometry;if(i===null||this.fill===null&&this.stroke===null)return!1;const s=i.bounds;let n=this.strokeWidth/2;i.type===1&&!e&&(n+=2);const o=I.l();if(o.h(s),o.inflate(n+2,n+2),!o.containsPoint(t))return I.i(o),!1;const r=n+1e-4;if(i.type===1){if(this.stroke===null)return!1;const a=(i.startX-i.endX)*(t.x-i.endX)+(i.startY-i.endY)*(t.y-i.endY),l=(i.endX-i.startX)*(t.x-i.startX)+(i.endY-i.startY)*(t.y-i.startY);return a<0||l<0?!1:(I.i(o),L.Ve(i.startX,i.startY,i.endX,i.endY,n,t.x,t.y))}else if(i.type===2){const a=i.startX,l=i.startY,h=i.endX,u=i.endY;if(o.x=Math.min(a,h),o.y=Math.min(l,u),o.width=Math.abs(h-a),o.height=Math.abs(u-l),this.fill===null){if(o.inflate(-r,-r),o.containsPoint(t))return I.i(o),!1;o.inflate(r,r)}this.stroke!==null&&o.inflate(n,n);const c=o.containsPoint(t);return I.i(o),c}else if(i.type===3){const a=i.startX,l=i.startY,h=i.endX,u=i.endY;let c=Math.min(a,h),d=Math.min(l,u);const f=Math.abs(h-a),m=Math.abs(u-l);let g=f/2,p=m/2;if(c=t.x-(c+g),d=t.y-(d+p),this.fill===null){if(g-=r,p-=r,g<=0||p<=0||c*c/(g*g)+d*d/(p*p)<=1)return I.i(o),!1;g+=r,p+=r}return this.stroke!==null&&(g+=r,p+=r),I.i(o),g<=0||p<=0?!1:c*c/(g*g)+d*d/(p*p)<=1}else{if(i.type===4)return I.i(o),this.fill===null?i.ZL(t.x,t.y,n):i.VP(t,n,this.strokeWidth>1,e);y.o("Unknown Geometry type: "+i.type)}}bd(t,e,i,s){const n=this.desiredSize,o=this.Qo;t=Math.max(t,0),e=Math.max(e,0);let r;if(this.en!==null)r=this.geometry.bounds;else{const m=this.figure;let g=et.iC[m];if(g===void 0){let p=L.Jn[m];typeof p=="string"&&(p=L.Jn[p]),y.st(p)?(g=p(null,100,100),et.iC[m]=g):y.o("Unsupported Figure: "+m)}r=g.bounds}let a=r.width,l=r.height,h=r.width,u=r.height;switch(this.Qs(!0)){case 0:i=0,s=0;break;case 2:h=Math.max(t-o,0),u=Math.max(e-o,0);break;case 5:h=Math.max(t-o,0),s=0;break;case 4:i=0,u=Math.max(e-o,0);break}isFinite(n.width)&&(h=n.width),isFinite(n.height)&&(u=n.height);const c=this.maxSize,d=this.minSize;i=Math.max(i-o,d.width),s=Math.max(s-o,d.height),h=Math.min(c.width,h),u=Math.min(c.height,u),h=isFinite(h)?Math.max(i,h):Math.max(a,i),u=isFinite(u)?Math.max(s,u):Math.max(l,s);const f=this._S();switch(f){case 0:break;case 2:a=h,l=u;break;case 6:{let m=Math.min(h/a,u/l);isFinite(m)||(m=1),a=a*m,l=l*m;break}default:y.o(f+" is not a valid geometryStretch.")}if(this.en!==null){a===0&&(a=.001),l===0&&(l=.001);const m=this.en.sR(a,l);this.ut=m}else(this.ut===null||!L.X(this.ut.Sc,t-o)||!L.X(this.ut.Mc,e-o))&&(this.ut=et.iE(this,a,l));r=this.ut.bounds,t===1/0||e===1/0?this.lo(r.x-o/2,r.y-o/2,t===0&&a===0?0:r.width+o,e===0&&l===0?0:r.height+o):this.lo(-(o/2),-(o/2),h+o,u+o),n.isReal()?(h=n.width,u=n.height,h=Math.min(c.width,h),u=Math.min(c.height,u),h=Math.max(d.width,h),u=Math.max(d.height,u),this.Ke.e(0,0,h,u)):this.Ke.h(r)}_S(){const t=this.geometryStretch;return this.en!==null?t===1?2:t:t===1?et.iC[this.figure].defaultStretch:t}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}getNearestIntersectionPoint(t,e,i){return this.pf(t.x,t.y,e.x,e.y,i)}pf(t,e,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,l=-o.m12*r,h=-o.m21*r,u=o.m11*r,c=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),f=t*a+e*h+c,m=t*l+e*u+d,g=i*a+s*h+c,p=i*l+s*u+d,b=this.Qo/2;let v=this.ut;v===null&&(this.ht(1/0,1/0),v=this.ut);const w=v.bounds;let k=!1;if(v.type===1)if(this.strokeWidth<=1.5)k=L.vo(v.startX,v.startY,v.endX,v.endY,f,m,g,p,n);else{let S=0,N=0;if(v.startX===v.endX)S=b,N=0;else{const F=(v.endY-v.startY)/(v.endX-v.startX);N=b/Math.sqrt(1+F*F),S=N*F}const D=y.nt();let A=new P;L.vo(v.startX+S,v.startY+N,v.endX+S,v.endY+N,f,m,g,p,A)&&D.push(A),A=new P,L.vo(v.startX-S,v.startY-N,v.endX-S,v.endY-N,f,m,g,p,A)&&D.push(A),A=new P,L.vo(v.startX+S,v.startY+N,v.startX-S,v.startY-N,f,m,g,p,A)&&D.push(A),A=new P,L.vo(v.endX+S,v.endY+N,v.endX-S,v.endY-N,f,m,g,p,A)&&D.push(A);const M=D.length;if(M===0)return y.Z(D),!1;k=!0;let C=1/0;for(let F=0;F<M;F++){const O=D[F],E=(O.x-f)**2+(O.y-m)**2;E<C&&(C=E,n.x=O.x,n.y=O.y)}y.Z(D)}else if(v.type===2)k=L.Cl(w.x-b,w.y-b,w.x+w.width+b,w.y+w.height+b,f,m,g,p,n);else if(v.type===3){const S=I.z(w.x,w.y,w.width,w.height).inflate(b,b);k=this.sE(S,f,m,g,p,n),I.i(S)}else if(v.type===4){let S=0,N=0,D=0,A=0;const M=P.l();let C=g-f,F=p-m,O=C*C+F*F,E=f,B=m;if(O>0&&w.contains(E,B)&&(M.x=E,M.y=B,this.containsPoint(M)))for(C!==0&&Math.abs(C)<.5?(F*=.5/C,C=.5):F!==0&&Math.abs(F)<.5&&(C*=.5/F,F=.5),E-=C,B-=F;w.contains(E,B);)E-=C,B-=F;const z=.6;n.x=g,n.y=p;for(let nt=0;nt<v.figures.count;nt++){const $=v.figures.r[nt],it=$.isFilled?E:f,Q=$.isFilled?B:m,rt=$.segments;S=$.startX,N=$.startY;let ut=S,gt=N;for(let vt=0;vt<rt.count;vt++){const Z=rt.r[vt],xt=Z.type;D=Z.endX,A=Z.endY;let mt=!1;switch(xt){case 1:ut=D,gt=A;break;case 2:mt=this._1(S,N,D,A,it,Q,g,p,M);break;case 3:{mt=L.om(S,N,Z.point1X,Z.point1Y,Z.point2X,Z.point2Y,D,A,it,Q,g,p,z,M);break}case 4:{mt=L.om(S,N,S+2/3*(Z.point1X-S),N+2/3*(Z.point1Y-N),D+2/3*(Z.point1X-D),A+2/3*(Z.point1Y-A),D,A,it,Q,g,p,z,M);break}case 5:case 6:{const Ft=Z.type===5?Z.Fo($):Z.Za($,S,N),ot=Ft.length;if(ot===0){mt=this._1(S,N,Z.type===5?Z.centerX:Z.endX,Z.type===5?Z.centerY:Z.endY,it,Q,g,p,M);break}let q=null;for(let ct=0;ct<ot;ct++){if(q=Ft[ct],ct===0&&this._1(S,N,q[0],q[1],it,Q,g,p,M)){const kt=this.tk(it,Q,M,O,n);kt<O&&(O=kt,k=!0)}if(L.om(q[0],q[1],q[2],q[3],q[4],q[5],q[6],q[7],it,Q,g,p,z,M)){const kt=this.tk(it,Q,M,O,n);kt<O&&(O=kt,k=!0)}}D=q[6],A=q[7];break}default:y.o("Unknown Segment type: "+xt)}if(S=D,N=A,mt){const Ft=this.tk(it,Q,M,O,n);Ft<O&&(O=Ft,k=!0)}if(Z.isClosed&&(D=ut,A=gt,this._1(S,N,D,A,it,Q,g,p,M))){const Ft=this.tk(it,Q,M,O,n);Ft<O&&(O=Ft,k=!0)}}}let V=i-t,Y=s-e;const _=Math.sqrt(V*V+Y*Y);_!==0&&(V/=_,Y/=_),n.x-=V*b,n.y-=Y*b,P.i(M)}else y.o("Unknown Geometry type: "+v.type);return k?(this.v.gt(n),!0):!1}tk(t,e,i,s,n){const o=i.x-t,r=i.y-e,a=o*o+r*r;return a<s?(n.x=i.x,n.y=i.y,a):s}_1(t,e,i,s,n,o,r,a,l){if(L.X(t,i)&&L.X(e,s)||L.X(n,r)&&L.X(o,a))return!1;let h=!1;const u=(n-r)*(e-s)-(o-a)*(t-i);if(u===0)return!1;if(l.x=((n*a-o*r)*(t-i)-(n-r)*(t*s-e*i))/u,l.y=((n*a-o*r)*(e-s)-(o-a)*(t*s-e*i))/u,(t>i?t-i:i-t)<(e>s?e-s:s-e)){const c=e<s?e:s,d=e<s?s:e;(l.y>c||L.X(l.y,c))&&(l.y<d||L.X(l.y,d))&&(h=!0)}else{const c=t<i?t:i,d=t<i?i:t;(l.x>c||L.X(l.x,c))&&(l.x<d||L.X(l.x,d))&&(h=!0)}return h}nE(t,e,i){return this.pickable===!1?!1:(i.kc(this.v),e?this.oE(t,i):this.containedInRect(t,i))}containedInRect(t,e){if(e===void 0)return t.containsRect(this.actualBounds);let i=this.ut;i===null&&(this.ht(1/0,1/0),i=this.ut);const s=i.bounds,n=this.strokeWidth/2;let o=!1;const r=P.l();return r.e(s.x-n,s.y-n),t.containsPoint(e.gt(r))&&(r.e(s.x-n,s.bottom+n),t.containsPoint(e.gt(r))&&(r.e(s.right+n,s.bottom+n),t.containsPoint(e.gt(r))&&(r.e(s.right+n,s.y-n),t.containsPoint(e.gt(r))&&(o=!0)))),P.i(r),o}intersectsRect(t,e){if(this.containedInRect(t,e)||e===void 0&&(e=this.v,t.containsRect(this.actualBounds)))return!0;const i=wt.l();i.set(e),i.ex();const s=t.left,n=t.right,o=t.top,r=t.bottom,a=P.l();if(a.e(s,o),i.gt(a),this.ka(a,!0)||(a.e(n,o),i.gt(a),this.ka(a,!0))||(a.e(s,r),i.gt(a),this.ka(a,!0))||(a.e(n,r),i.gt(a),this.ka(a,!0)))return P.i(a),!0;const l=P.l(),h=P.l();i.set(e),i.zL(this.v),i.ex(),l.x=n,l.y=o,l.v(i),a.x=s,a.y=o,a.v(i);let u=!1;return this.qh(a,l,h)?u=!0:(a.x=n,a.y=r,a.v(i),this.qh(a,l,h)?u=!0:(l.x=s,l.y=r,l.v(i),this.qh(a,l,h)?u=!0:(a.x=s,a.y=o,a.v(i),this.qh(a,l,h)&&(u=!0)))),P.i(a),wt.i(i),P.i(l),P.i(h),u}qh(t,e,i){if(!this.getNearestIntersectionPoint(t,e,i))return!1;const s=t.x,n=t.y,o=e.x,r=e.y,a=i.x,l=i.y;if(s===o){let h=0,u=0;return n<r?(h=n,u=r):(h=r,u=n),l>=h&&l<=u}else{let h=0,u=0;return s<o?(h=s,u=o):(h=o,u=s),a>=h&&a<=u}}oE(t,e){if(this.containedInRect(t,e)||e===void 0&&(e=this.v,t.containsRect(this.actualBounds)))return!0;const i=t.left,s=t.right,n=t.top,o=t.bottom,r=P.l(),a=P.l(),l=P.l(),h=wt.l();h.set(e),h.zL(this.v),h.ex(),a.x=s,a.y=n,a.v(h),r.x=i,r.y=n,r.v(h);let u=!1;return this.qh(r,a,l)?u=!0:(r.x=s,r.y=o,r.v(h),this.qh(r,a,l)?u=!0:(a.x=i,a.y=o,a.v(h),this.qh(r,a,l)?u=!0:(r.x=i,r.y=n,r.v(h),this.qh(r,a,l)&&(u=!0)))),wt.i(h),P.i(r),P.i(a),P.i(l),u}$T(t,e,i){if(i&&this.fill!==null&&this.ka(t,!0))return!0;let s=t.distanceSquaredPoint(e);const n=s;this.strokeWidth>1.5&&(s=this.strokeWidth/2+Math.sqrt(s),s*=s);let o=this.ut;if(o===null&&(this.ht(1/0,1/0),o=this.ut,o===null))return!1;if(!i){const c=o.bounds,d=c.x,f=c.y,m=c.x+c.width,g=c.y+c.height;if(P.distanceSquared(t.x,t.y,d,f)<=s&&P.distanceSquared(t.x,t.y,m,f)<=s&&P.distanceSquared(t.x,t.y,d,g)<=s&&P.distanceSquared(t.x,t.y,m,g)<=s)return!0}function r(c,d){const f=c.length;for(let m=0;m<f;m+=2)if(d.distanceSquared(c[m],c[m+1])>s)return!0;return!1}const a=o.startX,l=o.startY,h=o.endX,u=o.endY;if(o.type===1){const c=P.distanceLineSegmentSquared(t.x,t.y,a,l,h,u),d=(h-a)*(t.x-a)+(u-l)*(t.y-l),f=(a-h)*(t.x-h)+(l-u)*(t.y-u),m=d>=0&&f>=0?s:n;return c<=m}else if(o.type===2){let c=!1;return i&&(c=P.distanceLineSegmentSquared(t.x,t.y,a,l,a,u)<=s||P.distanceLineSegmentSquared(t.x,t.y,a,l,h,l)<=s||P.distanceLineSegmentSquared(t.x,t.y,h,l,h,u)<=s||P.distanceLineSegmentSquared(t.x,t.y,a,u,h,u)<=s),c}else if(o.type===3){const c=(a+h)/2,d=(l+u)/2,f=t.x-c,m=t.y-d,g=Math.abs(h-a)/2,p=Math.abs(u-l)/2;if(g===0||p===0)return P.distanceLineSegmentSquared(t.x,t.y,a,l,h,u)<=s;if(i){const b=L.WF(g,p,f,m);return b*b<=s}else return!(P.distanceSquared(f,m,-g,0)>=s||P.distanceSquared(f,m,0,-p)>=s||P.distanceSquared(f,m,0,p)>=s||P.distanceSquared(f,m,g,0)>=s)}else if(o.type===4){const c=o.bounds,d=c.x,f=c.y,m=c.x+c.width,g=c.y+c.height;if(t.x>m&&t.x<d&&t.y>g&&t.y<f&&P.distanceLineSegmentSquared(t.x,t.y,d,f,d,g)>s&&P.distanceLineSegmentSquared(t.x,t.y,d,f,m,f)>s&&P.distanceLineSegmentSquared(t.x,t.y,m,g,d,g)>s&&P.distanceLineSegmentSquared(t.x,t.y,m,g,m,f)>s)return!1;const p=Math.sqrt(s);if(i){if(this.fill===null?o.ZL(t.x,t.y,p):o.VP(t,p,!0,!1))return!0}else{const b=o.figures;for(let v=0;v<b.count;v++){const w=b.r[v];let k=w.startX,S=w.startY;if(t.distanceSquared(k,S)>s)return!1;const N=w.segments.r,D=N.length;for(let A=0;A<D;A++){const M=N[A];switch(M.type){case 1:case 2:if(k=M.endX,S=M.endY,t.distanceSquared(k,S)>s)return!1;break;case 3:{const C=y.nt();L.Wn(k,S,M.point1X,M.point1Y,M.point2X,M.point2Y,M.endX,M.endY,.8,C);const F=r(C,t);if(y.Z(C),F||(k=M.endX,S=M.endY,t.distanceSquared(k,S)>s))return!1;break}case 4:{const C=y.nt();L.nm(k,S,M.point1X,M.point1Y,M.endX,M.endY,.8,C);const F=r(C,t);if(y.Z(C),F||(k=M.endX,S=M.endY,t.distanceSquared(k,S)>s))return!1;break}case 5:case 6:{const C=M.type===5?M.Fo(w):M.Za(w,k,S),F=C.length;if(F===0){if(k=M.type===5?M.centerX:M.endX,S=M.type===5?M.centerY:M.endY,t.distanceSquared(k,S)>s)return!1;break}let O=null;const E=y.nt();for(let B=0;B<F;B++)if(O=C[B],E.length=0,L.Wn(O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],.8,E),r(E,t))return y.Z(E),!1;y.Z(E),O!==null&&(k=O[6],S=O[7]);break}default:y.o("Unknown Segment type: "+M.type)}}}return!0}}return!1}sE(t,e,i,s,n,o){if(t.width===0)return L.vo(t.x,t.y,t.x,t.y+t.height,e,i,s,n,o);if(t.height===0)return L.vo(t.x,t.y,t.x+t.width,t.y,e,i,s,n,o);{const r=t.width/2,a=t.height/2,l=t.x+r,h=t.y+a;let u=9999;if(e!==s&&(u=(i-n)/(e-s)),Math.abs(u)<9999){const c=i-h-u*(e-l);if(r*r*(u*u)+a*a-c*c<0)return o.x=NaN,o.y=NaN,!1;const d=Math.sqrt(r*r*(u*u)+a*a-c*c),f=(-(r*r*u*c)+r*a*d)/(a*a+r*r*(u*u))+l,m=(-(r*r*u*c)-r*a*d)/(a*a+r*r*(u*u))+l,g=u*(f-l)+c+h,p=u*(m-l)+c+h,b=Math.abs((e-f)**2)+Math.abs((i-g)**2),v=Math.abs((e-m)**2)+Math.abs((i-p)**2);b<v?(o.x=f,o.y=g):(o.x=m,o.y=p)}else{const c=a*a,d=r*r,f=e-l,m=c-c/d*(f*f);if(m<0)return o.x=NaN,o.y=NaN,!1;const g=Math.sqrt(m),p=h+g,b=h-g,v=Math.abs(p-i),w=Math.abs(b-i);v<w?(o.x=e,o.y=p):(o.x=e,o.y=b)}return!0}}qI(){return this.Qo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ut!==null?this.ut:this.en}set geometry(t){const e=this.ut,i=this.en;if(e===t)return;t!==null?(this.ut=t.k(),this.en=this.ut):(this.ut=null,this.en=null);const s=this.part;if(s!==null&&s.Df(),this.c(),this.t("geometry",e||i,t),this.mf()){const n=this.part;n!==null&&this.Eh(n,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const e=yt.parse(t),i=e.normalize();this.geometry=e;const s=P.z(-i.x,-i.y);this.position=s,P.i(s)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const e=(this.n&1048576)!==0;e!==t&&(this.n=this.n^1048576,this.c(),this.t("isGeometryPositioned",e,t))}ai(){this.ut=null}get fill(){return this.Hh}set fill(t){const e=this.Hh;e!==t&&(t!==null&&R.Md(t,"Shape.fill"),t instanceof R&&t.k(),this.Hh=t,this.C(),this.t("fill",e,t))}get stroke(){return this.Qe}set stroke(t){const e=this.Qe;e!==t&&(t!==null&&R.Md(t,"Shape.stroke"),t instanceof R&&t.k(),this.Qe=t,this.C(),this.t("stroke",e,t))}get strokeWidth(){return this.Qo}set strokeWidth(t){const e=this.Qo;if(e!==t)if(t>=0){this.Qo=t,this.c();const i=this.part;i!==null&&i.Df(),this.t("strokeWidth",e,t)}else y.J(t,"value >= 0",et,"strokeWidth:value")}jp(){return this.Qo}get strokeCap(){return this.Kt!==null?this.Kt.Y0:"butt"}set strokeCap(t){const e=this.strokeCap;e!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.jh().Y0=t,this.C(),this.t("strokeCap",e,t)):y.J(t,'"butt", "round", or "square"',et,"strokeCap"))}get strokeJoin(){return this.Kt!==null?this.Kt.K0:"miter"}set strokeJoin(t){const e=this.strokeJoin;e!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.jh().K0=t,this.C(),this.t("strokeJoin",e,t)):y.J(t,'"miter", "bevel", or "round"',et,"strokeJoin"))}get strokeMiterLimit(){return this.Kt!==null?this.Kt.H0:10}set strokeMiterLimit(t){const e=this.strokeMiterLimit;if(e!==t&&t>=1){this.jh().H0=t,this.C();const i=this.part;i!==null&&i.Df(),this.t("strokeMiterLimit",e,t)}}get strokeDashArray(){return this.Wo}set strokeDashArray(t){const e=this.Wo;if(e!==t){if(t!==null&&!Array.isArray(t)&&y.si(t,"Array",et,"strokeDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(!(o>=0)||!isFinite(o))&&y.o("strokeDashArray:value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.Wo=t,this.C(),this.t("strokeDashArray",e,t)}}get strokeDashOffset(){return this.Kt!==null?this.Kt.Ca:0}set strokeDashOffset(t){const e=this.strokeDashOffset;e!==t&&t>=0&&(this.jh().Ca=t,this.C(),this.t("strokeDashOffset",e,t))}get figure(){return this.zd}set figure(t){const e=this.zd;if(e!==t){let i=L.Jn[t];if(y.st(i)?i=t:(i=L.Jn[t.toLowerCase()],(!i||typeof i=="function")&&y.o("Unknown Shape.figure: "+t)),e!==i){const s=this.part;s!==null&&s.Df(),this.zd=i,this.en=null,this.ai(),this.c(),this.t("figure",e,i)}}}get toArrow(){return this.Ot!==null?this.Ot.j0:"None"}set toArrow(t){const e=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),e!==t){const i=et.PD(t);i===null?y.o("Unknown Shape.toArrow: "+t):e!==i&&(this.Ot===null&&(this.Ot=new we),this.Ot.j0=i,this.en=null,this.ai(),this.c(),this.SD(i),this.t("toArrow",e,i))}}get fromArrow(){return this.Ot!==null?this.Ot.q0:"None"}set fromArrow(t){const e=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),e!==t){const i=et.PD(t);i===null?y.o("Unknown Shape.fromArrow: "+t):e!==i&&(this.Ot===null&&(this.Ot=new we),this.Ot.q0=i,this.en=null,this.ai(),this.c(),this.SD(i),this.t("fromArrow",e,i))}}SD(t){const e=this.diagram;e!==null&&e.undoManager.isUndoingRedoing||(this.mI(),this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=T.Right):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=T.Left))}get spot1(){return this.Kt!==null?this.Kt.$n:T.Default}set spot1(t){const e=this.spot1;e.equals(t)||(t=t.N(),this.jh().$n=t,this.c(),this.t("spot1",e,t))}get spot2(){return this.Kt!==null?this.Kt.Zn:T.Default}set spot2(t){const e=this.spot2;e.equals(t)||(t=t.N(),this.jh().Zn=t,this.c(),this.t("spot2",e,t))}get parameter1(){return this.Xd}set parameter1(t){const e=this.Xd;e!==t&&(this.Xd=t,this.ai(),this.c(),this.t("parameter1",e,t))}get parameter2(){return this.Gd}set parameter2(t){const e=this.Gd;e!==t&&(this.Gd=t,this.ai(),this.c(),this.t("parameter2",e,t))}get naturalBounds(){return this.Ke}EI(){const t=this.desiredSize;if(!t.isReal()&&this.ut!==null){const e=this.ut.bounds;this.Ke.h(e)}else this.Ke.e(0,0,t.width,t.height)}get pathPattern(){return this.Kt!==null?this.Kt.W0:null}set pathPattern(t){const e=this.pathPattern;e!==t&&(this.jh().W0=t,this.C(),this.t("pathPattern",e,t))}get geometryStretch(){return this.Kt!==null?this.Kt.J0:1}set geometryStretch(t){const e=this.geometryStretch;e!==t&&(this.jh().J0=t,this.c(),this.t("geometryStretch",e,t))}get interval(){return this.K!==null?this.K.Ff:1}set interval(t){const e=this.interval;if(t=Math.round(t),e!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new le),this.K.Ff=t;const i=this.diagram;i!==null&&this.panel===i.grid&&i.ca(),this.c();const s=this.panel;s!==null&&(s.ds=null),this.t("interval",e,t)}}get graduatedStart(){return this.K!==null?this.K.Rf:0}set graduatedStart(t){const e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new le),this.K.Rf=t,this.c(),this.t("graduatedStart",e,t))}get graduatedEnd(){return this.K!==null?this.K.Of:1}set graduatedEnd(t){const e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new le),this.K.Of=t,this.c(),this.t("graduatedEnd",e,t))}get graduatedSkip(){return this.K!==null?this.K.If:null}set graduatedSkip(t){const e=this.graduatedSkip;e!==t&&(t!==null&&y.S(t,et,"graduatedSkip"),this.K===null&&(this.K=new le),this.K.If=t,this.c(),this.t("graduatedSkip",e,t))}polygonContainsRect(t){const e=this;if(!e.part||!e.part.actualBounds.containsRect(t))return!1;const i=e.geometry;if(!i)return!1;const s=t.x,n=t.y,o=t.width,r=t.height,a=P.l();if(a.x=s,a.y=n,e.getLocalPoint(a,a),!i.containsPoint(a)||o>0&&r>0&&(a.x=s+o,a.y=n+r,e.getLocalPoint(a,a),!i.containsPoint(a))||o>0&&(a.x=s+o,a.y=n,e.getLocalPoint(a,a),!i.containsPoint(a))||r>0&&(a.x=s,a.y=n+r,e.getLocalPoint(a,a),!i.containsPoint(a))||i.type===1)return!1;if(i.type===4){const l=i.figures.iterator;for(;l.next();){const h=l.value;if(!h.isFilled)continue;a.x=h.startX,a.y=h.startY,e.getDocumentPoint(a,a);let u=a.x,c=a.y,d=u,f=c,m=u,g=c;const p=h.segments.iterator;for(;p.next();){const b=p.value;if(a.x=b.endX,a.y=b.endY,e.getDocumentPoint(a,a),m=a.x,g=a.y,b.type===1)u=m,c=g;else if(b.type!==5&&(I.intersectsLineSegment(s,n,o,r,d,f,m,g)||b.isClosed&&I.intersectsLineSegment(s,n,o,r,m,g,u,c)))return!1;d=m,f=g}}}return P.i(a),!0}static iE(t,e,i){let s=null;if(t.toArrow!=="None")s=et.Dn[t.toArrow];else if(t.fromArrow!=="None")s=et.Dn[t.fromArrow];else{let n=L.Jn[t.figure];typeof n=="string"&&(n=L.Jn[n]),n===void 0&&y.o("Unknown Shape.figure: "+t.figure),s=n(t,e,i),s.Sc=e,s.Mc=i}if(s===null){const n=L.Jn.Rectangle;y.st(n)&&(s=n(t,e,i))}return s}static getFigureGenerators(){const t=new bt;for(const e in L.Jn){if(e===e.toLowerCase())continue;const i=L.Jn[e];t.set(e,i)}return t.k(),t}static defineFigureGenerator(t,e){y.s(t,"string",et,"defineFigureGenerator:name"),typeof e=="string"||y.S(e,et,"defineFigureGenerator:func");const i=t.toLowerCase(),s=L.Jn;s[t]=e,s[i]=t}static isFigureDefined(t){return t in L.Jn}static getArrowheadGeometries(){const t=new bt;for(const e in L.lm)if(et.Dn[e]===void 0){const i=yt.parse(L.lm[e],!1);et.Dn[e]=i;const s=e.toLowerCase();s!==e&&(et.Dn[s]=e)}for(const e in et.Dn){if(e===e.toLowerCase())continue;const i=et.Dn[e];i instanceof yt&&t.set(e,i)}return t.k(),t}static defineArrowheadGeometry(t,e){y.s(t,"string",et,"defineArrowheadGeometry:name");let i=null;typeof e=="string"?(y.s(e,"string",et,"defineArrowheadGeometry:pathstr"),i=yt.parse(e,!1)):i=e;const s=t.toLowerCase();(s==="none"||t===s)&&y.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const n=et.Dn;n[t]=i,n[s]=t}static isArrowheadDefined(t){return et.Dn.has(t)}static Dn=new Zt;static iC=new Zt;static PD(t){let e=et.Dn[t];if(e===void 0){const i=t.toLowerCase();if(i==="none")return"None";if(e=et.Dn[i],e===void 0){let s=null;for(const n in L.lm)if(n.toLowerCase()===i){s=n;break}if(s!==null){const n=yt.parse(L.lm[s],!1);return et.Dn[s]=n,i!==s&&(et.Dn[i]=s),s}}}return typeof e=="string"?e:e instanceof yt?t:null}}class di{me;Y0;K0;H0;Ca;W0;J0;$n;Zn;constructor(){this.me=!1,this.Y0="butt",this.K0="miter",this.H0=10,this.Ca=0,this.W0=null,this.J0=1,this.$n=T.Default,this.Zn=T.Default}copy(){const t=new di;return t.Y0=this.Y0,t.K0=this.K0,t.H0=this.H0,t.Ca=this.Ca,t.W0=this.W0,t.J0=this.J0,t.$n=this.$n.N(),t.Zn=this.Zn.N(),t}}var fi=(x=>(x[x.None=0]="None",x[x.Fit=1]="Fit",x[x.DesiredSize=2]="DesiredSize",x[x.BreakAll=3]="BreakAll",x))(fi||{}),us=(x=>(x[x.Clip=0]="Clip",x[x.Ellipsis=1]="Ellipsis",x))(us||{}),gi=(x=>(x[x.Trim=0]="Trim",x[x.None=1]="None",x))(gi||{});class lt extends tt{ue;Qe;vn;Pi;pe;qp;Kd;K;tt;Xl;go;Fn;Ii;ye;Rn;constructor(t,e){return super(),lt.M0===!1&&(lt.M0=!0,lt.us=X.isUsingDOM()?new xe(null)._t:null),this.n|=2097152,this.ue="",this.Qe="black",this.vn="13px sans-serif",this.Pi=0,this.pe=0,this.qp=0,this.Kd=null,this.K=null,this.tt=null,this.Xl=0,this.go=null,this.Fn=0,this.Ii=null,this.ye=null,this.Rn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),e&&Object.assign(this,e),this}cloneProtected(t){super.cloneProtected(t),t.ue=this.ue,t.Qe=this.Qe,t.vn=this.vn,t.Pi=this.Pi,t.pe=this.pe,t.qp=this.qp,t.Kd=this.Kd,this.K!==null&&(t.K=this.K.copy()),this.tt!==null&&(this.tt.me?t.tt=this.tt:t.tt=this.tt.copy()),t.Xl=this.Xl,t.go=this.go,t.Fn=this.Fn,t.Ii=this.Ii,t.ye=this.ye,t.Rn=this.Rn}Os(){return this.tt===null?this.tt=new mi:this.tt.me&&(this.tt=this.tt.copy()),this.tt}ba(){super.ba(),this.tt!==null&&(this.tt.me=!0)}YI(t){this.n=t.n|2048|4096,this.Zt=t.opacity,this.Lt=t.background,this.cs=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),t.Se!==null?this.Se=t.Se.copy():this.Se=null,this.it=t.scale,this.Xt=t.angle,this.stretch=t.stretch,this.sl=t.margin.N(),this.de=t.alignment.N(),this.wd=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,t.he!==null&&(this.he=t.he.copy()),this.shadowVisible=t.shadowVisible,this.ue=t.ue,this.Qe=t.Qe,this.vn=t.vn,this.K!==null&&(this.K=t.K.copy()),t.tt!==null&&(t.tt.me?this.tt=t.tt:this.tt=t.tt.copy()),this.Xl=t.Xl}XI(t){if(this.ue=t.text||"",this.Xt=t.labelAngle||0,this.Pi=t.lineCount||0,this.rE(t.lines),t.naturalBounds&&(this.Ke=t.naturalBounds),t.actualBounds){const e=t.actualBounds;this.Ut(e.x,e.y,e.width,e.height)}}fe(t){t in fi?this.wrap=t:super.fe(t)}toString(){return this.ue.length>22?'TextBlock("'+this.ue.substring(0,20)+'"...)':'TextBlock("'+this.ue+'")'}static getEllipsis(){return lt.$0}static setEllipsis(t){lt.$0=t,lt.ek=new Zt,lt.sC=0}static getBaseline(){return lt.ik}static setBaseline(t){lt.ik=t}static ik=null;static getUnderline(){return lt.sk}static setUnderline(t){lt.sk=t}static sk=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;c(){super.c(),this.$i(!0)}get font(){return this.vn}set font(t){const e=this.vn;e!==t&&(this.vn=t,this.go=null,this.c(),this.t("font",e,t))}static isValidFont(t){return H.CSS?H.CSS.supports("font",t):!0}get text(){return this.ue}set text(t){const e=this.ue;t!=null?t=t.toString():t="",e!==t&&(this.ue=t,this.c(),this.t("text",e,t))}get textAlign(){return this.tt!==null?this.tt.Z0:"start"}set textAlign(t){const e=this.textAlign;e!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.Os().Z0=t,this.C(),this.t("textAlign",e,t))}get flip(){return this.tt!==null?this.tt.mo:0}set flip(t){const e=this.flip;e!==t&&(this.Os().mo=t,this.C(),this.t("flip",e,t))}get verticalAlignment(){return this.tt!==null?this.tt.hl:T.Top}set verticalAlignment(t){const e=this.verticalAlignment;e.equals(t)||(t=t.N(),this.Os().hl=t,this.Pf(),this.t("verticalAlignment",e,t))}get naturalBounds(){if(!this.Ke.isReal()){const t=st.l();this.nC(this.ue,999999,t);let e=t.width;st.i(t);let i=this.MD(e);const s=this.desiredSize;isNaN(s.width)||(e=s.width),isNaN(s.height)||(i=s.height),this.Ke.jn(e,i)}return this.Ke}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const e=(this.n&2097152)!==0;e!==t&&(this.n=this.n^2097152,this.c(),this.t("isMultiline",e,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const e=(this.n&4194304)!==0;e!==t&&(this.n=this.n^4194304,this.$i(!0),this.C(),this.t("isUnderline",e,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const e=(this.n&8388608)!==0;e!==t&&(this.n=this.n^8388608,this.$i(!0),this.C(),this.t("isStrikethrough",e,t))}get wrap(){return this.tt!==null?this.tt.Q0:2}set wrap(t){const e=this.wrap;e!==t&&(this.Os().Q0=t,this.c(),this.t("wrap",e,t))}get overflow(){return this.tt!==null?this.tt._0:0}set overflow(t){const e=this.overflow;e!==t&&(this.Os()._0=t,this.c(),this.t("overflow",e,t))}get isOverflowed(){return(this.n&16777216)!==0}oC(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Qe}set stroke(t){const e=this.Qe;e!==t&&(t!==null&&R.Md(t,"TextBlock.stroke"),t instanceof R&&t.k(),this.Qe=t,typeof t!="string"&&this.xf(),this.C(),this.t("stroke",e,t))}get lineCount(){return this.Pi}get lineHeight(){return this.ty()}get editable(){return(this.n&1048576)!==0}set editable(t){const e=(this.n&1048576)!==0;e!==t&&(this.n=this.n^1048576,this.t("editable",e,t))}get jN(){return(this.n&33554432)!==0}set jN(t){this.n=this.n^33554432}get textEditor(){return this.tt!==null?this.tt.ey:null}set textEditor(t){const e=this.textEditor;e!==t&&(this.Os().ey=t,this.t("textEditor",e,t))}get errorFunction(){return this.tt!==null?this.tt.gs:null}set errorFunction(t){const e=this.errorFunction;e!==t&&(t!==null&&y.S(t,lt,"errorFunction"),this.Os().gs=t,this.t("errorFunction",e,t))}get interval(){return this.K!==null?this.K.Ff:1}set interval(t){const e=this.interval;if(t=Math.round(t),e!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new le),this.K.Ff=t,this.c();const i=this.panel;i!==null&&(i.ds=null),this.t("interval",e,t)}}get graduatedStart(){return this.K!==null?this.K.Rf:0}set graduatedStart(t){const e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new le),this.K.Rf=t,this.c(),this.t("graduatedStart",e,t))}get graduatedEnd(){return this.K!==null?this.K.Of:1}set graduatedEnd(t){const e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new le),this.K.Of=t,this.c(),this.t("graduatedEnd",e,t))}get graduatedFunction(){return this.K!==null?this.K.iy:null}set graduatedFunction(t){const e=this.graduatedFunction;e!==t&&(t!==null&&y.S(t,lt,"graduatedFunction"),this.K===null&&(this.K=new le),this.K.iy=t,this.c(),this.t("graduatedFunction",e,t))}get graduatedSkip(){return this.K!==null?this.K.If:null}set graduatedSkip(t){const e=this.graduatedSkip;e!==t&&(t!==null&&y.S(t,lt,"graduatedSkip"),this.K===null&&(this.K=new le),this.K.If=t,this.c(),this.t("graduatedSkip",e,t))}Ma(t,e){if(this.Qe===null||this.ue.length===0||this.vn===null)return;const i=this.naturalBounds,s=this.actualBounds,n=i.width,o=i.height,r=this.ty();let a=t.textAlign=this.textAlign;const l=e.ld;a==="start"?a=l?"right":"left":a==="end"&&(a=l?"left":"right");const h=this.isUnderline,u=this.isStrikethrough;this.kn(t,this.Qe,!0,!1,i,s),(h||u)&&this.kn(t,this.Qe,!1,!1,i,s);const c=0;let d=0;const f=n;let m=!1;e.Wt===t&&!(e.Wt instanceof Wt)&&!this.jN&&e.getRenderingHint("textGreeking")===!0&&r*this.Th*e.scale<3&&(m=!0);const g=this.spacingAbove,p=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(n,0),t.scale(-1,1);break;case 1:t.translate(0,o),t.scale(1,-1);break;case 3:t.translate(n,o),t.scale(-1,-1);break}t.commitTransform();const b=this.Pi,v=(g+r+p)*b;if(o>v){const w=this.verticalAlignment;d=w.y*o-w.y*v+w.offsetY}if(lt.nk&&(t.letterSpacing=this.letterSpacing,t.wordSpacing=this.wordSpacing),b===1&&this.Rn!==null){let w=this.pe;w>f&&(w=f),d+=g,this.ND(this.Rn,t,c,d,f,r,w,m,a,h,u)}else if(this.Ii!==null&&this.ye!==null)for(let w=0;w<b;w++){let k=this.Ii[w];k>f&&(k=f),d+=g,this.ND(this.ye[w],t,c,d,f,r,k,m,a,h,u),d+=r+p}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-n,0);break;case 1:t.scale(1,-1),t.translate(0,-o);break;case 3:t.scale(-1,-1),t.translate(-n,-o);break}}ND(t,e,i,s,n,o,r,a,l,h,u){let c=0;if(a){l==="left"?c=0:l==="right"?c=n-r:l==="center"&&(c=(n-r)/2);const m=e.globalAlpha;e.globalAlpha=m/2,e.fillRect(i+c,s+o/4,r,o/2),e.globalAlpha=m;return}l==="left"?c=0:l==="right"?c=n:l==="center"&&(c=n/2);const d=lt.ik!==null?lt.ik(this,o):o*.75;e.fillText(t,i+c,s+d);let f=o/20|0;if(f===0&&(f=1),l==="right"?c-=r:l==="center"&&(c-=r/2),h){const m=lt.sk!==null?lt.sk(this,o):o*.8;this.CD(i+c,s+m,i+c+r,s+m,f,e),e instanceof Wt&&e.lastCreatedElement.classList.add("gojs-td")}if(u){let m=s+o-o/2.2|0;f%2!==0&&(m+=.5),this.CD(i+c,m,i+c+r,m,f,e),e instanceof Wt&&e.lastCreatedElement.classList.add("gojs-td")}}CD(t,e,i,s,n,o){o.beginPath(),o.lineWidth=n,o.moveTo(t,e),o.lineTo(i,s),o.stroke(),o.endPath()}wf(t,e,i){if(!super.wf(t,e,i))return!1;if(this.kn(t,this.Qe,!0,!1,this.naturalBounds,this.actualBounds),i){if(this.svg.getElementsByTagName("text").length===0)return!0;const s=this.svg.getElementsByClassName("gojs-td");for(let n=0;n<s.length;n++)t.setFillOrStrokeInPlace(s[n],!1)}else this.lE(this.svg,this.ye?this.ye[0]:this.text,t);return!0}lE(t,e,i){t.innerHTML=e,i.setFillOrStrokeInPlace(t,!0)}Pd(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.Pd(t)}LN(t,e){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",e);else{const i=t.getElementsByTagName("text");for(let s=0;s<i.length;s++)i[s].setAttributeNS(null,"filter",e)}}aE(){this.Fn=0,this.pe=0,this.go=null,this.Ii=null,this.ye=null,this.Rn=null}bd(t,e,i,s){const n=this.Pi;this.Xl=t,this.oC(!1);const o=this.vn;lt.us!==null&&(lt.LD!==o&&(lt.us.font=o,lt.LD=o),lt.nk&&(lt.us.letterSpacing=this.letterSpacing,lt.us.wordSpacing=this.wordSpacing)),this.aE();let r=0,a=0;isNaN(this.desiredSize.width)?(r=this.hE(),r=Math.min(r,t/this.scale)):r=this.desiredSize.width,this.panel!==null&&(r=Math.min(r,this.panel.maxSize.width)),a=this.MD(r),isNaN(this.desiredSize.height)?a=Math.min(a,e/this.scale):a=this.desiredSize.height,this.cE(t,a),(this.wrap===1||isNaN(this.desiredSize.width))&&(r=isNaN(t)?this.pe:Math.min(t,this.pe)),r=Math.max(i,r),a=Math.max(s,a),this.Ke.jn(r,a),this.lo(0,0,r,a),this.svg!==null&&n!==this.Pi&&this.$i(!0)}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}On(t,e){this.Rn===null?(this.Rn=t,this.pe=e):((this.ye===null||this.Ii===null)&&(this.ye=[],this.Ii=[],this.ye.push(this.Rn),this.Ii.push(this.pe)),this.ye.push(t),this.Ii.push(e),this.ye.length>this.maxLines&&(this.n|=16777216))}nC(t,e,i){const s=this.formatting===0;s&&(t=t.trim());let n=0,o=0,r=0;const a=this.vn,l=this.spacingAbove+this.spacingBelow,h=Math.max(0,this.ty()+l),u=this.overflow===1?this.AD(a):0;if(this.Pi>=this.maxLines){i!==void 0&&i.e(0,h);return}let c=t;if(this.wrap===0){if(this.Fn=1,o=this.getStringWidth(t),u===0||o<=e){this.pe=Math.max(this.pe,o),this.On(t,this.pe),i!==void 0&&i.e(o,h);return}let f=this.Hd(c);c=c.substring(f.length);let m=this.Hd(c);for(o=this.getStringWidth(f+m),r=0;m.length>0&&o<=e;){f+=m,c=c.substring(m.length),m=this.Hd(c),r=o;let g=f+m;s&&(g=g.trim()),o=this.getStringWidth(g)}for(s&&(m=m.trim()),f+=m,e=Math.max(1,e-u);this.getStringWidth(f)>e&&f.length>1;)f=f.substring(0,f.length-1);this.oC(!0),f+=lt.$0,r=this.getStringWidth(f),this.pe=r,this.On(f,r),i!==void 0&&i.e(r,h);return}let d=0;for(c.length===0&&(d=1,this.On(c,0));c.length>0;){let f=this.Hd(c);for(c=c.substring(f.length);this.getStringWidth(f)>e;){let p=1;for(o=this.getStringWidth(f.substring(0,p)),r=0;o<=e;)p++,r=o,o=this.getStringWidth(f.substring(0,p));let b=0;p===1?(b=o,n=Math.max(n,o)):(b=r,n=Math.max(n,r)),p--,p<1&&(p=1);const v=f.substring(0,p);if(this.On(v,b),d++,f=f.substring(p),this.Pi+d>this.maxLines)break}let m=this.Hd(c);for(o=this.getStringWidth(f+m),r=0;m.length>0&&o<=e;){f+=m,c=c.substring(m.length),m=this.Hd(c),r=o;let p=f+m;s&&(p=p.trim()),o=this.getStringWidth(p)}if(s&&(f=f.trim()),f==="")continue;f[f.length-1]===""&&(f=f.substring(0,f.length-1)+"");let g=0;if(m.length===0?(g=o,n=Math.max(n,o)):(r=this.getStringWidth(f),g=r,n=Math.max(n,r)),this.On(f,g),d++,this.Pi+d>this.maxLines)break}this.Fn=Math.min(this.maxLines-this.Pi,d),this.pe=Math.max(this.pe,n),i!==void 0&&i.e(this.pe,h*this.Fn)}cE(t,e){if(this.pe===0||this.Ii===null||this.ye===null||this.overflow!==1)return;const i=this.vn,s=this.overflow===1?this.AD(i):0,n=this.spacingAbove+this.spacingBelow,o=Math.max(0,this.ty()+n),r=Math.min(this.maxLines-1,Math.max(Math.floor(e/o+.01)-1,0));if(r+1>=this.ye.length)return;this.oC(!0);let a=this.ye[r];const l=Math.max(1,t-s);for(;this.getStringWidth(a)>l&&a.length>1;)a=a.substring(0,a.length-1);a+=lt.$0;const h=this.getStringWidth(a);this.ye[r]=a,this.ye=this.ye.slice(0,r+1),this.Ii[r]=h,this.Ii=this.Ii.slice(0,r+1),this.Fn=this.ye.length,this.pe=Math.max(this.pe,h),this.Pi=this.Fn,this.Pi===1&&(this.Rn=this.ye[0])}Hd(t){if(this.wrap===3)return t.substring(0,1);let e=t.length,i=0;const s=lt.fE;for(;i<e&&!s.test(t.charAt(i));)i++;for(this.formatting===1&&(e=Math.min(e,i+1));i<e&&s.test(t.charAt(i));)i++;return i>=t.length?t:t.substring(0,i)}getStringWidth(t){return lt.us===null?t.length*8:lt.us.measureText(t).width}ty(){if(this.go!==null)return this.go;const t=this.vn;let e=0;if(lt.us===null)return e=16,this.go=e,e;if(lt.rC[t]!==void 0&&lt.TD<5e3)e=lt.rC[t];else{lt.us.letterSpacing="0px";const i=lt.us.measureText("M");lt.us.letterSpacing=this.letterSpacing,e=i.width*1.3,lt.rC[t]=e,lt.TD++}return this.go=e,e}AD(t){if(lt.us===null)return 6;let e=0;return lt.ek[t]!==void 0&&lt.sC<5e3?e=lt.ek[t]:(e=lt.us.measureText(lt.$0).width,lt.ek[t]=e,lt.sC++),e}ok(t,e){return t.indexOf(`
`,e)}MD(t){let e=this.ue.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const i=this.spacingAbove+this.spacingBelow,s=Math.max(0,this.ty()+i);if(e.length===0)return this.pe=0,this.Pi=1,s;if(!this.isMultiline){const l=this.ok(e,0);l>=0&&(e=e.substring(0,l))}let n=0;this.Pi=0;let o=0,r=-1,a=!1;for(;!a;){if(r=this.ok(e,o),r===-1&&(r=e.length,a=!0),o<=r){const l=e.substring(o,r);if(this.wrap!==0){this.Fn=0;const h=st.l();this.nC(l,t,h),n+=h.height,st.i(h),this.Pi+=this.Fn}else this.nC(l,t),n+=s,this.Pi++;this.Pi===this.maxLines&&(a=!0)}o=r+1}return this.qp=n,n}hE(){let t=this.ue.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let e=0,i=0,s=!1;for(;!s;){let n=this.ok(t,i);n===-1&&(n=t.length,s=!0);let o=t.substring(i,n);this.formatting===0&&(o=o.trim()),e=Math.max(e,this.getStringWidth(o)),i=n+1}return e}else{const e=this.ok(t,0);return e>=0&&(t=t.substring(0,e)),this.getStringWidth(t)}}get textValidation(){return this.tt!==null?this.tt.zl:null}set textValidation(t){const e=this.textValidation;e!==t&&(t!==null&&y.S(t,lt,"textValidation"),this.Os().zl=t,this.t("textValidation",e,t))}get textEdited(){return this.tt!==null?this.tt.ny:null}set textEdited(t){const e=this.textEdited;e!==t&&(t!==null&&y.S(t,lt,"textEdited"),this.Os().ny=t,this.t("textEdited",e,t))}get spacingAbove(){return this.tt!==null?this.tt.ly:0}set spacingAbove(t){const e=this.spacingAbove;e!==t&&(this.Os().ly=t,this.c(),this.t("spacingAbove",e,t))}get spacingBelow(){return this.tt!==null?this.tt.hy:0}set spacingBelow(t){const e=this.spacingBelow;e!==t&&(this.Os().hy=t,this.c(),this.t("spacingBelow",e,t))}get letterSpacing(){return this.tt!==null?this.tt.cy:"0px"}set letterSpacing(t){const e=this.letterSpacing;e!==t&&(lt.nk=!0,this.Os().cy=t,this.c(),this.t("letterSpacing",e,t))}get wordSpacing(){return this.tt!==null?this.tt.fy:"0px"}set wordSpacing(t){const e=this.wordSpacing;e!==t&&(lt.nk=!0,this.Os().fy=t,this.c(),this.t("wordSpacing",e,t))}get formatting(){return this.tt!==null?this.tt.uy:0}set formatting(t){const e=this.formatting;e!==t&&(this.Os().uy=t,this.c(),this.t("formatting",e,t))}get maxLines(){return this.tt!==null?this.tt.gy:1/0}set maxLines(t){const e=this.maxLines;e!==t&&(t=Math.floor(t),t<=0&&y.J(t,"> 0",lt,"maxLines"),this.Os().gy=t,this.c(),this.t("maxLines",e,t))}getMetrics(){return[this.pe,this.Xl,this.go,this.Fn,this.Ii,this.ye,this.Rn||""]}rE(t){t!==void 0&&(this.pe=t[0],this.Xl=t[1],this.go=t[2],this.Fn=t[3],this.Ii=t[4],this.ye=t[5],this.Rn=t[6])}get metrics(){return{arrSize:this.Ii!==null?this.Ii:[this.pe],arrText:this.ye!==null?this.ye:[this.Rn],maxLineWidth:this.pe,fontHeight:this.go}}get choices(){return this.Kd}set choices(t){const e=this.Kd;e!==t&&(this.Kd=t,this.t("choices",e,t))}static fE=new RegExp("[ ]");static rC=new Zt;static TD=0;static ek=new Zt;static sC=0;static $0="...";static LD="";static us=null;static M0=!1;static nk=!1}class mi{me;gs;mo;uy;gy;_0;ly;hy;Z0;ny;ey;zl;hl;Q0;cy;fy;constructor(){this.me=!1,this.gs=null,this.mo=0,this.uy=0,this.gy=1/0,this._0=0,this.ly=0,this.hy=0,this.Z0="start",this.ny=null,this.ey=null,this.zl=null,this.hl=T.Top,this.Q0=2,this.cy="0px",this.fy="0px"}copy(){const t=new mi;return t.gs=this.gs,t.mo=this.mo,t.uy=this.uy,t.gy=this.gy,t._0=this._0,t.ly=this.ly,t.hy=this.hy,t.Z0=this.Z0,t.ny=this.ny,t.ey=this.ey,t.zl=this.zl,t.hl=this.hl,t.Q0=this.Q0,t.cy=this.cy,t.fy=this.fy,t}}class le{Ff;Rf;Of;iy;If;constructor(){this.Ff=1,this.Rf=0,this.Of=1,this.iy=null,this.If=null}copy(){const t=new le;return t.Ff=this.Ff,t.Rf=this.Rf,t.Of=this.Of,t.iy=this.iy,t.If=this.If,t}}var pi=(x=>(x[x.None=0]="None",x[x.Fill=2]="Fill",x[x.Uniform=6]="Uniform",x[x.UniformToFill=7]="UniformToFill",x))(pi||{});class Tt extends tt{cl;sn;fl;Ef;gs;ul;Uf;mo;Vf;Bf;U1;constructor(t,e){super(),this.n|=2097152,this.cl=null,this.sn="",this.fl=I.GF,this.Ef=2,this.gs=null,this.ul=null,this.Uf=T.Center,this.mo=0,this.Vf=null,this.Bf=null,this.U1=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.sn=this.sn,t.element=this.cl,t.fl=this.fl.N(),t.Ef=this.Ef,t.mo=this.mo,t.gs=this.gs,t.ul=this.ul,t.Uf=this.Uf.N(),t.Bf=this.Bf}fe(t){t in pi?this.imageStretch=t:super.fe(t)}toString(){return"Picture("+this.source+")#"+K.xs(this)}get zf(){return(this.n&1048576)!==0}set zf(t){this.zf!==t&&(this.n=this.n^1048576)}get my(){return(this.n&2097152)!==0}set my(t){this.my!==t&&(this.n=this.n^2097152)}get Mn(){return(this.n&4194304)!==0}set Mn(t){this.Mn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),y.s(t,"string",Tt,"clearCache:url"),t!==""?Tt.yy[t]&&(delete Tt.yy[t],Tt.rk--):(Tt.yy=new Zt,Tt.rk=0)}static ST(t,e){e.DD||(e.lk=i=>{Tt.uE(e,i),t.desiredSize.isReal()||(t.xi(!1),t.c())},e.ak=i=>Tt.dE(e,i),e.addEventListener("load",e.lk),e.addEventListener("error",e.ak),e.DD=!0)}static DO(t){t.lk&&t.removeEventListener("load",t.lk),t.ak&&t.removeEventListener("error",t.ak),delete t.lk,delete t.ak,t.DD=!1}get element(){return this.cl}set element(t){const e=this.cl;if(this.$i(!0),e!==t){const i=X.isUsingDOM();let s=!1;i&&(this.zf=t instanceof HTMLCanvasElement,s=t instanceof HTMLImageElement,t!==null&&!(s||t instanceof HTMLVideoElement||this.zf)&&y.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t));const n=this.diagram;n!==null&&n.R2(this),this.cl=t,t!==null&&s&&t.hs===void 0&&(t.hs=new K),n!==null&&s&&n.F2(this),this.t("element",e,t),this.C()}}AO(){const t=this.cl;if(t===null)return;const e=this.desiredSize.isReal();(this.zf||t.complete===!0)&&(t.Dp&&(t.wy instanceof Event&&this.gs!==null?this.gs(this,t.wy):t.Mn===!0&&!t.wy&&this.ul!==null&&t.lC&&this.ul(this,t.lC)),t.Mn=!0),t.Mn&&e&&this.diagram!==null&&this.diagram.rd.add(this)}gE(){if(this.cl===null){this.Vf=!1;return}const t=new xe(null)._t;try{t.drawImage(this.cl,0,0)}catch{this.my=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.Vf=!1),this.Vf=!1}catch{this.Vf=!0}}get source(){return this.sn}set source(t){const e=this.sn;if(e!==t){this.$i(!0),y.s(t,"string",Tt,"source"),this.sn=t;let i=Tt.yy,s=null;if(i[t]!==void 0)s=i[t];else if(t!==""){Tt.rk>30&&(Tt.clearCache(),i=Tt.yy),s=y.Ni("img"),s.Dp=!0,Tt.ST(this,s);const n=this.Bf;n!==null&&(s.crossOrigin=n(this)),s.src=t,i[t]=s,Tt.rk++}this.element=s,s!==null&&s.__goCache===void 0&&(s.__goCache=new Js),this.c(),this.C(),this.t("source",e,t)}}static uE(t,e){t.Mn=!0,t.wy=!1;let i;const s=t.hs.copy();if(s==null)return;const n=s.iterator;for(;n.next();){const o=n.value;o.C();const r=t.getAttribute("src")||"",a=o.oa.get(r);if(a===null)continue;const l=a.length;for(let h=0;h<l;h++)i=a[h],i.desiredSize.isReal()||o.rd.add(i),i.$i(!0),o.requestUpdate(),t.Dp&&(t.lC===void 0&&(t.lC=e),i.ul!==null&&i.ul(i,e))}t.hs.clear()}static dE(t,e){t.wy=e;let i;const s=t.hs.copy();if(s==null)return;const n=s.iterator;for(;n.next();){const o=n.value,r=t.getAttribute("src")||"",a=o.oa.get(r);if(a===null)continue;const l=a.length,h=y.nt();for(let u=0;u<l;u++)h.push(a[u]);if(t.Dp)for(let u=0;u<l;u++)i=h[u],i.gs!==null&&i.gs(i,e);y.Z(h)}t.hs.clear()}reloadSource(){if(this.source==="")return;Tt.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.C(),this.$i(!0)}get sourceCrossOrigin(){return this.Bf}set sourceCrossOrigin(t){if(this.Bf!==t){t!==null&&y.S(t,Tt,"sourceCrossOrigin"),this.Bf=t;const e=this.element;if(e!==null){const i=e.getAttribute("src");e.crossOrigin!==void 0&&(t===null&&typeof i=="string"?e.crossOrigin=null:t!==null&&(e.crossOrigin=t(this)),i&&(e.src=i))}}}get sourceRect(){return this.fl}set sourceRect(t){const e=this.fl;e.equals(t)||(t=t.N(),this.fl=t,this.C(),this.t("sourceRect",e,t))}get imageStretch(){return this.Ef}set imageStretch(t){const e=this.Ef;e!==t&&(this.Ef=t,this.C(),this.t("imageStretch",e,t))}get flip(){return this.mo}set flip(t){const e=this.mo;e!==t&&(this.mo=t,this.C(),this.t("flip",e,t))}get imageAlignment(){return this.Uf}set imageAlignment(t){const e=this.Uf;e.equals(t)||(t=t.N(),this.Uf=t,this.C(),this.t("imageAlignment",e,t))}get errorFunction(){return this.gs}set errorFunction(t){const e=this.gs;e!==t&&(t!==null&&y.S(t,Tt,"errorFunction"),this.gs=t,this.t("errorFunction",e,t))}get successFunction(){return this.ul}set successFunction(t){const e=this.ul;e!==t&&(t!==null&&y.S(t,Tt,"successFunction"),this.ul=t,this.t("successFunction",e,t))}Ma(t,e){const i=this.cl;if(i===null)return;const s=i.getAttribute("src"),n=X.isUsingDOM();if(n&&i instanceof HTMLImageElement&&(s===null||s==="")||i.wy instanceof Event&&t instanceof je)return;const o=t instanceof Wt,r=this.naturalBounds;let a=0,l=0;const h=this.zf;let u=h?+i.width:i.naturalWidth,c=h?+i.height:i.naturalHeight;if(u===void 0&&i.videoWidth&&(u=i.videoWidth),c===void 0&&i.videoHeight&&(c=i.videoHeight),n){if(u===0||c===0)return}else u=this.width,c=this.height;const d=u,f=c;this.sourceRect.isReal()&&(a=this.fl.x,l=this.fl.y,u=this.fl.width,c=this.fl.height);let m=u,g=c;const p=this.Ef,b=this.Uf;switch(p){case 0:if(this.sourceRect.isReal())break;m>=r.width&&(a=a+b.offsetX+(m*b.x-r.width*b.x)),g>=r.height&&(l=l+b.offsetY+(g*b.y-r.height*b.y)),u=Math.min(r.width,m),c=Math.min(r.height,g);break;case 2:m=r.width,g=r.height;break;case 6:case 7:let E=0;p===6?(E=Math.min(r.height/g,r.width/m),m*=E,g*=E):p===7&&(E=Math.max(r.height/g,r.width/m),m*=E,g*=E,m>=r.width&&(a=(a+b.offsetX+(m*b.x-r.width*b.x)/m)*u),g>=r.height&&(l=(l+b.offsetY+(g*b.y-r.height*b.y)/g)*c),u*=1/(m/r.width),c*=1/(g/r.height),m=r.width,g=r.height);break}const v=u*c,w=this.getDocumentScale()*e.scale,k=m*w,S=g*w,N=k*S,D=v/N,A=i.__goCache;let M=null;const C=Tt.mE;if(!o){if(i.Mn&&A!==void 0&&d<8e3&&f<8e3&&N>4&&D>C*C){A.Vt===null&&(A.vD(4,d,f,i),A.vD(16,d,f,i));const E=A.Vt,B=E.length;for(let z=0;z<B&&E[z].jd*E[z].jd<D;z++)M=E[z]}if(!e.od&&(this.Vf===null&&this.gE(),this.Vf))return}const F=m<r.width?b.offsetX+(r.width*b.x-m*b.x):0,O=g<r.height?b.offsetY+(r.height*b.y-g*b.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(r.width,m),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(r.height,g)),t.scale(1,-1);break;case 3:t.translate(Math.min(r.width,m),Math.min(r.height,g)),t.scale(-1,-1);break}if(t.commitTransform(),e.getRenderingHint("pictureRatioOptimization")&&!e.ph&&A!==void 0&&M!==null&&M.jd!==1){t.save();const E=M.jd;try{t.drawImage(M.sn,a/E,l/E,Math.min(M.sn.width,u/E),Math.min(M.sn.height,c/E),F,O,Math.min(r.width,m),Math.min(r.height,g)),t instanceof Wt&&(this.U1=[a/E,l/E,Math.min(M.sn.width,u/E),Math.min(M.sn.height,c/E),F,O,Math.min(r.width,m),Math.min(r.height,g)])}catch{this.my=!1}t.restore()}else try{t.drawImage(i,a,l,u,c,F,O,Math.min(r.width,m),Math.min(r.height,g)),t instanceof Wt&&(this.U1=[a,l,u,c,F,O,Math.min(r.width,m),Math.min(r.height,g)])}catch{this.my=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(r.width,m),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(r.height,g));break;case 3:t.scale(-1,-1),t.translate(-Math.min(r.width,m),-Math.min(r.height,g));break}}get naturalBounds(){return this.Ke}bd(t,e,i,s){const n=this.desiredSize,o=this.Qs(!0),r=this.cl,a=this.zf;let l=0,h=0;(a||!this.Mn&&r&&r.complete)&&(this.Mn=!0),r===null?(isFinite(n.width)||(t=i),isFinite(n.height)||(e=s)):(l=a?+r.width:r.naturalWidth,h=a?+r.height:r.naturalHeight),!isFinite(n.width)&&o!==2&&o!==5?r!==null&&this.Mn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=l):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:r!==null&&(t=l)),i=0),!isFinite(n.height)&&o!==2&&o!==4?r!==null&&this.Mn!==!1&&(this.sourceRect.isReal()?e=this.sourceRect.height:e=h):(isFinite(e)||(this.sourceRect.isReal()?e=this.sourceRect.height:r!==null&&(e=h)),s=0),isFinite(n.width)&&(t=n.width),isFinite(n.height)&&(e=n.height);const u=this.maxSize,c=this.minSize;i=Math.max(i||0,c.width),s=Math.max(s||0,c.height),t=Math.min(u.width,t),e=Math.min(u.height,e),t=Math.max(i,t),e=Math.max(s,e),r!==null&&!r.complete&&(isFinite(t)||(t=0),isFinite(e)||(e=0)),this.Ke.jn(t,e),this.lo(0,0,t,e)}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}static yy=new Zt;static rk=0;static mE=4}class Js{Vt;constructor(){this.Vt=null}vD(t,e,i,s){this.Vt===null&&(this.Vt=[]);const n=new xe(null),o=n._t,r=1/t;if(n.width=e/t,n.height=i/t,n.width===0||n.height===0)return;const a=new $s(n.bt,t);let l=s,h=1;if(this.Vt.length>0){const u=this.Vt[this.Vt.length-1];l=u.sn,h=u.jd}o.setTransform(r*h,0,0,r*h,0,0),o.commitTransform(),o.drawImage(l,0,0),this.Vt.push(a)}}class $s{sn;jd;constructor(t,e){this.sn=t,this.jd=e}}class me{Ne;um;constructor(){this.um=new yt,this.Ne=null}Ue(t){t!==null?(this.um=t,t.figures.clear()):this.um=new yt,this.Ne=null}Au(t,e,i,s,n,o){if(s!==void 0&&s===!0){const r=new dt(1);r.endX=t,r.endY=e,this.Ne.segments.add(r)}else this.Ne=new Lt,this.Ne.startX=t,this.Ne.startY=e,this.Ne.isFilled=i,this.Ne.isEvenOdd=o||!1,this.um.figures.add(this.Ne);n!==void 0&&(this.Ne.isShadowed=n)}_F(){const t=this.Ne.segments.length;t>0&&this.Ne.segments.elt(t-1).close()}tR(){this.Ne.segments.length>0&&(this.Ne.isFilled=!0)}eR(t){this.Ne.isShadowed=t}zU(t){this.Ne.isEvenOdd=t}$F(t,e,i){i===void 0&&(i=!1);const s=new dt(1);s.endX=t,s.endY=e,i&&s.close(),this.Ne.segments.add(s)}Ks(t,e,i){i===void 0&&(i=!1);const s=new dt(2);s.endX=t,s.endY=e,i&&s.close(),this.Ne.segments.add(s)}xr(t,e,i,s,n,o,r){r===void 0&&(r=!1);const a=new dt(3);a.point1X=t,a.point1Y=e,a.point2X=i,a.point2Y=s,a.endX=n,a.endY=o,r&&a.close(),this.Ne.segments.add(a)}Tu(t,e,i,s,n){n===void 0&&(n=!1);const o=new dt(4);o.point1X=t,o.point1Y=e,o.endX=i,o.endY=s,n&&o.close(),this.Ne.segments.add(o)}ZF(t,e,i,s,n,o,r){o===void 0&&(o=0),r===void 0&&(r=!1);const a=new dt(5);a.startAngle=t,a.sweepAngle=e,a.centerX=i,a.centerY=s,a.radiusX=n,o!==0?a.radiusY=o:a.radiusY=n,r&&a.close(),this.Ne.segments.add(a)}QF(t,e,i,s,n,o,r,a){a===void 0&&(a=!1);const l=new dt(6,o,r,t,e,i,s,n);a&&l.close(),this.Ne.segments.add(l)}static aC=null;static qL(t){const e=me.aC;if(e!==null)return me.aC=null,e.Ue(t),e;{const i=new me;return i.Ue(t),i}}static WL(t){me.aC=t}}{const x=function(n,o){const r=n.toLowerCase(),a=L.Jn;a[n]=o,a[r]=n};x("Rectangle",(n,o,r)=>{const a="r"+o+","+r;let l=L.yr[a];return l!==void 0||(l=new yt(2),l.endX=o,l.endY=r,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l}),x("Square",(n,o,r)=>{const a="s"+o+","+r;let l=L.yr[a];return l!==void 0||(l=new yt(2),l.endX=o,l.endY=r,l.defaultStretch=6,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l});const t=(n,o,r,a,l)=>{(isNaN(a)||a<0)&&(a=5),isNaN(l)&&(l=15);const h="rr"+o+","+r+","+a+","+l;let u=L.yr[h];if(u!==void 0)return u;let c=a;(l&1)===1?(c=Math.min(c,(l&2)===2?o/3:o),c=Math.min(c,(l&8)===8?r/3:r)):c=0;const d=new Lt(c,0,!0);u=new yt().add(d);const f=T.TopLeft.copy(),m=T.BottomRight.copy();if((l&2)===2){let g=a;g=Math.min(g,(l&1)===1?o/3:o),g=Math.min(g,(l&4)===4?r/3:r);const p=g*L.qn;d.add(new dt(2,o-g,0)).add(new dt(3,o,g,o-p,0,o,p)),f.offsetY=p,m.offsetX=-p}else d.add(new dt(2,o,0));if((l&4)===4){let g=a;g=Math.min(g,(l&8)===8?o/3:o),g=Math.min(g,(l&2)===2?r/3:r);const p=g*L.qn;d.add(new dt(2,o,r-g)).add(new dt(3,o-g,r,o,r-p,o-p,r)),m.offsetX=-p,m.offsetY=-p}else d.add(new dt(2,o,r));if((l&8)===8){let g=a;g=Math.min(g,(l&4)===4?o/3:o),g=Math.min(g,(l&1)===1?r/3:r);const p=g*L.qn;d.add(new dt(2,g,r)).add(new dt(3,0,r-g,p,r,0,r-p)),f.offsetX=p,m.offsetY=-p}else d.add(new dt(2,0,r));if((l&1)===1){const g=c*L.qn;d.add(new dt(2,0,c)).add(new dt(3,c,0,0,g,g,0).close()),f.offsetX=g,f.offsetY=g}else d.add(new dt(2,0,0).close());return u.spot1=f,u.spot2=m,L.wr<L.am&&(L.yr[h]=u,L.wr++),u};x("RoundedRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN,l=n?n.parameter2:NaN;return t(n,o,r,a,l)}),x("Border","RoundedRectangle"),x("RoundedTopRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return t(n,o,r,a,3)}),x("RoundedBottomRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return t(n,o,r,a,12)}),x("RoundedLeftRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return t(n,o,r,a,9)}),x("RoundedRightRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return t(n,o,r,a,6)}),x("Ellipse",(n,o,r)=>{const a="e"+o+","+r;let l=L.yr[a];return l!==void 0||(l=new yt(3),l.endX=o,l.endY=r,l.spot1=T.vP,l.spot2=T.FP,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l}),x("Circle",(n,o,r)=>{const a="c"+o+","+r;let l=L.yr[a];return l!==void 0||(l=new yt(3),l.endX=o,l.endY=r,l.spot1=T.vP,l.spot2=T.FP,l.defaultStretch=6,L.wr<L.am&&(L.yr[a]=l,L.wr++)),l}),x("TriangleRight",(n,o,r)=>new yt().add(new Lt(0,0).add(new dt(2,o,.5*r)).add(new dt(2,0,r).close())).setSpots(0,.25,.5,.75)),x("TriangleDown",(n,o,r)=>new yt().add(new Lt(0,0).add(new dt(2,o,0)).add(new dt(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),x("TriangleLeft",(n,o,r)=>new yt().add(new Lt(o,r).add(new dt(2,0,.5*r)).add(new dt(2,o,0).close())).setSpots(.5,.25,1,.75)),x("TriangleUp",(n,o,r)=>new yt().add(new Lt(o,r).add(new dt(2,0,r)).add(new dt(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),x("Triangle","TriangleUp"),x("Diamond",(n,o,r)=>new yt().add(new Lt(.5*o,0).add(new dt(2,0,.5*r)).add(new dt(2,.5*o,r)).add(new dt(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),x("LineH",(n,o,r)=>{const a=new yt(1);return a.startX=0,a.startY=r/2,a.endX=o,a.endY=r/2,a}),x("LineV",(n,o,r)=>{const a=new yt(1);return a.startX=o/2,a.startY=0,a.endX=o/2,a.endY=r,a}),x("None","Rectangle"),x("BarH","Rectangle"),x("BarV","Rectangle"),x("MinusLine","LineH"),x("PlusLine",(n,o,r)=>new yt().add(new Lt(0,r/2,!1).add(new dt(2,o,r/2)).add(new dt(1,o/2,0)).add(new dt(2,o/2,r)))),x("XLine",(n,o,r)=>new yt().add(new Lt(0,r,!1).add(new dt(2,o,0)).add(new dt(1,0,0)).add(new dt(2,o,r)))),x("LineRight",(n,o,r)=>new yt().add(new Lt(.25*o,0,!1).add(new dt(2,.75*o,.5*r)).add(new dt(2,.25*o,r)))),x("LineDown",(n,o,r)=>new yt().add(new Lt(0,.25*r,!1).add(new dt(2,.5*o,.75*r)).add(new dt(2,o,.25*r)))),x("LineLeft",(n,o,r)=>new yt().add(new Lt(.75*o,0,!1).add(new dt(2,.25*o,.5*r)).add(new dt(2,.75*o,r)))),x("LineUp",(n,o,r)=>new yt().add(new Lt(0,.75*r,!1).add(new dt(2,.5*o,.25*r)).add(new dt(2,o,.75*r)))),x("Capsule",(n,o,r)=>{const a=new yt;if(o<r){const l=o/2,h=new Lt(0,l,!0);a.add(h),h.add(new dt(5,180,180,l,l,l,l)),h.add(new dt(2,o,r-l)),h.add(new dt(5,0,180,l,r-l,l,l)),h.add(new dt(2,0,l));const u=isFinite(n.parameter1)?n.parameter1:o*.156;return a.setSpots(0,0,1,1,0,u,0,-u),a}else if(o>r){const l=r/2,h=new Lt(l,0,!0);a.add(h),h.add(new dt(2,o-l,0)),h.add(new dt(5,270,180,o-l,l,l,l)),h.add(new dt(2,l,r)),h.add(new dt(5,90,180,l,l,l,l));const u=isFinite(n.parameter1)?n.parameter1:r*.156;return a.setSpots(0,0,1,1,u,0,-u,0),a}else return a.type=3,a.endX=o,a.endY=r,a.spot1=T.vP,a.spot2=T.FP,a});const e=(n,o)=>new Lt(n,o,!1,!1),i=(n,o,r)=>n.add(new dt(2,o,r)),s=(n,o,r)=>n.add(new dt(1,o,r));x("Borders",(n,o,r)=>{let a=n?n.parameter1:NaN;isNaN(a)?a=10:a=a&15;const l=new yt;let h;return a===10?(h=e(o,0),i(h,o,r),s(h,0,r),i(h,0,0)):a===5?(h=e(0,0),i(h,o,0),s(h,o,r),i(h,0,r)):a===1?(h=e(0,0),i(h,o,0),s(h,o,r)):a===2?(h=e(o,0),i(h,o,r)):a===4?(h=e(o,r),i(h,0,r)):a===8?(h=e(0,r),i(h,0,0),s(h,o,r)):a===3?(h=e(0,0),i(h,o,0),i(h,o,r)):a===6?(h=e(o,0),i(h,o,r),i(h,0,r)):a===12?(h=e(o,r),i(h,0,r),i(h,0,0)):a===9?(h=e(0,r),i(h,0,0),i(h,o,0)):a===7?(h=e(0,0),i(h,o,0),i(h,o,r),i(h,0,r)):a===14?(h=e(o,0),i(h,o,r),i(h,0,r),i(h,0,0)):a===13?(h=e(o,r),i(h,0,r),i(h,0,0),i(h,o,0)):a===11?(h=e(0,r),i(h,0,0),i(h,o,0),i(h,o,r)):a===15?(h=e(0,0),i(h,o,0),i(h,o,r),i(h,0,r),h.add(new dt(2,0,0).close())):(h=e(0,0),s(h,o,r)),l.add(h),l})}L.lm={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var cs=(x=>(x[x.None=0]="None",x[x.Added=1]="Added",x[x.Removed=2]="Removed",x[x.Shown=4]="Shown",x[x.Hidden=8]="Hidden",x[x.NodeSized=16]="NodeSized",x[x.GroupLayout=32]="GroupLayout",x[x.NodeReplaced=64]="NodeReplaced",x[x.Standard=127]="Standard",x[x.All=16777215]="All",x))(cs||{});class ft extends j{b;_o;H;dl;gl;tr;ue;pl;Ta;nn;er;qd;UM;FD;xy;ky;constructor(t,e){let i;t===void 0||t instanceof Pt||typeof t=="string"?i=t:t&&(e=t),super(i),this.b=2408959,this._o="",this.H=null,this.dl="",this.gl=null,this.tr=null,this.ue="",this.pl=null,this.Ta=null,this.nn=new P(NaN,NaN).k(),this.er=null,this.qd=NaN,this.UM=-1,this.FD=new I,this.xy=null,this.ky=NaN,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.b=this.b&-4097|16384|32768,t._o=this._o,this.H!==null&&(this.H.me?t.H=this.H:t.H=this.H.copy()),t.dl=this.dl,t.tr=null,t.ue=this.ue,t.nn.h(this.nn),t.qd=this.qd}jo(t){super.jo(t),t.Sa(),t.gl=null,t.er=null,t.xy=null}toString(){let t=y.Hn(this.constructor)+"#"+K.xs(this);return this.data!==null&&(t+="("+y.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=16777215;_e(){return this.H===null?this.H=new yi:this.H.me&&(this.H=this.H.copy()),this.H}ba(){super.ba(),this.H!==null&&(this.H.me=!0)}gf(t,e,i,s,n,o,r){const a=this.diagram;a!==null&&(t===3&&e==="elements"?n instanceof j?n.Sn(l=>{a.partManager.N2(l,a)}):n instanceof Tt&&a.F2(n):t===4&&e==="elements"&&(n instanceof j?n.Sn(l=>a.partManager.C2(l,a)):n instanceof Tt&&a.R2(n)),a.raiseChangedEvent(t,e,i,s,n,o,r))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const e=this.D.r,i=e.length;for(let n=0;n<i;n++){const o=e[n];o instanceof j&&o.Sn(r=>{r.data!==null&&r.JI(t)})}const s=this.adornments;for(;s.next();)s.value.updateTargetBindings(t)}Yo(){if(super.Yo(),this.RN()){const e=this.D.r,i=e.length;for(let s=0;s<i;s++){const n=e[s];n instanceof j&&n.Sn(o=>o.Yo())}}const t=this.adornments;for(;t.next();)t.value.Yo()}updateRelationshipsFromData(){this.data!==null&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this.tr===null?Ut.instance:this.tr.iteratorValues}findAdornment(t){const e=this.tr;return e===null?null:e.get(t)}addAdornment(t,e){if(e===null)return;let i=null,s=this.tr;if(s!==null&&(i=s.get(t)),i!==e){if(i!==null){const o=i.diagram;o!==null&&o.remove(i)}s===null&&(s=new bt,this.tr=s),e._o!==t&&(e.category=t),s.set(t,e);const n=this.diagram;if(n!==null){n.add(e);const o=e.adornedObject;if(o!==null){const r=o.findBindingPanel();r!==null&&(e.data=r.data)}}}}removeAdornment(t){const e=this.tr;if(e===null)return;const i=e.get(t);if(i!==null){const s=i.diagram;s!==null&&(s.remove(i),i.data=null)}e.delete(t),e.count===0&&(this.tr=null)}clearAdornments(){const t=this.tr;if(t===null)return;const e=y.nt(),i=t.iterator;for(;i.next();){const n=i.key;e.push(n)}const s=e.length;for(let n=0;n<s;n++)this.removeAdornment(e[n]);y.Z(e)}updateAdornments(){const t=this.diagram;if(t===null)return;this.pE(t),this.yE(t);let e=this.adornments;for(;e.next();){const i=e.value;i.c(),i.hasPlaceholder()&&i.placeholder.c()}for(e=this.adornments;e.next();)e.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t.ha(),this.RD()!==!0&&this.OD(!0))}VM(){this.RD()!==!1&&(this.updateAdornments(),this.OD(!1))}pE(t){const e="Selection";if(this.isSelected&&this.selectionAdorned){const i=this.selectionObject;if(i!==null&&this.actualBounds.isReal()&&this.isVisible()&&i.isVisibleObject()&&i.actualBounds.isReal()){let s=this.findAdornment(e);if(s===null){let n=this.selectionAdornmentTemplate;n===null&&(this.Ar()?n=t.linkSelectionAdornmentTemplate:this instanceof at?n=t.groupSelectionAdornmentTemplate:n=t.nodeSelectionAdornmentTemplate),s=n.copy(),s!==null&&(this.Ar()&&this.selectionObject===this.path&&(s.type=j.Link),s.adornedObject=i)}if(s!==null){s.type===j.Link&&s.c(),this.addAdornment(e,s);return}}}this.removeAdornment(e)}yE(t){const e=this;t.toolManager.mouseDownTools.each(i=>{i.isEnabled&&i.updateAdornments(e)}),t.toolManager.updateAdornments(e)}IM(t){this.pl=t,t===null&&this.uI()}get layer(){return this.pl}get diagram(){const t=this.pl;return t==null?null:t.diagram}get layerName(){return this.dl}set layerName(t){const e=this.dl;if(e===t)return;let i=this.diagram;if(i!==null&&(i.findLayer(t)===null||i.partManager.addsToTemporaryLayer))return;this.dl=t,i!==null&&i.invalidateDocumentBounds(),this.t("layerName",e,t);const s=this.layer;if(s===null||s.name===t||(i=s.diagram,i===null))return;const n=i.findLayer(t);if(n===null||n===s)return;let o=s.ri(-1,this,!0);o>=0&&i.raiseChangedEvent(4,"parts",s,this,null,o,!0),o=n.ch(99999999,this,!0),s.visible!==n.visible&&this.Xe(n.visible),o>=0&&i.raiseChangedEvent(3,"parts",n,null,this,!0,o);const r=this.layerChanged;if(r===null)return;const a=i.G;i.G=!0,r(this,s,n),i.G=a}get layerChanged(){return this.H!==null?this.H.Py:null}set layerChanged(t){const e=this.layerChanged;e!==t&&(t!==null&&y.S(t,ft,"layerChanged"),this._e().Py=t,this.t("layerChanged",e,t))}get zOrder(){return this.qd}set zOrder(t){const e=this.qd;if(e===t)return;this.qd=t;const i=this.layer;i!==null&&i.rb(-1,this),this.t("zOrder",e,t);const s=this.diagram;s!==null&&s.C()}wE(){const t=this.layer;t!==null&&t.rb(-1,this)}hk(){if(this.fa()!==!1)return;this.hC(!0),this.yf();const t=this.diagram;t!==null&&(t.Cp(this),t.requestUpdate())}ID(){if(this.b|=2097152,this.fa()===!1)return;const t=this.position,e=this.location;(!e.isReal()||!t.isReal())&&this.ED(t,e);const i=this.De,s=I.l().h(i);i.ce(),i.x=t.x,i.y=t.y,i.k(),this.kd(s,i),I.i(s),this.hC(!1),this.yf()}lo(t,e,i,s){const n=this.hi;n.e(t,e,i,s),this.Se===null&&(this.Se=new wt);const o=this.Se;o.Ue(),this.Kp(o,t,e,i,s),this.Se=o,o.RP()||o.sm(n)}Kp(t,e,i,s,n){if(this.it!==1&&t.it(this.it),this.Xt===0)return;let o=T.Center;this.locationSpot.isSpot()&&(o=this.locationSpot);const r=P.l();if(this.locationObject!==this){const a=this.locationObject,l=a.naturalBounds;r.setSpot(l.x,l.y,l.width,l.height,o),a.Se!==null&&a.Se.gt(r),r.offset(-a.measuredBounds.x,-a.measuredBounds.y);let h=a.panel;for(;h!==null&&h!==this;)h.Se!==null&&h.Se.gt(r),r.offset(-h.measuredBounds.x,-h.measuredBounds.y),h=h.panel}else r.setSpot(e,i,s,n,o);t.ks(this.Xt,r.x,r.y),P.i(r)}get locationObject(){if(this.er===null)if(this instanceof pt&&this.type!==j.Link&&this.hasPlaceholder())this.er=this.placeholder;else{const t=this.locationObjectName;if(t!==""){const e=this.findObject(t);e!==null?this.er=e:this.er=this}else this.er=this}return this.er?.visible?this.er:this}get minLocation(){return this.H!==null?this.H.Sy:P.DL}set minLocation(t){const e=this.minLocation;e.equals(t)||(t=t.N(),this._e().Sy=t,this.t("minLocation",e,t))}get maxLocation(){return this.H!==null?this.H.My:P.vL}set maxLocation(t){const e=this.maxLocation;e.equals(t)||(t=t.N(),this._e().My=t,this.t("maxLocation",e,t))}get locationObjectName(){return this.H!==null?this.H.Ny:""}set locationObjectName(t){const e=this.locationObjectName;e!==t&&(this._e().Ny=t,this.er=null,this.c(),this.t("locationObjectName",e,t))}get locationSpot(){return this.H!==null?this.H.Cy:T.TopLeft}set locationSpot(t){const e=this.locationSpot;e.equals(t)||(t=t.N(),this._e().Cy=t,this.c(),this.t("locationSpot",e,t))}move(t,e){e===!0?this.location=t:this.position=t}moveTo(t,e,i){const s=P.z(t,e);this.move(s,i),P.i(s)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const i=t.diagram;if(i!==null&&i.animationManager.Wx(this))return!0}const e=this.containingGroup;return!(e!==null&&(!e.isSubGraphExpanded||!e.isVisible()))}Xe(t){const e=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),e!==null&&e.Cp(this)):(this.invalidateLayout(8),this.clearAdornments()),this.Sa(),e!==null&&(e.invalidateDocumentBounds(),this instanceof W&&this.canAvoid()&&e.fd(this),e.C())}findObject(t){if(this.name===t)return this;let e=this.xy;if(e===null&&(this.xy=e=new bt),e.get(t)!==null)return e.get(t);const i=super.findObject(t);return i!==null?(e.set(t,i),i):(e.set(t,null),null)}s0(){this.xy=null}getRelativePoint(t,e,i){i===void 0&&(i=new P);const s=e.isNoSpot()?T.Center:e,n=t.naturalBounds;if(i.e(n.width*s.x+s.offsetX,n.height*s.y+s.offsetY),t===null||t===this)return i;t.v.gt(i);let o=t.panel;for(;o!==null&&o!==this;)o.v.gt(i),o=o.panel;return this.Se!==null&&this.Se.gt(i),i.offset(-this.hi.x,-this.hi.y),i}getDocumentBounds(t){return t===void 0&&(t=new I),t.h(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Ut()}cD(t){const e=this.locationSpot,i=this.locationObject;let s=i.naturalBounds;s.isReal()||(s=I.em);const n=i instanceof et?i.strokeWidth:0;if(t.setSpot(0,0,s.width+n,s.height+n,e),i!==this){t.offset(-n/2,-n/2),i.v.gt(t);let o=i.panel;for(;o!==null&&o!==this;)o.v.gt(t),o=o.panel}return this.Se!==null&&this.Se.gt(t),t.offset(-this.hi.x,-this.hi.y),t}hh(t,e){const i=e===void 0?this.FD:e,s=this.xE(),n=s*2;if(!this.isShadowed)return i.e(t.x-1-s,t.y-1-s,t.width+2+n,t.height+2+n),i;let o=t.x,r=t.y,a=t.width,l=t.height;const h=this.shadowBlur,u=this.shadowOffset;return a+=h,l+=h,o-=h/2,r-=h/2,u.x>0?a+=u.x:(o+=u.x,a-=u.x),u.y>0?l+=u.y:(r+=u.y,l-=u.y),i.e(o-1,r-1,a+2,l+2),i}eE(){return this.type===j.Link&&this instanceof pt&&this.category==="Selection"&&this.adornedObject instanceof et&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}xE(){return isNaN(this.ky)&&(this.ky=this.yD()),this.ky}Df(){this.ky=NaN}Ut(){if(this.as()===!1){this.ID();return}this.ao(!1);const t=this.De,e=I.l();e.h(t);const i=this.Ul();this.Pa(0,0,this.hi.width,this.hi.height);const s=this.position;this.ED(s,this.location),t.ce(),t.x=s.x,t.y=s.y,t.k(),this.kd(e,t),e.equals(t)?this.As(i):this.Di()&&(!L.u(e.width,t.width)||!L.u(e.height,t.height))&&this.UM>=0&&this.invalidateLayout(16),I.i(e),this.hC(!1)}kd(t,e){const i=this.diagram;if(i===null)return;let s=!1;if(i.mh===!1&&t.isReal()){const n=I.l();n.h(i.documentBounds),n.subtractMargin(i.padding),t.x>n.x&&t.y>n.y&&t.right<n.right&&t.bottom<n.bottom&&e.x>n.x&&e.y>n.y&&e.right<n.right&&e.bottom<n.bottom&&(s=!0),I.i(n)}(this.bE()===!0||!t.equals(e))&&this.dT(s,i),i.C(),!(!t.isReal()&&!e.isReal()||t.equalsApproxClose(e))&&(this instanceof W&&!i.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.Sa())}get location(){return this.nn}set location(t){const e=t.x,i=t.y,s=this.nn;(s.x!==e&&(!isNaN(s.x)||!isNaN(e))||s.y!==i&&(!isNaN(s.y)||!isNaN(i)))&&(t=t.copy(),this.kE(t,s)&&this.t("location",s,t.copy()))}kE(t,e){if(this.Ar())return!1;if(this.nn=t,this.b|=2097152,this.as()===!1){this.hk();const i=this.ct;if(i.isReal()){const s=this.diagram;if(s===null||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing){const n=i.copy();i.e(i.x+(t.x-e.x),i.y+(t.y-e.y)),this.UD(s,i,n.x,n.y),this.t("position",n,i.copy())}}}return!0}DN(t,e,i){if(this.Ar()||!t.isReal())return!1;const s=this.diagram;if(s!==null&&this.UD(s,t,e,i),this.ct=t,this.b&=-2097153,this.nn.isReal()&&(s===null||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing)){const n=this.nn;this.nn=new P(n.x+(t.x-e),n.y+(t.y-i)).k(),this.t("location",n,this.nn.copy())}return this.fa()===!1&&this.as()===!1&&(this.hk(),this.ID()),!0}UD(t,e,i,s){if(t===null||this instanceof pt)return;const n=t.animationManager;n.ke&&n.vA(this,new P(i,s),e,!1)}Uc(t,e,i){const s=this.nn,n=this.ct;if(i){if(s.x===t&&s.y===e)return;this.fa()||this.as()?n.e(NaN,NaN):n.e(n.x+t-s.x,n.y+e-s.y),s.e(t,e)}else{if(n.x===t&&n.y===e)return;s.e(s.x+t-n.x,s.y+e-n.y),n.e(t,e)}this.hk()}vN(){this.b&=-2097153,this.hk()}ED(t,e){const i=this.cD(P.l()),s=this.diagram,n=e.isReal(),o=t.isReal();n&&o?(this.b&2097152)!==0?this.VD(t,e,s,i):this.BD(t,e,s,i):n?this.VD(t,e,s,i):o&&this.BD(t,e,s,i),this.b|=2097152,P.i(i),this.yf()}VD(t,e,i,s){const n=t.x,o=t.y;if(t.e(e.x-s.x,e.y-s.y),i!==null){const r=i.animationManager,a=r.defaultAnimation.isAnimating;!a&&r.ke&&!(this instanceof pt)&&r.vA(this,new P(n,o),t,!1),!a&&!(t.x===n&&t.y===o)&&this.t("position",new P(n,o),t.copy())}}BD(t,e,i,s){const n=e.copy();e.e(t.x+s.x,t.y+s.y),!e.equals(n)&&i!==null&&this.t("location",n,e.copy())}dT(t,e){this.NN(!1),this instanceof W&&e.fd(this),!this.layer.isTemporary&&!t&&e.invalidateDocumentBounds();const i=this.De,s=e.viewportBounds;s.isReal()?this.Ul()?(i.UL(s,10)||this.As(!1),this.updateAdornments()):this.isVisible()&&i.intersectsRect(s)?(this.As(!0),this.updateAdornments()):this.invalidateAdornments():e.tf=!0}_r(){return!0}Di(){return!0}Ar(){return!1}_s(){return!0}hasPlaceholder(){return!1}get category(){return this._o}set category(t){const e=this._o;if(e===t)return;this.svg!==null&&(this.svg.remove(),this.$i(!0));const i=this.diagram,s=this.data;let n=null;if(i!==null&&s!==null&&!(this instanceof pt)){const o=i.model.undoManager;o.isEnabled&&!o.isUndoingRedoing&&(n=this.clone(),n.D.addAll(this.D))}if(this._o=t,this.t("category",e,t),i!==null&&s!==null&&!(this instanceof pt)){const o=i.model;if(o.undoManager.isUndoingRedoing)return;if(this.Ar()){i.partManager.setLinkCategoryForData(s,t);const r=i.partManager.findLinkTemplateForCategory(t);if(r!==null){r.It();const a=r.copy();a!==null&&this.cC(a,e,t)}}else{o!==null&&o.setCategoryForNodeData(s,t);const r=i.partManager.findTemplateForNodeData(s,t);if(r!==null){r.It();const a=r.copy();if(a!==null&&!(a instanceof U)){const l=this.location.copy();this.cC(a,e,t),this.location.isReal()||(this.location=l)}}}if(n!==null){const r=this.clone();r.D.addAll(this.D),this.t("self",n,r)}}else if(this instanceof pt){const o=this.adornedPart;if(o!==null){const r=o.tr;r!==null&&r.delete(e),o.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.cC(t,this.category,t.category)}static zD=!1;cC(t,e,i){t.constructor!==this.constructor&&(ft.zD||(ft.zD=!0,y.ne('Should not change the class of the Part when changing category from "'+e+'" to "'+i+'"'),y.ne("  Old class: "+y.Hn(this.constructor)+", new class: "+y.Hn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const s=this.data,n=this.layerName,o=this.isSelected,r=this.isHighlighted;let a=!0,l=!0,h=!1;this instanceof W&&(a=this.isTreeLeaf,l=this.isTreeExpanded,h=this.wasTreeExpanded),t.jo(this),t.cloneProtected(this),this._o=i,this.svg!==null&&(this.svg.remove(),this.Wc(),this.$i(!0)),this.c(),this.C();const u=this.diagram;let c=!0;u!==null&&(c=u.skipsUndoManager,u.skipsUndoManager=!0),this.te=s,this.b=o?this.b|4096:this.b&-4097,this.b=r?this.b|524288:this.b&-524289,this instanceof W&&(this.E=a?this.E|4:this.E&-5,this.E=l?this.E|1:this.E&-2,this.E=h?this.E|2:this.E&-3),s!==null&&this.updateTargetBindings();const d=this.layerName;d!==n&&(this.dl=n,this.layerName=d),u!==null&&(u.skipsUndoManager=c),this.Di()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const e=t.diagram;return e===null?!0:!!e.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const e=t.diagram;return e===null?!0:!!e.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const e=t.diagram;return e===null?!0:!!e.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const e=t.diagram;return e===null?!0:!!e.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const e=t.diagram;return e===null?!0:!!e.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const e=t.diagram;return e===null?!0:!!e.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const e=t.diagram;return e===null?!0:!!e.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const e=t.diagram;return e===null?!0:!!e.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const e=t.diagram;return e===null?!0:!!e.allowSelect}get copyable(){return(this.b&1)!==0}set copyable(t){const e=(this.b&1)!==0;e!==t&&(this.b=this.b^1,this.t("copyable",e,t))}get deletable(){return(this.b&2)!==0}set deletable(t){const e=(this.b&2)!==0;e!==t&&(this.b=this.b^2,this.t("deletable",e,t))}get textEditable(){return(this.b&4)!==0}set textEditable(t){const e=(this.b&4)!==0;e!==t&&(this.b=this.b^4,this.t("textEditable",e,t),this.invalidateAdornments())}get groupable(){return(this.b&8)!==0}set groupable(t){const e=(this.b&8)!==0;e!==t&&(this.b=this.b^8,this.t("groupable",e,t))}get movable(){return(this.b&16)!==0}set movable(t){const e=(this.b&16)!==0;e!==t&&(this.b=this.b^16,this.t("movable",e,t))}get selectionAdorned(){return(this.b&32)!==0}set selectionAdorned(t){const e=(this.b&32)!==0;e!==t&&(this.b=this.b^32,this.t("selectionAdorned",e,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.b&64)!==0}set isInDocumentBounds(t){const e=(this.b&64)!==0;if(e!==t){this.b=this.b^64;const i=this.diagram;i!==null&&i.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t)}}get isLayoutPositioned(){return(this.b&128)!==0}set isLayoutPositioned(t){const e=(this.b&128)!==0;e!==t&&(this.b=this.b^128,this.t("isLayoutPositioned",e,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.b&256)!==0}set selectable(t){const e=(this.b&256)!==0;e!==t&&(this.b=this.b^256,this.t("selectable",e,t),this.invalidateAdornments())}get reshapable(){return(this.b&512)!==0}set reshapable(t){const e=(this.b&512)!==0;e!==t&&(this.b=this.b^512,this.t("reshapable",e,t),this.invalidateAdornments())}get resizable(){return(this.b&1024)!==0}set resizable(t){const e=(this.b&1024)!==0;e!==t&&(this.b=this.b^1024,this.t("resizable",e,t),this.invalidateAdornments())}get rotatable(){return(this.b&2048)!==0}set rotatable(t){const e=(this.b&2048)!==0;e!==t&&(this.b=this.b^2048,this.t("rotatable",e,t),this.invalidateAdornments())}get isSelected(){return(this.b&4096)!==0}set isSelected(t){const e=(this.b&4096)!==0;if(e!==t){const i=this.diagram;if(t){if(!this.canSelect())return;if(i!==null){const o=i.maxSelectionCount;if(i.selection.count>=o)return}}this.b=this.b^4096;let s=!1;if(i!==null){s=i.skipsUndoManager,i.skipsUndoManager=!0;const o=i.selection;o.ce(),t?o.add(this):o.delete(this),o.k()}this.t("isSelected",e,t),this.invalidateAdornments();const n=this.selectionChanged;n!==null&&n(this),i!==null&&(i.requestUpdate(),i.skipsUndoManager=s)}}get isHighlighted(){return(this.b&524288)!==0}set isHighlighted(t){const e=(this.b&524288)!==0;if(e!==t){this.b=this.b^524288;const i=this.diagram;if(i!==null){const n=i.highlighteds;n.ce(),t?n.add(this):n.delete(this),n.k()}this.t("isHighlighted",e,t),this.C();const s=this.highlightedChanged;s!==null&&s(this)}}get isShadowed(){return(this.b&8192)!==0}set isShadowed(t){const e=(this.b&8192)!==0;e!==t&&(this.b=this.b^8192,this.$i(!0),this.t("isShadowed",e,t),this.C())}RD(){return(this.b&16384)!==0}OD(t){t?this.b|=16384:this.b&=-16385}fa(){return(this.b&32768)!==0}hC(t){t?this.b|=32768:this.b&=-32769}bE(){return(this.b&65536)!==0}NN(t){t?this.b|=65536:this.b&=-65537}Ul(){return(this.b&131072)!==0}As(t){t?this.b|=131072:this.b&=-131073}XD(){return(this.b&1048576)!==0}ck(t){t?this.b|=1048576:this.b&=-1048577}get isAnimated(){return(this.b&262144)!==0}set isAnimated(t){const e=(this.b&262144)!==0;e!==t&&(this.b=this.b^262144,this.t("isAnimated",e,t))}get highlightedChanged(){return this.H!==null?this.H.Ly:null}set highlightedChanged(t){const e=this.highlightedChanged;e!==t&&(t!==null&&y.S(t,ft,"highlightedChanged"),this._e().Ly=t,this.t("highlightedChanged",e,t))}get selectionObjectName(){return this.H!==null?this.H.Ay:""}set selectionObjectName(t){const e=this.selectionObjectName;e!==t&&(this._e().Ay=t,this.gl=null,this.t("selectionObjectName",e,t))}get selectionAdornmentTemplate(){return this.H!==null?this.H.Ty:null}set selectionAdornmentTemplate(t){const e=this.selectionAdornmentTemplate;e!==t&&(t!==null&&t.It(),this._e().Ty=t,this.t("selectionAdornmentTemplate",e,t))}get selectionObject(){if(this.gl===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const e=this.findObject(t);e!==null?this.gl=e:this.gl=this}else if(this instanceof U){const e=this.path;e!==null?this.gl=e:this.gl=this}else this.gl=this}return this.gl}get selectionChanged(){return this.H!==null?this.H.Dy:null}set selectionChanged(t){const e=this.selectionChanged;e!==t&&(t!==null&&y.S(t,ft,"selectionChanged"),this._e().Dy=t,this.t("selectionChanged",e,t))}get resizeAdornmentTemplate(){return this.H!==null?this.H.vy:null}set resizeAdornmentTemplate(t){const e=this.resizeAdornmentTemplate;e!==t&&(this._e().vy=t!==null?t.It():null,this.t("resizeAdornmentTemplate",e,t))}get resizeObjectName(){return this.H!==null?this.H.Fy:""}set resizeObjectName(t){const e=this.resizeObjectName;e!==t&&(this._e().Fy=t,this.t("resizeObjectName",e,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const e=this.findObject(t);if(e!==null)return e}return this}get resizeCellSize(){return this.H!==null?this.H.Ry:st.Zw}set resizeCellSize(t){const e=this.resizeCellSize;e.equals(t)||(t=t.N(),this._e().Ry=t,this.t("resizeCellSize",e,t))}get rotateAdornmentTemplate(){return this.H!==null?this.H.Oy:null}set rotateAdornmentTemplate(t){const e=this.rotateAdornmentTemplate;e!==t&&(this._e().Oy=t!==null?t.It():null,this.t("rotateAdornmentTemplate",e,t))}get rotateObjectName(){return this.H!==null?this.H.Iy:""}set rotateObjectName(t){const e=this.rotateObjectName;e!==t&&(this._e().Iy=t,this.t("rotateObjectName",e,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const e=this.findObject(t);if(e!==null)return e}return this}get rotationSpot(){return this.H!==null?this.H.Ey:T.Default}set rotationSpot(t){const e=this.rotationSpot;e.equals(t)||(t=t.N(),this._e().Ey=t,this.t("rotationSpot",e,t))}get text(){return this.ue}set text(t){const e=this.ue;e!==t&&(this.ue=t,this.t("text",e,t))}get containingGroup(){return this.Ta}set containingGroup(t){if(this.Di()){const e=this.Ta;if(e!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&y.o("Cannot make a Group a member of itself: "+this.toString()),y.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const i=this.diagram;if(e!==null?e.fC(this):this instanceof at&&i!==null&&i.Zr.delete(this),this.Ta=t,t!==null?t.uC(this):this instanceof at&&i!==null&&i.Zr.add(this),this.invalidateLayout(1),i!==null&&i.G){const n=this.data,o=i.model;if(n!==null&&o.uf()){const r=t!==null?t.data:null;o.setGroupForData(n,o.getKeyForNodeData(r))}}const s=this.containingGroupChanged;if(s!==null){let n=!0;i!==null&&(n=i.G,i.G=!0),s(this,e,t),i!==null&&(i.G=n)}if(this instanceof at){const n=new K;ft.ga(n,this,!0,0,!0);const o=n.iterator;for(;o.next();){const r=o.value;if(r instanceof W){const a=r.linksConnected;for(;a.next();)a.value.Wd()}}}if(this instanceof W){const n=this.linksConnected;for(;n.next();)n.value.Wd();const o=this.labeledLink;o!==null&&o.Wd()}this.t("containingGroup",e,t),t!==null&&t.wE()}}else y.o("cannot set the Part.containingGroup of a Link or Adornment")}Sa(){const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&t.placeholder.c(),t.c(),t.invalidateConnectedLinks())}C(){const t=this.diagram;t!==null&&!this.as()&&!this.fa()&&this.isVisible()&&this.De.isReal()&&t.C(this.hh(this.De))}c(){if(this.Go())return;super.c();const t=this.diagram;t!==null&&(t.Cp(this),this instanceof W&&this.labeledLink!==null&&this.labeledLink.Pf(),t.requestUpdate(!0))}Pf(t){if(this.as())return;const e=this.diagram;e!==null&&(e.Cp(this),this instanceof W&&this.invalidateConnectedLinks(),e.requestUpdate()),this.ao(!0)}tp(t){if(!t){const e=this.Ta;e!==null&&e.uC(this)}}ep(t){if(!t){const e=this.Ta;e!==null&&e.fC(this)}}lf(){const t=this.data;if(t!==null){const e=this.diagram;if(e!==null){const i=e.model;i!==null&&i.removeNodeData(t)}}}get containingGroupChanged(){return this.H!==null?this.H.Uy:null}set containingGroupChanged(t){const e=this.containingGroupChanged;e!==t&&(t!==null&&y.S(t,ft,"containingGroupChanged"),this._e().Uy=t,this.t("containingGroupChanged",e,t))}findSubGraphLevel(){return this.dC(this)}dC(t){const e=t.containingGroup;if(e!==null)return 1+this.dC(e);if(t instanceof W){const i=t.labeledLink;if(i!==null)return this.dC(i)}return 0}findTopLevelPart(){return this.gC(this)}gC(t){const e=t.containingGroup;if(e!==null)return this.gC(e);if(t instanceof W){const i=t.labeledLink;if(i!==null)return this.gC(i)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof W&&this.labeledLink!==null)}isMemberOf(t){return t instanceof at?this.mC(this,t):!1}mC(t,e){if(t===e||e===null)return!1;const i=t.containingGroup;if(i!==null&&(i===e||this.mC(i,e)))return!0;if(t instanceof W){const s=t.labeledLink;if(s!==null)return this.mC(s,e)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let e=this;for(;e!==null;){if(e instanceof at&&e.ck(!0),e instanceof W){const s=e.labeledLink;s!==null&&(e=s)}e=e.containingGroup}let i=null;for(e=t;e!==null;){if(e.XD()){i=e;break}if(e instanceof W){const s=e.labeledLink;s!==null&&(e=s)}e=e.containingGroup}for(e=this;e!==null;){if(e instanceof at&&e.ck(!1),e instanceof W){const s=e.labeledLink;s!==null&&(e=s)}e=e.containingGroup}return i}get layoutConditions(){return this.H!==null?this.H.Vy:127}set layoutConditions(t){const e=this.layoutConditions;e!==t&&(this._e().Vy=t,this.t("layoutConditions",e,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof W&&this.isLinkLabel)}PE(t){if(!this.isLayoutPositioned||(t&this.layoutConditions)===0)return!1;const e=this.layer;if(e!==null&&e.isTemporary||this instanceof W&&this.isLinkLabel)return!1;const i=this.diagram;return!(i!==null&&i.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.PE(t))return;const e=this.Ta;if(e!==null){const i=e.layout;i!==null?i.p():e.invalidateLayout(t)}else{const i=this.diagram;if(i!==null){const s=i.layout;s!==null&&s.p()}}}gT(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static ga(t,e,i,s,n,o){if(o===void 0&&(o=null),!t.has(e)&&!(o!==null&&!o(e))&&!(e instanceof pt)){if(t.add(e),e instanceof W){if(i&&e instanceof at){const r=e.memberParts;for(;r.next();){const a=r.value;ft.ga(t,a,i,s,n,o)}}if(n!==!1){const r=e.linksConnected;for(;r.next();){const a=r.value;if(t.has(a))continue;const l=a.fromNode,h=a.toNode,u=l===null||t.has(l),c=h===null||t.has(h);(n?u&&c:u||c)&&ft.ga(t,a,i,s,n,o)}}if(s>1){const r=e.findTreeChildrenNodes();for(;r.next();){const a=r.value;ft.ga(t,a,i,s-1,n,o)}}}else if(e instanceof U){const r=e.labelNodes;for(;r.next();){const a=r.value;ft.ga(t,a,i,s,n,o)}}}}get dragComputation(){return this.H!==null?this.H.By:null}set dragComputation(t){const e=this.dragComputation;e!==t&&(t!==null&&y.S(t,ft,"dragComputation"),this._e().By=t,this.t("dragComputation",e,t))}get shadowOffset(){return this.H!==null?this.H.zy:P.FL}set shadowOffset(t){const e=this.shadowOffset;e.equals(t)||(t=t.N(),this._e().zy=t,this.C(),this.t("shadowOffset",e,t))}get shadowColor(){return this.H!==null?this.H.Xy:"gray"}set shadowColor(t){const e=this.shadowColor;e!==t&&(this._e().Xy=t,this.C(),this.t("shadowColor",e,t))}get shadowBlur(){return this.H!==null?this.H.An:4}set shadowBlur(t){const e=this.shadowBlur;e!==t&&(this._e().An=t,this.C(),this.t("shadowBlur",e,t))}}class yi{me;Py;Uy;Ty;Ay;Dy;Ly;vy;Fy;Ry;Oy;Iy;Ey;Ny;Cy;Sy;My;By;Vy;zy;Xy;An;constructor(){this.me=!1,this.Py=null,this.Uy=null,this.Ty=null,this.Ay="",this.Dy=null,this.Ly=null,this.vy=null,this.Fy="",this.Ry=st.Zw,this.Oy=null,this.Iy="",this.Ey=T.Default,this.Ny="",this.Cy=T.TopLeft,this.Sy=P.DL,this.My=P.vL,this.By=null,this.Vy=127,this.zy=P.FL,this.Xy="gray",this.An=4}copy(){const t=new yi;return t.Py=this.Py,t.Uy=this.Uy,t.Ty=this.Ty,t.Ay=this.Ay,t.Dy=this.Dy,t.Ly=this.Ly,t.vy=this.vy,t.Fy=this.Fy,t.Ry=this.Ry.N(),t.Oy=this.Oy,t.Iy=this.Iy,t.Ey=this.Ey.N(),t.Ny=this.Ny,t.Cy=this.Cy.N(),t.Sy=this.Sy.N(),t.My=this.My.N(),t.By=this.By,t.Vy=this.Vy,t.zy=this.zy.N(),t.Xy=this.Xy,t.An=this.An,t}}class pt extends ft{Ms;Dt;WS;JS;Af;constructor(t,e){let i;t===void 0||t instanceof Pt||typeof t=="string"?i=t:t&&(e=t),super(i),this.b&=-257,this.dl="Adornment",this.Ms=null,this.WS=0,this.JS=!1,this.Dt=null,this.Af=null,e&&Object.assign(this,e)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}Td(t){const e=this.adornedObject;if(!(e instanceof et))return;const i=e.part;if(!(i instanceof U))return;const s=i.path;let n=s.geometry;i.Td(t),n=s.geometry;const o=this.D.r,r=o.length;for(let a=0;a<r;a++){const l=o[a];l.isPanelMain&&l instanceof et&&(l.ut=n)}}hasPlaceholder(){return this.Dt!==null&&this.Dt.isVisibleObject()}get placeholder(){return this.Dt}get adornedObject(){return this.Ms}set adornedObject(t){const e=this.adornedPart;let i=null;t!==null&&(i=t.part),e!==null&&(t===null||e!==i)&&e.removeAdornment(this.category),this.Ms=t,i!==null&&i.addAdornment(this.category,this)}get adornedPart(){const t=this.Ms;return t!==null?t.part:null}_r(){const t=this.Ms;if(t===null)return!0;const e=t.part;return e===null||!e.as()}Di(){return!1}get containingGroup(){return null}gf(t,e,i,s,n,o,r){if(t===3&&e==="elements"){if(n instanceof Jt)this.Dt===null&&(this.Dt=n);else if(n instanceof j){const a=n.findInVisualTree(l=>l instanceof Jt);a instanceof Jt&&this.Dt===null&&(this.Dt=a)}}else t===4&&e==="elements"&&this.Dt!==null&&(s===this.Dt?this.Dt=null:s instanceof j&&this.Dt.isContainedBy(s)&&(this.Dt=null));super.gf(t,e,i,s,n,o,r)}updateAdornments(){}lf(){}}var ds=(x=>(x[x.None=0]="None",x[x.Evenly=1]="Evenly",x[x.Packed=2]="Packed",x))(ds||{});class W extends ft{E;vt;Xf;yl;Da;ci;ee;constructor(t,e){let i;t===void 0||t instanceof Pt||typeof t=="string"?i=t:t&&(e=t),super(i),this.E=13,this.vt=null,this.ee=new J,this.Xf=null,this.yl=null,this.ci=null,this.Da=!1,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,this.vt!==null&&(this.vt.me?t.vt=this.vt:t.vt=this.vt.copy())}jo(t){super.jo(t),t.invalidateConnectedLinks(),t.yl=this.yl,t.ci=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;wl(){return this.vt===null?this.vt=new xi:this.vt.me&&(this.vt=this.vt.copy()),this.vt}ba(){super.ba(),this.vt!==null&&(this.vt.me=!0)}GD(t){t!==null&&(this.yl===null&&(this.yl=new K),this.yl.add(t))}YD(t){t!==null&&this.yl!==null&&this.yl.delete(t)}KD(t,e,i){if(t===null||this.yl===null)return null;const s=this.yl.iterator;for(;s.next();){const n=s.value;if(n.Gy===this&&n.fk===t&&n.pC===e&&n.yC===i||n.Gy===t&&n.fk===this&&n.pC===i&&n.yC===e)return n}return null}invalidateLinkBundle(t,e,i){e==null&&(e=""),i==null&&(i="");const s=this.KD(t,e,i);s!==null&&s.Jd()}gf(t,e,i,s,n,o,r){t===3&&e==="elements"?this.ci=null:t===4&&e==="elements"&&(this.ci=null),super.gf(t,e,i,s,n,o,r)}invalidateConnectedLinks(t,e){const i=this.linksConnected;for(;i.next();){const s=i.value;t&&t.has(s)||e&&s.fromPort!==e&&s.toPort!==e||(this.Ze(s.fromPort),this.Ze(s.toPort),s.$t())}}Ze(t){if(t===null)return;const e=t.yd;e!==null&&e.Jd();const i=t.part,s=i.containingGroup;s!==null&&!i.isVisible()&&s.Ze(s.port)}_r(){return!0}get portSpreading(){return this.vt!==null?this.vt.Yy:1}set portSpreading(t){const e=this.portSpreading;if(e!==t){this.wl().Yy=t,this.t("portSpreading",e,t);const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.E&8)!==0}set avoidable(t){const e=(this.E&8)!==0;if(e!==t){this.E=this.E^8;const i=this.diagram;i!==null&&i.fd(this),this.t("avoidable",e,t)}}get avoidableMargin(){return this.vt!==null?this.vt.Ky:Mt.BL}set avoidableMargin(t){typeof t=="number"&&(t=new Mt(t));const e=this.avoidableMargin;if(!e.equals(t)){t=t.N(),this.wl().Ky=t;const i=this.diagram;i!==null&&i.fd(this),this.t("avoidableMargin",e,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,e=1;const i=this.diagram;if(i!==null){if(i.animationManager.Wx(this))return!0;t=i.isTreePathToChildren,e=i.treeCollapsePolicy}if(e===1){const n=this.findTreeParentNode();if(n!==null&&!n.isTreeExpanded)return!1}else if(e===2){const n=t?this.findLinksInto():this.findLinksOutOf();let o=!1,r=!1;for(;n.next();){const a=n.value;if(a.isTreeLink){o=!0;const l=t?a.fromNode:a.toNode;if(l&&l.isTreeExpanded){r=!0;break}}}if(o&&!r)return!1}else if(e===3){const n=t?this.findLinksInto():this.findLinksOutOf();let o=!1,r=!1;for(;n.next();){const a=n.value;if(a.isTreeLink){o=!0;const l=t?a.fromNode:a.toNode;if(l&&!l.isTreeExpanded){r=!0;break}}}if(o&&r)return!1}const s=this.labeledLink;return s!==null?s.isVisible():!0}Xe(t){super.Xe(t);const e=this.linksConnected;for(;e.next();){const i=e.value;if(t&&this.containingGroup!==null){const s=i.getOtherNode(this);s!==null&&!s.isMemberOf(this.containingGroup)&&i.$t()}i.Xe(t)}}get linksConnected(){return this.ee.iterator}findExternalTreeLinksConnected(){const t=new K,e=new K;return this.HD(this,t,e),e.iterator}HD(t,e,i){if(t===null||e.has(t))return;e.add(t);let s=!0;const n=this.diagram;n!==null&&(s=n.isTreePathToChildren),t.linksConnected.each(o=>{o.isTreeLink?(s?o.fromNode===t:o.toNode===t)&&this.HD(s?o.toNode:o.fromNode,e,i):i.add(o)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this.ee.iterator;const e=new Se(this.ee),i=this;return e.predicate=s=>s.fromNode===i&&s.fromPortId===t||s.toNode===i&&s.toPortId===t,e}findLinksOutOf(t){t===void 0&&(t=null);const e=new Se(this.ee),i=this;return e.predicate=s=>s.fromNode!==i?!1:t===null?!0:s.fromPortId===t,e}findLinksInto(t){t===void 0&&(t=null);const e=new Se(this.ee),i=this;return e.predicate=s=>s.toNode!==i?!1:t===null?!0:s.toPortId===t,e}findNodesConnected(t){t===void 0&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this){if(t===null||n.fromPortId===t){const o=n.toNode;e!==null?e.add(o):i!==null&&i!==o?(e=new K,e.add(i),e.add(o)):i=o}}else if(n.toNode===this&&(t===null||n.toPortId===t)){const o=n.fromNode;e!==null?e.add(o):i!==null&&i!==o?(e=new K,e.add(i),e.add(o)):i=o}}return e!==null?e.iterator:i!==null?new Pe(i):Ut.instance}findNodesOutOf(t){t===void 0&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this&&(t===null||n.fromPortId===t)){const o=n.toNode;e!==null?e.add(o):i!==null&&i!==o?(e=new K,e.add(i),e.add(o)):i=o}}return e!==null?e.iterator:i!==null?new Pe(i):Ut.instance}findNodesInto(t){t===void 0&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.toNode===this&&(t===null||n.toPortId===t)){const o=n.fromNode;e!==null?e.add(o):i!==null&&i!==o?(e=new K,e.add(i),e.add(o)):i=o}}return e!==null?e.iterator:i!==null?new Pe(i):Ut.instance}findLinksBetween(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null);const s=new Se(this.ee),n=this;return s.predicate=o=>o.fromNode===n&&o.toNode===t&&(e===null||o.fromPortId===e)&&(i===null||o.toPortId===i)||o.fromNode===t&&o.toNode===n&&(i===null||o.fromPortId===i)&&(e===null||o.toPortId===e),s}findLinksTo(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null);const s=new Se(this.ee),n=this;return s.predicate=o=>!(o.fromNode!==n||o.toNode!==t||e!==null&&o.fromPortId!==e||i!==null&&o.toPortId!==i),s}findSuccessorParts(t){return t===void 0&&(t=new K),this.jD(this,t),t.remove(this),t}jD(t,e){t!==null&&(e.has(t)||(e.add(t),t.findLinksOutOf().each(i=>{if(e.has(i))return;e.add(i);const s=i.toNode;s!==null&&this.jD(s,e)})))}findPredecessorParts(t){return t===void 0&&(t=new K),this.qD(this,t),t.remove(this),t}qD(t,e){t!==null&&(e.has(t)||(e.add(t),t.findLinksInto().each(i=>{if(e.has(i))return;e.add(i);const s=i.fromNode;s!==null&&this.qD(s,e)})))}get linkConnected(){return this.vt!==null?this.vt.Hy:null}set linkConnected(t){const e=this.linkConnected;e!==t&&(t!==null&&y.S(t,W,"linkConnected"),this.wl().Hy=t,this.t("linkConnected",e,t))}get linkDisconnected(){return this.vt!==null?this.vt.jy:null}set linkDisconnected(t){const e=this.linkDisconnected;e!==t&&(t!==null&&y.S(t,W,"linkDisconnected"),this.wl().jy=t,this.t("linkDisconnected",e,t))}get linkValidation(){return this.vt!==null?this.vt.El:null}set linkValidation(t){const e=this.linkValidation;e!==t&&(t!==null&&y.S(t,W,"linkValidation"),this.wl().El=t,this.t("linkValidation",e,t))}uk(t,e){this.Ze(e);const i=this.ee.has(t);if(i||this.ee.add(t),!i||t.fromNode===t.toNode){const s=this.linkConnected;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.G,o.G=!0),s(this,t,e),o!==null&&(o.G=n)}}if(!i){if(!t.isTreeLink)return;const s=t.fromNode,n=t.toNode;if(s!==null&&n!==null&&s!==n){let o=!0;const r=this.diagram;r!==null&&(o=r.isTreePathToChildren);const a=o?n:s,l=o?s:n;if(a.Da||(a.Da=l),l.isTreeLeaf){if(r!==null&&r.undoManager.isUndoingRedoing)return;o?s===l&&(l.isTreeLeaf=!1):n===l&&(l.isTreeLeaf=!1)}}}}dk(t,e){this.Ze(e);const i=this.ee.delete(t);let s=null;if(i||t.toNode===t.fromNode){const n=this.linkDisconnected;if(s=this.diagram,n!==null){let o=!0;s!==null&&(o=s.G,s.G=!0),n(this,t,e),s!==null&&(s.G=o)}}if(i){if(!t.isTreeLink)return;let n=!0;s!==null&&(n=s.isTreePathToChildren);const o=n?t.toNode:t.fromNode,r=n?t.fromNode:t.toNode;if(o!==null&&(o.Da=!1),r!==null&&!r.isTreeLeaf)if(r.ee.count===0){if(r.Da=null,s!==null&&s.undoManager.isUndoingRedoing)return;r.isTreeLeaf=!0}else r.vp()}}vp(){if(this.Da=!1,this.ee.count===0)return;let t=!0;const e=this.diagram;if(e!==null&&e.undoManager.isUndoingRedoing)return;e!==null&&(t=e.isTreePathToChildren);const i=this.ee.iterator;for(;i.next();){const s=i.value;if(s.isTreeLink){if(t){if(s.fromNode===this){this.isTreeLeaf=!1;return}}else if(s.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}tp(t){if(super.tp(t),!t){this.vp();const e=this.Xf;e!==null&&e.WD(this)}}ep(t){if(super.ep(t),!t){const e=this.Xf;e!==null&&e.JD(this)}}lf(){if(this.ee.count>0){const t=this.diagram;if(t!==null){const e=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,i=this.ee.copy().iterator;for(;i.next();){const s=i.value;e?t.remove(s):(s.fromNode===this&&(s.fromNode=null),s.toNode===this&&(s.toNode=null))}}}this.labeledLink=null,super.lf()}get isLinkLabel(){return this.Xf!==null}get labeledLink(){return this.Xf}set labeledLink(t){const e=this.Xf;if(e!==t){const i=this.diagram,s=this.data;if(e!==null){if(e.JD(this),i!==null&&s!==null&&!i.undoManager.isUndoingRedoing){const n=e.data,o=i.model;if(n!==null&&o.Wh()){const r=o.getKeyForNodeData(s);r!==void 0&&o.removeLabelKeyForLinkData(n,r)}}this.containingGroup=null}if(this.Xf=t,t!==null){if(t.WD(this),i!==null&&s!==null&&!i.undoManager.isUndoingRedoing){const n=t.data,o=i.model;if(n!==null&&o.Wh()){const r=o.getKeyForNodeData(s);r!==void 0&&o.addLabelKeyForLinkData(n,r)}}this.containingGroup=t.containingGroup}this.Pf(),this.t("labeledLink",e,t)}}findVisiblePort(t){let e=t;for(;e!==null&&(!e.actualBounds.isReal()||!e.isVisibleObject());)e=e.panel;return e===null?this.port:e}findPort(t){if(this.ci===null){if(t===""&&this.Ln===!1)return this;this.$D()}let e=this.ci.get(t);return e!==null||t!==""&&(e=this.ci.get(""),e!==null)?e:this}get port(){return this.findPort("")}get ports(){return this.ci===null&&this.$D(),this.ci.iteratorValues}$D(){this.ci===null?this.ci=new bt:this.ci.clear(),this.walkVisualTreeFrom(this,(t,e)=>t.sD(e)),this.ci.count===0&&this.ci.set("",this)}sD(t){const e=t.portId;e!==null&&this.ci!==null&&this.ci.set(e,t)}FN(t,e){const i=t.portId;if(i!==null){this.ci!==null&&this.ci.delete(i);const s=this.diagram;if(s!==null&&e){let n=null;const o=this.findLinksConnected(i);for(;o.next();){const r=o.value;n===null&&(n=y.nt()),n.push(r)}if(n!==null){for(let r=0;r<n.length;r++){const a=n[r];s.remove(a)}y.Z(n)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let e=!0;const i=this.diagram;i!==null&&(e=i.isTreePathToChildren);let s=this;const n=t;let o;if(e)for(;s!==n;){o=null;const r=s.ee.iterator;for(;r.next();){const a=r.value;if(a.isTreeLink&&(o=a.fromNode,o!==s&&o!==this))break}if(o===this||o===null||o===s)return!1;s=o}else for(;s!==n;){o=null;const r=s.ee.iterator;for(;r.next();){const a=r.value;if(a.isTreeLink&&(o=a.toNode,o!==s&&o!==this))break}if(o===this||o===null||o===s)return!1;s=o}return!0}findTreeRoot(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);let i=this,s;if(t)for(;;){s=null;const n=i.ee.iterator;for(;n.next();){const o=n.value;if(o.isTreeLink&&(s=o.fromNode,s!==i&&s!==this))break}if(s===this)return this;if(s===null||s===i)return i;i=s}else for(;;){s=null;const n=i.ee.iterator;for(;n.next();){const o=n.value;if(o.isTreeLink&&(s=o.toNode,s!==i&&s!==this))break}if(s===this)return this;if(s===null||s===i)return i;i=s}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let e=this;for(;e!==null;)e.ck(!0),e=e.findTreeParentNode();let i=null;for(e=t;e!==null;){if(e.XD()){i=e;break}e=e.findTreeParentNode()}for(e=this;e!==null;)e.ck(!1),e=e.findTreeParentNode();return i}findTreeParentLink(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);const i=this.ee.iterator;if(t)for(;i.next();){const s=i.value;if(s.isTreeLink&&s.fromNode!==this)return s}else for(;i.next();){const s=i.value;if(s.isTreeLink&&s.toNode!==this)return s}return null}findTreeParentNode(){const t=this.Da;if(t===null)return null;if(t instanceof W)return t;const e=this.diagram,i=e!==null?e.isTreePathToChildren:!0,s=this.ee.iterator;for(;s.next();){const n=s.value;if(!n.isTreeLink)continue;const o=i?n.fromNode:n.toNode;if(o!==this)return this.Da=o,o}return this.Da=null,null}findTreeParentChain(t){function e(i,s){s.add(i);const n=i.findTreeParentLink();if(n!==null){s.add(n);const o=i.findTreeParentNode();if(o===null)return;e(o,s)}}return t===void 0&&(t=new K),e(this,t),t}findTreeLevel(){return this.SE(this)}SE(t){let e=0,i=t.findTreeParentNode();for(;i!==null&&i!==t;)i=i.findTreeParentNode(),e++;return e}findTreeChildrenLinks(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);const i=new Se(this.ee),s=this;return t?i.predicate=n=>!(!n.isTreeLink||n.fromNode!==s):i.predicate=n=>!(!n.isTreeLink||n.toNode!==s),i}findTreeChildrenNodes(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);let i=null,s=null;const n=this.ee.iterator;if(t)for(;n.next();){const o=n.value;if(o.isTreeLink&&o.fromNode===this){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new J,i.add(s),i.add(r)):s=r}}else for(;n.next();){const o=n.value;if(o.isTreeLink&&o.toNode===this){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new J,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new Pe(s):Ut.instance}findTreeParts(t,e){return t===void 0&&(t=1/0),y.s(t,"number",W,"findTreeParts:level"),e===void 0&&(e=new K),ft.ga(e,this,!1,t,!0),e}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const e=this.diagram;if(e===null||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const i=new K;i.add(this),this.ZD(i,e.isTreePathToChildren,t,e,this,e.treeCollapsePolicy===1),e.isCollapsingExpanding=!1}ZD(t,e,i,s,n,o){if(i>1){const r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const a=r.value;if(!a.isTreeLink)continue;const l=a.getOtherNode(this);l!==null&&l!==this&&!t.has(l)&&(t.add(l),l.ZD(t,e,i-1,s,n,o))}}else this.QD(t,e,s,n,o)}QD(t,e,i,s,n){const o=s===this?!0:this.isTreeExpanded,r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const a=r.value;if(!a.isTreeLink)continue;const l=a.getOtherNode(this);if(l!==null&&l!==this){const h=t.has(l);if(h||t.add(l),o){const u=e?l.findNodesInto():l.findNodesOutOf(),c=this;u.all(d=>d===c||!d.isTreeExpanded)&&i.Kc(l,s),l.Sa(),l.Xe(!1)}l.isTreeExpanded&&(l.wasTreeExpanded=l.isTreeExpanded,h||l.QD(t,e,i,s,n))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const e=this.diagram;if(e===null||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const i=new K;i.add(this),this._D(i,e.isTreePathToChildren,t,e,this,e.treeCollapsePolicy===1),e.isCollapsingExpanding=!1}_D(t,e,i,s,n,o){const r=n===this?!1:this.isTreeExpanded,a=e?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const l=a.value;if(!l.isTreeLink)continue;r||l.Fi||l.$t();const h=l.getOtherNode(this);if(h!==null&&h!==this&&!t.has(h)){if(t.add(h),!r){h.Xe(!0),h.Sa();const u=e?h.findNodesInto():h.findNodesOutOf(),c=this;u.all(d=>d===c||!d.isTreeExpanded)&&s.Yc(h,n)}(i>2||h.wasTreeExpanded)&&(h.wasTreeExpanded=!1,h._D(t,e,i-1,s,n,o))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.E&1)!==0}set isTreeExpanded(t){const e=(this.E&1)!==0;if(e!==t){this.E=this.E^1;const i=this.diagram;this.t("isTreeExpanded",e,t);const s=this.treeExpandedChanged;if(s!==null){let n=!0;i!==null&&(n=i.G,i.G=!0),s(this),i!==null&&(i.G=n)}if(i!==null&&i.undoManager.isUndoingRedoing){this.Xe(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.E&2)!==0}set wasTreeExpanded(t){const e=(this.E&2)!==0;e!==t&&(this.E=this.E^2,this.t("wasTreeExpanded",e,t))}get treeExpandedChanged(){return this.vt!==null?this.vt.qy:null}set treeExpandedChanged(t){const e=this.treeExpandedChanged;e!==t&&(t!==null&&y.S(t,W,"treeExpandedChanged"),this.wl().qy=t,this.t("treeExpandedChanged",e,t))}get isTreeLeaf(){return(this.E&4)!==0}set isTreeLeaf(t){const e=(this.E&4)!==0;e!==t&&(this.E=this.E^4,this.t("isTreeLeaf",e,t))}get isTreeRoot(){return this.findTreeParentLink()===null}}class xi{me;Hy;jy;El;qy;Ky;Yy;Wy;Jy;da;$y;constructor(){this.me=!1,this.Hy=null,this.jy=null,this.El=null,this.qy=null,this.Ky=Mt.BL,this.Yy=1,this.Wy=null,this.Jy=null,this.da=null,this.$y=null}copy(){const t=new xi;return t.Hy=this.Hy,t.jy=this.jy,t.El=this.El,t.qy=this.qy,t.Ky=this.Ky.N(),t.Yy=this.Yy,t.Wy=this.Wy,t.Jy=this.Jy,t.da=this.da,t.$y=this.$y,t}}var bi=(x=>(x[x.None=0]="None",x[x.End=17]="End",x[x.Scale=18]="Scale",x[x.Stretch=19]="Stretch",x))(bi||{}),wi=(x=>(x[x.Normal=1]="Normal",x[x.Orthogonal=2]="Orthogonal",x[x.AvoidsNodes=6]="AvoidsNodes",x[x.AvoidsNodesStraight=7]="AvoidsNodesStraight",x))(wi||{}),vi=(x=>(x[x.None=0]="None",x[x.Bezier=9]="Bezier",x[x.JumpGap=10]="JumpGap",x[x.JumpOver=11]="JumpOver",x))(vi||{});class U extends ft{Mt;po;yo;$d;wo;xo;Zd;Gf;Qd;_d;tg;Jh;eg;on;Me;xl;vr;va;ir;wC;xC;gk;bC;kC;$h;mk;ut;sr;static Zh=null;static Qh=null;Af;PC;SC;constructor(t){super(j.Link),this.Mt=8,this.po=null,this.yo="",this.$d=null,this.wo=null,this.xo="",this.Zd=null,this.Gf=0,this.Qd=0,this._d=0,this.tg=NaN,this.Jh=1,this.eg=.5,this.on=null,this.Me=new J().k(),this.xl=null,this.vr=null,this.va=new I,this.ut=new yt,this.ir=null,this.sr=null,this.wC=P.mn,this.xC=P.mn,this.PC=0,this.SC=0,this.gk=new P,this.bC=null,this.kC=null,this.$h=null,this.mk=NaN,this.ft=null,this.Af=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Mt=this.Mt&-113,t.yo=this.yo,t.$d=this.$d,t.xo=this.xo,t.Zd=this.Zd,t.Gf=this.Gf,t.Qd=this.Qd,t._d=this._d,t.tg=this.tg,t.Jh=this.Jh,t.eg=this.eg,this.ft!==null&&(t.ft=this.ft.copy())}jo(t){super.jo(t),this.yo=t.yo,this.xo=t.xo,t.xl=null,t.$t(),t.sr=this.sr;const e=t.fromPort;e!==null&&t.fromNode.Ze(e);const i=t.toPort;i!==null&&t.toNode.Ze(i)}fe(t){t in wi||t in vi||t in bi?U.MC(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||y.o("Unknown Link enum value for a Link property: "+t):super.fe(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static tv=8;static ev=16;static Fa=8;static J1=3;static iv=3;static sv=1.333;static NC=1;static CC=0;static nv=10;static Yf=9999;static ov=30;static rv=30;static LC=10;static lv=10;static av=14;static hv=30;static cv=14;static _A=8;static tT=8;static fv=11;static setRoutingParameter(t,e){switch(t){case 1:U.tv=e;break;case 2:U.ev=e;break;case 3:U.Fa=e;break;case 4:U.J1=e;break;case 5:U.iv=e;break;case 6:U.sv=e;break;case 7:U.NC=e;break;case 8:U.CC=e;break;case 9:U.nv=e;break;case 10:U.Yf=e;break;case 11:U.ov=e;break;case 12:U.rv=e;break;case 13:U.LC=e;break;case 14:U.lv=e;break;case 15:U.av=e;break;case 16:U.hv=e;break;case 17:U.cv=e;break;case 18:U._A=e;break;case 19:U.tT=e;break;case 20:U.fv=e;break}t>29&&t<71&&(U.IT=t+parseInt(e.toString().slice(0,-1)))}static IT;Ji(){return this.ft===null&&(this.ft=new ti),this.ft}II(t,e,i){const s=t.segmentIndex,n=t.segmentFraction;let o=t.alignmentFocus;const r=t.segmentOrientation,a=t.segmentOffset;let l=0,h=0,u=0,c=0;if(isNaN(s)){const A=this.ut,M=y.nt();A.getPointAndAngleAlongPath(n,M);const C=P.z(M[0],M[1]);if(c=M[2],C.add(this.getPoint(0)),A.type===1)C.offset(-A.startX,-A.startY);else{const F=A.figures.first();C.offset(-F.startX,-F.startY)}r!==0&&(u=this.computeAngle(t,r,c),t.angle=u),l=C.x,h=C.y,P.i(C),y.Z(M)}else if(s<-e||s>=e){const A=P.l();this.HN(A),c=this.midAngle,r!==0&&(u=this.computeAngle(t,r,c),t.angle=u),l=A.x,h=A.y,P.i(A)}else{let A,M,C=0;if(s>=0?(A=i.r[s],M=s<e-1?i.r[s+1]:A):(C=e+s,A=i.r[C],M=C>0?i.r[C-1]:A),A.equalsApprox(M)){let F,O;s>=0?(F=s>0?i.r[s-1]:A,O=s<e-2?i.r[s+2]:M):(F=C<e-1?i.r[C+1]:A,O=C>1?i.r[C-2]:M);const E=F.distanceSquaredPoint(A),B=M.distanceSquaredPoint(O);E>B+10?c=s>=0?F.directionPoint(A):A.directionPoint(F):B>E+10?c=s>=0?M.directionPoint(O):O.directionPoint(M):c=s>=0?F.directionPoint(O):O.directionPoint(F)}else c=s>=0?A.directionPoint(M):M.directionPoint(A);r!==0&&(u=this.computeAngle(t,r,c),t.angle=u),l=A.x+(M.x-A.x)*n,h=A.y+(M.y-A.y)*n}if(o.isNone()){t.moveTo(l,h,!0);return}else o.isNoSpot()&&(o=T.Center);const d=wt.l();d.Ue(),d.it(t.scale,t.scale),d.ks(t.angle,0,0);const f=t.naturalBounds,m=I.z(0,0,f.width,f.height),g=P.l();g.setRectSpot(m,o),d.gt(g);let p=-g.x,b=-g.y;const v=f.width,w=f.height,k=P.bs(a),S=isNaN(a.x),N=isNaN(a.y);if(S||N){const A=v/2+U.J1,M=w/2+U.iv,C=c>=45&&c<=135,F=c>=225&&c<=315;r===0&&(C||F)?(k.x=N?A:a.y,k.y=S?M:a.x,C?s>=0||isNaN(s)&&n<.5||S&&(k.y=-M):F&&((s>=0||isNaN(s)&&n<.5)&&S&&(k.y=-M),N&&(k.x=-A))):(S&&(s>=0||isNaN(s)&&n<.5?k.x=A:k.x=-A),N&&(k.y=-M),k.rotate(c))}else k.rotate(c);l+=k.x,h+=k.y,d.sm(m),p+=m.x,b+=m.y;const D=P.z(l+p,h+b);t.move(D),P.i(D),P.i(k),P.i(g),I.i(m),wt.i(d)}_r(){let t=this.fromNode;if(t!==null){const i=t.findVisibleNode();if(i!==null&&(t=i),t.as()||t.fa())return!1}let e=this.toNode;if(e!==null){const i=e.findVisibleNode();if(i!==null&&(e=i),e.as()||e.fa())return!1}return!0}DN(t,e,i){return!1}vN(){}Di(){return!1}computeAngle(t,e,i){return U.computeAngle(e,i)}static computeAngle(t,e){let i=0;switch(t){default:case 0:i=0;break;case 21:i=e;break;case 22:i=e+90;break;case 23:i=e-90;break;case 24:i=e+180;break;case 25:i=L.Ee(e),i>90&&i<270&&(i-=180);break;case 26:i=L.Ee(e+90),i>90&&i<270&&(i-=180);break;case 27:i=L.Ee(e-90),i>90&&i<270&&(i-=180);break;case 28:if(i=L.Ee(e),i>45&&i<135||i>225&&i<315)return 0;i>90&&i<270&&(i-=180);break}return L.Ee(i)}get fromNode(){return this.po}set fromNode(t){const e=this.po;if(e!==t){const i=this.fromPort;e!==null&&(this.wo!==e&&e.dk(this,i),this.Zy(),this.invalidateLayout(2)),this.po=t,t!==null&&this.Xe(t.isVisible()),this.ir=null,this.$t();const s=this.diagram;s!==null&&s.G&&s.partManager.setFromNodeForLink(this,t,e);const n=this.fromPort,o=this.fromPortChanged;if(o!==null){let r=!0;s!==null&&(r=s.G,s.G=!0),o(this,i,n),s!==null&&(s.G=r)}t!==null&&(this.wo!==t&&t.uk(this,n),this.Qy(),this.invalidateLayout(1)),this.t("fromNode",e,t),this.Wd()}}get fromPortId(){return this.yo}set fromPortId(t){const e=this.yo;if(e!==t){const i=this.fromPort;i!==null&&this.fromNode?.Ze(i),this.Zy(),this.yo=t;const s=this.fromPort;s!==null&&this.fromNode?.Ze(s);const n=this.diagram;if(n!==null){const o=this.data,r=n.model;o!==null&&r.Wh()&&r.setFromPortIdForLinkData(o,t)}if(i!==s){this.ir=null,this.$t();const o=this.fromPortChanged;if(o!==null){let r=!0;n!==null&&(r=n.G,n.G=!0),o(this,i,s),n!==null&&(n.G=r)}}this.Qy(),this.t("fromPortId",e,t)}}get fromPort(){const t=this.po;if(t===null)return null;const e=this.yo;return t.findPort(e)}get fromPortChanged(){return this.$d}set fromPortChanged(t){const e=this.$d;e!==t&&(t!==null&&y.S(t,U,"fromPortChanged"),this.$d=t,this.t("fromPortChanged",e,t))}get toNode(){return this.wo}set toNode(t){const e=this.wo;if(e!==t){const i=this.toPort;e!==null&&(this.po!==e&&e.dk(this,i),this.Zy(),this.invalidateLayout(2)),this.wo=t,t!==null&&this.Xe(t.isVisible()),this.ir=null,this.$t();const s=this.diagram;s!==null&&s.G&&s.partManager.setToNodeForLink(this,t,e);const n=this.toPort,o=this.toPortChanged;if(o!==null){let r=!0;s!==null&&(r=s.G,s.G=!0),o(this,i,n),s!==null&&(s.G=r)}t!==null&&(this.po!==t&&t.uk(this,n),this.Qy(),this.invalidateLayout(1)),this.t("toNode",e,t),this.Wd()}}get toPortId(){return this.xo}set toPortId(t){const e=this.xo;if(e!==t){const i=this.toPort;i!==null&&this.toNode?.Ze(i),this.Zy(),this.xo=t;const s=this.toPort;s!==null&&this.toNode?.Ze(s);const n=this.diagram;if(n!==null){const o=this.data,r=n.model;o!==null&&r.Wh()&&r.setToPortIdForLinkData(o,t)}if(i!==s){this.ir=null,this.$t();const o=this.toPortChanged;if(o!==null){let r=!0;n!==null&&(r=n.G,n.G=!0),o(this,i,s),n!==null&&(n.G=r)}}this.Qy(),this.t("toPortId",e,t)}}get toPort(){const t=this.wo;if(t===null)return null;const e=this.xo;return t.findPort(e)}get toPortChanged(){return this.Zd}set toPortChanged(t){const e=this.Zd;e!==t&&(t!==null&&y.S(t,U,"toPortChanged"),this.Zd=t,this.t("toPortChanged",e,t))}get fromSpot(){return this.ft!==null?this.ft.Dh:T.Default}set fromSpot(t){const e=this.fromSpot;if(!e.equals(t)){if(t=t.N(),this.Ji().Dh=t,this.t("fromSpot",e,t),e.isSide()||t.isSide()){const i=this.fromNode;i!==null&&i.Ze(this.fromPort)}this.$t()}}get fromEndSegmentLength(){return this.ft!==null?this.ft.Fh:NaN}set fromEndSegmentLength(t){const e=this.fromEndSegmentLength;if(e!==t){if(t<0&&y.J(t,">= 0",U,"fromEndSegmentLength"),this.Ji().Fh=t,this.t("fromEndSegmentLength",e,t),this.computeSpot(!0,this.fromPort).isSide()){const i=this.fromNode;i!==null&&i.Ze(this.fromPort)}this.$t()}}get fromShortLength(){return this.ft!==null?this.ft.Oh:NaN}set fromShortLength(t){const e=this.fromShortLength;e!==t&&(this.Ji().Oh=t,this.ai(),this.t("fromShortLength",e,t))}get toSpot(){return this.ft!==null?this.ft.vh:T.Default}set toSpot(t){const e=this.toSpot;if(!e.equals(t)){if(t=t.N(),this.Ji().vh=t,this.t("toSpot",e,t),e.isSide()||t.isSide()){const i=this.toNode;i!==null&&i.Ze(this.toPort)}this.$t()}}get toEndSegmentLength(){return this.ft!==null?this.ft.Rh:NaN}set toEndSegmentLength(t){const e=this.toEndSegmentLength;if(e!==t){if(t<0&&y.J(t,">= 0",U,"toEndSegmentLength"),this.Ji().Rh=t,this.t("toEndSegmentLength",e,t),this.computeSpot(!1,this.toPort).isSide()){const i=this.toNode;i!==null&&i.Ze(this.toPort)}this.$t()}}get toShortLength(){return this.ft!==null?this.ft.Ih:NaN}set toShortLength(t){const e=this.toShortLength;e!==t&&(this.Ji().Ih=t,this.ai(),this.t("toShortLength",e,t))}Wd(){const t=this.fromNode,e=this.toNode;let i=null;if(t!==null?e!==null?i=t.findCommonContainingGroup(e):i=t.containingGroup:e!==null?i=e.containingGroup:i=null,this.ME(i),this.isLabeledLink){const s=this.labelNodes;for(;s.next();){const n=s.value;n.containingGroup=i}}}ME(t){const e=this.Ta;if(e!==t){e!==null&&e.fC(this),this.Ta=t,t!==null&&t.uC(this);const i=this.containingGroupChanged;if(i!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.G,n.G=!0),i(this,e,t),n!==null&&(n.G=s)}this.Fi&&(this.bC===e||this.kC===e)&&this.$t()}}Sa(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.Sa()}getOtherNode(t){const e=this.fromNode;return t===e?this.toNode:e}getOtherPort(t){const e=this.fromPort;return t===e?this.toPort:e}get isLabeledLink(){return this.on===null?!1:this.on.count>0}get labelNodes(){return this.on===null?Ut.instance:this.on.iterator}WD(t){this.on===null&&(this.on=new K),this.on.add(t),this.c()}JD(t){this.on!==null&&(this.on.delete(t),this.c())}tp(t){if(super.tp(t),this._h()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const e=this.po;let i=null;e!==null&&(i=this.fromPort,e.uk(this,i));const s=this.wo;let n=null;s!==null&&(n=this.toPort,(s!==e||n!==i)&&s.uk(this,n)),this.Qy()}}ep(t){if(super.ep(t),this._h()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const e=this.po;let i=null;e!==null&&(i=this.fromPort,e.dk(this,i));const s=this.wo;let n=null;s!==null&&(n=this.toPort,(s!==e||n!==i)&&s.dk(this,n)),this.Zy()}}lf(){if(this.Fi=!0,this.on!==null){const t=this.diagram;if(t!==null){const e=this.on.copy().iterator;for(;e.next();){const i=e.value;t.remove(i)}}}if(this.data!==null){const t=this.diagram;t!==null&&t.partManager.AC(this)}}updateRelationshipsFromData(){if(this.data===null)return;const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}move(t,e){const i=e?this.location:this.position;let s=i.x;isNaN(s)&&(s=0);let n=i.y;isNaN(n)&&(n=0);const o=t.x-s,r=t.y-n;if(e===!0)super.move(t,!1);else{const l=P.z(i.x+o,i.y+r);super.move(l,!1),P.i(l)}this.Pr(o,r);const a=this.labelNodes;for(;a.next();){const l=a.value,h=l.position;l.moveTo(h.x+o,h.y+r)}}get relinkableFrom(){return(this.Mt&1)!==0}set relinkableFrom(t){const e=(this.Mt&1)!==0;e!==t&&(this.Mt=this.Mt^1,this.t("relinkableFrom",e,t),this.invalidateAdornments())}get relinkableTo(){return(this.Mt&2)!==0}set relinkableTo(t){const e=(this.Mt&2)!==0;e!==t&&(this.Mt=this.Mt^2,this.t("relinkableTo",e,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const e=t.diagram;return!(e!==null&&!e.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const e=t.diagram;return!(e!==null&&!e.allowRelink)}get resegmentable(){return(this.Mt&4)!==0}set resegmentable(t){const e=(this.Mt&4)!==0;e!==t&&(this.Mt=this.Mt^4,this.t("resegmentable",e,t),this.invalidateAdornments())}get isTreeLink(){return(this.Mt&8)!==0}set isTreeLink(t){const e=(this.Mt&8)!==0;e!==t&&(this.Mt=this.Mt^8,this.t("isTreeLink",e,t),this.fromNode!==null&&this.fromNode.vp(),this.toNode!==null&&this.toNode.vp())}get path(){const t=this.findMainElement();return t instanceof et?t:null}get routeBounds(){return this.updateRoute(),this.va}uv(t){let e=1/0,i=1/0;const s=this.pointsCount;if(s===0)return t.e(NaN,NaN,0,0),t;if(s===1){const n=this.getPoint(0);e=Math.min(n.x,e),i=Math.min(n.y,i),t.e(n.x,n.y,0,0)}else if(s===2){const n=this.getPoint(0),o=this.getPoint(1);e=Math.min(n.x,o.x),i=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o)}else if(this.computeCurve()===9&&s>=3&&!this.isOrthogonal){let n=this.getPoint(0);if(e=n.x,i=n.y,t.e(e,i,0,0),s===3){const o=this.getPoint(1);e=Math.min(o.x,e),i=Math.min(o.y,i);const r=this.getPoint(2);e=Math.min(r.x,e),i=Math.min(r.y,i),L.Nu(n.x,n.y,o.x,o.y,o.x,o.y,r.x,r.y,.5,t)}else for(let o=3;o<s;o+=3){const r=this.getPoint(o-2);o+3>=s&&(o=s-1);const a=this.getPoint(o-1),l=this.getPoint(o);L.Nu(n.x,n.y,r.x,r.y,a.x,a.y,l.x,l.y,.5,t),e=Math.min(l.x,e),i=Math.min(l.y,i),n=l}}else{const n=this.getPoint(0),o=this.getPoint(1);e=Math.min(n.x,o.x),i=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o);for(let r=2;r<s;r++){const a=this.getPoint(r);e=Math.min(a.x,e),i=Math.min(a.y,i),t.unionPoint(a)}}return this.gk.e(e-t.x,i-t.y),t}get midPoint(){return this.HN(new P)}HN(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const e=this.pointsCount;if(e===0)return t.h(P.mn),t;if(e===1)return t.h(this.getPoint(0)),t;if(e===2){const h=this.getPoint(0),u=this.getPoint(1);return t.e((h.x+u.x)/2,(h.y+u.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ut.getPointAlongPath(.5,t),t.add(this.getPoint(0));const h=this.ut.figures.first();return t.offset(-h.startX,-h.startY),t}if(this.computeCurve()===9){if(e===3){const c=this.getPoint(0),d=this.getPoint(1),f=this.getPoint(2);return L.YL(c.x,c.y,d.x,d.y,d.x,d.y,f.x,f.y,t),t}const h=(e-1)/3|0,u=(h/2|0)*3;if(h%2===1){const c=this.getPoint(u),d=this.getPoint(u+1),f=this.getPoint(u+2),m=this.getPoint(u+3);return L.YL(c.x,c.y,d.x,d.y,f.x,f.y,m.x,m.y,t),t}else return t.h(this.getPoint(u)),t}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<e&&(r=i[o],!(n+r>s/2));)n+=r,o++;const a=this.getPoint(o),l=this.getPoint(o+1);if(Math.abs(a.x-l.x)<1)a.y>l.y?t.e(a.x,a.y-(s/2-n)):t.e(a.x,a.y+(s/2-n));else if(Math.abs(a.y-l.y)<1)a.x>l.x?t.e(a.x-(s/2-n),a.y):t.e(a.x+(s/2-n),a.y);else{const h=(s/2-n)/r,u=h*(l.x-a.x),c=h*(l.y-a.y);t.e(a.x+u,a.y+c)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const l=this.getPoint(0),h=this.getPoint(1);return l.directionPoint(h)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ut.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const l=(t-1)/3|0;let h=(l/2|0)*3;if(l%2===1){h=Math.floor(h);const u=this.getPoint(h),c=this.getPoint(h+1),d=this.getPoint(h+2),f=this.getPoint(h+3);return L.HF(u.x,u.y,c.x,c.y,d.x,d.y,f.x,f.y)}else if(h>0&&h+1<t){const u=this.getPoint(h-1),c=this.getPoint(h+1);return u.directionPoint(c)}}const e=this.flattenedLengths,i=this.flattenedTotalLength;let s=0,n=0,o=0;for(;s<i/2&&n<t&&(o=e[n],!(s+o>i/2));)s+=o,n++;const r=this.getPoint(n),a=this.getPoint(n+1);if(Math.abs(r.x-a.x)<.5&&Math.abs(r.y-a.y)<U.NC){if(n>0&&n<t-2){const l=this.getPoint(n-1),h=this.getPoint(n+2);return l.x<h.x?0:l.x>h.x?180:l.y<h.y?90:270}}else if(Math.abs(r.y-a.y)<.5&&Math.abs(r.x-a.x)<U.NC&&n>0&&n<t-2){const l=this.getPoint(n-1),h=this.getPoint(n+2);return l.y<h.y?90:l.y>h.y?270:l.x<h.x?0:180}return r.directionPoint(a)}get flattenedLengths(){return this.$h!==null?this.$h:(this.Fi||this.pk(),this.NE())}get flattenedTotalLength(){let t=this.mk;if(isNaN(t)){const e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++)t+=e[s];this.mk=t}return t}NE(){this.$h===null?this.$h=[]:this.$h.length=0;const t=this.$h,e=this.pointsCount;for(let i=0;i<e-1;i++){let s=0;const n=this.getPoint(i),o=this.getPoint(i+1);L.X(n.x,o.x)?(s=o.y-n.y,s<0&&(s=-s),t.push(s)):L.X(n.y,o.y)?(s=o.x-n.x,s<0&&(s=-s),t.push(s)):(s=Math.sqrt(n.distanceSquaredPoint(o)),t.push(s))}return t}get points(){return this.Me}set points(t){const e=this.Me;if(e===t)return;let i=null;if(Array.isArray(t))i=this.convertPointsArrayToList(t);else if(t instanceof J){i=t.copy();const n=i.iterator;for(;n.next();)n.value.k()}else y.o("Link.points value is not an instance of List or Array: "+t);if(i===null)return;i.k(),this.Me=i,this.ai(),this.pk();const s=this.diagram;s!==null&&(!s.Qa&&!s.undoManager.isUndoingRedoing&&s.nb.add(this),s.animationManager.ke&&s.animationManager.AM(this,i)),this.t("points",e,i)}convertPointsArrayToList(t){let e=null,i=t.length%2===0;if(i){for(let s=0;s<t.length;s++)if(typeof t[s]!="number"||isNaN(t[s])){i=!1;break}}if(i){e=new J;for(let s=0;s<t.length/2;s++)e.add(new P(t[s*2],t[s*2+1]).k())}else{let s=!0;for(let n=0;n<t.length;n++){const o=t[n];if(!y.$(o)||typeof o.x!="number"||isNaN(o.x)||typeof o.y!="number"||isNaN(o.y)){s=!1;break}}if(s){e=new J;for(let n=0;n<t.length;n++){const o=t[n];e.add(new P(o.x,o.y).k())}}}return e}get pointsCount(){return this.Me.count}getPoint(t){return this.Me.r[t]}setPoint(t,e){this.Me.setElt(t,e)}setPointAt(t,e,i){this.Me.setElt(t,new P(e,i))}insertPoint(t,e){this.Me.insertAt(t,e)}insertPointAt(t,e,i){this.Me.insertAt(t,new P(e,i))}addPoint(t){this.Me.add(t)}addPointAt(t,e){this.Me.add(new P(t,e))}removePoint(t){this.Me.removeAt(t)}clearPoints(){this.Me.clear()}Pr(t,e){if(t===0&&e===0)return;if(this.pointsCount===0){this.defaultFromPoint.isReal()&&this.defaultFromPoint.offset(t,e),this.defaultToPoint.isReal()&&this.defaultToPoint.offset(t,e);return}const i=this.Fi,s=new J,n=this.Me.iterator;for(;n.next();){const a=n.value;s.add(new P(a.x+t,a.y+e).k())}s.k();const o=this.Me;this.Me=s;const r=this.diagram;isNaN(t)||isNaN(e)||r!==null&&r.animationManager.ke?this.c():(this.nn.e(this.nn.x+t,this.nn.y+e),this.ct.e(this.ct.x+t,this.ct.y+e),this.Pf()),i?this.pk():(this.defaultFromPoint.isReal()&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint.isReal()&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),r!==null&&r.animationManager.ke&&r.animationManager.AM(this,s),this.t("points",o,s)}startRoute(){this.xl===null&&(this.xl=this.Me,this.Me=this.Me.copy())}commitRoute(){if(this.xl===null)return;const t=this.xl,e=this.Me;this.xl=null;const i=this.diagram;i!==null&&i.animationManager.ke&&i.animationManager.AM(this,e),this.ai(),this.pk(),this.t("points",t,e)}rollbackRoute(){this.xl!==null&&(this.Me=this.xl,this.xl=null,this.uv(this.va))}DR(){this.vr!==null&&(this.points=this.vr,this.vr=null)}pk(){if(this.Me.count===0){this.Fi=!1;return}this.Fi=!0,this.uv(this.va),this.$h=null,this.mk=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.yk(!1)}invalidateRoute(){this.$t()}$t(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const e=this.diagram;if(e){if(e.nb.has(this)||e.undoManager.isUndoingRedoing)return;const i=e.animationManager;if(i.isTicking&&!i.isAnimating)return;this.vr!==null&&!i.isTicking&&(this.vr=null)}this.Fi=!1,this.c(),t.c()}get Fi(){return(this.Mt&16)!==0}set Fi(t){(this.Mt&16)!==0!==t&&(this.Mt=this.Mt^16)}get suspendsRouting(){return(this.Mt&32)!==0}set suspendsRouting(t){(this.Mt&32)!==0!==t&&(this.Mt=this.Mt^32)}get _y(){return(this.Mt&64)!==0}set _y(t){(this.Mt&64)!==0!==t&&(this.Mt=this.Mt^64)}get TC(){return(this.Mt&512)!==0}set TC(t){(this.Mt&512)!==0!==t&&(this.Mt=this.Mt^512)}get defaultFromPoint(){return this.wC}set defaultFromPoint(t){this.wC=t&&t.isReal()?t.copy():P.mn}get defaultToPoint(){return this.xC}set defaultToPoint(t){this.xC=t&&t.isReal()?t.copy():P.mn}updateRoute(){if(this.Fi||this._y)return;let t=!0;try{this._y=!0,this.startRoute(),t=this.computePoints()}catch{this._y=!1,this.rollbackRoute()}finally{this._y=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let e=this.fromNode,i=null;if(e===null?(U.Zh||(U.Zh=new W,U.Zh.desiredSize=st.bc,U.Zh.ensureBounds()),this.defaultFromPoint.isReal()&&(U.Zh.location=this.defaultFromPoint,U.Zh.ensureBounds(),e=U.Zh,i=U.Zh)):i=this.fromPort,i!==null&&!e.isVisible()){const m=e.findVisibleNode();m!==null&&m!==e?(e=m,i=m.port):e=m}if(this.bC=e,e===null||!e.location.isReal()||i===null||(i=e.findVisiblePort(i),i===null))return!1;let s=this.toNode,n=null;if(s===null?(U.Qh||(U.Qh=new W,U.Qh.desiredSize=st.bc,U.Qh.ensureBounds()),this.defaultToPoint.isReal()&&(U.Qh.location=this.defaultToPoint,U.Qh.ensureBounds(),s=U.Qh,n=U.Qh)):n=this.toPort,n!==null&&!s.isVisible()){const m=s.findVisibleNode();m!==null&&m!==s?(s=m,n=m.port):s=m}if(this.kC=s,s===null||!s.location.isReal()||n===null||(n=s.findVisiblePort(n),n===null))return!1;const o=this.pointsCount,r=this.computeSpot(!0,i),a=this.computeSpot(!1,n),l=this.bl(r),h=this.bl(a),u=i===n&&i!==null,c=this.isOrthogonal;let d=this.curve===9;u&&!c?(d=!0,this.ir=!0):this.ir=!1;const f=this.computeAdjusting()===0||u;if(!c&&!u&&l&&h){let m=!1;if(!f&&o>=3){let g=this.getLinkPoint(e,i,r,!0,!1,s,n),p=this.getLinkPoint(s,n,a,!1,!1,e,i);m=this.adjustPoints(0,g,o-1,p),m&&(g=this.getLinkPoint(e,i,r,!0,!1,s,n),p=this.getLinkPoint(s,n,a,!1,!1,e,i),this.adjustPoints(0,g,o-1,p))}m||(this.clearPoints(),d?this.CE(e,i,r,s,n,a):this.LE(e,i,r,s,n,a))}else{const m=u?this.computeCurviness():0;f&&(c&&this.isAvoiding||u)&&this.clearPoints();const g=this.getLinkPoint(e,i,r,!0,c,s,n),p=this.getLinkPoint(s,n,a,!1,c,e,i);let b=0,v=0,w=0;if(c||!l||u){w=this.getLinkDirection(e,i,g,r,!0,c,s,n);let M=this.wk(e,i,r,!0,w);if(u&&(l||r.equals(a)||!c&&r.x+a.x===1&&r.y+a.y===1)&&(w-=c?90:U.ov,m<0&&(w-=180)),w=L.Ee(w),u&&(M+=Math.abs(m)*(c?1:2)),w===0?b=M:w===90?v=M:w===180?b=-M:w===270?v=-M:(b=M*Math.cos(w*Math.PI/180),v=M*Math.sin(w*Math.PI/180)),r.isNoSpot()&&u){const C=i.getDocumentPoint(T.Center,P.l()),F=P.z(C.x+b*U.Yf,C.y+v*U.Yf);this.getLinkPointFromPoint(e,i,C,F,!0,g),P.i(C),P.i(F)}}let k=0,S=0,N=0;if(c||!h||u){N=this.getLinkDirection(s,n,p,a,!1,c,e,i);let M=this.wk(s,n,a,!1,N);if(u&&(h||r.equals(a)||!c&&r.x+a.x===1&&r.y+a.y===1)&&(N+=c?0:U.rv,m<0&&(N+=180)),N=L.Ee(N),u&&(M+=Math.abs(m)*(c?1:2)),N===0?k=M:N===90?S=M:N===180?k=-M:N===270?S=-M:(k=M*Math.cos(N*Math.PI/180),S=M*Math.sin(N*Math.PI/180)),a.isNoSpot()&&u){const C=n.getDocumentPoint(T.Center,P.l()),F=P.z(C.x+k*U.Yf,C.y+S*U.Yf);this.getLinkPointFromPoint(s,n,C,F,!1,p),P.i(C),P.i(F)}}let D=g;(c||!l||u)&&(D=new P(g.x+b,g.y+v));let A=p;(c||!h||u)&&(A=new P(p.x+k,p.y+S)),!f&&!c&&l&&o>3&&this.adjustPoints(0,g,o-2,A)?this.setPoint(o-1,p):!f&&!c&&h&&o>3&&this.adjustPoints(1,D,o-1,p)?this.setPoint(0,g):!f&&(c?o>=6:o>4)&&this.adjustPoints(1,D,o-2,A)?(this.setPoint(0,g),this.setPoint(o-1,p)):(this.clearPoints(),this.addPoint(g),(c||!l||u)&&this.addPoint(D),c&&this.addOrthoPoints(D,w,A,N,e,s),(c||!h||u)&&this.addPoint(A),this.addPoint(p))}return t.addInvalidRoute(this),!0}DC(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?(e.x>=t.x?e.x=t.x+9e9:e.x=t.x-9e9,e.y=t.y):(e.y>=t.y?e.y=t.y+9e9:e.y=t.y-9e9,e.x=t.x),e}getLinkPointFromPoint(t,e,i,s,n,o){if(o===void 0&&(o=new P),t===null||e===null)return o.h(i),o;if(!t.isVisible()){const d=t.findVisibleNode();d!==null&&d!==t&&(t=d,e=t.port)}let r=0,a=0,l=0,h=0,u=null,c=e.panel;if(c!==null&&!c.Nn()&&(c=c.panel),c===null)r=s.x,a=s.y,l=i.x,h=i.y;else{u=c.Js;const d=1/(u.m11*u.m22-u.m12*u.m21),f=u.m22*d,m=-u.m12*d,g=-u.m21*d,p=u.m11*d,b=d*(u.m21*u.dy-u.m22*u.dx),v=d*(u.m12*u.dx-u.m11*u.dy);r=s.x*f+s.y*g+b,a=s.x*m+s.y*p+v,l=i.x*f+i.y*g+b,h=i.x*m+i.y*p+v}return e.pf(r,a,l,h,o),u!==null&&o.v(u),o}AE(t,e){const i=t.yd;return i!==null?i.dv(e):null}xk(t){if(t===null)return null;let e=t.yd;return e===null&&(e=new ki(t.part,t),t.yd=e),e.dv(this)}getLinkPoint(t,e,i,s,n,o,r,a){if(a===void 0&&(a=new P),i.isSpot()&&!this.bl(i))return e.getDocumentPoint(i,a),a;if(i.isSide()){const u=this.xk(e);if(u!==null){const c=u.tc;if(a.h(c),n&&this.routing===7){const d=this.xk(r);if(d!==null&&u.Kf<d.Kf){const f=P.l(),m=P.l(),g=I.l();e.getDocumentPoint(T.TopLeft,f),e.getDocumentPoint(T.BottomRight,m);const p=f.x,b=f.y,v=m.x,w=m.y;g.x=Math.min(p,v),g.y=Math.min(b,w),g.width=Math.abs(p-v),g.height=Math.abs(b-w);const k=this.computeSpot(!s,r),S=this.getLinkPoint(o,r,k,!s,n,t,e,m);(i.includesSide(T.LeftSide)||i.includesSide(T.RightSide))&&S.y>=g.y&&S.y<=g.y+g.height?a.y=S.y:(i.includesSide(T.TopSide)||i.includesSide(T.BottomSide))&&S.x>=g.x&&S.x<=g.x+g.width&&(a.x=S.x),I.i(g),P.i(f),P.i(m)}}return a}}const l=e.getDocumentPoint(this.ig(i,s),P.l()),h=P.l();if(this.pointsCount>(n?6:2))h.h(s?this.getPoint(1):this.getPoint(this.pointsCount-2)),n&&this.DC(l,h);else if(t?.isMemberOf(o)||o?.isMemberOf(t)){const u=e.getDocumentBounds(I.l()),c=r.getDocumentBounds(I.l());u.isReal()&&c.isReal()?c.containsRect(u)?(h.h(l),this.vC(c,l.x,l.y,0,this.computeSpot(r===this.toPort,r),h)):u.containsRect(c)?(r.getDocumentPoint(T.Center,h),this.vC(u,h.x,h.y,0,this.computeSpot(e===this.toPort,e),h)):this.FC(r,l,s,n,h):this.FC(r,l,s,n,h),I.i(u),I.i(c)}else this.FC(r,l,s,n,h);return this.getLinkPointFromPoint(t,e,l,h,s,a),P.i(h),P.i(l),a}FC(t,e,i,s,n){const o=this.computeSpot(!i,t);t.getDocumentPoint(this.ig(o,!i),n),s&&this.DC(e,n)}getLinkDirection(t,e,i,s,n,o,r,a){let l=this.TE(t,e,i,s,n,o,r,a);if(t&&r){const u=I.l(),c=I.l();if(s.isNone()&&t.isMemberOf(r)&&e&&a){if(e.getDocumentBounds(u),a.getDocumentBounds(c),u.isReal()&&c.isReal()&&c.containsRect(u)){const d=this.computeSpot(a===this.toPort,a);d.equals(T.Left)||d.equals(T.LeftSide)?l=180:d.equals(T.Right)||d.equals(T.RightSide)?l=0:d.equals(T.Top)||d.equals(T.TopSide)?l=270:d.equals(T.Bottom)||d.equals(T.BottomSide)?l=90:l=L.Ee(l+180)}}else r?.isMemberOf(t)&&e&&a&&(e.getDocumentBounds(u),a.getDocumentBounds(c),u.isReal()&&c.isReal()&&u.containsRect(c)&&(l=L.Ee(l+180)));I.i(u),I.i(c)}if(this.bl(s)||e===null)return l;const h=e.getDocumentAngle();return h===0?l:(45<=h&&h<135?l+=90:135<=h&&h<225?l+=180:225<=h&&h<315&&(l+=270),L.Ee(l))}TE(t,e,i,s,n,o,r,a){if(s.isSpot())return L._w(null,s.x,s.y);if(s.isSide()){const c=this.xk(e);if(c!==null)switch(c.fi){case 1:return 270;case 8:return 90;case 2:return 180;default:return 0}else return s.includesSide(T.TopSide)?270:s.includesSide(T.BottomSide)?90:s.includesSide(T.LeftSide)?180:0}if(e===null||a===null)return 0;const l=e.getDocumentPoint(T.Center,P.l()),h=P.l();this.pointsCount>(o?6:2)?o?(h.h(n?this.getPoint(1):this.getPoint(this.pointsCount-2)),this.DC(l,h)):h.h(i):a.getDocumentPoint(T.Center,h);let u=0;return Math.abs(h.x-l.x)>Math.abs(h.y-l.y)?h.x>=l.x?u=0:u=180:h.y>=l.y?u=90:u=270,P.i(h),P.i(l),u}computeEndSegmentLength(t,e,i,s){return this.wk(t,e,i,s,NaN)}wk(t,e,i,s,n){if(e!==null&&i.isSide()){const r=this.xk(e);if(r!==null)return r.bk}let o=NaN;if(s?o=this.fromEndSegmentLength:o=this.toEndSegmentLength,e!==null&&isNaN(o))if(n===void 0&&(n=NaN),U.CC>0&&this.computeCurve()===9&&!isNaN(n)&&i.isSpot()){const r=this.getOtherPort(e);if(r){const a=P.l(),l=P.l(),h=e.getDocumentPoint(i,a),u=r.getDocumentPoint(i.opposite(),l),c=n>=315||n<=45||n>=135&&n<=225;let d=Math.abs(c?h.x-u.x:h.y-u.y)/U.CC;return d=Math.max(d,U.LC),P.i(a),P.i(l),d}}else s?o=e.fromEndSegmentLength:o=e.toEndSegmentLength;return isNaN(o)&&(o=U.LC),o}computeSpot(t,e){return e===void 0&&(e=null),t?this.DE(e||this.fromPort):this.vE(e||this.toPort)}DE(t){if(t===null)return T.Center;let e=this.fromSpot;return e.isDefault()&&(e=t.fromSpot),e===T.Default?T.None:e}vE(t){if(t===null)return T.Center;let e=this.toSpot;return e.isDefault()&&(e=t.toSpot),e===T.Default?T.None:e}bl(t){return t===T.None||t.x===.5&&t.y===.5}ig(t,e){return t.x===.5&&t.y===.5?t:T.Center}computeOtherPoint(t,e){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new P);{const i=this.AE(e,this);if(i!==null)return i.tc;if(t instanceof at){let s=this.fromNode,n=this.fromPort;n===e&&(s=this.toNode,n=this.toPort);const o=I.l(),r=I.l();if(n&&s?.isMemberOf(t)){const a=this.computeSpot(n===e,e);if(e.getDocumentBounds(o),n.getDocumentBounds(r),o.isReal()&&r.isReal()&&o.containsRect(r)){const l=n.getDocumentPoint(T.Center);return this.vC(o,l.x,l.y,0,a,l),I.i(o),I.i(r),l}}I.i(o),I.i(r)}return e.getDocumentPoint(T.Center)}}computeShortLength(t){if(t){let e=this.fromShortLength;if(isNaN(e)){const i=this.fromPort;i!==null&&(e=i.fromShortLength)}return isNaN(e)?0:e}else{let e=this.toShortLength;if(isNaN(e)){const i=this.toPort;i!==null&&(e=i.toShortLength)}return isNaN(e)?0:e}}Zm(t,e,i,s,n,o){if(this.pickable===!1)return!1;e===void 0&&(e=null),i===void 0&&(i=null);let r;if(o===void 0?(r=wt.l(),r.Ue()):r=o,r.kc(this.v),this.containedInRect(t,r))return this.JN(e,i,n),o===void 0&&wt.i(r),!0;if(this.intersectsRect(t,r)){let a=!1;if(!this.Tf){const l=this.D.r,h=l.length;for(let u=h;u--;){const c=l[u];if(!c.visible&&c!==this.locationObject)continue;const d=c.actualBounds,f=this.naturalBounds;if(d.x>f.width||d.y>f.height||d.x+d.width<0||d.y+d.height<0)continue;const m=c,g=wt.l();if(g.set(r),m instanceof j?a=m.Zm(t,e,i,s,n,g):this.path===m?m instanceof et&&(a=m.nE(t,s,g)):a=m.JT(t,s,g),a){let p=m;e!==null&&(p=e(m)),p&&(i===null||i(p))&&n.add(p)}wt.i(g)}}return o===void 0&&wt.i(r),a||this.background!==null}return o===void 0&&wt.i(r),!1}get isOrthogonal(){return(this.Jh&2)===2}static MC(t){return(t&2)===2}get isAvoiding(){return(this.Jh&4)===4}computeCurve(){if(this.ir===null){const t=this.fromPort,e=t!==null&&t===this.toPort,i=this.isOrthogonal;this.ir=e&&!i}return this.ir?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=U.lv),t}findMidLabel(){const t=this.path,e=this.D.r,i=e.length;for(let n=0;n<i;n++){const o=e[n];if(!(o===t||o.isPanelMain)&&(o.segmentIndex===-1/0||isNaN(o.segmentIndex)))return o}const s=this.labelNodes;for(;s.next();){const n=s.value;if(n.segmentIndex===-1/0||isNaN(n.segmentIndex))return n}return null}computeSpacing(){if(!this.isVisible())return 0;let t=U.av;t=Math.max(t,this.computeThickness());const e=this.fromPort,i=this.toPort;if(e!==null&&i!==null){const s=this.findMidLabel();if(s!==null){const n=s.naturalBounds,o=s.margin,r=isNaN(n.width)?U.hv:n.width*s.scale+o.left+o.right,a=isNaN(n.height)?U.cv:n.height*s.scale+o.top+o.bottom,l=s.segmentOrientation;if(l===21||l===25||l===24)t=Math.max(t,a);else if(l===23||l===27||l===22||l===26)t=Math.max(t,r);else{const h=e.getDocumentPoint(T.Center).directionPoint(i.getDocumentPoint(T.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(h)*r)+Math.abs(Math.cos(h)*a)+1)}this.curve===9&&(t*=U.sv)}}return t}arrangeBundledLinks(t,e){if(e)for(let i=0;i<t.length;i++){const s=t[i];s.computeAdjusting()===0&&s.$t()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=U.ev;const e=this.sr;if(e!==null){const i=y.nt();let s=0;const n=e.rn;for(let r=0;r<n.length;r++){const a=n[r].computeSpacing();i.push(a),s+=a}let o=-s/2;for(let r=0;r<n.length;r++){if(n[r]===this){t=o+i[r]/2;break}o+=i[r]}e.Gy===this.fromNode&&(t=-t),y.Z(i)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.sr!==null}LE(t,e,i,s,n,o){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),a=this.getLinkPoint(s,n,o,!1,!1,t,e);if(this.gv(t,e,i,r,s,n,o,a),this.addPoint(r),this.addPoint(a),this.hasCurviness()){const l=a.x-r.x,h=a.y-r.y,u=this.computeCurviness(),c=u,d=r.x+l/2,f=r.y+h/2;let m=d,g=f;if(L.u(h,0))l>0?g-=c:g+=c;else{const p=-l/h;let b=Math.sqrt(c*c/(p*p+1));u<0&&(b=-b),m=(h<0?-1:1)*b+d,g=p*(m-d)+f}this.insertPointAt(1,m,g)}}gv(t,e,i,s,n,o,r,a){const l=o.getDocumentBounds(I.l()),h=e.getDocumentBounds(I.l());if(l.intersectsRect(h)&&!l.containsRect(h)&&!h.containsRect(l)){const u=P.l();e.getDocumentPoint(this.ig(i,!0),u);const c=P.l();o.getDocumentPoint(this.ig(r,!1),c);const d=h.width*h.height,f=l.width*l.height;d>f?(s.h(u),this.getLinkPointFromPoint(n,o,c,u,!1,c),a.h(c)):d<f?(this.getLinkPointFromPoint(t,e,u,c,!0,u),s.h(u),a.h(c)):(s.h(u),a.h(c)),P.i(u),P.i(c)}else if(l.containsPoint(s)){const u=P.l();e.getDocumentPoint(this.ig(i,!0),u),a.h(u),this.RC(l,u.x,u.y,U.Yf,a),this.getLinkPointFromPoint(n,o,l.containsPoint(u)?u:s,a,!1,a),this.getLinkPointFromPoint(t,e,u,a,!0,s),P.i(u)}else if(h.containsPoint(a)){const u=P.l();o.getDocumentPoint(this.ig(r,!1),u),s.h(u),this.RC(h,u.x,u.y,U.Yf,s),this.getLinkPointFromPoint(t,e,h.containsPoint(u)?u:a,s,!0,s),this.getLinkPointFromPoint(n,o,u,s,!1,a),P.i(u)}I.i(h),I.i(l)}vC(t,e,i,s,n,o){let r=-1;return n.equals(T.Left)||n.equals(T.LeftSide)?r=180:n.equals(T.Right)||n.equals(T.RightSide)?r=0:n.equals(T.Top)||n.equals(T.TopSide)?r=270:(n.equals(T.Bottom)||n.equals(T.BottomSide))&&(r=90),r===-1?this.RC(t,e,i,0,o):this.mv(t,e,i,0,r,o)}RC(t,e,i,s,n){const o=L._w(t,e,i);return this.mv(t,e,i,s,o,n)}mv(t,e,i,s,n,o){return n===0?o.x=t.right+s:n===90?o.y=t.bottom+s:n===180?o.x=t.x-s:n===270?o.y=t.y-s:n===45?(o.x=t.right+s,o.y=t.bottom+s):n===135?(o.x=t.x-s,o.y=t.bottom+s):n===225?(o.x=t.x-s,o.y=t.y-s):n===315&&(o.x=t.right+s,o.y=t.y-s),o}CE(t,e,i,s,n,o){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),a=this.getLinkPoint(s,n,o,!1,!1,t,e);this.gv(t,e,i,r,s,n,o,a),this.addPoint(r),this.addPoint(a);const l=a.x-r.x,h=a.y-r.y,u=this.computeCurviness();let c=0,d=0,f=r.x+l/3,m=r.y+h/3,g=f,p=m;L.u(h,0)?l>0?p-=u:p+=u:(c=-l/h,d=Math.sqrt(u*u/(c*c+1)),u<0&&(d=-d),g=(h<0?-1:1)*d+f,p=c*(g-f)+m),f=r.x+2*l/3,m=r.y+2*h/3;let b=f,v=m;L.u(h,0)?l>0?v-=u:v+=u:(b=(h<0?-1:1)*d+f,v=c*(b-f)+m),this.insertPointAt(1,g,p),this.insertPointAt(2,b,v),this.setPoint(0,this.getLinkPoint(t,e,i,!0,!1,s,n)),this.setPoint(3,this.getLinkPoint(s,n,o,!1,!1,t,e))}adjustPoints(t,e,i,s){let n=this.computeAdjusting();if(this.isOrthogonal){if(n===18)return!1;n===19&&(n=17)}switch(n){case 18:return this.FE(t,e,i,s);case 19:return this.RE(t,e,i,s);case 17:return this.OE(t,e,i,s);default:return!1}}FE(t,e,i,s){const n=this.getPoint(t),o=this.getPoint(i);if(n.equalsApprox(e)&&o.equalsApprox(s))return!0;const r=n.x,a=n.y,l=o.x,h=o.y;let u=l-r,c=h-a;const d=Math.sqrt(u*u+c*c);if(L.X(d,0))return!0;let f=0;L.X(u,0)?c<0?f=-Math.PI/2:f=Math.PI/2:(f=Math.atan(c/Math.abs(u)),u<0&&(f=Math.PI-f));const m=e.x,g=e.y,p=s.x,b=s.y,v=p-m,w=b-g,k=Math.sqrt(v*v+w*w);let S=0;L.X(v,0)?w<0?S=-Math.PI/2:S=Math.PI/2:(S=Math.atan(w/Math.abs(v)),v<0&&(S=Math.PI-S));const N=k/d,D=S-f;this.setPoint(t,e);for(let A=t+1;A<i;A++){const M=this.getPoint(A);u=M.x-r,c=M.y-a;const C=Math.sqrt(u*u+c*c);if(L.X(C,0))continue;let F=0;L.X(u,0)?c<0?F=-Math.PI/2:F=Math.PI/2:(F=Math.atan(c/Math.abs(u)),u<0&&(F=Math.PI-F));const O=F+D,E=C*N,B=m+E*Math.cos(O),z=g+E*Math.sin(O);this.setPointAt(A,B,z)}return this.setPoint(i,s),!0}RE(t,e,i,s){const n=this.getPoint(t),o=this.getPoint(i);if(n.equalsApprox(e)&&o.equalsApprox(s))return!0;const r=n.x,a=n.y,l=o.x,h=o.y,u=(l-r)**2+(h-a)**2,c=e.x,d=e.y,f=s.x,m=s.y;let g=0,p=1;f-c!==0?(g=(m-d)/(f-c),p=Math.sqrt(1+1/(g*g))):g=9e9,this.setPoint(t,e);for(let b=t+1;b<i;b++){const v=this.getPoint(b),w=v.x,k=v.y;let S=.5;u!==0&&(S=((r-w)*(r-l)+(a-k)*(a-h))/u);const N=r+S*(l-r),D=a+S*(h-a);let A=Math.sqrt((w-N)**2+(k-D)**2);k<g*(w-N)+D&&(A=-A),g>0&&(A=-A);const M=c+S*(f-c),C=d+S*(m-d);if(g!==0){const F=M+A/p,O=C-(F-M)/g;this.setPointAt(b,F,O)}else this.setPointAt(b,M,C+A)}return this.setPoint(i,s),!0}OE(t,e,i,s){if(this.isOrthogonal){let n=this.getPoint(t),o=this.getPoint(t+1),r=this.getPoint(t+2),a=o.x,l=o.y;const h=a,u=l;L.u(n.y,o.y)?L.u(o.x,r.x)?l=e.y:L.u(o.y,r.y)&&(a=e.x):L.u(n.x,o.x)&&(L.u(o.y,r.y)?a=e.x:L.u(o.x,r.x)&&(l=e.y)),this.setPointAt(t+1,a,l),n=this.getPoint(i),o=this.getPoint(i-1),r=this.getPoint(i-2);let c=o.x,d=o.y;const f=c,m=d;if(L.u(n.y,o.y)?L.u(o.x,r.x)?d=s.y:L.u(o.y,r.y)&&(c=s.x):L.u(n.x,o.x)&&(L.u(o.y,r.y)?c=s.x:L.u(o.x,r.x)&&(d=s.y)),this.setPointAt(i-1,c,d),this.yT())return this.setPointAt(t+1,h,u),this.setPointAt(i-1,f,m),!1}return this.setPoint(t,e),this.setPoint(i,s),!0}addOrthoPoints(t,e,i,s,n,o){e=L.Ee(e),s=L.Ee(s);const r=s;e>=315||e<45?e=0:45<=e&&e<135?e=90:135<=e&&e<225?e=180:e=270,s>=315||s<45?s=0:45<=s&&s<135?s=90:135<=s&&s<225?s=180:s=270;const a=t,l=i,h=I.bs(n.actualBounds),u=I.bs(o.actualBounds);h.inflate(U.Fa,U.Fa),u.inflate(U.Fa,U.Fa),h.unionPoint(t),u.unionPoint(i);const c=P.l(),d=P.l();e===0?l.x>a.x||s===270&&l.y<a.y&&u.right>a.x||s===90&&l.y>a.y&&u.right>a.x?(c.e(l.x,a.y),d.e(l.x,(a.y+l.y)/2),s===180?(c.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1),d.x=c.x,d.y=l.y):s===270&&l.y<a.y||s===90&&l.y>a.y?(a.x<u.left?c.x=this.computeMidOrthoPosition(a.x,a.y,u.left,l.y,!1):a.x<u.right&&(s===270&&a.y<u.top||s===90&&a.y>u.bottom)?c.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):c.x=u.right,d.x=c.x,d.y=l.y):s===0&&a.x<u.left&&a.y>u.top&&a.y<u.bottom&&(c.x=a.x,a.y<l.y?c.y=Math.min(l.y,u.top):c.y=Math.max(l.y,u.bottom),d.y=c.y)):(c.e(a.x,l.y),d.e((a.x+l.x)/2,l.y),(s===180||s===90&&l.y<h.top||s===270&&l.y>h.bottom)&&(s===180&&(u.containsPoint(a)||h.containsPoint(l))?c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):l.y<a.y&&(s===180||s===90)?c.y=this.computeMidOrthoPosition(a.x,h.top,l.x,Math.min(l.y,u.bottom),!0):l.y>a.y&&(s===180||s===270)&&(c.y=this.computeMidOrthoPosition(a.x,h.bottom,l.x,Math.max(l.y,u.top),!0)),d.x=l.x,d.y=c.y),c.y>h.top&&c.y<h.bottom&&(l.x>=h.left&&l.x<=a.x||a.x<=u.right&&a.x>=l.x?(s===90||s===270)&&(c.e(Math.max((a.x+l.x)/2,a.x),a.y),d.e(c.x,l.y)):(s===270||(s===0||s===180)&&l.y<a.y?c.y=Math.min(l.y,s===0?h.top:Math.min(h.top,u.top)):c.y=Math.max(l.y,s===0?h.bottom:Math.max(h.bottom,u.bottom)),d.x=l.x,d.y=c.y))):e===180?l.x<a.x||s===270&&l.y<a.y&&u.left<a.x||s===90&&l.y>a.y&&u.left<a.x?(c.e(l.x,a.y),d.e(l.x,(a.y+l.y)/2),s===0?(c.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1),d.x=c.x,d.y=l.y):s===270&&l.y<a.y||s===90&&l.y>a.y?(a.x>u.right?c.x=this.computeMidOrthoPosition(a.x,a.y,u.right,l.y,!1):a.x>u.left&&(s===270&&a.y<u.top||s===90&&a.y>u.bottom)?c.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):c.x=u.left,d.x=c.x,d.y=l.y):s===180&&a.x>u.right&&a.y>u.top&&a.y<u.bottom&&(c.x=a.x,a.y<l.y?c.y=Math.min(l.y,u.top):c.y=Math.max(l.y,u.bottom),d.y=c.y)):(c.e(a.x,l.y),d.e((a.x+l.x)/2,l.y),(s===0||s===90&&l.y<h.top||s===270&&l.y>h.bottom)&&(s===0&&(u.containsPoint(a)||h.containsPoint(l))?c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):l.y<a.y&&(s===0||s===90)?c.y=this.computeMidOrthoPosition(a.x,h.top,l.x,Math.min(l.y,u.bottom),!0):l.y>a.y&&(s===0||s===270)&&(c.y=this.computeMidOrthoPosition(a.x,h.bottom,l.x,Math.max(l.y,u.top),!0)),d.x=l.x,d.y=c.y),c.y>h.top&&c.y<h.bottom&&(l.x<=h.right&&l.x>=a.x||a.x>=u.left&&a.x<=l.x?(s===90||s===270)&&(c.e(Math.min((a.x+l.x)/2,a.x),a.y),d.e(c.x,l.y)):(s===270||(s===0||s===180)&&l.y<a.y?c.y=Math.min(l.y,s===180?h.top:Math.min(h.top,u.top)):c.y=Math.max(l.y,s===180?h.bottom:Math.max(h.bottom,u.bottom)),d.x=l.x,d.y=c.y))):e===90?l.y>a.y||s===180&&l.x<a.x&&u.bottom>a.y||s===0&&l.x>a.x&&u.bottom>a.y?(c.e(a.x,l.y),d.e((a.x+l.x)/2,l.y),s===270?(c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0),d.x=l.x,d.y=c.y):s===180&&l.x<a.x||s===0&&l.x>a.x?(a.y<u.top?c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,u.top,!0):a.y<u.bottom&&(s===180&&a.x<u.left||s===0&&a.x>u.right)?c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):c.y=u.bottom,d.x=l.x,d.y=c.y):s===90&&a.y<u.top&&a.x>u.left&&a.x<u.right&&(a.x<l.x?c.x=Math.min(l.x,u.left):c.x=Math.max(l.x,u.right),c.y=a.y,d.x=c.x)):(c.e(l.x,a.y),d.e(l.x,(a.y+l.y)/2),(s===270||s===0&&l.x<h.left||s===180&&l.x>h.right)&&(s===270&&(u.containsPoint(a)||h.containsPoint(l))?c.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):l.x<a.x&&(s===270||s===0)?c.x=this.computeMidOrthoPosition(h.left,a.y,Math.min(l.x,u.right),l.y,!1):l.x>a.x&&(s===270||s===180)&&(c.x=this.computeMidOrthoPosition(h.right,a.y,Math.max(l.x,u.left),l.y,!1)),d.x=c.x,d.y=l.y),c.x>h.left&&c.x<h.right&&(l.y>=h.top&&l.y<=a.y||a.y<=u.bottom&&a.y>=l.y?(s===0||s===180)&&(c.e(a.x,Math.max((a.y+l.y)/2,a.y)),d.e(l.x,c.y)):(s===180||(s===90||s===270)&&l.x<a.x?c.x=Math.min(l.x,s===90?h.left:Math.min(h.left,u.left)):c.x=Math.max(l.x,s===90?h.right:Math.max(h.right,u.right)),d.x=c.x,d.y=l.y))):l.y<a.y||s===180&&l.x<a.x&&u.top<a.y||s===0&&l.x>a.x&&u.top<a.y?(c.e(a.x,l.y),d.e((a.x+l.x)/2,l.y),s===90?(c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0),d.x=l.x,d.y=c.y):s===180&&l.x<a.x||s===0&&l.x>=a.x?(a.y>u.bottom?c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,u.bottom,!0):a.y>u.top&&(s===180&&a.x<u.left||s===0&&a.x>u.right)?c.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):c.y=u.top,d.x=l.x,d.y=c.y):s===270&&a.y>u.bottom&&a.x>u.left&&a.x<u.right&&(a.x<l.x?c.x=Math.min(l.x,u.left):c.x=Math.max(l.x,u.right),c.y=a.y,d.x=c.x)):(c.e(l.x,a.y),d.e(l.x,(a.y+l.y)/2),(s===90||s===0&&l.x<h.left||s===180&&l.x>h.right)&&(s===90&&(u.containsPoint(a)||h.containsPoint(l))?c.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):l.x<a.x&&(s===90||s===0)?c.x=this.computeMidOrthoPosition(h.left,a.y,Math.min(l.x,u.right),l.y,!1):l.x>a.x&&(s===90||s===180)&&(c.x=this.computeMidOrthoPosition(h.right,a.y,Math.max(l.x,u.left),l.y,!1)),d.x=c.x,d.y=l.y),c.x>h.left&&c.x<h.right&&(l.y<=h.bottom&&l.y>=a.y||a.y>=u.top&&a.y<=l.y?(s===0||s===180)&&(c.e(a.x,Math.min((a.y+l.y)/2,a.y)),d.e(l.x,c.y)):(s===180||(s===90||s===270)&&l.x<a.x?c.x=Math.min(l.x,s===270?h.left:Math.min(h.left,u.left)):c.x=Math.max(l.x,s===270?h.right:Math.max(h.right,u.right)),d.x=c.x,d.y=l.y))),this.TC=s!==r,this.PC=e,this.SC=s,this.addPoint(c.copy()),this.addPoint(d.copy()),P.i(c),P.i(d),I.i(h),I.i(u)}computeMidOrthoPosition(t,e,i,s,n){let o=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(o=this.computeCurviness()),n?(e+s)/2+o:(t+i)/2+o}yT(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,e=t.length;if(e<4)return!1;const i=this.diagram.getPositions(!1,this.containingGroup,null);for(let s=1;s<e-2;s++){const n=t[s],o=t[s+1];if(!i.isUnoccupied(Math.min(n.x,o.x),Math.min(n.y,o.y),Math.abs(n.x-o.x),Math.abs(n.y-o.y)))return!0}return!1}findClosestSegment(t){const e=t.x,i=t.y;let s=this.getPoint(0),n=this.getPoint(1),o=P.distanceLineSegmentSquared(e,i,s.x,s.y,n.x,n.y),r=0;for(let a=1;a<this.pointsCount-1;a++){s=this.getPoint(a+1);const l=P.distanceLineSegmentSquared(e,i,n.x,n.y,s.x,s.y);n=s,l<o&&(r=a,o=l)}return r}invalidateGeometry(){this.ai()}ai(){this.Ra&&(this.Ra=!1,this.c())}get Ra(){return(this.Mt&128)!==0}set Ra(t){(this.Mt&128)!==0!==t&&(this.Mt=this.Mt^128)}get geometry(){if(!this.Ra){if(this.updateRoute(),this.pointsCount<2)return this.Ra=!0,this.ut;this.ut=this.makeGeometry(),this.Ra=!0}return this.ut}Td(t){if(!t){if(this.Fi===!1)return;const n=this.findMainElement();if(this.Ra&&(n===null||n.geometry!==null))return}this.pointsCount>=2&&(this.ut=this.makeGeometry()),this.Ra=!0;const e=this.path;if(e===null)return;e.ut=this.ut;const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o!==e&&o.isPanelMain&&o instanceof et&&(o.ut=this.ut)}}IE(t){return this._h()&&t.ra.has(this)&&(this.va.width!==0||this.va.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ut,e=this.pointsCount;let i=!1;const s=this.diagram;s!==null&&this.IE(s)&&(i=!0);let n=0,o=0,r=P.bs(this.getPoint(0));const a=P.bs(r),l=this.Me.r,h=this.computeCurve();if(h===9&&e>=3&&!L.X(this.smoothness,0))if(e===3){let u=this.getPoint(1);n=Math.min(r.x,u.x),o=Math.min(r.y,u.y),u=this.getPoint(2),n=Math.min(n,u.x),o=Math.min(o,u.y)}else if(this.isOrthogonal){for(let u=0;u<e;u++){const c=l[u];a.x=Math.min(c.x,a.x),a.y=Math.min(c.y,a.y)}n=a.x,o=a.y}else{for(let u=3;u<e;u+=3){u+3>=e&&(u=e-1);const c=this.getPoint(u);a.x=Math.min(c.x,a.x),a.y=Math.min(c.y,a.y)}n=a.x,o=a.y}else{for(let u=0;u<e;u++){const c=l[u];a.x=Math.min(c.x,a.x),a.y=Math.min(c.y,a.y)}n=a.x,o=a.y}if(n-=this.gk.x,o-=this.gk.y,r.x-=n,r.y-=o,this.computeShortLength(!0)!==0&&(r=this.ec(r,!0,a)),e===2&&!this._h()){let u=P.bs(this.getPoint(1));return u.x-=n,u.y-=o,this.computeShortLength(!1)!==0&&(u=this.ec(u,!1,a)),t.type=1,t.startX=r.x,t.startY=r.y,t.endX=u.x,t.endY=u.y,P.i(u),P.i(r),P.i(a),t}else{t.type=4;const u=me.qL(t);if(u.Au(r.x,r.y,!1,!1),h===9&&e>=3&&!L.X(this.smoothness,0))if(e===3){const c=this.getPoint(1),d=c.x-n,f=c.y-o,m=P.bs(this.getPoint(2));m.x-=n,m.y-=o,this.computeShortLength(!1)!==0&&this.ec(m,!1,a),u.xr(d,f,d,f,m.x,m.y),P.i(m)}else if(this.isOrthogonal){const c=P.z(n,o),d=P.bs(this.getPoint(1)),f=P.z(n,o),m=P.z(n,o);let g=this.getPoint(0),p;const b=this.smoothness/3;for(let S=1;S<this.pointsCount-1;S++){p=this.getPoint(S);const N=g,D=p,A=this.getPoint(this.OC(p,S,!1));L.X(N.x,D.x)&&L.X(D.x,A.x)||L.X(N.y,D.y)&&L.X(D.y,A.y)||(this.EE(N,D,A,b,f,m),(S===1||S===2&&L.X(g.x,this.getPoint(0).x)&&L.X(g.y,this.getPoint(0).y))&&(d.x=(g.x+p.x)*.5,d.y=(g.y+p.y)*.5),u.xr(d.x-n,d.y-o,f.x-n,f.y-o,p.x-n,p.y-o),c.h(f),d.h(m),g=p)}let v=g.x,w=g.y;const k=P.bs(this.getPoint(this.pointsCount-1));this.computeShortLength(!1)!==0&&this.ec(k,!1,P.gn),v=.5*(v+k.x),w=.5*(w+k.y),u.xr(m.x-n,m.y-o,v-n,w-o,k.x-n,k.y-o),P.i(k),P.i(c),P.i(d),P.i(f),P.i(m)}else for(let c=3;c<e;c+=3){const d=this.getPoint(c-2);c+3>=e&&(c=e-1);const f=this.getPoint(c-1),m=P.bs(this.getPoint(c));c===e-1&&this.computeShortLength(!1)!==0&&this.ec(m,!1,P.gn),u.xr(d.x-n,d.y-o,f.x-n,f.y-o,m.x-n,m.y-o),P.i(m)}else if(this.isOrthogonal||e===2){const c=P.bs(this.getPoint(0)),d=P.l(),f=P.bs(c),m=this.computeCorner();let g=1,p=0;for(;g<e;){if(g=this.OC(c,g,g>1),d.h(this.getPoint(g)),g>=e-1){if(!c.equals(d))this.computeShortLength(!1)!==0&&this.ec(d,!1,P.gn),this.On(u,-n,-o,c,d,i);else if(p===0)for(g=1;g<e;)f.h(c),d.h(this.getPoint(g++)),this.On(u,-n,-o,c,d,i),c.h(d);break}p=this.OC(d,g+1,g<e-3);const b=this.getPoint(p);this.UE(u,-n,-o,c,d,b,c,f,m,i),f.h(d),g=p}P.i(c),P.i(d),P.i(f)}else{const c=this.computeCorner();if(e>2&&c>=.5){const d=P.bs(l[e-1]);this.computeShortLength(!1)!==0&&this.ec(d,!1,P.gn),r.x+=n,r.y+=o;for(let f=1;f<e;f++){const m=f===1?r:l[f-1],g=f===e-1?d:l[f],p=Math.sqrt(m.distanceSquaredPoint(g)),b=c/p;if(b<.5){if(f>1){const v=m.x+(g.x-m.x)*b,w=m.y+(g.y-m.y)*b;u.Tu(m.x-n,m.y-o,v-n,w-o)}u.Ks(g.x+(m.x-g.x)*b-n,g.y+(m.y-g.y)*b-o)}else f>1&&u.Tu(m.x-n,m.y-o,(m.x+g.x)/2-n,(m.y+g.y)/2-o);f===e-1&&u.Ks(d.x-n,d.y-o)}P.i(d)}else if(e>=2){const d=P.bs(l[e-1]);this.computeShortLength(!1)!==0&&this.ec(d,!1,P.gn);for(let f=1;f<e-1;f++)u.Ks(l[f].x-n,l[f].y-o);u.Ks(d.x-n,d.y-o),P.i(d)}}return me.WL(u),P.i(r),P.i(a),t}}kk(t,e,i,s){let n=i-t;if(isNaN(n)||n===1/0||n===-1/0)return NaN;n<0&&(n=-n);let o=s-e;return isNaN(o)||o===1/0||o===-1/0?NaN:(o<0&&(o=-o),L.X(n,0)?o:L.X(o,0)?n:Math.sqrt(n*n+o*o))}EE(t,e,i,s,n,o){isNaN(s)&&(s=this.smoothness/3);const r=t.x,a=t.y,l=e.x,h=e.y,u=i.x,c=i.y,d=s*this.kk(r,a,l,h),f=s*this.kk(l,h,u,c);if(L.X(a,h)&&L.X(l,u)&&(l>r?c>h?(n.x=l-d,n.y=h-d,o.x=l+f,o.y=h+f):(n.x=l-d,n.y=h+d,o.x=l+f,o.y=h-f):c>h?(n.x=l+d,n.y=h-d,o.x=l-f,o.y=h+f):(n.x=l+d,n.y=h+d,o.x=l-f,o.y=h-f)),L.X(r,l)&&L.X(h,c)&&(h>a?u>l?(n.x=l-d,n.y=h-d,o.x=l+f,o.y=h+f):(n.x=l+d,n.y=h-d,o.x=l-f,o.y=h+f):u>l?(n.x=l-d,n.y=h+d,o.x=l+f,o.y=h-f):(n.x=l+d,n.y=h+d,o.x=l-f,o.y=h-f)),L.X(r,l)&&L.X(l,u)||L.X(a,h)&&L.X(h,c)){const m=.5*(r+u),g=.5*(a+c);n.x=m,n.y=g,o.x=m,o.y=g}}ec(t,e,i){const s=this.pointsCount;if(s<2)return t;if(e){const n=this.getPoint(1),o=n.x-i.x,r=n.y-i.y,a=this.kk(t.x,t.y,o,r);if(a===0)return t;const l=s===2?a*.5:a;let h=this.computeShortLength(!0);h>l&&(h=l);const u=h*(o-t.x)/a,c=h*(r-t.y)/a;t.x+=u,t.y+=c}else{const n=this.getPoint(s-2),o=n.x-i.x,r=n.y-i.y,a=this.kk(t.x,t.y,o,r);if(a===0)return t;const l=s===2?a*.5:a;let h=this.computeShortLength(!1);h>l&&(h=l);const u=h*(t.x-o)/a,c=h*(t.y-r)/a;t.x-=u,t.y-=c}return t}OC(t,e,i){const s=this.pointsCount;let n=t;for(;L.X(t.x,n.x)&&L.X(t.y,n.y);){if(e>=s)return s-1;n=this.getPoint(e++)}if(!L.X(t.x,n.x)&&!L.X(t.y,n.y))return e-1;let o=n;for(;L.X(t.x,n.x)&&L.X(n.x,o.x)&&(!i||(t.y>=n.y?n.y>=o.y:n.y<=o.y))||L.X(t.y,n.y)&&L.X(n.y,o.y)&&(!i||(t.x>=n.x?n.x>=o.x:n.x<=o.x));){if(e>=s)return s-1;o=this.getPoint(e++)}return e-2}UE(t,e,i,s,n,o,r,a,l,h){if(L.u(s.y,n.y)&&L.u(n.x,o.x)){let u=Math.min(l,Math.abs(n.x-a.x)/2);const c=Math.min(u,Math.abs(o.y-n.y)/2);if(u=c,L.u(u,0)){this.On(t,e,i,s,n,h),r.h(n);return}let d=n.x;const f=n.y,m=d;let g=f;n.x>s.x?(d=n.x-u,o.y>n.y?g=n.y+c:g=n.y-c):(d=n.x+u,o.y>n.y?g=n.y+c:g=n.y-c);const p=P.z(d,f);this.On(t,e,i,s,p,h),P.i(p),t.Tu(n.x+e,n.y+i,m+e,g+i),r.e(m,g)}else if(L.u(s.x,n.x)&&L.u(n.y,o.y)){let u=Math.min(l,Math.abs(n.y-a.y)/2);const c=Math.min(u,Math.abs(o.x-n.x)/2);if(u=c,L.u(c,0)){this.On(t,e,i,s,n,h),r.h(n);return}const d=n.x;let f=n.y,m=d;const g=f;n.y>s.y?(f=n.y-u,o.x>n.x?m=n.x+c:m=n.x-c):(f=n.y+u,o.x>n.x?m=n.x+c:m=n.x-c);const p=P.z(d,f);this.On(t,e,i,s,p,h),P.i(p),t.Tu(n.x+e,n.y+i,m+e,g+i),r.e(m,g)}else this.On(t,e,i,s,n,h),r.h(n)}On(t,e,i,s,n,o){if(o||!this._h())t.Ks(n.x+e,n.y+i);else{const r=U.nv,a=r/2,l=[];let h=0;this.isVisible()&&(h=this.VE(s,n,l));let u=s.x,c=s.y;if(h>0){if(L.u(s.y,n.y))if(s.x<n.x){let d=0;for(;d<h;){const f=Math.max(s.x,Math.min(l[d++]-a,n.x-r));t.Ks(f+e,n.y+i),u=f+e,c=n.y+i;let m=Math.min(f+r,n.x);for(;d<h;){const v=l[d];if(v<m+r)d++,m=Math.min(v+a,n.x);else break}const g=n.y-r+i,p=m+e,b=n.y+i;this.curve===10?t.Au(p,b,!1,!1):t.xr(u,g,p,g,p,b),u=p,c=b}}else{let d=h-1;for(;d>=0;){const f=Math.min(s.x,Math.max(l[d--]+a,n.x+r));t.Ks(f+e,n.y+i),u=f+e,c=n.y+i;let m=Math.max(f-r,n.x);for(;d>=0;){const v=l[d];if(v>m-r)d--,m=Math.max(v-a,n.x);else break}const g=n.y-r+i,p=m+e,b=n.y+i;this.curve===10?t.Au(p,b,!1,!1):t.xr(u,g,p,g,p,b),u=p,c=b}}else if(L.u(s.x,n.x))if(s.y<n.y){let d=0;for(;d<h;){const f=Math.max(s.y,Math.min(l[d++]-a,n.y-r));t.Ks(n.x+e,f+i),u=n.x+e,c=f+i;let m=Math.min(f+r,n.y);for(;d<h;){const v=l[d];if(v<m+r)d++,m=Math.min(v+a,n.y);else break}const g=n.x-r+e,p=n.x+e,b=m+i;this.curve===10?t.Au(p,b,!1,!1):t.xr(g,c,g,b,p,b),u=p,c=b}}else{let d=h-1;for(;d>=0;){const f=Math.min(s.y,Math.max(l[d--]+a,n.y+r));t.Ks(n.x+e,f+i),u=n.x+e,c=f+i;let m=Math.max(f-r,n.y);for(;d>=0;){const v=l[d];if(v>m-r)d--,m=Math.max(v-a,n.y);else break}const g=n.x-r+e,p=n.x+e,b=m+i;this.curve===10?t.Au(p,b,!1,!1):t.xr(g,c,g,b,p,b),u=p,c=b}}}t.Ks(n.x+e,n.y+i)}}VE(t,e,i){const s=this.diagram;if(s===null||t.equals(e))return 0;const n=s.layers;for(;n.next();){const o=n.value;if(o!==null&&o.visible){const r=o.EM(),a=r.length;for(let l=0;l<a;l++){const h=r[l];if(!(h instanceof U))continue;if(h===this)return i.length>0&&i.sort((d,f)=>d-f),i.length;if(!h.isVisible()||!h._h())continue;const u=h.routeBounds;if(!u.isReal()||!this.routeBounds.intersectsRect(u)||this.usesSamePort(h))continue;const c=h.path;c!==null&&c.isVisibleObject()&&this.BE(t,e,i,h)}}}return i.length>0&&i.sort((o,r)=>o-r),i.length}BE(t,e,i,s){const n=L.u(t.y,e.y),o=s.pointsCount;let r=s.getPoint(0);const a=P.l();for(let l=1;l<o;l++){const h=s.getPoint(l);if(l<o-1){const u=s.getPoint(l+1);if(r.y===h.y&&h.y===u.y){if(h.x>r.x&&u.x>=h.x||h.x<r.x&&u.x<=h.x)continue}else if(r.x===h.x&&h.x===u.x&&(h.y>r.y&&u.y>=h.y||h.y<r.y&&u.y<=h.y))continue}this.zE(t,e,r,h,a)&&(n?i.push(a.x):i.push(a.y)),r=h}P.i(a)}zE(t,e,i,s,n){const o=t.x,r=t.y,a=e.x,l=e.y,h=i.x,u=i.y,c=s.x,d=s.y;if(L.u(o,a)){if(!L.u(r,l)&&L.u(u,d)&&Math.min(r,l)<u&&Math.max(r,l)>u&&Math.min(h,c)<o&&Math.max(h,c)>o&&!L.u(h,c))return n.x=o,n.y=u,!0}else if(L.u(r,l)&&L.u(h,c)&&Math.min(o,a)<h&&Math.max(o,a)>h&&Math.min(u,d)<r&&Math.max(u,d)>r&&!L.u(u,d))return n.x=h,n.y=r,!0;return n.x=0,n.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.bl(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.bl(this.computeSpot(!1))?t-2:t-1}_h(){const t=this.curve;return t===11||t===10}yk(t){if(t||this._h()){const e=this.diagram;e!==null&&!e.animationManager.isTicking&&!e.ra.has(this)&&(this.va.width!==0||this.va.height!==0)&&e.ra.set(this,this.va.copy())}}invalidateOtherJumpOvers(t){const e=this.layer;if(e===null||!e.visible||e.isTemporary)return;const i=e.diagram;if(i===null||i.animationManager.isTicking)return;let s=!1;const n=i.layers;for(;n.next();){const o=n.value;if(o.visible){if(o===e){s=!0;let r=!1;const a=o.EM(),l=a.length;for(let h=0;h<l;h++){const u=a[h];u instanceof U&&(u===this?r=!0:r&&this.pv(u,t))}}else if(s){const r=o.EM(),a=r.length;for(let l=0;l<a;l++){const h=r[l];h instanceof U&&this.pv(h,t)}}}}}pv(t,e){if(t===null||!t.Ra||!t.Fi||!t._h())return;const i=t.routeBounds;i.isReal()&&(!this.routeBounds.intersectsRect(i)&&!e.intersectsRect(i)||this.usesSamePort(t)||t.ai())}usesSamePort(t){const e=this.pointsCount,i=t.pointsCount;if(e>0&&i>0){const s=this.getPoint(0),n=t.getPoint(0);if(s.equalsApprox(n))return!0;const o=this.getPoint(e-1),r=t.getPoint(i-1);if(o.equalsApprox(r)||s.equalsApprox(r)||o.equalsApprox(n))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let e=!0;const i=this.diagram;i!==null&&(e=i.isTreePathToChildren);const s=this.fromNode;if(s!==null){if(this.isTreeLink&&e&&!s.isTreeExpanded)return!1;if(s===t)return!0;let o=s;for(;o!==null;){if(o.labeledLink===this)return!0;o=o.containingGroup}const r=s.findVisibleNode();if(r===null||r===t)return!1}const n=this.toNode;if(n!==null){if(this.isTreeLink&&!e&&!n.isTreeExpanded)return!1;if(n===t)return!0;let o=n;for(;o!==null;){if(o.labeledLink===this)return!0;o=o.containingGroup}const r=n.findVisibleNode();if(r===null||r===t)return!1}return!0}Xe(t){if(super.Xe(t),t&&this.yk(!1),this.sr!==null&&this.sr.Jd(),this.on!==null){const e=this.on.iterator;for(;e.next();)e.value.Xe(t)}}get adjusting(){return this.Gf}set adjusting(t){const e=this.Gf;e!==t&&(this.Gf=t,this.t("adjusting",e,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Gf}get corner(){return this.Qd}set corner(t){const e=this.Qd;e!==t&&(this.Qd=t,this.ai(),this.t("corner",e,t))}get curve(){return this._d}set curve(t){const e=this._d;e!==t&&(this._d=t,this.$t(),this.ai(),this.yk(e===10||e===11||t===10||t===11),this.t("curve",e,t))}get curviness(){return this.tg}set curviness(t){const e=this.tg;e!==t&&(this.tg=t,this.$t(),this.ai(),this.t("curviness",e,t))}get routing(){return this.Jh}set routing(t){const e=this.Jh;e!==t&&(this.Jh=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.lp=!0),this.ir=null,this.$t(),this.yk(U.MC(e)||U.MC(t)),this.t("routing",e,t))}get smoothness(){return this.eg}set smoothness(t){const e=this.eg;e!==t&&(this.eg=t,this.ai(),this.t("smoothness",e,t))}Qy(){const t=this.po;if(t===null)return;const e=this.wo;if(e===null||!isNaN(this.curviness))return;const i=this.yo,s=this.xo;let n=null,o=null;const r=t.ee.r,a=r.length;for(let l=0;l<a;l++){const h=r[l];!(h.po===t&&h.yo===i&&h.wo===e&&h.xo===s)&&!(h.po===e&&h.yo===s&&h.wo===t&&h.xo===i)||(o===null?o=h:(n===null&&(n=[],n.push(o)),n.push(h)))}if(n!==null){let l=t.KD(e,i,s);l===null&&(l=new Zs(t,i,e,s),t.GD(l),e.GD(l)),l.rn=n;for(let h=0;h<n.length;h++){const u=n[h];u.sr=l}l.Jd()}}Zy(){const t=this.sr;if(t!==null){if(!isNaN(this.curviness))return;this.sr=null;const e=t.rn.indexOf(this);e>=0&&(t.rn.splice(e,1),t.Jd())}}Ar(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.Wh()))return t.model.getKeyForLinkData(this.data)}}class Zs{Ko;qs;Gy;pC;fk;yC;rn;constructor(t,e,i,s){K.Je(this),this.Ko=!1,this.qs=!1,this.Gy=t,this.pC=e,this.fk=i,this.yC=s,this.rn=[]}Jd(){if(!this.Ko){const t=this.rn;if(t.length>0){const e=t[0].diagram;e!==null&&(e.o2.add(this),this.qs=e.undoManager.isUndoingRedoing)}}this.Ko=!0}P2(){if(this.Ko){this.Ko=!1;const t=this.rn;if(t.length>0){const e=t[0],i=e.diagram,s=i===null||i.Qa&&!this.qs;this.qs=!1,e.arrangeBundledLinks(t,s),t.length===1&&(e.sr=null,t.length=0)}t.length===0&&(this.Gy.YD(this),this.fk.YD(this))}}}class Ct{ui;di;ic;sc;we;xe;Vt;Oa;Ia;Ah;I2;Ko;tw;hf;E2;U2;constructor(t){K.Je(this),this.Ah=null,this.I2=null,this.Ko=!0,this.tw=!1,this.ui=1,this.di=1,this.ic=-1,this.sc=-1,this.we=t.width,this.xe=t.height,this.Vt=[],this.Oa=0,this.Ia=0,this.hf=U.fv,this.E2=this.hf*2,this.U2=this.hf*2}static ln=0;static nc=1;static sg=999999;static IC=Ct.sg+1;static EC=Ct.sg+2;f1(t){if(t.width<=0||t.height<=0)return;const e=t.x,i=t.y,s=t.x+t.width,n=t.y+t.height;this.ui=Math.floor((e-this.we)/this.we)*this.we,this.di=Math.floor((i-this.xe)/this.xe)*this.xe,this.ic=Math.ceil((s+2*this.we)/this.we)*this.we,this.sc=Math.ceil((n+2*this.xe)/this.xe)*this.xe;const o=1+(Math.ceil((this.ic-this.ui)/this.we)|0),r=1+(Math.ceil((this.sc-this.di)/this.xe)|0);if(this.Vt.length===0||this.Oa<o-1||this.Ia<r-1){const a=[];for(let l=0;l<=o;l++)a[l]=new Uint32Array(r);this.Vt=a,this.Oa=o-1,this.Ia=r-1}this.XE(Ct.IC)}get bounds(){return new I(this.ui,this.di,this.ic-this.ui,this.sc-this.di)}get cellWidth(){return this.we}set cellWidth(t){t>0&&t!==this.we&&(this.we=t,this.f1(this.bounds))}get cellHeight(){return this.xe}set cellHeight(t){t>0&&t!==this.xe&&(this.xe=t,this.f1(this.bounds))}ng(t,e){return this.ui<=t&&t<=this.ic&&this.di<=e&&e<=this.sc}bo(t,e){if(!this.ng(t,e))return Ct.IC;t-=this.ui,t/=this.we,e-=this.di,e/=this.xe;const i=t|0,s=e|0;return this.Vt[i][s]}vO(t,e,i,s){if(!this.ng(t,e))return;const n=(t-this.ui)/this.we|0,o=(e-this.di)/this.xe|0,r=(t+i-this.ui)/this.we|0,a=(e+s-this.di)/this.xe|0,l=Math.min(r,this.Oa),h=Math.min(a,this.Ia);for(let u=n;u<=l;u++){const c=this.Vt[u];if(c.fill)c.fill(Ct.ln,o,h+1);else for(let d=o;d<=h;d++)c[d]=Ct.ln}}XE(t){for(let e=0;e<=this.Oa;e++){const i=this.Vt[e];if(i.fill)i.fill(t);else for(let s=0;s<=this.Ia;s++)i[s]=t}}TT(){for(let t=0;t<=this.Oa;t++){const e=this.Vt[t];for(let i=0;i<=this.Ia;i++)e[i]>=Ct.nc&&(e[i]=Ct.IC)}}GE(t,e){return this.bo(t,e)===Ct.ln}isUnoccupied(t,e,i,s){if(t>this.ic||t+i<this.ui||e>this.sc||e+s<this.di)return!0;let n=(t-this.ui)/this.we|0,o=(e-this.di)/this.xe|0,r=Math.max(0,i)/this.we+1|0,a=Math.max(0,s)/this.xe+1|0;if(n<0&&(r+=n,n=0),o<0&&(a+=o,o=0),r<0||a<0)return!0;const l=Math.min(n+r-1,this.Oa)|0,h=Math.min(o+a-1,this.Ia)|0;for(let u=n;u<=l;u++){const c=this.Vt[u];for(let d=o;d<=h;d++)if(c[d]===Ct.ln)return!1}return!0}maxAvoidsLinksSpaceH(t,e,i,s){if(t>this.ic||e<this.ui||i>this.sc||i<this.di)return 0;const n=(t-this.ui)/this.we|0,o=(e-this.ui)/this.we|0,r=(i-this.di)/this.xe|0,a=s/this.xe+1|0;let l;for(l=0;l<a/2;l++){let h=!1;for(let u=n;u<=o;u++)if(this.Vt[u][r+l]===Ct.ln||this.Vt[u][r-l]===Ct.ln){h=!0;break}if(h)return Math.max(0,(2*l-1)*this.xe)}return s}maxAvoidsLinksSpaceV(t,e,i,s){if(t>this.sc||e<this.di||i>this.ic||i<this.ui)return 0;const n=(t-this.di)/this.xe|0,o=(e-this.di)/this.xe|0,r=(i-this.ui)/this.we|0,a=s/this.we+1|0;let l;for(l=0;l<a/2;l++){let h=!1;for(let u=n;u<=o;u++)if(this.Vt[r+l][u]===Ct.ln||this.Vt[r-l][u]===Ct.ln){h=!0;break}if(h)return Math.max(0,(2*l-1)*this.we)}return s}YE(t,e,i,s,n,o,r,a){t=t|0,e=e|0;let l=this.Vt[t][e];if(l>=Ct.nc&&l<Ct.sg)for(s?e+=i:t+=i,l+=1;n<=t&&t<=o&&r<=e&&e<=a;){const h=this.Vt[t][e];if(l>=h)break;this.Vt[t][e]=l,l+=1,s?e+=i:t+=i}return s?e:t}ko(t,e,i,s,n,o,r,a){if(t<n||t>o||e<r||e>a)return;const l=this.YE(t,e,i,s,n,o,r,a);if(s)if(i>0)for(let h=e+i;h<l;h+=i)this.ko(t,h,1,!s,n,o,r,a),this.ko(t,h,-1,!s,n,o,r,a);else for(let h=e+i;h>l;h+=i)this.ko(t,h,1,!s,n,o,r,a),this.ko(t,h,-1,!s,n,o,r,a);else if(i>0)for(let h=t+i;h<l;h+=i)this.ko(h,e,1,!s,n,o,r,a),this.ko(h,e,-1,!s,n,o,r,a);else for(let h=t+i;h>l;h+=i)this.ko(h,e,1,!s,n,o,r,a),this.ko(h,e,-1,!s,n,o,r,a)}Pk(t,e,i,s,n,o,r,a,l,h){let u=t|0,c=e|0,d=Ct.ln,f=Ct.nc;for(this.Vt[u][c]=f;d===Ct.ln&&u>r&&u<a&&c>l&&c<h;)f+=1,this.Vt[u][c]=f,o?c+=n:u+=n,d=this.Vt[u][c];return o?c:u}Sk(t,e,i,s,n,o,r,a,l,h){let u=i|0,c=s|0,d=Ct.ln;const f=Ct.sg;for(this.Vt[u][c]=f;d===Ct.ln&&u>r&&u<a&&c>l&&c<h;)this.Vt[u][c]=f,o?c+=n:u+=n,d=this.Vt[u][c]}yv(t,e,i,s,n,o){this.tw=!1;let r=t.x,a=t.y;if(!this.ng(r,a))return;r-=this.ui,r/=this.we,a-=this.di,a/=this.xe;let l=i.x,h=i.y;if(!this.ng(l,h))return;if(l-=this.ui,l/=this.we,h-=this.di,h/=this.xe,Math.abs(r-l)<=1&&Math.abs(a-h)<=1){this.tw=!0;return}let u=n.x,c=n.y,d=n.x+n.width,f=n.y+n.height;u-=this.ui,u/=this.we,c-=this.di,c/=this.xe,d-=this.ui,d/=this.we,f-=this.di,f/=this.xe;const m=Math.max(0,Math.min(this.Oa,u|0)),g=Math.min(this.Oa,Math.max(0,d|0)),p=Math.max(0,Math.min(this.Ia,c|0)),b=Math.min(this.Ia,Math.max(0,f|0)),v=0,w=90,k=270,S=this.Vt,N=r|0,D=a|0,A=l|0,M=h|0,C=e===v||e===w?1:-1,F=e===w||e===k;S[N][D]===Ct.ln?(this.Pk(N,D,A,M,C,F,m,g,p,b),this.Pk(N,D,A,M,1,!F,m,g,p,b),this.Pk(N,D,A,M,-1,!F,m,g,p,b)):this.Pk(N,D,A,M,C,F,N,D,N,D),S[A][M]===Ct.ln?(this.Sk(N,D,A,M,s===v||s===w?1:-1,s===w||s===k,m,g,p,b),this.Sk(N,D,A,M,1,!(s===w||s===k),m,g,p,b),this.Sk(N,D,A,M,-1,!(s===w||s===k),m,g,p,b)):this.Sk(N,D,A,M,C,F,A,M,A,M);const O=y.nt();if(o&&this.wv(A,M,s,N,D,O)){(O[0]!==A||O[1]!==M)&&(O.unshift(M),O.unshift(A)),(O[O.length-2]!==N||O[O.length-1]!==D)&&(O.push(N),O.push(D));let E=Ct.nc,B=O[O.length-2],z=O[O.length-1];S[B][z]=E++;for(let V=O.length-4;V>=0;V-=2){B=O[V+2],z=O[V+3];const Y=O[V],_=O[V+1];for(;Y>B?B++:Y<B?B--:_>z?z++:_<z&&z--,S[B][z]=E++,!(B===Y&&z===_););}}else this.ko(N,D,1,!1,m,g,p,b),this.ko(N,D,-1,!1,m,g,p,b),this.ko(N,D,1,!0,m,g,p,b),this.ko(N,D,-1,!0,m,g,p,b);y.Z(O)}wv(t,e,i,s,n,o){const r=this.Vt;let a=t,l=e;for(;;){if(a===s&&l===n)return!0;let h=a,u=l;if(i===0)if(h<s)h++;else break;else if(i===90)if(u<n)u++;else break;else if(i===180)if(h>s)h--;else break;else if(u>n)u--;else break;const c=r[h][u];if(c===0||c===Ct.EC)break;a=h,l=u}for(;;){let h=i,u=a,c=l;i===0?c<n?(h=90,c++):c>n&&(h=270,c--):i===90?u<s?(h=0,u++):u>s&&(h=180,u--):i===180?c<n?(h=90,c++):c>n&&(h=270,c--):u<s?(h=0,u++):u>s&&(h=180,u--);const d=r[u][c];if(h!==i&&d!==0&&d!==Ct.EC){if(o.push(a),o.push(l),this.wv(a,l,h,s,n,o))return!0;o.pop(),o.pop()}if(r[a][l]=Ct.EC,i===0){if(a===t)return!1;a--}else if(i===90){if(l===e)return!1;l--}else if(i===180){if(a===t)return!1;a++}else{if(l===e)return!1;l++}}}}class ki{Ri;kl;Ei;og;constructor(t,e){K.Je(this),this.Ri=t,this.kl=e,this.Ei=[],this.og=!1}toString(){const t=this.Ei;let e=this.Ri.toString()+" "+t.length.toString()+":";for(let i=0;i<t.length;i++){const s=t[i];s!==null&&(e+=`
  `+s.toString())}return e}KE(t,e,i,s){const n=e.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=Math.atan2(t.height,t.width)*180/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Jd(){this.Ei.length=0}dv(t){let e=this.Ei;e.length===0&&(this.HE(),e=this.Ei);for(let i=0;i<e.length;i++){const s=e[i];if(s!==null&&s.es===t)return s}return null}HE(){if(!this.og){const t=this.og;this.og=!0;let e,i=null;const s=this.Ri,n=s instanceof at?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.og=t,this.Ei;i=n,e=i.findExternalLinksConnected()}else s.isTreeExpanded?e=s.findLinksConnected(this.kl.portId):e=s.findExternalTreeLinksConnected();this.Ei.length=0;let o=0;const r=this.kl.getDocumentPoint(T.TopLeft,P.l()),a=this.kl.getDocumentPoint(T.BottomRight,P.l()),l=I.z(r.x,r.y,0,0);l.unionPoint(a),P.i(r),P.i(a);const h=P.z(l.x+l.width/2,l.y+l.height/2),u=this.kl.getDocumentAngle(),c=e.iterator;for(;c.next();){const g=c.value;if(!g.isVisible()||g.fromPort===g.toPort)continue;const p=g.fromPort===this.kl||i!==null&&g.fromNode!==null&&g.fromNode.isMemberOf(i),b=g.computeSpot(p,this.kl);if(!b.isSide())continue;let v;if(p?v=g.toPort:v=g.fromPort,v===null)continue;let w=v.part;if(w===null)continue;const k=w.findVisibleNode();k!==null&&k!==w&&(w=k,v=w.port);const S=g.computeOtherPoint(w,v);let N=h.directionPoint(S);u!==0&&(N=L.Ee(N-u));const D=this.KE(l,b,N,g.isOrthogonal);let A=0;D===0?(A=4,N>180&&(N-=360)):D===90?(A=8,N>270&&(N-=360)):D===180?A=2:(A=1,N<90&&(N+=360));let M=this.Ei[o];M===void 0?(M=new Qs(g,N,A),this.Ei[o]=M):(M.es=g,M.Xt=N,M.fi=A),M.Mk.h(S),o++}P.i(h),this.jE();const d=this.Ei.length;let f=-1,m=0;for(o=0;o<d;o++){const g=this.Ei[o];g!==void 0&&(g.fi!==f&&(f=g.fi,m=0),g.rg=m,m++)}for(f=-1,m=0,o=d-1;o>=0;o--){const g=this.Ei[o];g!==void 0&&(g.fi!==f&&(f=g.fi,m=g.rg+1),g.Kf=m)}this.qE(this.Ei),this.WE(this.Ei),this.og=t,I.i(l)}return this.Ei}JE(t,e){return t===e?0:t===null?-1:e===null?1:t.fi<e.fi?-1:t.fi>e.fi?1:t.Xt<e.Xt?-1:t.Xt>e.Xt?1:0}jE(){this.Ei.sort(ki.prototype.JE)}qE(t){const e=this.kl,i=this.Ri.portSpreading,s=P.l(),n=P.l(),o=P.l(),r=P.l();e.getDocumentPoint(T.TopLeft,s),e.getDocumentPoint(T.TopRight,n),e.getDocumentPoint(T.BottomRight,o),e.getDocumentPoint(T.BottomLeft,r);let a=0,l=0,h=0,u=0;if(i===2)for(let v=0;v<t.length;v++){const w=t[v];if(w===null)continue;const k=w.es.computeThickness();switch(w.fi){case 8:h+=k;break;case 2:u+=k;break;case 1:a+=k;break;default:case 4:l+=k;break}}let c=0,d=0,f=1,m=n,g=o,p=0,b=0;for(let v=0;v<t.length;v++){const w=t[v];if(w===null)continue;if(c!==w.fi){switch(c=w.fi,c){case 8:m=o,g=r;break;case 2:m=r,g=s;break;case 1:m=s,g=n;break;default:case 4:m=n,g=o;break}switch(p=g.x-m.x,b=g.y-m.y,c){case 8:h>Math.abs(p)?(f=Math.abs(p)/h,h=Math.abs(p)):f=1;break;case 2:u>Math.abs(b)?(f=Math.abs(b)/u,u=Math.abs(b)):f=1;break;case 1:a>Math.abs(p)?(f=Math.abs(p)/a,a=Math.abs(p)):f=1;break;default:case 4:l>Math.abs(b)?(f=Math.abs(b)/l,l=Math.abs(b)):f=1;break}d=0}const k=w.tc;if(i===2){let S=w.es.computeThickness();switch(S*=f,k.h(m),c){case 8:k.x=m.x+p/2+h/2-d-S/2;break;case 2:k.y=m.y+b/2+u/2-d-S/2;break;case 1:k.x=m.x+p/2-a/2+d+S/2;break;default:case 4:k.y=m.y+b/2-l/2+d+S/2;break}d+=S}else{let S=.5;i===1&&(S=(w.rg+1)/(w.Kf+1)),k.x=m.x+p*S,k.y=m.y+b*S}}P.i(s),P.i(n),P.i(o),P.i(r)}WE(t){for(let e=0;e<t.length;e++){const i=t[e];i!==null&&(i.bk=this.$E(i,e))}}$E(t,e){const i=t.es,s=i.fromPort===this.kl;let n=0;switch(t.fi){case 1:n=270;break;case 2:n=180;break;case 4:n=0;break;case 8:n=90;break}const o=i.wk(this.Ri,this.kl,T.None,s,n);let r=t.rg;if(r<0)return o;const a=t.Kf;if(a<=1||!i.isOrthogonal)return o;const l=t.Mk,h=t.tc,u=t.fi===2||t.fi===8;u&&(r=a-1-r);const c=U.tv,d=t.fi===2||t.fi===4,f=r<=0?h:this.Ei[u?e+1:e-1].tc,m=r>=a-1?h:this.Ei[u?e-1:e+1].tc;return(d?l.y>=f.y&&l.y<=m.y:l.x>=f.x&&l.x<=m.x)?o:(d?l.y<h.y:l.x<h.x)?o+r*c:o+(a-1-r)*c}}class Qs{es;Xt;fi;Mk;rg;Kf;tc;bk;constructor(t,e,i){this.es=t,this.Xt=e,this.fi=i,this.Mk=new P,this.rg=0,this.Kf=0,this.tc=new P,this.bk=0}toString(){return this.es.toString()+" "+this.Xt.toString()+" "+this.fi.toString()+":"+this.rg.toString()+"/"+this.Kf.toString()+" "+this.tc.toString()+" "+this.bk.toString()+" "+this.Mk.toString()}}class ti{Dh;vh;Fh;Rh;Oh;Ih;c0;a0;f0;h0;constructor(){this.Dh=T.Default,this.vh=T.Default,this.Fh=NaN,this.Rh=NaN,this.Oh=NaN,this.Ih=NaN,this.c0=null,this.a0=null,this.f0=1/0,this.h0=1/0}copy(){const t=new ti;return t.Dh=this.Dh.N(),t.vh=this.vh.N(),t.Fh=this.Fh,t.Rh=this.Rh,t.Oh=this.Oh,t.Ih=this.Ih,t.c0=this.c0,t.a0=this.a0,t.f0=this.f0,t.h0=this.h0,t}}class we{t0;e0;i0;_p;j0;q0;constructor(){this.t0=-1/0,this.e0=0,this.i0=P.gn,this._p=0,this.j0="None",this.q0="None"}copy(){const t=new we;return t.t0=this.t0,t.e0=this.e0,t.i0=this.i0.N(),t._p=this._p,t.j0=this.j0,t.q0=this.q0,t}}class at extends W{lg;Dt;Ch;Fp;he;li;constructor(t,e){let i;t===void 0||t instanceof Pt||typeof t=="string"?i=t:t&&(e=t),super(i),this.E=this.E|4608,this.lg=new K,this.Dt=null,this.li=new Kt,this.li.group=this,this.Ch=new K,this.Fp=null,this.he=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),this.E=this.E&-32769;const e=t.findInVisualTree(i=>i instanceof Jt);e instanceof Jt?t.Dt=e:t.Dt=null,this.li!==null?(t.li=this.li.copy(),t.li.group=t):(t.li!==null&&(t.li.group=null),t.li=null),this.he!==null&&(t.he=this.he.copy())}jo(t){super.jo(t);const e=t.findSubGraphParts(),i=t.memberParts;for(;i.next();){const s=i.value;if(s.c(),s.invalidateLayout(8),s.clearAdornments(),s instanceof W)s.invalidateConnectedLinks(e);else if(s instanceof U){const n=s.labelNodes;for(;n.next();)n.value.invalidateConnectedLinks(e)}}}gf(t,e,i,s,n,o,r){if(t===3&&e==="elements"){if(n instanceof Jt)this.Dt===null?this.Dt=n:this.Dt!==n&&y.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(n instanceof j){const a=n.findInVisualTree(l=>l instanceof Jt);a instanceof Jt&&(this.Dt===null?this.Dt=a:this.Dt!==a&&y.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&e==="elements"&&this.Dt!==null&&(s===this.Dt?this.Dt=null:s instanceof j&&this.Dt.isContainedBy(s)&&(this.Dt=null));super.gf(t,e,i,s,n,o,r)}kd(t,e){if(super.kd(t,e),this.isClipping&&this.type!==j.Spot&&this.isSubGraphExpanded){let i=this.resizeObject;i instanceof j&&(i=i.findMainElement()),this.he===null&&(this.he=new I),i.getDocumentBounds(this.he),i instanceof et&&this.he.inflate(-i.strokeWidth,-i.strokeWidth)}}Pa(t,e,i,s){this.hasPlaceholder()&&(this.er=this.placeholder),super.Pa(t,e,i,s)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(t=>{t.ensureBounds()}),super.ensureBounds()}_r(){if(!super._r())return!1;const t=this.memberParts;for(;t.next();){const e=t.value;if(e instanceof W){if(!e.isVisible())continue;if(e.as())return!1}else if(e instanceof U){if(!e.isVisible())continue;if(e.as()&&e.fromNode!==this&&e.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.Dt!==null&&this.Dt.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Dt}get computesBoundsAfterDrag(){return(this.E&2048)!==0}set computesBoundsAfterDrag(t){const e=(this.E&2048)!==0;e!==t&&(this.E=this.E^2048,this.t("computesBoundsAfterDrag",e,t))}get computesBoundsIncludingLinks(){return(this.E&4096)!==0}set computesBoundsIncludingLinks(t){const e=(this.E&4096)!==0;e!==t&&(this.E=this.E^4096,this.t("computesBoundsIncludingLinks",e,t))}get computesBoundsIncludingLocation(){return(this.E&8192)!==0}set computesBoundsIncludingLocation(t){const e=(this.E&8192)!==0;e!==t&&(this.E=this.E^8192,this.t("computesBoundsIncludingLocation",e,t))}get handlesDragDropForMembers(){return(this.E&16384)!==0}set handlesDragDropForMembers(t){const e=(this.E&16384)!==0;e!==t&&(this.E=this.E^16384,this.t("handlesDragDropForMembers",e,t))}get avoidableMembers(){return(this.E&131072)!==0}set avoidableMembers(t){const e=(this.E&131072)!==0;e!==t&&(this.E=this.E^131072,this.t("avoidableMembers",e,t))}get memberParts(){return this.lg.iterator}uC(t){if(this.lg.add(t)){t instanceof at&&this.Ch.add(t);const i=this.memberAdded;if(i!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.G,n.G=!0),i(this,t),n!==null&&(n.G=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!1)}if(t instanceof U&&!this.computesBoundsIncludingLinks)return;let e=this.Dt;e===null&&(e=this),e.c()}fC(t){if(this.lg.delete(t)){t instanceof at&&this.Ch.delete(t);const i=this.memberRemoved;if(i!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.G,n.G=!0),i(this,t),n!==null&&(n.G=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!0)}if(t instanceof U&&!this.computesBoundsIncludingLinks)return;let e=this.Dt;e===null&&(e=this),e.c()}lf(){if(this.lg.count>0){const t=this.diagram;if(t!==null){const e=this.lg.copy().iterator;for(;e.next();){const i=e.value;t.remove(i)}}}super.lf()}get layout(){return this.li}set layout(t){const e=this.li;if(e!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&y.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),e!==null&&(e.diagram=null,e.group=null),this.li=t;const i=this.diagram;t!==null&&(t.diagram=i,t.group=this),i!==null&&(i.$r=!0),this.t("layout",e,t),i!==null&&i.requestUpdate()}}get memberAdded(){return this.vt!==null?this.vt.Wy:null}set memberAdded(t){const e=this.memberAdded;e!==t&&(t!==null&&y.S(t,at,"memberAdded"),this.wl().Wy=t,this.t("memberAdded",e,t))}get memberRemoved(){return this.vt!==null?this.vt.Jy:null}set memberRemoved(t){const e=this.memberRemoved;e!==t&&(t!==null&&y.S(t,at,"memberRemoved"),this.wl().Jy=t,this.t("memberRemoved",e,t))}get memberValidation(){return this.vt!==null?this.vt.da:null}set memberValidation(t){const e=this.memberValidation;e!==t&&(t!==null&&y.S(t,at,"memberValidation"),this.wl().da=t,this.t("memberValidation",e,t))}canAddMembers(t){const e=this.diagram;if(e===null)return!1;const i=e.commandHandler,s=i.wN(t).iterator;for(;s.next();){const n=s.value;if(!i.isValidMember(this,n))return!1}return!0}addMembers(t,e){const i=this.diagram;if(i===null)return!1;const s=i.commandHandler,n=s.wN(t);let o=!0;const r=n.iterator;for(;r.next();){const a=r.value;!e||s.isValidMember(this,a)?a.containingGroup=this:o=!1}return o}get ungroupable(){return(this.E&256)!==0}set ungroupable(t){const e=(this.E&256)!==0;e!==t&&(this.E=this.E^256,this.t("ungroupable",e,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const e=t.diagram;return!(e!==null&&!e.allowUngroup)}invalidateConnectedLinks(t){const e=this.ZE();if(super.invalidateConnectedLinks(t),e)return;this.cT(!0);const i=this.findExternalLinksConnected();for(;i.next();){const s=i.value;if(t!==void 0&&t.has(s))continue;const n=s.fromNode;if(n!==null&&n!==this&&n.isMemberOf(this)&&!n.isVisible())n.Ze(s.fromPort),n.Ze(s.toPort),s.$t();else{const o=s.toNode;o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible()&&(o.Ze(s.fromPort),o.Ze(s.toPort),s.$t())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.u2;if(t&&this.Fp!==null)return this.Fp.iterator;const e=this.findSubGraphParts();e.add(this);const i=new K,s=e.iterator;for(;s.next();){const n=s.value;if(!(n instanceof W))continue;const o=n.linksConnected;for(;o.next();){const r=o.value;e.has(r)||i.add(r)}}return t&&(this.Fp=i),i.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const e=new K,i=t.iterator;for(;i.next();){const s=i.value;if(!(s instanceof W))continue;const n=s.linksConnected;for(;n.next();){const o=n.value,r=o.fromNode;r!==null&&(!t.has(r)||r===this)&&e.add(r);const a=o.toNode;a!==null&&(!t.has(a)||a===this)&&e.add(a)}}return e.iterator}XU(){function t(i,s){i!==null&&(s.add(i),t(i.containingGroup,s))}const e=new K;return t(this,e),e}findSubGraphParts(){const t=new K;return ft.ga(t,this,!0,0,!0),t.delete(this),t}Xe(t){super.Xe(t);const e=this.memberParts;for(;e.next();)e.value.Xe(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const e=this.findSubGraphParts();this.xv(e,t,this),t.isCollapsingExpanding=!1}xv(t,e,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!1),n instanceof at&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.xv(t,e,i)),n instanceof W)n.invalidateConnectedLinks(t),e.Kc(n,i);else if(n instanceof U){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const e=this.findSubGraphParts();this.bv(e,t,this),t.isCollapsingExpanding=!1}bv(t,e,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!0),n instanceof at&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.bv(t,e,i)),n instanceof W)n.invalidateConnectedLinks(t);else if(n instanceof U){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.E&512)!==0}set isSubGraphExpanded(t){const e=(this.E&512)!==0;if(e!==t){this.E=this.E^512;const i=this.diagram;this.t("isSubGraphExpanded",e,t);const s=this.subGraphExpandedChanged;if(s!==null){let n=!0;i!==null&&(n=i.G,i.G=!0),s(this),i!==null&&(i.G=n)}if(i!==null&&i.undoManager.isUndoingRedoing){this.Dt!==null&&this.Dt.c(),this.memberParts.each(n=>n.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.E&1024)!==0}set wasSubGraphExpanded(t){const e=(this.E&1024)!==0;e!==t&&(this.E=this.E^1024,this.t("wasSubGraphExpanded",e,t))}get subGraphExpandedChanged(){return this.vt!==null?this.vt.$y:null}set subGraphExpandedChanged(t){const e=this.subGraphExpandedChanged;e!==t&&(t!==null&&y.S(t,at,"subGraphExpandedChanged"),this.wl().$y=t,this.t("subGraphExpandedChanged",e,t))}move(t,e){e===void 0&&(e=!1);const i=e?this.location:this.position,s=i.x,n=i.y,o=t.x,r=t.y;if((s===o||isNaN(s)&&isNaN(o))&&(n===r||isNaN(n)&&isNaN(r)))return;const a=o-(isNaN(s)?0:s),l=r-(isNaN(n)?0:n),h=P.l();super.move(t,e);const u=new K,c=this.findSubGraphParts().iterator;for(;c.next();){const d=c.value;d instanceof U&&(d.suspendsRouting&&u.add(d),!(!d.Fi&&(d.fromNode===this||d.toNode===this))&&(d.suspendsRouting=!0))}for(c.reset();c.next();){const d=c.value;if(d.Ar()||d instanceof W&&d.isLinkLabel)continue;const f=d.position,m=d.location;f.isReal()?(h.x=f.x+a,h.y=f.y+l,d.position=h):m.isReal()&&(h.x=m.x+a,h.y=m.y+l,d.location=h)}for(c.reset();c.next();){const d=c.value;if(!(d instanceof U)||(d.suspendsRouting=u.has(d),!d.Fi&&(d.fromNode===this||d.toNode===this)))continue;const f=d.position;h.x=f.x+a,h.y=f.y+l,h.isReal()?d.move(h):d.$t()}P.i(h)}ZE(){return(this.E&65536)!==0}cT(t){(this.E&65536)!==0!==t&&(this.E=this.E^65536)}get Lh(){return(this.E&32768)!==0}set Lh(t){(this.E&32768)!==0!==t&&(this.E=this.E^32768)}}class Jt extends tt{Qt;ag;constructor(t){super(),this.Qt=Mt.im,this.ag=new I(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Qt=this.Qt.N(),t.ag=this.ag.copy()}ka(t){if(this.background===null)return!1;const e=this.naturalBounds;return I.contains(0,0,e.width,e.height,t.x,t.y)}bd(t,e,i,s){const n=this.part;if((n===null||!(n instanceof at)&&!(n instanceof pt))&&y.o("Placeholder is not inside a Group or Adornment."),n instanceof at){const o=this.computeBorder(this.ag),r=this.minSize,a=isFinite(r.width)?Math.max(r.width,o.width):o.width,l=isFinite(r.height)?Math.max(r.height,o.height):o.height,h=this.Ke;h.jn(a||0,l||0),this.lo(0,0,h.width,h.height);const u=n.memberParts;let c=!1;for(;u.next();)if(u.value.isVisible()){c=!0;break}const d=n.diagram;if(c&&d!==null&&!d.animationManager.CM(n)&&!isNaN(o.x)&&!isNaN(o.y)){const f=P.l();f.setRectSpot(o,n.locationSpot),n.location=f,P.i(f)}}else{const o=n,r=this.Ke,a=this.Qt,l=a.left+a.right,h=a.top+a.bottom,u=o.adornedObject,c=u.getDocumentAngle();o.angle=c;let d=0;u instanceof et&&(d=u.strokeWidth);const f=u.getDocumentScale(),m=u.naturalBounds,g=(m.width+d)*f,p=(m.height+d)*f;if(o.type!==j.Link){const b=o.category==="Selection"?T.TopLeft:o.locationSpot,v=u.getDocumentPoint(b,P.l());o.location=v,P.i(v)}if(!isNaN(g)&&!isNaN(p))r.jn(g+l||0,p+h||0),this.lo(-a.left,-a.top,r.width,r.height);else{const b=u.getDocumentPoint(T.TopLeft,P.l()),v=I.z(b.x,b.y,0,0);v.unionPoint(u.getDocumentPoint(T.BottomRight,b)),v.unionPoint(u.getDocumentPoint(T.TopRight,b)),v.unionPoint(u.getDocumentPoint(T.BottomLeft,b)),r.jn(v.width+l||0,v.height+h||0),this.lo(-a.left,-a.top,r.width,r.height),P.i(b),I.i(v)}}}Pa(t,e,i,s){this.actualBounds.e(t,e,i,s)}computeBorder(t){const e=this.part,i=e.diagram;if(i===null||i.animationManager.isAnimating)return t;if(e instanceof at&&!e.layer.isTemporary&&e.computesBoundsAfterDrag&&this.ag.isReal()){const r=i.toolManager.findTool("Dragging");if(r===i.currentTool&&r.mR(e,this.ag,t))return t}const s=I.l(),n=this.computeMemberBounds(s),o=this.Qt;return e instanceof at&&!e.isSubGraphExpanded?t.e(n.x-o.left,n.y-o.top,0,0):t.e(n.x-o.left,n.y-o.top,Math.max(n.width+o.left+o.right,0),Math.max(n.height+o.top+o.bottom,0)),I.i(s),e instanceof at&&e.computesBoundsIncludingLocation&&e.location.isReal()&&t.unionPoint(e.location),t}computeMemberBounds(t){if(!(this.part instanceof at))return t.e(0,0,0,0),t;const e=this.part;let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=e.memberParts;for(;r.next();){const a=r.value;if(!a.isVisible()||a instanceof U&&(!e.computesBoundsIncludingLinks||a.Go()||a.fromNode===e||a.toNode===e))continue;const l=a.actualBounds;l.left<i&&(i=l.left),l.top<s&&(s=l.top),l.right>n&&(n=l.right),l.bottom>o&&(o=l.bottom)}if(!isFinite(i)||!isFinite(s)){const a=e.location;t.e(a.x,a.y,0,0)}else t.e(i,s,n-i,o-s);return t}get padding(){return this.Qt}set padding(t){typeof t=="number"&&(t=new Mt(t));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.t("padding",e,t),this.c())}}class Kt{a;Ah;hg;Tr;cg;fg;Vo;Pl;ug;dg;Po;constructor(t){K.Je(this),this.a=null,this.Ah=null,this.hg=!0,this.Tr=!0,this.cg=!1,this.fg=new P(0,0),this.Vo=!0,this.Pl=null,this.ug=null,this.dg=!1,this.Po=null,t&&Object.assign(this,t)}cloneProtected(t){t.hg=this.hg,t.Tr=this.Tr,t.cg=this.cg,t.fg.h(this.fg),t.Vo=this.Vo,t.Pl=this.Pl,t.ug=this.ug,t.dg=!0}copy(){const t=new this.constructor;return this.cloneProtected(t),t}fe(t){}toString(){let t=y.Hn(this.constructor);return t+="(",this.group!==null&&(t+=" in "+this.group),this.diagram!==null&&(t+=" for "+this.diagram),t+=")",t}get diagram(){return this.a}set diagram(t){this.a=t}get group(){return this.Ah}set group(t){this.Ah!==t&&(this.Ah=t,t!==null&&(this.a=t.diagram))}get isOngoing(){return this.hg}set isOngoing(t){this.hg!==t&&(y.s(t,"boolean",Kt,"isOngoing"),this.hg=t)}get isInitial(){return this.Tr}set isInitial(t){y.s(t,"boolean",Kt,"isInitial"),this.Tr=t,t||(this.dg=!0)}get isViewportSized(){return this.cg}set isViewportSized(t){this.cg!==t&&(y.s(t,"boolean",Kt,"isViewportSized"),this.cg=t,t&&this.p())}get isRouting(){return this.Vo}set isRouting(t){this.Vo!==t&&(y.s(t,"boolean",Kt,"isRouting"),this.Vo=t)}get isRealtime(){return this.Pl}set isRealtime(t){this.Pl!==t&&(t!==null&&y.s(t,"boolean",Kt,"isRealtime"),this.Pl=t)}get isValidLayout(){return this.dg}set isValidLayout(t){if(this.dg!==t&&(y.s(t,"boolean",Kt,"isValidLayout"),this.dg=t,!t)){const e=this.diagram;e!==null&&(e.$r=!0)}}invalidateLayout(){if(!this.isValidLayout)return;const t=this.diagram;if(t===null||t.undoManager.isUndoingRedoing)return;const e=t.animationManager;e.isTicking||(e.defaultAnimation.isAnimating&&e.stopAnimation(),(this.isOngoing&&t.Qa||this.isInitial&&!t.Qa)&&(this.isValidLayout=!1,t.requestUpdate()))}p(){this.invalidateLayout()}get network(){return this.Po}set network(t){this.Po!==t&&(this.Po=t,t!==null&&(t.layout=this))}createNetwork(){return new ve(this)}makeNetwork(t){const e=this.createNetwork();return t instanceof X?(e.addParts(t.nodes,!0),e.addParts(t.links,!0)):t instanceof at?e.addParts(t.memberParts):e.addParts(t.iterator),e}updateParts(){this.isValidLayout=!0;let t=this.diagram;if(t===null&&this.network!==null){const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value.node;if(i!==null&&(t=i.diagram,t!==null))break}}try{t!==null&&t.startTransaction("Layout"),this.commitLayout()}finally{t!==null&&t.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();if(this.isRouting){const e=this.network.edges.iterator;for(;e.next();)e.value.commit()}}doLayout(t){const e=new K;if(t instanceof X?(this.Ea(e,t.nodes,!0,this.Lh,!0,!1,!0),this.Ea(e,t.parts,!0,this.Lh,!0,!1,!0)):t instanceof at?this.Ea(e,t.memberParts,!1,this.Lh,!0,!1,!0):e.addAll(t.iterator),e.count>0){const i=this.diagram;i!==null&&i.startTransaction("Layout"),this.doMinimalNoNetworkLayout(e),i!==null&&i.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(t){const e=t.count,i=Math.ceil(Math.sqrt(e));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,r=n,a=0,l=0;const h=t.iterator;for(;h.next();){const u=h.value;u.ensureBounds();const c=u.measuredBounds,d=c.width,f=c.height;u.moveTo(o,r),u instanceof at&&(u.Lh=!1),o+=Math.max(d,50)+20,l=Math.max(l,Math.max(f,50)),a>=i-1?(a=0,o=s,r+=l+20,l=0):a++}}Lh(t){return!!(!t.location.isReal()&&!t.position.isReal()||t instanceof at&&t.Lh)}Ea(t,e,i,s,n,o,r){const a=e.iterator;for(;a.next();){const l=a.value;if(!(i&&!l.isTopLevel)&&!(s!==null&&!s(l))&&l.canLayout())if(n&&l instanceof W){if(l.isLinkLabel)continue;l instanceof at&&l.layout===null?this.Ea(t,l.memberParts,!1,s,n,o,r):(l.ensureBounds(),t.add(l))}else o&&l instanceof U?t.add(l):r&&l.Di()&&!(l instanceof W)&&(l.ensureBounds(),t.add(l))}}getLayoutBounds(t,e){const i=this.boundsComputation;return i!==null?(e||(e=new I),i(t,this,e)):!e&&t.margin.equalTo(0,0,0,0)?t.actualBounds:(e||(e=new I),e.set(t.actualBounds),e.addMargin(t.margin),e)}get boundsComputation(){return this.ug}set boundsComputation(t){this.ug!==t&&(t!==null&&y.S(t,Kt,"boundsComputation"),this.ug=t,this.p())}collectParts(t){const e=new K;return t instanceof X?(this.Ea(e,t.nodes,!0,null,!0,!0,!0),this.Ea(e,t.links,!0,null,!0,!0,!0),this.Ea(e,t.parts,!0,null,!0,!0,!0)):t instanceof at?this.Ea(e,t.memberParts,!1,null,!0,!0,!0):this.Ea(e,t.iterator,!1,null,!0,!0,!0),e}get arrangementOrigin(){return this.fg}set arrangementOrigin(t){this.fg.equals(t)||(this.fg.h(t),this.p())}initialOrigin(t){const e=this.group;if(e!==null)if(e.hasPlaceholder()){const i=e.placeholder,s=i.getDocumentPoint(T.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(t);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}else{const i=e.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(t),i}return t}}class ve{li;So;In;ew;iw;constructor(t){K.Je(this),this.li=t,this.So=new K,this.In=new K,this.ew=new bt,this.iw=new bt}clear(){if(this.So){const t=this.So.iterator;for(;t.next();)t.value.clear()}if(this.In){const t=this.In.iterator;for(;t.next();)t.value.clear()}this.So=new K,this.In=new K,this.ew=new bt,this.iw=new bt}toString(t){t===void 0&&(t=0);let e="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(t<=0)return e;if(e+=" vertexes: "+this.So.count+" edges: "+this.In.count,t>1){const i=this.So.iterator;for(;i.next();){const n=i.value;e+=`
    `+n.toString(t-1)}const s=this.In.iterator;for(;s.next();){const n=s.value;e+=`
    `+n.toString(t-1)}}return e}get layout(){return this.li}set layout(t){t!==null&&(this.li=t)}get vertexes(){return this.So}get edges(){return this.In}createVertex(){return new ke(this)}createEdge(){return new Re(this)}addParts(t,e,i){if(t===null)return;e===void 0&&(e=!1),y.s(e,"boolean",ve,"addParts:toplevelonly"),i===void 0&&(i=null),i===null&&(i=n=>{if(n instanceof W)return!n.isLinkLabel;if(n instanceof U){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const r=n.toNode;return!(r===null||r.isLinkLabel)}return!1});const s=t.iterator;for(;s.next();){const n=s.value;if(n instanceof W&&!(e&&!n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof at&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof U)||e&&!n.isTopLevel||!n.canLayout()||!i(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,r=n.toNode;if(o===null||r===null||o===r)continue;const a=this.findGroupVertex(o),l=this.findGroupVertex(r);this.linkVertexes(a,l,n)}}findGroupVertex(t){const e=t.findVisibleNode();if(e===null)return null;let i=this.findVertex(e);if(i!==null)return i;let s=e.containingGroup;for(;s!==null;){if(i=this.findVertex(s),i!==null)return i;s=s.containingGroup}return null}addVertex(t){this.So.add(t);const e=t.node;e!==null&&this.ew.set(e,t),t.network=this}addNode(t){let e=this.findVertex(t);return e===null&&(e=this.createVertex(),e.node=t,this.addVertex(e)),e}deleteVertex(t){if(this.kv(t)){let e=t.nr;for(let i=e.count-1;i>=0;i--){const s=e.elt(i);this.deleteEdge(s)}e=t.or;for(let i=e.count-1;i>=0;i--){const s=e.elt(i);this.deleteEdge(s)}}}kv(t){const e=this.So.delete(t);if(e){const i=t.node;i!==null&&this.ew.delete(i)}return e}deleteNode(t){const e=this.findVertex(t);e!==null&&this.deleteVertex(e)}findVertex(t){return this.ew.get(t)}addEdge(t){this.UC(t);const e=t.toVertex;e!==null&&e.addSourceEdge(t);const i=t.fromVertex;i!==null&&i.addDestinationEdge(t)}UC(t){this.In.add(t);const e=t.link;e!==null&&this.findEdge(e)===null&&this.iw.set(e,t),t.network=this}addLink(t){const e=t.fromNode,i=t.toNode;let s=this.findEdge(t);return s===null?(s=this.createEdge(),s.link=t,e!==null&&(s.fromVertex=this.addNode(e)),i!==null&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(e!==null?s.fromVertex=this.addNode(e):s.fromVertex=null,i!==null?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(t){const e=t.toVertex;e!==null&&e.deleteSourceEdge(t);const i=t.fromVertex;i!==null&&i.deleteDestinationEdge(t),this.VC(t)}VC(t){const e=this.In.delete(t);if(e){const i=t.link;i!==null&&this.iw.delete(i)}return e}deleteLink(t){const e=this.findEdge(t);e!==null&&this.deleteEdge(e)}findEdge(t){return this.iw.get(t)}linkVertexes(t,e,i){if(t===null||e===null)return null;if(t.network===this&&e.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=t,s.toVertex=e,this.addEdge(s),s}return null}reverseEdge(t){const e=t.fromVertex,i=t.toVertex;e===null||i===null||(e.deleteDestinationEdge(t),i.deleteSourceEdge(t),t.reverseEdge(),e.addSourceEdge(t),i.addDestinationEdge(t))}deleteSelfEdges(){const t=y.nt(),e=this.In.iterator;for(;e.next();){const s=e.value;s.fromVertex===s.toVertex&&t.push(s)}const i=t.length;for(let s=0;s<i;s++)this.deleteEdge(t[s]);y.Z(t)}deleteArtificialVertexes(){const t=y.nt(),e=this.So.iterator;for(;e.next();){const o=e.value;o.node===null&&o.data===null&&t.push(o)}let i=t.length;for(let o=0;o<i;o++)this.deleteVertex(t[o]);const s=y.nt(),n=this.In.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);y.Z(t),y.Z(s)}deleteUselessEdges(){const t=y.nt(),e=this.In.iterator;for(;e.next();){const s=e.value;(s.fromVertex===null||s.toVertex===null)&&t.push(s)}const i=t.length;for(let s=0;s<i;s++)this.deleteEdge(t[s]);y.Z(t)}isSingleton(t){return!(t.nr.count>0||t.or.count>0)}splitIntoSubNetworks(t){t===void 0&&(t=!0),t&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const e=new J;let i=!0;for(;i;){i=!1;const s=this.So.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();e.add(o),this.QE(o,n),i=!0;break}}return e.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),e}QE(t,e){if(e===null)return;const i=new J;for(i.add(e);i.count>0;){const s=i.first();if(i.removeAt(0),!s||s.network===t)continue;this.kv(s),t.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==t&&(this.VC(o),t.UC(o),o.fromVertex&&i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==t&&(this.VC(o),t.UC(o),o.toVertex&&i.add(o.toVertex))}}}findAllParts(){const t=new K,e=this.So.iterator;for(;e.next();){const s=e.value;s.node&&t.add(s.node)}const i=this.In.iterator;for(;i.next();){const s=i.value;s.link&&t.add(s.link)}return t}}class ke{Po;te;Ri;Ui;is;nr;or;constructor(t){K.Je(this),this.Po=t,this.Ui=new I(0,0,10,10),this.is=new P(5,5),this.te=null,this.Ri=null,this.nr=new J,this.or=new J}clear(){this.te=null,this.Ri=null,this.nr=new J,this.or=new J}toString(t){t===void 0&&(t=0);let e="LayoutVertex#"+K.xs(this);if(t>0&&(e+=this.node!==null?"("+this.node.toString()+")":"",t>1)){let i="",s=!0,n=this.nr.iterator;for(;n.next();){const r=n.value;s?s=!1:i+=",",i+=r.toString(0)}let o="";for(s=!0,n=this.or.iterator;n.next();){const r=n.value;s?s=!1:o+=",",o+=r.toString(0)}e+=" sources: "+i+" destinations: "+o}return e}get Mo(){return this.nr.AL}get rr(){return this.or.AL}get data(){return this.te}set data(t){if(this.te=t,t!==null&&t.bounds){const e=t.bounds,i=e.x,s=e.y,n=e.width,o=e.height;this.is.e(n/2,o/2),this.Ui.e(i,s,n,o)}}get node(){return this.Ri}set node(t){if(this.Ri!==t){if(this.Ri=t,t===null)return;t.ensureBounds();const e=this.network.layout,i=I.l(),s=e.getLayoutBounds(t,i);let n=s.x,o=s.y;const r=s.width,a=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ui.e(n,o,r,a),I.i(i),!(t instanceof at)){const l=t.locationObject.getDocumentPoint(T.Center);if(l.isReal()){this.is.e(l.x-n,l.y-o);return}}this.is.e(r/2,a/2)}}get bounds(){return this.Ui}set bounds(t){this.Ui.equals(t)||this.Ui.h(t)}get focus(){return this.is}set focus(t){this.is.equals(t)||this.is.h(t)}get centerX(){return this.Ui.x+this.is.x}set centerX(t){const e=this.Ui;e.x+this.is.x!==t&&(e.x=t-this.is.x)}get centerY(){return this.Ui.y+this.is.y}set centerY(t){const e=this.Ui;e.y+this.is.y!==t&&(e.y=t-this.is.y)}get focusX(){return this.is.x}set focusX(t){const e=this.is;e.x!==t&&(e.x=t)}get focusY(){return this.is.y}set focusY(t){const e=this.is;e.y!==t&&(e.y=t)}get x(){return this.Ui.x}set x(t){const e=this.Ui;e.x!==t&&(e.x=t)}get y(){return this.Ui.y}set y(t){const e=this.Ui;e.y!==t&&(e.y=t)}get width(){return this.Ui.width}set width(t){const e=this.Ui;e.width!==t&&(e.width=t)}get height(){return this.Ui.height}set height(t){const e=this.Ui;e.height!==t&&(e.height=t)}commit(){const t=this.te;if(t!==null){const i=this.bounds,s=t.bounds;y.$(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):t.bounds=i.copy();return}const e=this.node;if(e!==null){const i=this.bounds;if(!(e instanceof at)){const s=I.l();e.ensureBounds();const n=this.network.layout.getLayoutBounds(e,s),o=e.locationObject.getDocumentPoint(T.Center);if(n.isReal()&&o.isReal()){e.moveTo(i.x+this.focusX-(o.x-n.x)+e.margin.left,i.y+this.focusY-(o.y-n.y+e.margin.top)),I.i(s);return}I.i(s)}e.moveTo(i.x+e.margin.left,i.y+e.margin.top)}}addSourceEdge(t){t!==null&&(this.nr.has(t)||this.nr.add(t))}deleteSourceEdge(t){t!==null&&this.nr.delete(t)}addDestinationEdge(t){t!==null&&(this.or.has(t)||this.or.add(t))}deleteDestinationEdge(t){t!==null&&this.or.delete(t)}get network(){return this.Po}set network(t){this.Po=t}get sourceVertexes(){const t=new K,e=this.sourceEdges;for(;e.next();){const i=e.value;i.fromVertex&&t.add(i.fromVertex)}return t.iterator}get destinationVertexes(){const t=new K,e=this.destinationEdges;for(;e.next();){const i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get vertexes(){const t=new K;let e=this.sourceEdges;for(;e.next();){const i=e.value;i.fromVertex&&t.add(i.fromVertex)}for(e=this.destinationEdges;e.next();){const i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get sourceEdges(){return this.nr.iterator}get destinationEdges(){return this.or.iterator}get edges(){const t=new J;let e=this.sourceEdges;for(;e.next();){const i=e.value;t.add(i)}for(e=this.destinationEdges;e.next();){const i=e.value;t.add(i)}return t.iterator}get edgesCount(){return this.nr.count+this.or.count}static standardComparer(t,e){const i=t.Ri,s=e.Ri;if(i)if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(t,e){if(t!==null)if(e!==null){const i=t.Ri,s=e.Ri;if(i!==null)if(s!==null){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),a=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let l=0;for(;l<r.length;l++)if(a[l]!==""&&a[l]!==void 0){const h=parseFloat(r[l]),u=parseFloat(a[l]);if(isNaN(h))if(isNaN(u)){if(r[l].localeCompare(a[l])!==0)return r[l].localeCompare(a[l]);continue}else return 1;else{if(isNaN(u))return-1;if(h-u!==0)return h-u;continue}}else{if(r[l]==="")continue;return 1}return a[l]!==""&&a[l]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return e!==null?-1:0}}class Re{Po;te;es;ss;ns;constructor(t){K.Je(this),this.Po=t,this.te=null,this.es=null,this.ss=null,this.ns=null}clear(){this.te=null,this.es=null,this.ss=null,this.ns=null}toString(t){t===void 0&&(t=0);let e="LayoutEdge#"+K.xs(this);return t>0&&(e+=this.es!==null?"("+this.es.toString()+")":"",t>1&&(e+=" "+(this.ss?this.ss.toString():"null")+" --> "+(this.ns?this.ns.toString():"null"))),e}reverseEdge(){const t=this.ss;this.ss=this.ns,this.ns=t}commit(){}getOtherVertex(t){return this.ns===t?this.ss:this.ss===t?this.ns:null}get network(){return this.Po}set network(t){this.Po=t}get data(){return this.te}set data(t){this.te!==t&&(this.te=t)}get link(){return this.es}set link(t){this.es!==t&&(this.es=t)}get fromVertex(){return this.ss}set fromVertex(t){this.ss!==t&&(this.ss=t)}get toVertex(){return this.ns}set toVertex(t){this.ns!==t&&(this.ns=t)}}var Pi=(x=>(x[x.Position=0]="Position",x[x.Location=1]="Location",x))(Pi||{}),Si=(x=>(x[x.LeftToRight=10]="LeftToRight",x[x.RightToLeft=11]="RightToLeft",x))(Si||{}),Mi=(x=>(x[x.Forwards=20]="Forwards",x[x.Reverse=21]="Reverse",x[x.Ascending=22]="Ascending",x[x.Descending=23]="Descending",x))(Mi||{});class ei extends Kt{gg;mg;Oo;En;de;He;Si;Mi;constructor(t){super(),this.isViewportSized=!0,this.gg=NaN,this.mg=NaN,this.Oo=new st(NaN,NaN).k(),this.En=new st(10,10).k(),this.de=1,this.He=10,this.Si=22,this.Mi=ei.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.Oo.h(this.Oo),t.En.h(this.En),t.de=this.de,t.He=this.He,t.Si=this.Si,t.Mi=this.Mi}fe(t){t in Mi?this.sorting=t:t in Si?this.arrangement=t:t in Pi?this.alignment=t:super.fe(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.collectParts(t),i=this.diagram,s=e.copy().iterator;for(;s.next();){const f=s.value;if(f.Ar()&&(f.fromNode!==null||f.toNode!==null)){e.delete(f);continue}if(f.ensureBounds(),f instanceof at){const m=f.memberParts;for(;m.next();){const g=m.value;e.delete(g)}}}const n=e.toArray();if(n.length===0)return;switch(this.sorting){case 20:break;case 21:n.reverse();break;case 22:n.sort(this.comparer);break;case 23:n.sort(this.comparer),n.reverse();break}let o=this.wrappingColumn;isNaN(o)&&(o=0);let r=this.wrappingWidth;if(isNaN(r)&&i!==null){const f=i.viewportBounds,m=i.padding;r=Math.max(f.width-m.left-m.right,0)}else r=Math.max(this.wrappingWidth,0);o<=0&&r<=0&&(o=1);let a=this.spacing.width;isFinite(a)||(a=0);let l=this.spacing.height;isFinite(l)||(l=0),i!==null&&i.startTransaction("Layout");const h=[];switch(this.alignment){case 0:this._E(n,r,o,a,l,h);break;case 1:this.t3(n,r,o,a,l,h);break}let u=0,c=0,d=0;for(let f=0;f<h.length;f++){const m=h[f];u=Math.min(u,m.x),c=Math.min(c,m.y),d=Math.max(d,m.x+m.width)}this.arrangement===11?this.commitLayers(h,new P(u+a/2-(d+u),c-l/2)):this.commitLayers(h,new P(u-a/2,c-l/2)),i!==null&&i.commitTransaction("Layout"),this.isValidLayout=!0}_E(t,e,i,s,n,o){const r=I.l();let a=Math.max(this.cellSize.width,1);if(!isFinite(a)){a=0;for(let p=0;p<t.length;p++){const b=t[p],v=this.getLayoutBounds(b,r);a=Math.max(a,v.width)}}a+=s,a=Math.max(a,1);let l=Math.max(this.cellSize.height,1);if(!isFinite(l)){l=0;for(let p=0;p<t.length;p++){const b=t[p],v=this.getLayoutBounds(b,r);l=Math.max(l,v.height)}}l+=n,l=Math.max(l,1);const h=this.arrangement,u=this.arrangementOrigin.x,c=this.arrangementOrigin.y;let d=u,f=c,m=0,g=0;for(let p=0;p<t.length;p++){const b=t[p],v=this.getLayoutBounds(b,r),w=Math.ceil((v.width+s)/a),k=Math.ceil((v.height+n)/l),S=w*a,N=k*l;let D=0;switch(h){case 11:D=Math.abs(d-v.width);break;default:D=d+v.width;break}(i>0&&m>i-1||e>0&&m>0&&D-u>e)&&(o.push(new I(0,f,e+s,g)),m=0,d=u,f+=g,g=0),g=Math.max(g,N);let A=0;switch(h){case 11:A=-v.width;break;default:A=0;break}switch(b.moveTo(d+A+b.margin.left,f+b.margin.top),h){case 11:d-=S;break;default:d+=S;break}m++}o.push(new I(0,f,e+s,g)),I.i(r)}t3(t,e,i,s,n,o){const r=I.l();let a=Math.max(this.cellSize.width,1),l=0,h=0,u=0;const c=P.l();for(let A=0;A<t.length;A++){const M=t[A],C=this.getLayoutBounds(M,r),F=M.getRelativePoint(M.locationObject,M.locationSpot,c);l=Math.max(l,F.x),h=Math.max(h,C.width-F.x),u=Math.max(u,F.y)}const d=this.arrangement;switch(d){case 11:l+=s;break;default:h+=s;break}isFinite(a)?a=Math.max(a+s,1):a=Math.max(l+h,1);const f=this.arrangementOrigin.x,m=this.arrangementOrigin.y;let g=f,p=m,b=0;e>=l&&(e-=l);let v=0,w=0;const k=Math.max(this.cellSize.height,1);u=0;let S=0,N=!0;const D=P.l();for(let A=0;A<t.length;A++){const M=t[A],C=this.getLayoutBounds(M,r),F=M.getRelativePoint(M.locationObject,M.locationSpot,c);if(b>0)switch(d){case 11:{let E=(g-f-(C.width-F.x))/a;L.X(Math.round(E),E)?E=Math.round(E):E=Math.floor(E),g=E*a+f;break}default:{let E=(g-f+F.x)/a;L.X(Math.round(E),E)?E=Math.round(E):E=Math.ceil(E),g=E*a+f;break}}else switch(d){case 11:v=g+F.x+C.width;break;default:v=g-F.x;break}let O=0;switch(d){case 11:O=-(g+F.x)+v;break;default:O=g+C.width-F.x-v;break}if(i>0&&b>i-1||e>0&&b>0&&O>e){o.push(new I(0,N?p-u:p,e+s,S+u+n));for(let E=0;E<b&&A!==b;E++){const B=t[A-b+E],z=B.getRelativePoint(B.locationObject,B.locationSpot,D);B.moveTo(B.position.x,B.position.y+u-z.y)}S+=n,N?p+=S:p+=S+u,u=0,S=0,b=0,g=f,N=!1}switch(g===f&&(d===11?w=Math.max(w,C.width-F.x):w=Math.min(w,-F.x)),u=Math.max(u,F.y),S=Math.max(S,C.height-F.y),isFinite(k)&&(S=Math.max(S,Math.max(C.height,k)-F.y)),N?M.moveTo(g-F.x,p-F.y):M.moveTo(g-F.x,p),d){case 11:g-=F.x+s;break;default:g+=C.width-F.x+s;break}b++}if(o.push(new I(0,p,e+s,(N?S:S+u)+n)),t.length!==b)for(let A=0;A<b;A++){const M=t[t.length-b+A],C=M.getRelativePoint(M.locationObject,M.locationSpot,c);M.moveTo(M.position.x,M.position.y+u-C.y)}if(P.i(c),P.i(D),d===11)for(let A=0;A<o.length;A++){const M=o[A];M.width+=w,M.x-=w}else for(let A=0;A<o.length;A++){const M=o[A];M.x>w&&(M.width+=M.x-w,M.x=w)}I.i(r)}commitLayers(t,e){}get wrappingWidth(){return this.gg}set wrappingWidth(t){this.gg!==t&&(t>0||isNaN(t))&&(this.gg=t,this.isViewportSized=isNaN(t),this.p())}get wrappingColumn(){return this.mg}set wrappingColumn(t){this.mg!==t&&(t>0||isNaN(t))&&(this.mg=t,this.p())}get cellSize(){return this.Oo}set cellSize(t){this.Oo.equals(t)||(this.Oo.h(t),this.p())}get spacing(){return this.En}set spacing(t){this.En.equals(t)||(this.En.h(t),this.p())}get alignment(){return this.de}set alignment(t){this.de!==t&&(t===1||t===0)&&(this.de=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===10||t===11)&&(this.He=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(t===20||t===21||t===22||t===23)&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(this.Mi=t,this.p())}static standardComparer(t,e){const i=t.text,s=e.text;return i<s?-1:i>s?1:0}static smartComparer(t,e){if(t!==null)if(e!==null){const i=t.text.toLocaleLowerCase(),s=e.text.toLocaleLowerCase(),n=i.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let r=0;for(;r<n.length;r++)if(o[r]!==""&&o[r]!==void 0){const a=parseFloat(n[r]),l=parseFloat(o[r]);if(isNaN(a))if(isNaN(l)){if(n[r].localeCompare(o[r])!==0)return n[r].localeCompare(o[r]);continue}else return 1;else{if(isNaN(l))return-1;if(a-l!==0)return a-l;continue}}else{if(n[r]==="")continue;return 1}return o[r]!==""&&o[r]!==void 0?-1:0}else return 1;else return e!==null?-1:0}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}class ee{pg;rn;Ct;No;yg;wg;a;BC;constructor(){this.pg=new K,this.rn=new K,this.Ct=new K,this.No=new bt,this.yg=new bt,this.wg=new bt,this.a=null,this.BC=!1}clear(){this.pg.clear(),this.rn.clear(),this.Ct.clear(),this.No.clear(),this.yg.clear(),this.wg.clear()}Eo(t){this.a=t}ch(t){if(t instanceof W){if(this.pg.add(t),t instanceof at){const i=t.containingGroup;i===null?this.diagram.Zr.add(t):i.Ch.add(t);const s=t.layout;s!==null&&(s.diagram=this.diagram)}}else t instanceof U?(this.rn.add(t),t.isAvoiding&&(this.diagram.lp=!0)):t instanceof pt||this.Ct.add(t);const e=t.data;e!==null&&(t instanceof pt||(t instanceof U?this.Pv(e,t):this.No.set(e,t)))}ri(t){if(t.clearAdornments(),t instanceof W){if(this.pg.delete(t),t instanceof at){const i=t.containingGroup;i===null?this.diagram.Zr.delete(t):i.Ch.delete(t);const s=t.layout;s!==null&&(s.diagram=null)}}else t instanceof U?this.rn.delete(t):t instanceof pt||this.Ct.delete(t);const e=t.data;e!==null&&(t instanceof pt||(t instanceof U?this.Sv(e,t):this.No.delete(e)))}Pv(t,e){this.yg.set(t,e)}Sv(t,e){this.yg.delete(t)}rebuildParts(){const t=this.diagram;if(t===null)return;const e=t.nodeTemplateMap.iterator;for(;e.next();){const d=e.value,f=e.key;(!d.Di()||d instanceof at)&&y.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${f}" must be a Node or a simple Part, not a Group or Link: ${d}`)}const i=t.groupTemplateMap.iterator;for(;i.next();){const d=i.value,f=i.key;d instanceof at||y.o(`Invalid group template in Diagram.groupTemplateMap: template for "${f}" must be a Group, not a normal Node or Link: ${d}`)}const s=t.linkTemplateMap.iterator;for(;s.next();){const d=s.value,f=s.key;d instanceof U||y.o(`Invalid link template in Diagram.linkTemplateMap: template for "${f}" must be a Link, not a normal Node or simple Part: ${d}`)}const n=y.nt(),o=t.selection.iterator;for(;o.next();){const d=o.value.data;d&&n.push(d)}const r=y.nt(),a=t.highlighteds.iterator;for(;a.next();){const d=a.value.data;d&&r.push(d)}const l=y.nt(),h=this.nodes.iterator;for(;h.next();){const d=h.value;d.data!==null&&(l.push(d.data),l.push(d.location))}const u=this.links.iterator;for(;u.next();){const d=u.value;d.data!==null&&(l.push(d.data),l.push(d.location))}const c=this.parts.iterator;for(;c.next();){const d=c.value;d.data!==null&&(l.push(d.data),l.push(d.location))}this.Mv(),this.D2();for(let d=0;d<n.length;d++){const f=this.findPartForData(n[d]);f!==null&&(f.isSelected=!0)}for(let d=0;d<r.length;d++){const f=this.findPartForData(r[d]);f!==null&&(f.isHighlighted=!0)}for(let d=0;d<l.length;d+=2){const f=this.findPartForData(l[d]);f!==null&&(f.location=l[d+1])}y.Z(n),y.Z(r),y.Z(l)}D2(){const t=this.diagram.model;this.nw(t.nodeDataArray)}nw(t,e){const i=this.diagram.model;t.forEach(s=>{i.containsNodeData(s)&&this.Nv(s,!1)}),t.forEach(s=>{i.containsNodeData(s)&&this.Nk(s)}),e!==!1&&this.diagram.c1(!1)}Nv(t,e){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.No.has(t))return null;e===void 0&&(e=!0);const i=this.e3(t);return i!==null&&e&&this.Nk(t),i}e3(t){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.No.has(t))return null;const e=this.i3(t),i=this.findTemplateForNodeData(t,e);if(i!==null){i.It();const s=i.copy();if(s!==null){const n=this.diagram.wi;return this.diagram.wi=!0,s._o=e,s.te=t,this.addsToTemporaryLayer&&(s.dl="Tool"),this.diagram.add(s),s.te=null,s.data=t,this.diagram.wi=n,s}}return null}insertLink(t,e,i,s){return null}Nk(t){}i3(t){return this.diagram.model.getCategoryForNodeData(t)}static Cv=!1;static Lv=!1;findTemplateForNodeData(t,e){const i=this.diagram,s=i.model,n=s.uf()&&s.isGroupForData(t);let o=null;return n?(o=i.groupTemplateMap.get(e),o===null&&(o=i.groupTemplateMap.get(""),o===null&&(ee.Lv||(ee.Lv=!0,y.ne('No Group template found for category "'+e+'"'),y.ne("  Using default group template")),o=i.s2))):(o=i.nodeTemplateMap.get(e),o===null&&(o=i.nodeTemplateMap.get(""),o===null&&(ee.Cv||(ee.Cv=!0,y.ne('No Node template found for category "'+e+'"'),y.ne("  Using default node template")),o=i.t2))),o}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,e){}setFromNodeForLink(t,e,i){}setToNodeForLink(t,e,i){}static Av=!1;findLinkTemplateForCategory(t){const e=this.diagram;let i=e.linkTemplateMap.get(t);return i===null&&(i=e.linkTemplateMap.get(""),i===null&&(ee.Av||(ee.Av=!0,y.ne('No Link template found for category "'+t+'"'),y.ne("  Using default link template")),i=e.e2)),i}WI(t,e,i){t instanceof U?(e!==null&&this.Sv(e,t),i!==null&&this.Pv(i,t)):t instanceof ft&&(e!==null&&this.No.delete(e),i!==null&&this.No.set(i,t))}Mv(){const t=this.diagram.model;this.zC(t.nodeDataArray)}zC(t){t.forEach(e=>{this.Ck(e)})}Ck(t){const e=this.findPartForData(t);e!==null&&(this.diagram.L2(e,!1),this.XC(e))}XC(t){}AC(t){}findPartForKey(t){if(t==null)return null;const e=this.diagram.model.findNodeDataForKey(t);return e!==null?this.No.get(e):null}findNodeForKey(t){if(t==null)return null;const e=this.diagram.model.findNodeDataForKey(t);if(e===null)return null;const i=this.No.get(e);return i instanceof W?i:null}findLinkForKey(t){return null}findPartForData(t){if(t===null)return null;let e=this.No.get(t);return e!==null||(e=this.yg.get(t)),e}findNodeForData(t){if(t===null)return null;const e=this.No.get(t);return e instanceof W?e:null}findLinkForData(t,e){return t===null?null:this.yg.get(t)}findNodesByExample(...t){const e=new K,i=this.pg.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(y.$(r)&&this.GC(n,r)){e.add(s);break}}}return e.iterator}findLinksByExample(...t){const e=new K,i=this.rn.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(y.$(r)&&this.GC(n,r)){e.add(s);break}}}return e.iterator}GC(t,e){for(const i in e){const s=t[i],n=e[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,r=n;if(o.length<r.length)return!1;for(let a=0;a<o.length;a++){const l=o[a],h=r[a];if(h!==void 0&&!this.Tv(l,h))return!1}}else if(!this.Tv(s,n))return!1}return!0}Tv(t,e){if(y.st(e)){if(!e(t))return!1}else if(e instanceof RegExp){if(!t||!e.test(t.toString()))return!1}else if(y.$(t)&&y.$(e)){if(!this.GC(t,e))return!1}else if(t!==e)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.G){this.diagram.G=!1;try{const e=t.change;t.modelChange===""&&t.object!==null&&e===2&&this.ow(t.object,t.propertyName)}finally{this.diagram.G=!0}}}doModelChanged(t){const e=this.diagram;if(!e||t.model!==e.model)return;const i=t.change;if(e.LO(t),!!e.G){e.G=!1;try{const s=t.modelChange;if(s!=="")if(i===2){if(s==="nodeCategory"){const n=t.object;if(n!==null){const o=this.findPartForData(n),r=t.newValue;o!==null&&typeof r=="string"&&(o.category=r)}}else if(s==="nodeDataArray"){const n=t.oldValue;this.zC(n);const o=t.newValue;this.nw(o)}e.isModified=!0}else if(i===3){const n=t.newValue;s==="nodeDataArray"&&y.$(n)&&this.Nv(n),e.isModified=!0}else if(i===4){const n=t.oldValue;s==="nodeDataArray"&&y.$(n)&&this.Ck(n),e.isModified=!0}else i===1&&(s==="SourceChanged"?t.object!==null?this.ow(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(i===2){const n=t.propertyName,o=t.object,r=e.model;o===r?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(e.undoManager.isUndoingRedoing||this.rebuildParts()):o!==null&&this.ow(o,n),e.isModified=!0}else(i===3||i===4)&&(this.s3(t,e.model),e.isModified=!0)}finally{e.G=!0}}}updateAllTargetBindings(t){t===void 0&&(t="");let e=this.parts.iterator;for(;e.next();)e.value.updateTargetBindings(t);for(e=this.nodes.iterator;e.next();)e.value.updateTargetBindings(t);for(e=this.links.iterator;e.next();)e.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Yo();for(t=this.nodes.iterator;t.next();)t.value.Yo();for(t=this.links.iterator;t.next();)t.value.Yo()}updateAllRelationshipsFromData(){const t=this.diagram.model,e=new K,i=t.nodeDataArray;for(let o=0;o<i.length;o++){const r=i[o];e.add(r)}const s=[];this.nodes.each(o=>{o.data!==null&&!e.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!e.has(o.data)&&s.push(o.data)}),s.forEach(o=>t.Dv(o,!1));for(let o=0;o<i.length;o++){const r=i[o];this.findPartForData(r)===null&&t.vv(r,!1)}this.Fv();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}Fv(){}updateRelationshipsFromData(t){}ow(t,e){if(typeof e=="string"){const i=this.findPartForData(t);if(i!==null)i.updateTargetBindings(e);else{const s=this.o3(t);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(e);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(e)}y.Z(s)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(e)}}o3(t){let e=null;const i=this.wg.iterator;for(;i.next();){const s=i.value;for(let n=0;n<s.length;n++){const o=s[n].findItemPanelForData(t);o!==null&&(e===null&&(e=y.nt()),e.push(o))}if(e!==null)break}return e}YC(t){return this.wg.get(t)}s3(t,e){const i=t.object;if(!Array.isArray(i))return;const s=t.change===3,n=s?t.newParam:t.oldParam,o=s?t.newValue:t.oldValue,r=this.YC(i);if(Array.isArray(r))for(let a=0;a<r.length;a++){const l=r[a];s?l.Q1(o,n,!0):l.ZI(n)}}N2(t,e){e!==null&&t.Sn(s=>e.uT(s));const i=t.Aa;if(Array.isArray(i)){const s=this.YC(i);if(s===null)this.wg.set(i,[t]);else{for(let n=0;n<s.length;n++)if(s[n]===t)return;s.push(t)}}}C2(t,e){t.Sn(s=>e.TO(s));const i=t.Aa;if(Array.isArray(i)){const s=this.YC(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),s.length===0&&this.wg.delete(i);return}}}}copyParts(t,e,i){i===void 0&&(i=!1);const s=new bt;if(Array.isArray(t))for(let o=0;o<t.length;o++)this.Lk(t[o],e,s,i);else{const o=t.iterator;for(;o.next();)this.Lk(o.value,e,s,i)}if(e!==null){const o=e.model,r=e.Tp().dragsLink,a=new K,l=new bt,h=s.iterator;for(;h.next();){const u=h.value;if(u instanceof U)!r&&(u.fromNode===null||u.toNode===null)&&a.add(u);else if(u instanceof W&&u.data!==null){if(o.Vm()){const c=u,d=h.key,f=d.findTreeParentNode();if(f!==null){const m=s.get(f);if(m!==null){o.setParentKeyForNodeData(c.data,o.getKeyForNodeData(m.data));const g=e.findLinkForData(c.data),p=d.findTreeParentLink();p!==null&&g!==null&&l.set(p,g)}}}else if(o.a1()){const c=u,d=h.key,f=o.isRelatedKeysPathTo?d.findNodesOutOf():d.findNodesInto();for(;f.next();){const m=f.value,g=s.get(m);if(g!==null){o.addRelatedKeyForNodeData(c.data,g.key);const p=e.partManager.findLinkForData(c.data,g.key),b=this.findLinkForData(d.data,m.key);b!==null&&p!==null&&l.set(b,p)}else o.removeRelatedKeyForNodeData(c.data,m.key)}}}}if(a.count>0&&e.removeParts(a,!1),l.count>0){const u=l.iterator;for(;u.next();){const c=u.key,d=u.value;s.set(c,d)}}}if(e!==null&&this.diagram!==null){const o=e.model,r=o.afterCopyFunction;if(r!==null){const a=new bt;s.each(h=>{h.key.data!==null&&a.set(h.key.data,h.value.data)});const l=this.diagram.model;r(a,o,l)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}Lk(t,e,i,s){if(t===null||s&&!t.canCopy())return null;if(i.has(t))return i.get(t);const n=this.KC(t,e);if(!(n instanceof ft))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(t,n),t instanceof W){const o=t.linksConnected;for(;o.next();){const r=o.value;if(r.fromNode===t){const a=i.get(r);a!==null&&(a.fromNode=n)}if(r.toNode===t){const a=i.get(r);a!==null&&(a.toNode=n)}}if(t instanceof at&&n instanceof at){const r=t.memberParts;for(;r.next();){const a=r.value,l=this.Lk(a,e,i,s);l instanceof U||l!==null&&(l.containingGroup=n)}}}else if(t instanceof U&&n instanceof U){const o=t.fromNode;if(o!==null){const l=i.get(o);l!==null&&(n.fromNode=l)}const r=t.toNode;if(r!==null){const l=i.get(r);l!==null&&(n.toNode=l)}const a=t.labelNodes;for(;a.next();){const l=a.value,h=this.Lk(l,e,i,s);h!==null&&h instanceof W&&(h.labeledLink=n)}}return n}KC(t,e){let i=null;const s=t.data;if(s!==null&&e!==null){const n=e.model;if(!(t instanceof U)){const o=n.copyNodeData(s);n.addNodeData(o),i=e.findPartForData(o)}}else if(t.It(),i=t.copy(),i!==null){const n=this.diagram;if(e!==null)e.add(i);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let r=null;i instanceof U||(r=o.copyNodeData(s)),i.data=r}}return i}get nodes(){return this.pg}get links(){return this.rn}get parts(){return this.Ct}get diagram(){return this.a}get addsToTemporaryLayer(){return this.BC}set addsToTemporaryLayer(t){this.BC=t}}class _s extends ee{D2(){const t=this.diagram.model;this.nw(t.nodeDataArray),this.Rv(t.linkDataArray)}nw(t){super.nw(t,!1);const e=this.links.iterator;for(;e.next();)e.value.Wd();this.diagram.c1(!1)}Rv(t){t.forEach(e=>{this.Ov(e)}),this.diagram.c1(!1)}Ov(t){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(t))return null;const e=this.getLinkCategoryForData(t),i=this.findLinkTemplateForCategory(e);if(i!==null){i.It();const s=i.copy();if(s!==null){const n=this.diagram.wi;this.diagram.wi=!0,s._o=e,s.te=t;const o=this.diagram.model,r=o.Ak(t,!0);r!==""&&(s.fromPortId=r);const a=o.Vi(t,!0);if(a!==void 0){const c=this.findNodeForKey(a);c instanceof W&&(s.fromNode=c)}const l=o.Ak(t,!1);l!==""&&(s.toPortId=l);const h=o.Vi(t,!1);if(h!==void 0){const c=this.findNodeForKey(h);c instanceof W&&(s.toNode=c)}const u=o.getLabelKeysForLinkData(t);return Array.isArray(u)&&u.forEach(c=>{const d=this.findNodeForKey(c);d!==null&&(d.labeledLink=s)}),this.addsToTemporaryLayer&&(s.dl="Tool"),this.diagram.add(s),s.te=null,s.data=t,this.diagram.wi=n,s}}return null}Mv(){const t=this.diagram.model;this.Iv(t.linkDataArray),this.zC(t.nodeDataArray)}Iv(t){t.forEach(e=>{this.Ck(e)})}getLinkCategoryForData(t){return this.diagram.model.getCategoryForLinkData(t)}setLinkCategoryForData(t,e){return this.diagram.model.setCategoryForLinkData(t,e)}setFromNodeForLink(t,e,i){const s=this.diagram.model,n=e!==null?e.data:null;s.setFromKeyForLinkData(t.data,s.getKeyForNodeData(n))}setToNodeForLink(t,e,i){const s=this.diagram.model,n=e!==null?e.data:null;s.setToKeyForLinkData(t.data,s.getKeyForNodeData(n))}AC(t){this.diagram.model.removeLinkData(t.data)}findPartForKey(t){const e=super.findPartForKey(t);if(e===null){const i=this.diagram.model.findLinkDataForKey(t);if(i!==null)return this.findLinkForData(i)}return e}findLinkForKey(t){if(t==null)return null;const e=this.diagram.model.findLinkDataForKey(t);return e!==null?this.findLinkForData(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const e=this.diagram;if(t.model!==e.model)return;const i=t.change;if(e.G){e.G=!1;try{const s=t.modelChange;if(s!==""){if(i===2){if(s==="linkFromKey"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue,a=this.findNodeForKey(r);o.fromNode=a}}else if(s==="linkToKey"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue,a=this.findNodeForKey(r);o.toNode=a}}else if(s==="linkFromPortId"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue;typeof r=="string"&&(o.fromPortId=r)}}else if(s==="linkToPortId"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue;typeof r=="string"&&(o.toPortId=r)}}else if(s==="nodeGroupKey"){const n=t.object,o=this.findPartForData(n);if(o!==null){const r=t.newValue;if(r!==void 0){const a=this.findNodeForKey(r);a instanceof at?o.containingGroup=a:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.oldValue,a=t.newValue;Array.isArray(r)&&r.forEach(l=>{if(a.indexOf(l)>=0)return;const h=this.findNodeForKey(l);h!==null&&(h.labeledLink=null)}),Array.isArray(a)&&a.forEach(l=>{const h=this.findNodeForKey(l);h!==null&&(h.labeledLink=o)})}}else if(s==="linkCategory"){const n=t.object,o=this.findLinkForData(n),r=t.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="linkDataArray"){const n=t.oldValue;this.Iv(n);const o=t.newValue;this.Rv(o)}e.isModified=!0}else if(i===3){const n=t.newValue;if(s==="linkDataArray"&&y.$(n))this.Ov(n);else if(s==="linkLabelKeys"&&t.model.isKeyType(n)){const o=t.object,r=this.findLinkForData(o),a=this.findNodeForKey(n);r!==null&&a!==null&&(a.labeledLink=r)}e.isModified=!0}else if(i===4){const n=t.oldValue;if(s==="linkDataArray"&&y.$(n))this.Ck(n);else if(s==="linkLabelKeys"&&t.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}e.isModified=!0}}else if(i===2){const n=t.propertyName,o=t.object,r=e.model;o===r&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0}}finally{e.G=!0}}}Fv(){const t=this.diagram.model,e=new Set,i=t.linkDataArray;i.forEach(n=>{e.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!e.has(n.data)&&s.push(n.data)}),s.forEach(n=>{t.Ev(n,!1)}),i.forEach(n=>{this.findLinkForData(n)===null&&t.Uv(n,!1)})}updateRelationshipsFromData(t){const e=t.data;if(e===null)return;const i=t.diagram;if(i===null)return;const s=i.model;if(t instanceof U){let n=s.Vi(e,!0),o=i.findNodeForKey(n);t.fromNode=o,n=s.Vi(e,!1),o=i.findNodeForKey(n),t.toNode=o;const r=s.getLabelKeysForLinkData(e);if(r.length>0||t.labelNodes.count>0){if(r.length===1&&t.labelNodes.count===1){const c=r[0],d=t.labelNodes.first();if(d!==null&&s.getKeyForNodeData(d.data)===c)return}const a=new K().addAll(r),l=new K;t.labelNodes.each(c=>{if(c.data!==null){const d=s.getKeyForNodeData(c.data);d!==void 0&&l.add(d)}});const h=l.copy();h.removeAll(a);const u=a.copy();if(u.removeAll(l),h.count>0||u.count>0){const c=t;h.each(d=>{const f=i.findNodeForKey(d);f!==null&&f.labeledLink===c&&(f.labeledLink=null)}),u.each(d=>{const f=i.findNodeForKey(d);f!==null&&f.labeledLink!==c&&(f.labeledLink=c)})}}}else if(!(t instanceof pt)){const n=s.getGroupKeyForNodeData(e),o=i.findPartForKey(n);(o===null||o instanceof at)&&(t.containingGroup=o)}}Nk(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(i!==void 0){const s=e.lw(i),n=this.findPartForData(t);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const a=r.value;if(e.containsNodeData(a)){if(n instanceof at&&e.getGroupKeyForNodeData(a)===i){const l=this.findPartForData(a);l!==null&&(l.containingGroup=n)}}else{const l=this.findLinkForData(a);if(l!==null&&n instanceof W){e.Vi(a,!0)===i&&(l.fromNode=n),e.Vi(a,!1)===i&&(l.toNode=n);const h=e.getLabelKeysForLinkData(a);Array.isArray(h)&&h.some(u=>u===i?(n.labeledLink=l,!0):!1)}}}e.an(i)}const o=e.getGroupKeyForNodeData(t);if(o!==void 0){const r=this.findNodeForKey(o);n!==null&&r instanceof at&&(n.containingGroup=r)}}}XC(t){const e=this.diagram.model;if(t instanceof W){const i=e.getKeyForNodeData(t.data);if(i!==void 0){const s=t.linksConnected;for(;s.next();){const n=s.value;e.hn(i,n.data)}if(t.isLinkLabel){const n=t.labeledLink;n!==null&&e.hn(i,n.data)}if(t instanceof at){const n=t.memberParts;for(;n.next();){const o=n.value.data;e.containsNodeData(o)&&e.hn(i,o)}}}}}KC(t,e){let i=super.KC(t,e);if(t instanceof U){const s=t.data;if(s!==null&&e!==null){const n=e.model,o=n.copyLinkData(s);n.addLinkData(o),i=e.findLinkForData(o)}else if(i!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model.copyLinkData(s);i.data=o}}}return i}insertLink(t,e,i,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let a="";t!==null&&(e===null&&(e=t),a=e.portId,a===null&&(a=""));let l="";i!==null&&(s===null&&(s=i),l=s.portId,l===null&&(l=""));const h=r.archetypeLinkData;if(h instanceof U){h.It();const u=h.copy();if(u!==null){u.fromNode=t,u.fromPortId=a,u.toNode=i,u.toPortId=l,n.add(u);const c=r.archetypeLabelNodeData;if(c instanceof W){c.It();const d=c.copy();d!==null&&(d.labeledLink=u,n.add(d))}return u}}else if(h!==null){const u=o.copyLinkData(h);if(y.$(u)){t!==null&&o.xg(u,o.getKeyForNodeData(t.data),!0),o.bg(u,a,!0),i!==null&&o.xg(u,o.getKeyForNodeData(i.data),!1),o.bg(u,l,!1),o.addLinkData(u);const c=r.archetypeLabelNodeData;if(c!==null&&!(c instanceof W)){const d=o.copyNodeData(c);o.addNodeData(d);const f=o.getKeyForNodeData(d);f!==void 0&&o.addLabelKeyForLinkData(u,f)}return n.findLinkForData(u)}}return null}}class tn extends ee{Ua=null;Tk(t,e){if(t===null||e===null||e.findTreeParentLink()!==null)return;const i=this.diagram.toolManager.findTool("Linking");let s=t,n=e;if(this.diagram.isTreePathToChildren){if(i!==null&&i.Vu(s,n,null,!0))return}else if(s=e,n=t,i!==null&&i.Vu(s,n,null,!0))return;const o=this.getLinkCategoryForData(e.data),r=this.findLinkTemplateForCategory(o);if(r!==null){r.It();const a=r.copy();if(a!==null){const l=this.diagram.wi;this.diagram.wi=!0,a._o=o,a.te=e.data,a.fromNode=s,a.toNode=n,this.diagram.add(a),a.te=null,a.data=e.data,this.diagram.wi=l}}}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,e){this.diagram.model.setParentLinkCategoryForNodeData(t,e)}setFromNodeForLink(t,e,i){const s=this.diagram.model;i===void 0&&(i=null);const n=e!==null?e.data:null;if(this.diagram.isTreePathToChildren)s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n));else{const o=this.Ua;this.Ua=t,i!==null&&s.setParentKeyForNodeData(i.data,void 0);const r=t.toNode!==null?t.toNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(r)),this.Ua=o}}setToNodeForLink(t,e,i){const s=this.diagram.model;i===void 0&&(i=null);const n=e!==null?e.data:null;if(this.diagram.isTreePathToChildren){const o=this.Ua;this.Ua=t,i!==null&&s.setParentKeyForNodeData(i.data,void 0);const r=t.fromNode!==null?t.fromNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(r)),this.Ua=o}else s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n))}AC(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const e=this.diagram.model.findNodeDataForKey(t);return e!==null?this.findLinkForData(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const e=this.diagram;if(t.model!==e.model)return;const i=t.change;if(e.G){e.G=!1;try{const s=t.modelChange;if(s!==""){if(i===2){if(s==="nodeParentKey"){const n=t.object,o=n?this.findNodeForData(n):null,r=t.newValue,a=this.findNodeForKey(r);if(n&&this.Ua!==null)a!==null&&(this.Ua.data=n,this.Ua.category=this.getLinkCategoryForData(n));else if(o!==null){const l=o.findTreeParentLink();l!==null?a===null?e.remove(l):e.isTreePathToChildren?l.fromNode=a:l.toNode=a:this.Tk(a,o)}}else if(s==="parentLinkCategory"){const n=t.object,o=n?this.findNodeForData(n):null,r=t.newValue;if(o!==null&&typeof r=="string"){const a=o.findTreeParentLink();a!==null&&(a.category=r)}}e.isModified=!0}}else i===2&&(t.object===e.model&&t.propertyName==="nodeParentKeyProperty"&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0)}finally{e.G=!0}}}updateRelationshipsFromData(t){const e=t.data;if(e===null)return;const i=t.diagram;if(i===null)return;const s=i.model;if(t instanceof W){const n=s.getParentKeyForNodeData(e),o=i.findNodeForKey(n),r=t.findTreeParentNode();if(o!==r){const a=t.findTreeParentLink();o!==null?a!==null?i.isTreePathToChildren?a.fromNode=o:a.toNode=o:this.Tk(o,t):a!==null&&i.L2(a,!1)}}}ow(t,e){if(super.ow(t,e),typeof e=="string"&&this.findPartForData(t)!==null){const i=this.findLinkForData(t);i!==null&&i.updateTargetBindings(e)}}Nk(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(i!==void 0){const s=e.lw(i),n=this.findPartForData(t);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const a=r.value;if(e.containsNodeData(a)&&n instanceof W&&e.getParentKeyForNodeData(a)===i){const l=this.findNodeForData(a);this.Tk(n,l)}}e.an(i)}const o=e.getParentKeyForNodeData(t);if(o!==void 0&&n instanceof W){const r=this.findNodeForKey(o);this.Tk(r,n)}}}XC(t){const e=this.diagram.model;if(t instanceof W){const i=e.getKeyForNodeData(t.data),s=this.findLinkForData(t.data);if(s!==null){s.isSelected=!1,s.isHighlighted=!1;const r=s.layer;if(r!==null){const a=r.ri(-1,s,!1);a>=0&&this.diagram.raiseChangedEvent(4,"parts",r,s,null,a,null);const l=s.layerChanged;l!==null&&l(s,r,null)}}const n=this.diagram.isTreePathToChildren,o=t.linksConnected;for(;o.next();){const r=o.value,a=n?r.toNode:r.fromNode;if(a!==null){const l=a.data;e.containsNodeData(l)&&e.hn(i,l)}}}}insertLink(t,e,i,s){const n=this.diagram.model;let o=t,r=i;if(this.diagram.isTreePathToChildren||(o=i,r=t),o!==null&&r!==null){const a=o.data,l=r.data;return n.setParentKeyForNodeData(l,n.getKeyForNodeData(a)),r.findTreeParentLink()}return null}}var ii=(x=>(x[x.OneWay=1]="OneWay",x[x.TwoWay=2]="TwoWay",x))(ii||{});class Yt{n;HC;oc;Hf;Va;jf;qf;Wf;Dk;Ti;Id;vf;constructor(t,e,i,s){K.Je(this),t===void 0?t="":y.s(t,"string",Yt,"constructor:targetprop"),e===void 0?e=t:y.s(e,"string",Yt,"constructor:sourceprop"),i===void 0?i=null:i!==null&&y.S(i,Yt,"constructor:conv"),this.HC=-1,this.Ti=null,this.oc=t,this.Id=0,this.vf=0,this.Hf=null,this.Va=e,this.jf=i,s===void 0?(this.qf=1,this.Wf=null):(this.qf=2,this.Wf=s),this.Dk=new K,this.n=2}copy(){const t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.oc=this.oc,t.Id=this.Id,t.vf=this.vf,t.Hf=this.Hf,t.Va=this.Va,t.jf=this.jf,t.qf=this.qf,t.Wf=this.Wf,t.n=this.n&-2}static OneWay=1;static TwoWay=2;static parseEnum(t,e){return y.S(t,Yt,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&(s=y.$a(t,i),s===null)?e:s}}fe(t){t in ii?this.mode=t:y.dr(this,t)}static toString(t){return y.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+ii[this.mode]+")"}k(){return this.n=this.n|1,this}get targetId(){return this.HC}set targetId(t){this.f&&y.L(this),this.HC=t}get targetProperty(){return this.oc}set targetProperty(t){this.f&&y.L(this),y.s(t,"string",Yt,"targetProperty"),this.oc=t}get sourceProperty(){return this.Va}set sourceProperty(t){this.f&&y.L(this),y.s(t,"string",Yt,"sourceProperty"),this.Va=t}get f(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get jC(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}xd(){return!1}get sourceName(){return this.Hf}set sourceName(t){this.f&&y.L(this),t!==null&&y.s(t,"string",Yt,"sourceName"),this.Hf=t,t!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.jf}set converter(t){this.f&&y.L(this),t!==null&&y.S(t,Yt,"converter"),this.jf=t}get backConverter(){return this.Wf}set backConverter(t){this.f&&y.L(this),t!==null&&y.S(t,Yt,"backConverter"),this.Wf=t}get mode(){return this.qf}set mode(t){this.f&&y.L(this),this.isToTheme&&t===2&&y.o("Theme Bindings cannot be TwoWay."),this.qf=t}makeTwoWay(t){return this.isToTheme&&y.o("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(y.S(t,Yt,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.f&&y.L(this),t===void 0&&(t=""),this.sourceName=t,this}ofModel(){return this.f&&y.L(this),this.n=this.n&-3&-5|8,this.Hf=null,this}WT(t,e){const i=this.sourceName;let s=null;return i===null||i===""?s=t:i==="/"?s=e.part:i==="."?s=e:i===".."?s=e.panel:s=t.findObject(i),s}check(t){const e=this.oc,i=this.Va,s=this.jf;(this.xd()&&s===null&&this.Ba===null&&e===""||s===null&&e==="")&&y.ne("Binding error: target property is the empty string: "+this.toString()),this.xd()&&this.jC&&i===""&&s===null&&this.Ba===null&&y.ne("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&typeof e=="string"&&(!y.st(["setAttribute"])&&e.length>0&&e[0]!=="_"&&!y.jw(t,e)?y.ne("Binding error: undefined target property: "+e+" on "+t.toString()):e==="name"&&t instanceof tt&&y.ne("Binding error: cannot modify GraphObject.name on "+t.toString()))}updateTarget(t,e,i,s){const n=this.Va;if(i!==void 0&&n!==""&&n!==i||this.isToTheme&&t.diagram===null)return;const o=this.oc,r=this.jf;let a=e;if(n!==""&&!this.jC&&(a=ht.St(e,n)),a!==void 0)if(r===null){if(o!==""){if(this.xd()){const l=t.diagram?.themeManager;if(a=this.Vv(l,a,t,o),a===void 0)return}s?s.et(t,o,a):(e instanceof tt||e instanceof Dt)&&ht.et(t,o,a)}}else try{if(o!==""){let l=r(a,t);if(this.xd()){const h=t.diagram?.themeManager;if(l=this.Vv(h,l,t,o),l===void 0)return}s?s.et(t,o,l):(e instanceof tt||e instanceof Dt)&&ht.et(t,o,l)}else r(a,t)}catch{}}updateSource(t,e,i,s){if(this.qf!==2)return;const n=this.oc;if(i!==void 0&&n!==i)return;const o=this.Va,r=this.Wf,a=s!==null?s.diagram:null,l=a!==null?a.model:null;let h=t;if(n!==""&&(h=ht.St(t,n)),h!==void 0&&!this.Dk.has(t))try{if(this.Dk.add(t),r===null){if(o!=="")l!==null?l.setDataProperty(e,o,h):(e instanceof tt||e instanceof Dt)&&(e[o]=h);else if(l!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const u=s.itemIndex,c=s.panel.itemArray;l.removeArrayItem(c,u),l.insertArrayItem(c,u,h)}}else try{if(o!==""){const u=r(h,e,l);l!==null?l.setDataProperty(e,o,u):(e instanceof tt||e instanceof Dt)&&(e[o]=u)}else{const u=r(h,e,l);if(u!==void 0&&l!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const c=s.itemIndex,d=s.panel.itemArray;l.removeArrayItem(d,c),l.insertArrayItem(d,c,u)}}}catch{}}finally{this.Dk.delete(t)}}}class Ee extends Yt{aw;Ba;rc;constructor(t,e,i,s,n){super(t,e,s),i==null&&(i=""),n===void 0&&(n=null),this.aw=i,this.Ba=n,this.rc=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.aw=this.aw,t.Ba=this.Ba,t.rc=this.rc}xd(){return!0}get themeSource(){return this.aw}set themeSource(t){this.f&&y.L(this),t!==null&&y.s(t,"string",Ee,"themeSource"),this.aw=t,this.rc=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Ba}set themeConverter(t){this.f&&y.L(this),t!==null&&y.S(t,Ee,"themeConverter"),this.Ba=t}ofData(){return this.f&&y.L(this),this.n=this.n|2,this.Hf=null,this}Vv(t,e,i,s){if(!t||(this.jC&&(e=this.Va),!e&&e!==0))return;let n=this.themeSource;this.rc!==null?n=this.rc:typeof n=="string"&&n.includes(".")&&(this.rc=n.split("."),n=this.rc);let o=t.findValue(e,n,s);if(o===void 0&&y.ne(`Theme warning: ${e} could not be found when setting target property ${s}.`),t.readsCssVariables&&typeof o=="string"&&o.startsWith("var(")){const r=o.match(this.r3);r&&(o=getComputedStyle(H.document.documentElement).getPropertyValue(r[1]))}return y.st(this.Ba)&&(o=this.Ba(o,i)),o}r3=/var\((.*)\)/}class ht{Pt;kg;zo;qC;Bi;be;za;Jf;$f;Pg;Sg;Mg;Ng;hw;lc;lr;cw;Bo;vk;constructor(t,e){if(K.Je(this),this.Pt="",this.kg="",this.zo=!1,this.qC={},this.Bi=[],this.be=new bt,this.za="key",this.Jf=null,this.$f=null,this.Pg=!1,this.Sg=!1,this.Mg=!1,this.Ng=null,this.hw=100,this.lc="category",this.lr=new bt,this.cw=[],this.Bo=!1,this.vk=null,this.undoManager=new Je,t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const i=e.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(t){t.Pt=this.Pt,t.kg=this.kg,t.zo=this.zo,t.za=this.za,t.Jf=this.Jf,t.$f=this.$f,t.Pg=this.Pg,t.Sg=this.Sg,t.Mg=this.Mg,t.Ng=this.Ng,t.hw=this.hw,t.lc=this.lc}copy(){const t=new this.constructor;return this.cloneProtected(t),t}clear(){this.Bi=[],this.be.clear(),this.lr.clear(),this.undoManager.clear()}toString(t){if(t===void 0&&(t=0),t>1)return this.toJson();{let e=(this.name!==""?this.name:"")+" Model";if(t>0){e+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];e+=" "+this.getKeyForNodeData(o)+":"+y.toString(o)}}return e}}toIncrementalData(t){t.change!==1&&y.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+t.toString());const e=t.object;if(!t.isTransactionFinished||!(e instanceof Ve))return null;const i=this.Bv(e);return this.WC(e,t.propertyName==="FinishedUndo",i)}WC(t,e,i){const s=this;let n=!1;const o=new K,r=new K,a=new K;t.changes.each(d=>{if(d.model===s){if(d.modelChange==="nodeDataArray")d.change===3?o.add(d.newValue):d.change===4&&a.add(d.oldValue);else if(s.containsNodeData(d.object))d.object!==null&&r.add(d.object);else if(d.change===2&&(s.modelData===d.object||d.propertyName==="modelData"))n=!0;else if(d.object!==null)if(i.has(d.object)){const f=i.get(d.object);f&&f.each(m=>{s.containsNodeData(m)&&r.add(m)})}else{if(d.object instanceof ht||s.Wh()&&s.containsLinkData(d.object))return;s.zv(d.object).each(f=>{r.add(f)})}}});const l=new K;o.each(d=>{const f=s.getKeyForNodeData(d);f!==void 0&&l.add(f),e||r.add(d)});const h=new K;a.each(d=>{const f=s.getKeyForNodeData(d);f!==void 0&&h.add(f),e&&r.add(d)});const u=s.cloneDeep(r.toArray());let c=null;return n&&(c===null&&(c={}),c.modelData=this.cloneDeep(this.modelData)),l.count>0&&(c===null&&(c={}),e?c.removedNodeKeys=l.toArray():c.insertedNodeKeys=l.toArray()),u.length>0&&(c===null&&(c={}),c.modifiedNodeData=u),h.count>0&&(c===null&&(c={}),e?c.insertedNodeKeys=h.toArray():c.removedNodeKeys=h.toArray()),c}cloneDeep(t){return this.Cg(t,!0)}Cg(t,e,i,s){if(!y.$(t))return t;i||(i=new bt);const n=i.get(t);if(n)return n;let o;if(Array.isArray(t)){o=[],i.set(t,o);for(let r=0;r<t.length;r++){const a=t[r];o.push(this.Cg(a,!1,i,s))}}else if(t instanceof P||t instanceof st||t instanceof I||t instanceof Mt||t instanceof T)o=t.copy(),i.set(t,o);else{if(t instanceof R||t instanceof yt)return t;if(t instanceof J)o=new J().addAll(this.Cg(t.toArray(),!1,i,s)),i.set(t,o);else if(t instanceof K)o=new K().addAll(this.Cg(t.toArray(),!1,i,s)),i.set(t,o);else if(t instanceof bt)o=new bt().addAll(this.Cg(t.toArray(),!1,i,s)),i.set(t,o);else if(t instanceof Date)o=new Date(t),i.set(t,o);else if(t instanceof RegExp)o=new RegExp(t),i.set(t,o),o.lastIndex=t.lastIndex;else if(ht.JC(null,"",t))o=t;else if(y.st(t.copy))o=t.copy(),i.set(t,o);else{o={},i.set(t,o);for(const r in t){if(r==="__gohashid")continue;const a=t[r];o[r]=this.Cg(a,!1,i,s)}}}return o}zi(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,e=>{const i="0000"+e.charCodeAt(0).toString(16);return"\\u"+i.substring(i.length-4)})}Lg(){let t="";return this.name!==""&&(t+=`,
  "name": `+this.zi(this.name)),this.dataFormat!==""&&(t+=`,
  "dataFormat": `+this.zi(this.dataFormat)),this.isReadOnly&&(t+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(t+=`,
  "nodeKeyProperty": `+this.zi(this.nodeKeyProperty)),this.copiesArrays&&(t+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(t+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(t+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(t+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(t+=`,
  "nodeCategoryProperty": `+this.zi(this.nodeCategoryProperty)),t}fw(t){t.name&&(this.name=t.name),t.dataFormat&&(this.dataFormat=t.dataFormat),t.isReadOnly&&(this.isReadOnly=!0),t.nodeKeyProperty&&(this.nodeKeyProperty=t.nodeKeyProperty),t.copiesArrays&&(this.copiesArrays=!0),t.copiesArrayObjects&&(this.copiesArrayObjects=!0),t.copiesKey!==void 0&&(this.copiesKey=t.copiesKey),t.pointsDigits!==void 0&&(this.pointsDigits=parseInt(t.pointsDigits)),t.nodeCategoryProperty&&(this.nodeCategoryProperty=t.nodeCategoryProperty)}Xv(){const t=this.modelData;return`,
  "modelData": `+this.Gv(t)}Yv(t){const e=t.modelData;y.$(e)&&(this.replaceJsonObjects(e),this.modelData=e)}$C(){const t=this.modelData;let e=!1;for(const s in t)if(!this.Fk(t,s,t[s])){e=!0;break}let i="";return e&&(i=this.Xv()),i+`,
  "nodeDataArray": `+this.Xa(this.nodeDataArray,!0)}ZC(t){this.Yv(t);const e=t.nodeDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.nodeDataArray=e)}QC(t,e,i){if(t===e)return!0;if(typeof t!=typeof e||y.st(t)||y.st(e))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(i.get(t)===e)return!0;if(i.set(t,e),t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!this.QC(t[s],e[s],i))return!1;return!0}else if(y.$(t)&&y.$(e)){if(i.get(t)===e)return!0;i.set(t,e);for(const s in t){const n=t[s];if(this.Fk(t,s,n))continue;const o=e[s];if(o===void 0||!this.QC(n,o,i))return!1}for(const s in e){const n=e[s];if(this.Fk(e,s,n))continue;const o=t[s];if(o===void 0||!this.QC(o,n,i))return!1}return!0}return!1}static Kv=`,
  "insertedNodeKeys": `;static l3=`,
  "modifiedNodeData": `;static Hv=`,
  "removedNodeKeys": `;Bv(t){let e=new bt;const i=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let a=e.get(s);a===null?(a=new K,a.add(r),e.set(s,a)):a.add(r)};return t.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){if(s.object!==null){const o=s.object.panel;if(o){const r=o.data;r&&i(r,o)}}}else if(n===3||n===4){const o=s.object,r=o.itemArray;r&&i(r,o)}}}),e}zv(t){const e=new K;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.Rk(t,s,s,e)}return e}Rk(t,e,i,s){if(Array.isArray(e))for(let n=0;n<e.length;n++){const o=e[n];if(o===t)return s.add(i),!0;if(this.Rk(t,o,i,s))return!0}else if(y.$(e)&&Object.getPrototypeOf(e)===Object.prototype)for(const n in e){const o=e[n];if(o===t)return s.add(i),!0;if(this.Rk(t,o,i,s))return!0}return!1}_C(t,e,i){const s=this;let n=!1;const o=new K,r=new K,a=new K;t.changes.each(c=>{if(c.model===s){if(c.modelChange==="nodeDataArray")c.change===3?o.add(c.newValue):c.change===4&&a.add(c.oldValue);else if(s.containsNodeData(c.object))c.object!==null&&r.add(c.object);else if(c.change===2&&(s.modelData===c.object||c.propertyName==="modelData"))n=!0;else if(c.object!==null)if(i.has(c.object)){const d=i.get(c.object);d&&d.each(f=>{s.containsNodeData(f)&&r.add(f)})}else{if(c.object instanceof ht||s.Wh()&&s.containsLinkData(c.object))return;s.zv(c.object).each(d=>{r.add(d)})}}});const l=new K;o.each(c=>{const d=s.getKeyForNodeData(c);d!==void 0&&l.add(d),e||r.add(c)});const h=new K;a.each(c=>{const d=s.getKeyForNodeData(c);d!==void 0&&h.add(d),e&&r.add(c)});let u="";return n&&(u+=this.Xv()),l.count>0&&(u+=(e?ht.Hv:ht.Kv)+this.Xa(l.toArray(),!0)),r.count>0&&(u+=ht.l3+this.Xa(r.toArray(),!0)),h.count>0&&(u+=(e?ht.Kv:ht.Hv)+this.Xa(h.toArray(),!0)),u}uw(t){(t.name!==void 0&&t.name!==this.name||t.dataFormat!==void 0&&t.dataFormat!==this.dataFormat||t.isReadOnly!==void 0&&t.isReadOnly!==this.isReadOnly||t.nodeKeyProperty!==void 0&&t.nodeKeyProperty!==this.nodeKeyProperty||t.copiesArrays!==void 0&&t.copiesArrays!==this.copiesArrays||t.copiesArrayObjects!==void 0&&t.copiesArrayObjects!==this.copiesArrayObjects||t.copiesKey!==void 0&&t.copiesKey!==this.copiesKey||t.nodeCategoryProperty!==void 0&&t.nodeCategoryProperty!==this.nodeCategoryProperty)&&y.o("applyIncrementalJson cannot change Model properties"),this.Yv(t);const e=t.insertedNodeKeys,i=t.modifiedNodeData,s=new bt;if(Array.isArray(i))for(let o=0;o<i.length;o++){const r=i[o],a=this.getKeyForNodeData(r);a!=null&&s.set(a,r)}if(Array.isArray(e)){const o=e.length;for(let r=0;r<o;r++){const a=e[r];let l=this.findNodeDataForKey(a);l===null&&(l=s.get(a)||this.copyNodeData({}),l!==null&&(this.setKeyForNodeData(l,a),this.addNodeData(l)))}}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const a=i[r],l=this.getKeyForNodeData(a),h=this.findNodeDataForKey(l);if(h!==null){for(const u in a)u==="__gohashid"||u===this.nodeKeyProperty||(this.Um()||this.a1())&&u===this.nodeIsGroupProperty||this.setDataProperty(h,u,a[u]);this.Ag(a,h)}}}const n=t.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const a=n[r],l=this.findNodeDataForKey(a);l!==null&&this.removeNodeData(l)}}}toIncrementalJson(t,e){t.change!==1&&y.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+t.toString());const i=t.object;if(!t.isTransactionFinished||!(i instanceof Ve))return'{ "incremental": 0 }';e===void 0&&(e=y.Hn(this));const s=this.Bv(i),n=this._C(i,t.propertyName==="FinishedUndo",s);return'{ "class": '+this.zi(e)+', "incremental": 1'+this.Lg()+n+"}"}toIncrementalJSON(t,e){return this.toIncrementalJson(t,e)}toJson(t){return t===void 0&&(t=y.Hn(this)),'{ "class": '+this.zi(t)+this.Lg()+this.$C()+"}"}toJSON(t){return this.toJson(t)}applyIncrementalJson(t){let e=null;if(typeof t=="string")try{e=H.JSON.parse(t)}catch{}else y.$(t)?e=t:y.o("Unable to modify a Model from: "+t);const i=e.incremental;typeof i!="number"&&y.o("Unable to apply non-incremental changes to Model: "+t),i!==0&&(this.startTransaction("applyIncrementalJson"),this.uw(e),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(t){return this.applyIncrementalJson(t)}static fromJson(t,e){e===void 0&&(e=null),e!==null&&y.se(e,ht,ht,"fromJson:model");let i=null;if(typeof t=="string")try{i=H.JSON.parse(t)}catch{}else y.$(t)?i=t:y.o("Unable to construct a Model from: "+t);if(e===null){const s=ht.a3(i);s===null||s instanceof ht?e=s:y.o("Unable to construct a Model of declared class: "+i.class)}return e===null&&(e=ht.jv()),e.fw(i),e.ZC(i),e}static fromJSON(t,e){return this.fromJson(t,e)}static jv(){return new ht}static a3(t){let e=null,i=t.class;if(typeof i=="string")try{let s=null;i.indexOf("go.")===0?s=ht.tL(i.substring(3)):(s=ht.tL(i),s===null&&(s=H[i])),y.st(s)&&(e=new s)}catch{}return e}replaceJsonObjects(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++){const s=t[i];y.$(s)&&this.qv(t,i,this.replaceJsonObjects(s))}}else if(y.$(t)){for(const e in t){const i=t[e];if(y.$(i)){const s=this.replaceJsonObjects(i);t[e]=s,this.replaceJsonPropertyValue(t,e,s)}}return this.h3(t)}return t}replaceJsonPropertyValue(t,e,i){if(e==="points"&&Array.isArray(i)){let s=i.length%2===0;for(let n=0;n<i.length;n++)if(typeof i[n]!="number"){s=!1;break}if(s){const n=new J;for(let o=0;o<i.length/2;o++)n.add(new P(i[o*2],i[o*2+1]));t[e]=n}}}writeJsonValue(t){return t===void 0?"undefined":t===null?"null":t===!0?"true":t===!1?"false":typeof t=="string"?this.zi(t):typeof t=="number"?t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?'{"class":"NaN"}':t.toString():t instanceof Boolean?this.writeJsonValue(t.valueOf()):t instanceof String?this.writeJsonValue(t.valueOf()):t instanceof Number?this.writeJsonValue(t.valueOf()):t instanceof Date?'{"class":"Date", "value":"'+t.toJSON()+'"}':Array.isArray(t)?this.Xa(t):y.$(t)?this.Gv(t):y.st(t)?"null":'"'+t.toString()+'"'}Xa(t,e){e===void 0&&(e=!1);const i=t.length;if(i<=0)return"[]";const s=new Ts;s.add("["),e&&i>1&&s.add(`
`);for(let n=0;n<i;n++){const o=t[n];o!==void 0&&(n>0&&(s.add(","),e&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return e&&i>1&&s.add(`
`),s.add("]"),s.toString()}Fk(t,e,i){return!!(i===void 0||e==="__gohashid"||e[0]==="_"||y.st(i))}je(t){return isNaN(t)?"NaN":t===1/0?"9e9999":t===-1/0?"-9e9999":t}Gv(t){const e=t;if(e instanceof P)t={class:"go.Point",x:this.je(e.x),y:this.je(e.y)};else if(e instanceof st)t={class:"go.Size",width:this.je(e.width),height:this.je(e.height)};else if(e instanceof I)t={class:"go.Rect",x:this.je(e.x),y:this.je(e.y),width:this.je(e.width),height:this.je(e.height)};else if(e instanceof Mt)t={class:"go.Margin",top:this.je(e.top),right:this.je(e.right),bottom:this.je(e.bottom),left:this.je(e.left)};else if(e instanceof T)e.isSpot()?t={class:"go.Spot",x:this.je(e.x),y:this.je(e.y),offsetX:this.je(e.offsetX),offsetY:this.je(e.offsetY)}:t={class:"go.Spot",enum:e.toString()};else if(e instanceof R){if(t={class:"go.Brush",type:be[e.type]},e.type===1?t.color=e.color:(e.type===2||e.type===3)&&(t.start=e.start,t.end=e.end,e.type===3&&(e.startRadius!==0&&(t.startRadius=this.je(e.startRadius)),isNaN(e.endRadius)||(t.endRadius=this.je(e.endRadius)))),e.colorStops!==null){const n={},o=e.colorStops.iterator;for(;o.next();){const r=o.key,a=o.value;n[r]=a}t.colorStops=n}}else if(e instanceof yt)t={class:"go.Geometry",type:Me[e.type]},e.startX!==0&&(t.startX=this.je(e.startX)),e.startY!==0&&(t.startY=this.je(e.startY)),e.endX!==0&&(t.endX=this.je(e.endX)),e.endY!==0&&(t.endY=this.je(e.endY)),e.spot1.equals(T.TopLeft)||(t.spot1=e.spot1),e.spot2.equals(T.BottomRight)||(t.spot2=e.spot2),e.type===4&&(t.path=yt.stringify(e));else if(ht.JC(null,"",e))return"{}";let i="{",s=!0;for(const n in t){const o=this.St(t,n);this.Fk(t,n,o)||(s?s=!1:i+=",",i+=this.zi(n)+":"+this.writeJsonPropertyValue(n,o))}return i+="}",i}writeJsonPropertyValue(t,e){if(t==="points"&&e instanceof J){const i=e;let s="[";const n=i.iterator;for(;n.next();){const o=n.value;s.length>1&&(s+=","),s+=this.Wv(o.x),s+=",",s+=this.Wv(o.y)}return s+="]",s}else return this.writeJsonValue(e)}Wv(t){if(t===1/0)return"9e9999";if(t===-1/0)return"-9e9999";if(isNaN(t))return"0";const e=this.pointsDigits;return e>16?t.toString():t.toFixed(e)}get pointsDigits(){return this.hw}set pointsDigits(t){t<0?t=0:t>100&&(t=100),this.hw=t}qe(t){return typeof t=="number"?t:t==="NaN"?NaN:t==="9e9999"?1/0:t==="-9e9999"?-1/0:parseFloat(t)}h3(t){if(!y.$(t))return t;let e=t.class||"";if(typeof e!="string"||e==="")return t;if(e==="NaN")return NaN;if(e==="Date")return new Date(t.value);if(e.indexOf("go.")!==0)return t;e=e.substring(3);let i=t;if(e==="Point")i=new P(this.qe(t.x),this.qe(t.y));else if(e==="Size")i=new st(this.qe(t.width),this.qe(t.height));else if(e==="Rect")i=new I(this.qe(t.x),this.qe(t.y),this.qe(t.width),this.qe(t.height));else if(e==="Margin")i=new Mt(this.qe(t.top),this.qe(t.right),this.qe(t.bottom),this.qe(t.left));else if(e==="Spot")typeof t.enum=="string"?i=T.parse(t.enum):i=new T(this.qe(t.x),this.qe(t.y),this.qe(t.offsetX),this.qe(t.offsetY));else if(e==="Brush"){const s=new R;s.type=y.$a(be,t.type)??1,typeof t.color=="string"&&(s.color=t.color),t.start instanceof T&&(s.start=t.start),t.end instanceof T&&(s.end=t.end),typeof t.startRadius=="number"&&(s.startRadius=this.qe(t.startRadius)),typeof t.endRadius=="number"&&(s.endRadius=this.qe(t.endRadius));const n=t.colorStops;if(y.$(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if(e==="Geometry"){let s=null;typeof t.path=="string"?s=yt.parse(t.path):s=new yt,s.type=y.$a(Me,t.type)??1,typeof t.startX=="number"&&(s.startX=this.qe(t.startX)),typeof t.startY=="number"&&(s.startY=this.qe(t.startY)),typeof t.endX=="number"&&(s.endX=this.qe(t.endX)),typeof t.endY=="number"&&(s.endY=this.qe(t.endY)),t.spot1 instanceof T&&(s.spot1=t.spot1),t.spot2 instanceof T&&(s.spot2=t.spot2),i=s}else if(e==="EnumValue"){let s=t.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=ht.tL(s);y.st(n)&&(i=y.$a(n,t.name))}return i}get name(){return this.Pt}set name(t){const e=this.Pt;e!==t&&(y.s(t,"string",ht,"name"),this.Pt=t,this.t("name",e,t))}get dataFormat(){return this.kg}set dataFormat(t){const e=this.kg;e!==t&&(y.s(t,"string",ht,"dataFormat"),this.kg=t,this.t("dataFormat",e,t))}get isReadOnly(){return this.zo}set isReadOnly(t){const e=this.zo;e!==t&&(y.s(t,"boolean",ht,"isReadOnly"),this.zo=t,this.t("isReadOnly",e,t))}get modelData(){return this.qC}set modelData(t){const e=this.modelData;e!==t&&(y.xc(t,ht,"modelData"),this.containsNodeData(t)&&y.o("Model.modelData Object must not be used by the rest of the model: "+t),this.qC=t,this.t("modelData",e,t),this.updateTargetBindings(t))}addChangedListener(t){return y.S(t,ht,"addChangedListener:listener"),this.cw.push(t),this}removeChangedListener(t){y.S(t,ht,"removeChangedListener:listener");const e=this.cw.indexOf(t);e>=0&&this.cw.splice(e,1)}T2(t){this.skipsUndoManager||this.undoManager.handleChanged(t),this.Jv(t)}Jv(t){this.cw.forEach(e=>e(t))}rR(t){this.Jv(t)}raiseChangedEvent(t,e,i,s,n,o,r){this.Ft("",t,e,i,s,n,o,r)}raiseChanged(t,e,i,s,n){this.Ft("",2,t,this,e,i,s,n)}t(t,e,i,s,n){this.Ft("",2,t,this,e,i,s,n)}raiseDataChanged(t,e,i,s,n,o){this.Ft("",2,e,t,i,s,n,o)}Ft(t,e,i,s,n,o,r,a){r===void 0&&(r=null),a===void 0&&(a=null);const l=new Ne;l.model=this,l.change=e,l.modelChange=t,l.propertyName=i,l.object=s,l.oldValue=n,l.oldParam=r,l.newValue=o,l.newParam=a,this.T2(l)}get undoManager(){return this.vk}set undoManager(t){const e=this.vk;e!==t&&(e&&e.removeModel(this),this.vk=t,t.addModel(this))}get skipsUndoManager(){return this.Bo}set skipsUndoManager(t){y.s(t,"boolean",ht,"skipsUndoManager"),this.Bo=t}changeState(t,e){if(t!==null&&t.model===this)if(t.change===2){const i=t.object,s=t.propertyName,n=t.getValue(e);if(i!==null&&s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=t.getValue(!e);o!==void 0&&this.be.delete(o),n!==void 0&&this.be.set(n,i)}this.et(i,s,n)}else if(t.change===3){const i=t.newParam;if(t.modelChange==="nodeDataArray"){const s=t.newValue;if(y.$(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);e?(this.Bi[i]===s&&this.Co(this.Bi,i),n!==void 0&&this.be.delete(n)):(this.Bi[i]!==s&&this.ar(this.Bi,i,s),n!==void 0&&this.be.set(n,s))}}else if(t.modelChange===""){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=this.St(s,t.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=t.newValue;e?this.Co(s,i):this.ar(s,i,n)}}else y.o("unknown ChangeType.Insert modelChange: "+t.toString())}else if(t.change===4){const i=t.oldParam;if(t.modelChange==="nodeDataArray"){const s=t.oldValue;if(y.$(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);e?(this.Bi[i]!==s&&this.ar(this.Bi,i,s),n!==void 0&&this.be.set(n,s)):(this.Bi[i]===s&&this.Co(this.Bi,i),n!==void 0&&this.be.delete(n))}}else if(t.modelChange===""){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=this.St(s,t.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=t.oldValue;e?this.ar(s,i,n):this.Co(s,i)}}else y.o("unknown ChangeType.Remove modelChange: "+t.toString())}else t.change===1||y.o("unknown ChangedEvent: "+t.toString())}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(t,e){e===void 0&&(e=""),this.Ft("SourceChanged",1,e,t,null,null)}get nodeKeyProperty(){return this.za}set nodeKeyProperty(t){const e=this.za;e!==t&&(this.Un(t,ht,"nodeKeyProperty"),t===""&&y.o("Model.nodeKeyProperty may not be the empty string"),this.be.count>0&&y.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.za=t,this.t("nodeKeyProperty",e,t))}Un(t,e,i){}getKeyForNodeData(t){if(t===null)return;const e=this.za;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;y.o("Key value for node data "+t+" is not a number or a string: "+i)}}setKeyForNodeData(t,e){if((e==null||!this.isKeyType(e))&&y.si(e,"number or string",ht,"setKeyForNodeData:key"),t===null)return;const i=this.za;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}const s=this.St(t,i);if(s!==e){if(this.findNodeDataForKey(e)!==null)return;this.et(t,i,e),s!==void 0&&this.be.delete(s),this.be.set(e,t),this.Ft("nodeKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i),this.dw(s,e)}}get makeUniqueKeyFunction(){return this.Jf}set makeUniqueKeyFunction(t){const e=this.Jf;e!==t&&(t!==null&&y.S(t,ht,"makeUniqueKeyFunction"),this.Jf=t,this.t("makeUniqueKeyFunction",e,t))}isKeyType(t){return typeof t=="number"||typeof t=="string"}containsNodeData(t){if(t===null)return!1;const e=this.getKeyForNodeData(t);return e===void 0?!1:this.be.get(e)===t}findNodeDataForKey(t){return t===null&&y.o("Model.findNodeDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.be.get(t)}get nodeDataArray(){return this.Bi}set nodeDataArray(t){const e=this.Bi;if(e!==t){this.eL(t,ht,"nodeDataArray"),this.be.clear(),this.iL();const i=t.length;for(let o=0;o<i;o++){const r=t[o];y.$(r)||y.o("Model.nodeDataArray must only contain Objects, not: "+r),r===this.modelData&&y.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Bi=t;const s=new J;for(let o=0;o<i;o++){const r=t[o],a=this.getKeyForNodeData(r);a===void 0||this.be.get(a)!==null?s.add(r):this.be.set(a,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);r!==void 0&&this.be.set(r,o)}this.Ft("nodeDataArray",2,"nodeDataArray",this,e,t);for(let o=0;o<i;o++){const r=t[o];this.Tg(r),this.Dg(r)}}}Ok(t){return t===void 0?!1:this.be.has(t)}makeNodeDataKeyUnique(t){if(t===null)return;const e=this.za;if(e==="")return;let i=this.getKeyForNodeData(t);if(i!==void 0&&!this.Ok(i))return;const s=this.Jf;if(s!==null&&(i=s(this,t),i!=null&&!this.Ok(i))){this.et(t,e,i);return}if(typeof i=="string"){let n=2;for(;this.Ok(i+n);)n++;this.et(t,e,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.be.count-1;for(;this.Ok(n);)n--;this.et(t,e,n)}}addNodeData(t){t!==null&&(t===this.modelData&&y.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(t)||this.vv(t,!0))}vv(t,e){let i=this.getKeyForNodeData(t);if(i===void 0)this.makeNodeDataKeyUnique(t),i=this.getKeyForNodeData(t);else{if(this.be.get(i)===t)return;this.makeNodeDataKeyUnique(t),i=this.getKeyForNodeData(t)}i===void 0&&y.o("Model.makeNodeDataKeyUnique failed on "+t+".  Data not added to Model."),this.be.set(i,t);let s=null;e&&(s=this.Bi.length,this.ar(this.Bi,s,t)),this.Ft("nodeDataArray",3,"nodeDataArray",this,null,t,null,s),this.Tg(t),this.Dg(t)}addNodeDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.addNodeData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.addNodeData(i)}}}removeNodeData(t){t!==null&&this.Dv(t,!0)}Dv(t,e){const i=this.getKeyForNodeData(t);i!==void 0&&this.be.delete(i);let s=null;if(e){if(s=this.Bi.indexOf(t),s<0)return;this.Co(this.Bi,s)}this.Ft("nodeDataArray",4,"nodeDataArray",this,t,null,s,null),this.gw(t)}removeNodeDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.removeNodeData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.removeNodeData(i)}}}mergeNodeDataArray(t){if(t===this.nodeDataArray||!Array.isArray(t))return;const e=new K;e.addAll(this.be.iteratorKeys);const i=new K,s=t.length;for(let o=0;o<s;o++){const r=t[o],a=this.getKeyForNodeData(r);if(a!==void 0){i.add(a);const l=this.findNodeDataForKey(a);if(l===r)continue;if(l!==null)this.assignAllDataProperties(l,r),this.Ag(r,l);else{const h=this.cloneDeep(r);this.setKeyForNodeData(h,a),this.addNodeData(h)}}else{const l=this.cloneDeep(r);this.addNodeData(l);const h=this.getKeyForNodeData(l);h!==void 0&&i.add(h)}}const n=e.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}}dw(t,e){if(e===void 0)return;const i=this.lw(t);i instanceof K&&this.lr.set(e,i)}iL(){}Tg(t){}Dg(t){}gw(t){}hn(t,e){if(t===void 0)return;let i=this.lr.get(t);i===null&&(i=new K,this.lr.set(t,i)),i.add(e)}an(t,e){if(t===void 0)return;const i=this.lr.get(t);i instanceof K&&(e==null?this.lr.delete(t):(i.delete(e),i.count===0&&this.lr.delete(t)))}lw(t){if(t===void 0)return null;const e=this.lr.get(t);return e instanceof K?e:null}GU(t){t===void 0?this.lr.clear():this.lr.delete(t)}get copyNodeDataFunction(){return this.$f}set copyNodeDataFunction(t){const e=this.$f;e!==t&&(t!==null&&y.S(t,ht,"copyNodeDataFunction"),this.$f=t,this.t("copyNodeDataFunction",e,t))}get copiesArrays(){return this.Pg}set copiesArrays(t){const e=this.Pg;e!==t&&(t!==null&&y.s(t,"boolean",ht,"copiesArrays"),this.Pg=t,this.t("copiesArrays",e,t))}get copiesArrayObjects(){return this.Sg}set copiesArrayObjects(t){const e=this.Sg;e!==t&&(t!==null&&y.s(t,"boolean",ht,"copiesArrayObjects"),this.Sg=t,this.t("copiesArrayObjects",e,t))}get copiesKey(){return this.Mg}set copiesKey(t){const e=this.Mg;e!==t&&(t!==null&&y.s(t,"boolean",ht,"copiesKey"),this.Mg=t,this.t("copiesKey",e,t))}copyNodeData(t){let e=null;const i=this.$f;return i!==null?e=i(t,this):e=this.Ik(t,!0),e}Ik(t,e){if(y.$(t))if(Array.isArray(t))if(this.copiesArrays){const i=t,s=[];for(let n=0;n<i.length;n++){const o=i[n],r=this.Ik(o,this.copiesArrayObjects);s.push(r)}return s}else return t;else{if(t instanceof P||t instanceof st||t instanceof I||t instanceof Mt||t instanceof T)return t.copy();if(e){const i=t,s=i.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const r in i){if(r==="__gohashid"){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const a=this.St(i,r);if(!y.$(a))n[r]=a;else if(ht.JC(i,r,a))this.et(n,r,a);else{const l=this.Ik(a,!1);this.et(n,r,l)}}return n}else return t}else return t}get afterCopyFunction(){return this.Ng}set afterCopyFunction(t){const e=this.Ng;e!==t&&(t!==null&&y.S(t,ht,"afterCopyFunction"),this.Ng=t,this.t("afterCopyFunction",e,t))}static JC(t,e,i){const s=y.Hn(i);return i instanceof ht||i instanceof Je||i instanceof Ve||i instanceof Ne||i instanceof tt||i instanceof Dt||i instanceof X||i instanceof EventTarget||s==="Layer"||s==="RowColumnDefinition"||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}static $v=!1;setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}else if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}}else!ht.$v&&t instanceof tt&&(ht.$v=!0,y.ne('Model.setDataProperty is modifying a GraphObject, "'+t.toString()+'"'),y.ne("  Is that really your intent?"));const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}set(t,e,i){this.setDataProperty(t,e,i)}assignAllDataProperties(t,e){if(!e)return;const i=this.containsNodeData(t);for(const s in e)s!=="__gohashid"&&(i&&s===this.nodeKeyProperty||this.setDataProperty(t,s,e[s]))}addArrayItem(t,e){this.insertArrayItem(t,-1,e)}insertArrayItem(t,e,i){e<0&&(e=t.length),t=this.ar(t,e,i),this.Ft("",3,"",t,null,i,null,e)}removeArrayItem(t,e){e===void 0&&(e=-1),t===this.Bi&&y.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),e===-1&&(e=t.length-1);const i=t[e];t=this.Co(t,e),this.Ft("",4,"",t,i,null,e,null)}get nodeCategoryProperty(){return this.lc}set nodeCategoryProperty(t){const e=this.lc;e!==t&&(this.Un(t,ht,"nodeCategoryProperty"),this.lc=t,this.t("nodeCategoryProperty",e,t))}getCategoryForNodeData(t){if(t===null)return"";const e=this.lc;if(e==="")return"";const i=this.St(t,e);if(i===void 0)return"";if(typeof i=="string")return i;y.o("getCategoryForNodeData found a non-string category for "+t+": "+i)}setCategoryForNodeData(t,e){if(y.s(e,"string",ht,"setCategoryForNodeData:cat"),t===null)return;const i=this.lc;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.St(t,i);s===void 0&&(s=""),s!==e&&(this.et(t,i,e),this.Ft("nodeCategory",2,i,t,s,e))}Ag(t,e){this.setCategoryForNodeData(e,this.getCategoryForNodeData(t))}get type(){return"Model"}Vm(){return!1}Um(){return!1}a1(){return!1}Wh(){return!1}Ax(){return!1}uf(){return!1}static m2(){return new ht}St(t,e){return ht.St(t,e)}static St(t,e){if(!t||!e)return null;let i;try{y.st(e)?i=e(t):y.st(t.getAttribute)?(i=t.getAttribute(e),i===null&&(i=void 0)):i=t[e]}catch{}return i}et(t,e,i){ht.et(t,e,i)}static et(t,e,i){if(!(!t||!e)){try{y.st(e)?e(t,i):y.st(t.setAttribute)?t.setAttribute(e,i):t[e]=i}catch{}return t}}eL(t,e,i){}qv(t,e,i){return t[e]=i,t}ar(t,e,i){return e>=t.length?t.push(i):t.splice(e,0,i),t}Co(t,e){return e>=t.length?t.pop():t.splice(e,1),t}static tL(t){return ht.sL[t]?ht.sL[t]:H.go!==void 0&&H.go[t]?H.go[t]:null}static Sl(t,e){ht.sL[e]=t}static sL={}}ht.fromJSON=ht.fromJson=ht.fromJson,ht.Sl(R,"Brush"),ht.Sl(yt,"Geometry"),ht.Sl(Mt,"Margin"),ht.Sl(P,"Point"),ht.Sl(I,"Rect"),ht.Sl(st,"Size"),ht.Sl(T,"Spot"),ht.Sl(ht,"Model");class Ot extends ht{Is;hr;Oe;Ga;Zf;Qf;Vl;Lo;Ao;ac;hc;cc;cn;_f;Vn;vg;constructor(t,e,i){if(super(),this.Is=[],this.hr=new K,this.Oe=new bt,this.Ga="",this.Zf=null,this.Qf=null,this.Vl=null,this.Lo="from",this.Ao="to",this.ac="",this.hc="",this.cc="category",this.cn="",this._f="isGroup",this.Vn="group",this.vg=!1,e!==void 0&&(this.linkDataArray=e),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Ga=this.Ga,t.Zf=this.Zf,t.Qf=this.Qf,t.Lo=this.Lo,t.Ao=this.Ao,t.ac=this.ac,t.hc=this.hc,t.cc=this.cc,t.cn=this.cn,t._f=this._f,t.Vn=this.Vn,t.vg=this.vg}clear(){this.Is=[],this.Oe.clear(),this.hr.clear(),super.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let e=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){e+=`
 node data:`;let i=this.nodeDataArray,s=i.length,n=0;for(n=0;n<s;n++){const o=i[n];e+=" "+this.getKeyForNodeData(o)+":"+Yt.toString(o)}for(e+=`
 link data:`,i=this.linkDataArray,s=i.length,n=0;n<s;n++){const o=i[n];e+=" "+this.Vi(o,!0)+"-->"+this.Vi(o,!1)}}return e}}WC(t,e,i){if(this.linkKeyProperty===""){const c=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=c}let s=super.WC(t,e,i);const n=this,o=new K,r=new K,a=new K;t.changes.each(c=>{if(c.model===n){if(c.modelChange==="linkDataArray")c.change===3?o.add(c.newValue):c.change===4&&a.add(c.oldValue);else if(n.containsLinkData(c.object))c.object!==null&&r.add(c.object);else if(c.object!==null)if(c.object!==null&&i.has(c.object)){const d=i.get(c.object);d&&d.each(f=>{n.containsLinkData(f)&&r.add(f)})}else{if(c.object instanceof ht||n.containsNodeData(c.object))return;n.Zv(c.object).each(d=>r.add(d))}}});const l=new K;o.each(c=>{const d=n.getKeyForLinkData(c);d!==void 0&&l.add(d),e||r.add(c)});const h=new K;a.each(c=>{const d=n.getKeyForLinkData(c);d!==void 0&&h.add(d),e&&r.add(c)});const u=n.cloneDeep(r.toArray());return l.count>0&&(s===null&&(s={}),e?s.removedLinkKeys=l.toArray():s.insertedLinkKeys=l.toArray()),u.length>0&&(s===null&&(s={}),s.modifiedLinkData=u),h.count>0&&(s===null&&(s={}),e?s.insertedLinkKeys=h.toArray():s.removedLinkKeys=h.toArray()),s}Lg(){const t=super.Lg();let e="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(e+=`,
  "linkCategoryProperty": `+this.zi(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(e+=`,
  "linkKeyProperty": `+this.zi(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(e+=`,
  "linkFromKeyProperty": `+this.zi(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(e+=`,
  "linkToKeyProperty": `+this.zi(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(e+=`,
  "linkFromPortIdProperty": `+this.zi(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(e+=`,
  "linkToPortIdProperty": `+this.zi(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(e+=`,
  "linkLabelKeysProperty": `+this.zi(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(e+=`,
  "nodeIsGroupProperty": `+this.zi(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(e+=`,
  "nodeGroupKeyProperty": `+this.zi(this.nodeGroupKeyProperty)),t+e}fw(t){super.fw(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}$C(){const t=super.$C(),e=`,
  "linkDataArray": `+this.Xa(this.linkDataArray,!0);return t+e}ZC(t){super.ZC(t);const e=t.linkDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.linkDataArray=e)}Qv=`,
  "insertedLinkKeys": `;c3=`,
  "modifiedLinkData": `;_v=`,
  "removedLinkKeys": `;Zv(t){const e=new K;for(let i=0;i<this.linkDataArray.length;i++){const s=this.linkDataArray[i];this.Rk(t,s,s,e)}return e}_C(t,e,i){if(this.linkKeyProperty===""){const c=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=c}const s=super._C(t,e,i),n=this,o=new K,r=new K,a=new K;t.changes.each(c=>{if(c.model===n){if(c.modelChange==="linkDataArray")c.change===3?o.add(c.newValue):c.change===4&&a.add(c.oldValue);else if(n.containsLinkData(c.object))c.object!==null&&r.add(c.object);else if(c.object!==null)if(c.object!==null&&i.has(c.object)){const d=i.get(c.object);d&&d.each(f=>{n.containsLinkData(f)&&r.add(f)})}else{if(c.object instanceof ht||n.containsNodeData(c.object))return;n.Zv(c.object).each(d=>r.add(d))}}});const l=new K;o.each(c=>{const d=n.getKeyForLinkData(c);d!==void 0&&l.add(d),e||r.add(c)});const h=new K;a.each(c=>{const d=n.getKeyForLinkData(c);d!==void 0&&h.add(d),e&&r.add(c)});let u=s;return l.count>0&&(u+=(e?this._v:this.Qv)+this.Xa(l.toArray(),!0)),r.count>0&&(u+=this.c3+this.Xa(r.toArray(),!0)),h.count>0&&(u+=(e?this.Qv:this._v)+this.Xa(h.toArray(),!0)),u}uw(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&y.o("applyIncrementalJson cannot change Model properties"),super.uw(t);const e=t.insertedLinkKeys;if(Array.isArray(e)){const n=e.length;for(let o=0;o<n;o++){const r=e[o];let a=this.findLinkDataForKey(r);a===null&&(a=this.copyLinkData({}),this.setKeyForLinkData(a,r),this.addLinkData(a))}}const i=t.modifiedLinkData;if(Array.isArray(i)){const n=i.length;for(let o=0;o<n;o++){const r=i[o],a=this.getKeyForLinkData(r),l=this.findLinkDataForKey(a);if(l!==null){for(const h in r)h==="__gohashid"||h===this.linkKeyProperty||this.setDataProperty(l,h,r[h]);this.tF(r,l)}}}const s=t.removedLinkKeys;if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++){const r=s[o],a=this.findLinkDataForKey(r);a!==null&&this.removeLinkData(a)}}}changeState(t,e){if(!(t===null||t.model!==this)){if(t.change===2){const i=t.object,s=t.propertyName;if(i!==null&&s===this.linkKeyProperty&&this.containsLinkData(i)){const n=t.getValue(e),o=t.getValue(!e);o!==void 0&&this.Oe.delete(o),n!==void 0&&this.Oe.set(n,i),this.et(i,s,n);return}}else if(t.change===3){let i=t.newParam;if(t.modelChange==="linkDataArray"){const s=t.newValue;if(y.$(s)&&typeof i=="number"){const n=this.getKeyForLinkData(s);e?(this.hr.delete(s),this.Is[i]===s&&this.Co(this.linkDataArray,i),n!==void 0&&this.Oe.delete(n)):(this.hr.add(s),this.Is[i]!==s&&this.ar(this.Is,i,s),n!==void 0&&this.Oe.set(n,s))}return}else if(t.modelChange==="linkLabelKeys"){const s=t.object,n=s!==null?this.getLabelKeysForLinkData(s):null;Array.isArray(n)&&typeof i=="number"&&(e?(i=n.indexOf(t.newValue),i>=0&&this.Co(n,i)):n.indexOf(t.newValue)<0&&this.ar(n,i,t.newValue));return}}else if(t.change===4){let i=t.oldParam;if(t.modelChange==="linkDataArray"){const s=t.oldValue;if(y.$(s)&&typeof i=="number"){const n=this.getKeyForLinkData(s);e?(this.hr.add(s),this.Is[i]!==s&&this.ar(this.Is,i,s),n!==void 0&&this.Oe.set(n,s)):(this.hr.delete(s),this.Is[i]===s&&this.Co(this.linkDataArray,i),n!==void 0&&this.Oe.delete(n))}return}else if(t.modelChange==="linkLabelKeys"){const s=t.object,n=s!==null?this.getLabelKeysForLinkData(s):null;Array.isArray(n)&&typeof i=="number"&&(e?n.indexOf(t.oldValue)<0&&this.ar(n,i,t.oldValue):(i=n.indexOf(t.oldValue),i>=0&&this.Co(n,i)));return}}super.changeState(t,e)}}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){const e=this.Vl;e!==t&&(t!==null&&y.xc(t,Ot,"archetypeNodeData"),this.Vl=t,this.t("archetypeNodeData",e,t))}nL(t){if(t===void 0)return;const e=this.Vl;if(e!==null){let i=this.findNodeDataForKey(t);i===null&&(i=this.copyNodeData(e),this.et(i,this.nodeKeyProperty,t),this.addNodeData(i))}return t}get linkFromKeyProperty(){return this.Lo}set linkFromKeyProperty(t){const e=this.Lo;e!==t&&(this.Un(t,Ot,"linkFromKeyProperty"),this.Lo=t,this.t("linkFromKeyProperty",e,t))}getFromKeyForLinkData(t){return this.Vi(t,!0)}setFromKeyForLinkData(t,e){this.xg(t,e,!0)}get linkToKeyProperty(){return this.Ao}set linkToKeyProperty(t){const e=this.Ao;e!==t&&(this.Un(t,Ot,"linkToKeyProperty"),this.Ao=t,this.t("linkToKeyProperty",e,t))}getToKeyForLinkData(t){return this.Vi(t,!1)}setToKeyForLinkData(t,e){this.xg(t,e,!1)}Vi(t,e){if(t===null)return;const i=e?this.Lo:this.Ao;if(i==="")return;const s=this.St(t,i);if(s!==void 0){if(this.isKeyType(s))return s;y.o((e?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+s)}}xg(t,e,i){if(e===null&&(e=void 0),e!==void 0&&!this.isKeyType(e)&&y.si(e,"number or string",Ot,i?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const s=i?this.Lo:this.Ao;if(s==="")return;if(e=this.nL(e),!this.containsLinkData(t)){this.et(t,s,e);return}const n=this.St(t,s);n!==e&&(this.an(n,t),this.et(t,s,e),this.findNodeDataForKey(e)===null&&this.hn(e,t),this.Ft(i?"linkFromKey":"linkToKey",2,s,t,n,e),typeof s=="string"&&this.updateTargetBindings(t,s))}get linkFromPortIdProperty(){return this.ac}set linkFromPortIdProperty(t){const e=this.ac;e!==t&&(this.Un(t,Ot,"linkFromPortIdProperty"),this.ac=t,this.t("linkFromPortIdProperty",e,t))}getFromPortIdForLinkData(t){return this.Ak(t,!0)}setFromPortIdForLinkData(t,e){this.bg(t,e,!0)}get linkToPortIdProperty(){return this.hc}set linkToPortIdProperty(t){const e=this.hc;e!==t&&(this.Un(t,Ot,"linkToPortIdProperty"),this.hc=t,this.t("linkToPortIdProperty",e,t))}getToPortIdForLinkData(t){return this.Ak(t,!1)}setToPortIdForLinkData(t,e){this.bg(t,e,!1)}Ak(t,e){if(t===null)return"";const i=e?this.ac:this.hc;if(i==="")return"";const s=this.St(t,i);return s===void 0?"":s}bg(t,e,i){if(t===null)return;const s=i?this.ac:this.hc;if(s==="")return;if(!this.containsLinkData(t)){this.et(t,s,e);return}let n=this.St(t,s);n===void 0&&(n=""),n!==e&&(this.et(t,s,e),this.Ft(i?"linkFromPortId":"linkToPortId",2,s,t,n,e),typeof s=="string"&&this.updateTargetBindings(t,s))}get linkLabelKeysProperty(){return this.cn}set linkLabelKeysProperty(t){const e=this.cn;e!==t&&(this.Un(t,Ot,"linkLabelKeysProperty"),this.cn=t,this.t("linkLabelKeysProperty",e,t))}getLabelKeysForLinkData(t){if(t===null)return Ot.EmptyArray;const e=this.cn;if(e==="")return Ot.EmptyArray;const i=this.St(t,e);return i===void 0?Ot.EmptyArray:i}setLabelKeysForLinkData(t,e){if(this.eL(e,Ot,"setLabelKeysForLinkData:arr"),t===null)return;const i=this.cn;if(i==="")return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.St(t,i);if(s===void 0&&(s=Ot.EmptyArray),s!==e){if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++){const a=s[r];this.an(a,t)}}this.et(t,i,e);const n=e.length;for(let o=0;o<n;o++){const r=e[o];this.findNodeDataForKey(r)===null&&this.hn(r,t)}this.Ft("linkLabelKeys",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i)}}addLabelKeyForLinkData(t,e){if(e==null||(this.isKeyType(e)||y.si(e,"number or string",Ot,"addLabelKeyForLinkData:key"),t===null))return;const i=this.cn;if(i==="")return;const s=this.St(t,i);if(s===void 0){const n=[];n.push(e),this.setLabelKeysForLinkData(t,n)}else if(Array.isArray(s)){let n=s.indexOf(e);if(n>=0)return;n=s.length,s.push(e),this.containsLinkData(t)&&(this.findNodeDataForKey(e)===null&&this.hn(e,t),this.Ft("linkLabelKeys",3,i,t,null,e,null,n))}else y.o(i+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,e){if(e==null||(this.isKeyType(e)||y.si(e,"number or string",Ot,"removeLabelKeyForLinkData:key"),t===null))return;const i=this.cn;if(i==="")return;const s=this.St(t,i);if(Array.isArray(s)){const n=s.indexOf(e);if(n<0)return;this.Co(s,n),this.containsLinkData(t)&&(this.an(e,t),this.Ft("linkLabelKeys",4,i,t,e,null,n,null))}else s!==void 0&&y.o(i+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Is}set linkDataArray(t){const e=this.Is;if(e!==t){this.eL(t,Ot,"linkDataArray"),this.Oe.clear();const i=t.length;for(let n=0;n<i;n++){const o=t[n];y.$(o)||y.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+o)}if(this.Is=t,this.linkKeyProperty!==""){const n=new J;for(let r=0;r<i;r++){const a=t[r],l=this.getKeyForLinkData(a);l===void 0||this.Oe.get(l)!==null?n.add(a):this.Oe.set(l,a)}const o=n.iterator;for(;o.next();){const r=o.value;this.makeLinkDataKeyUnique(r);const a=this.getKeyForLinkData(r);a!==void 0&&this.Oe.set(a,r)}}const s=new K;for(let n=0;n<i;n++){const o=t[n];s.add(o)}this.hr=s,this.Ft("linkDataArray",2,"linkDataArray",this,e,t);for(let n=0;n<i;n++){const o=t[n];this.oL(o)}}}get linkKeyProperty(){return this.Ga}set linkKeyProperty(t){const e=this.Ga;if(e!==t){this.Un(t,Ot,"linkKeyProperty"),this.Ga=t,this.Oe.clear();const i=this.linkDataArray.length;for(let s=0;s<i;s++){const n=this.linkDataArray[s];let o=this.getKeyForLinkData(n);o===void 0&&(this.makeLinkDataKeyUnique(n),o=this.getKeyForLinkData(n)),o!==void 0&&this.Oe.set(o,n)}this.t("linkKeyProperty",e,t)}}getKeyForLinkData(t){if(t===null)return;const e=this.Ga;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;y.o("Key value for link data "+t+" is not a number or a string: "+i)}}setKeyForLinkData(t,e){if((e==null||!this.isKeyType(e))&&y.si(e,"number or string",Ot,"setKeyForLinkData:key"),t===null)return;const i=this.Ga;if(i==="")return;if(!this.containsLinkData(t)){this.et(t,i,e);return}const s=this.St(t,i);if(s!==e){if(this.findLinkDataForKey(e)!==null)return;this.et(t,i,e),s!==void 0&&this.Oe.delete(s),this.Oe.set(e,t),this.Ft("linkKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i)}}get makeUniqueLinkKeyFunction(){return this.Zf}set makeUniqueLinkKeyFunction(t){const e=this.Zf;e!==t&&(this.Zf=t,this.t("makeUniqueLinkKeyFunction",e,t))}findLinkDataForKey(t){return t===null&&y.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.Oe.get(t)}Ek(t){return t===void 0?!1:this.Oe.has(t)}makeLinkDataKeyUnique(t){if(t===null)return;const e=this.Ga;if(e==="")return;let i=this.getKeyForLinkData(t);if(i!==void 0&&!this.Ek(i))return;const s=this.Zf;if(s!==null&&(i=s(this,t),i!=null&&!this.Ek(i))){this.et(t,e,i);return}if(typeof i=="string"){let n=2;for(;this.Ek(i+n);)n++;this.et(t,e,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.Oe.count-1;for(;this.Ek(n);)n--;this.et(t,e,n)}}containsLinkData(t){return t===null?!1:this.hr.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.Uv(t,!0))}Uv(t,e){if(this.linkKeyProperty!==""){let s=this.getKeyForLinkData(t);if(s===void 0)this.makeLinkDataKeyUnique(t),s=this.getKeyForLinkData(t);else{if(this.Oe.get(s)===t)return;this.makeLinkDataKeyUnique(t),s=this.getKeyForLinkData(t)}s===void 0&&y.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.Oe.set(s,t)}this.hr.add(t);let i=null;e&&(i=this.Is.length,this.ar(this.Is,i,t)),this.Ft("linkDataArray",3,"linkDataArray",this,null,t,null,i),this.oL(t)}addLinkDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.addLinkData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.addLinkData(i)}}}removeLinkData(t){t!==null&&this.Ev(t,!0)}Ev(t,e){this.hr.delete(t);const i=this.getKeyForLinkData(t);i!==void 0&&this.Oe.delete(i);let s=null;if(e){if(s=this.Is.indexOf(t),s<0)return;this.Co(this.Is,s)}this.Ft("linkDataArray",4,"linkDataArray",this,t,null,s,null),this.f3(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.removeLinkData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.removeLinkData(i)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&y.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;const e=new K;e.addAll(this.Oe.iteratorKeys);const i=new K,s=t.length;for(let o=0;o<s;o++){const r=t[o],a=this.getKeyForLinkData(r);if(a!==void 0){i.add(a);const l=this.findLinkDataForKey(a);if(l===r)continue;if(l!==null)this.assignAllDataProperties(l,r),this.tF(r,l);else{const h=this.cloneDeep(r);this.setKeyForLinkData(h,a),this.addLinkData(h)}}else{const l=this.cloneDeep(r);this.addLinkData(l);const h=this.getKeyForLinkData(l);h!==void 0&&i.add(h)}}const n=e.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findLinkDataForKey(o);r&&this.removeLinkData(r)}}}oL(t){let e=this.Vi(t,!0);e=this.nL(e),this.findNodeDataForKey(e)===null&&this.hn(e,t),e=this.Vi(t,!1),e=this.nL(e),this.findNodeDataForKey(e)===null&&this.hn(e,t);const i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)e=i[n],this.findNodeDataForKey(e)===null&&this.hn(e,t)}}f3(t){let e=this.Vi(t,!0);this.an(e,t),e=this.Vi(t,!1),this.an(e,t);const i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)e=i[n],this.an(e,t)}}get copyLinkDataFunction(){return this.Qf}set copyLinkDataFunction(t){const e=this.Qf;e!==t&&(this.Qf=t,this.t("copyLinkDataFunction",e,t))}copyLinkData(t){let e=null;const i=this.Qf;return i!==null?e=i(t,this):e=this.Ik(t,!0),y.$(e)&&(this.Lo!==""&&this.et(e,this.Lo,void 0),this.Ao!==""&&this.et(e,this.Ao,void 0),this.cn!==""&&this.et(e,this.cn,[])),e}get nodeIsGroupProperty(){return this._f}set nodeIsGroupProperty(t){const e=this._f;e!==t&&(this.Un(t,Ot,"nodeIsGroupProperty"),this._f=t,this.t("nodeIsGroupProperty",e,t))}isGroupForNodeData(t){if(t===null)return!1;const e=this._f;return e===""?!1:!!this.St(t,e)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Vn}set nodeGroupKeyProperty(t){const e=this.Vn;e!==t&&(this.Un(t,Ot,"nodeGroupKeyProperty"),this.Vn=t,this.t("nodeGroupKeyProperty",e,t))}get copiesGroupKeyOfNodeData(){return this.vg}set copiesGroupKeyOfNodeData(t){this.vg!==t&&(this.vg=t)}getGroupKeyForNodeData(t){if(t===null)return;const e=this.Vn;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;y.o("GroupKey value for node data "+t+" is not a number or a string: "+i)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,e){if(e===null&&(e=void 0),e!==void 0&&!this.isKeyType(e)&&y.si(e,"number or string",Ot,"setGroupKeyForNodeData:key"),t===null)return;const i=this.Vn;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}const s=this.St(t,i);s!==e&&(this.an(s,t),this.et(t,i,e),this.findNodeDataForKey(e)===null&&this.hn(e,t),this.Ft("nodeGroupKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}setGroupForData(t,e){this.setGroupKeyForNodeData(t,e)}copyNodeData(t){const e=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Vn!==""&&this.St(e,this.Vn)!==void 0&&this.et(e,this.Vn,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}else if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}else if(e===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,i);return}}else if(this.containsLinkData(t)){if(e===this.linkFromKeyProperty){this.xg(t,i,!0);return}else if(e===this.linkToKeyProperty){this.xg(t,i,!1);return}else if(e===this.linkFromPortIdProperty){this.bg(t,i,!0);return}else if(e===this.linkToPortIdProperty){this.bg(t,i,!1);return}else if(e===this.linkKeyProperty){this.setKeyForLinkData(t,i);return}else if(e===this.linkCategoryProperty){this.setCategoryForLinkData(t,i);return}else if(e===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,i);return}}const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}assignAllDataProperties(t,e){if(!e)return;const i=this.containsNodeData(t),s=this.containsLinkData(t);for(const n in e)if(n!=="__gohashid"&&!(i&&n===this.nodeKeyProperty)){if(i&&n===this.nodeIsGroupProperty&&this.St(t,n)===e[n]||s&&n===this.linkKeyProperty)continue;this.setDataProperty(t,n,e[n])}}dw(t,e){super.dw(t,e);const i=this.be.iterator;for(;i.next();){const n=i.value;this.rL(n,t,e)}const s=this.hr.iterator;for(;s.next();){const n=s.value;this.u3(n,t,e)}}rL(t,e,i){if(this.getGroupKeyForNodeData(t)===e){const s=this.Vn;this.et(t,s,i),this.Ft("nodeGroupKey",2,s,t,e,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}u3(t,e,i){if(this.Vi(t,!0)===e){const n=this.Lo;this.et(t,n,i),this.Ft("linkFromKey",2,n,t,e,i),typeof n=="string"&&this.updateTargetBindings(t,n)}if(this.Vi(t,!1)===e){const n=this.Ao;this.et(t,n,i),this.Ft("linkToKey",2,n,t,e,i),typeof n=="string"&&this.updateTargetBindings(t,n)}const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length,o=this.cn;for(let r=0;r<n;r++)s[r]===e&&(this.qv(s,r,i),this.Ft("linkLabelKeys",3,o,t,e,i,r,r))}}iL(){super.iL();const t=this.linkDataArray,e=t.length;for(let i=0;i<e;i++){const s=t[i];this.oL(s)}}Tg(t){super.Tg(t);const e=this.getKeyForNodeData(t),i=this.lw(e);if(i!==null){const s=y.nt(),n=i.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)){if(this.getGroupKeyForNodeData(o)===e){const r=this.Vn;this.Ft("nodeGroupKey",2,r,o,e,e),typeof r=="string"&&this.updateTargetBindings(o,r),s.push(o)}}else{if(this.Vi(o,!0)===e){const a=this.Lo;this.Ft("linkFromKey",2,a,o,e,e),typeof a=="string"&&this.updateTargetBindings(o,a),s.push(o)}if(this.Vi(o,!1)===e){const a=this.Ao;this.Ft("linkToKey",2,a,o,e,e),typeof a=="string"&&this.updateTargetBindings(o,a),s.push(o)}const r=this.getLabelKeysForLinkData(o);if(Array.isArray(r)){const a=r.length,l=this.cn;for(let h=0;h<a;h++)r[h]===e&&(this.Ft("linkLabelKeys",3,l,o,e,e,h,h),s.push(o))}}}for(let o=0;o<s.length;o++)this.an(e,s[o]);y.Z(s)}}Dg(t){super.Dg(t);const e=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(e)===null&&this.hn(e,t)}gw(t){super.gw(t);const e=this.getGroupKeyForNodeData(t);this.an(e,t)}get linkCategoryProperty(){return this.cc}set linkCategoryProperty(t){const e=this.cc;e!==t&&(this.Un(t,Ot,"linkCategoryProperty"),this.cc=t,this.t("linkCategoryProperty",e,t))}getCategoryForLinkData(t){if(t===null)return"";const e=this.cc;if(e==="")return"";const i=this.St(t,e);if(i===void 0)return"";if(typeof i=="string")return i;y.o("getCategoryForLinkData found a non-string category for "+t+": "+i)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,e){if(t===null)return;const i=this.cc;if(i==="")return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.St(t,i);s===void 0&&(s=""),s!==e&&(this.et(t,i,e),this.Ft("linkCategory",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}setLinkCategoryForData(t,e){this.setCategoryForLinkData(t,e)}Ag(t,e){super.Ag(t,e),this.setGroupKeyForNodeData(e,this.getGroupKeyForNodeData(t))}tF(t,e){this.setCategoryForLinkData(e,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(e,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(e,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(e,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(e,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(e,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}Um(){return!0}Wh(){return!0}Ax(){return!0}uf(){return!0}static EmptyArray=Object.freeze([])}ht.Sl(Ot,"GraphLinksModel"),ht.jv=()=>new Ot,ht.m2=()=>new Ot;class Ie extends ht{Bn;Fg;fc;constructor(t,e){if(super(),this.Bn="parent",this.Fg=!1,this.fc="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const i=e.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(t){super.cloneProtected(t),t.Bn=this.Bn,t.Fg=this.Fg,t.fc=this.fc}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let e=(this.name!==""?this.name:"")+" TreeModel";if(t>0){e+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];e+=" "+this.getKeyForNodeData(o)+":"+Yt.toString(o)}}return e}}Lg(){const t=super.Lg();let e="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(e+=`,
  "nodeParentKeyProperty": `+this.zi(this.nodeParentKeyProperty)),t+e}fw(t){super.fw(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}uw(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&y.o("applyIncrementalJson cannot change Model properties"),super.uw(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Bn}set nodeParentKeyProperty(t){const e=this.Bn;e!==t&&(this.Un(t,Ie,"nodeParentKeyProperty"),this.Bn=t,this.t("nodeParentKeyProperty",e,t))}get copiesParentKeyOfNodeData(){return this.Fg}set copiesParentKeyOfNodeData(t){this.Fg!==t&&(this.Fg=t)}getParentKeyForNodeData(t){if(t===null)return;const e=this.Bn;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;y.o("ParentKey value for node data "+t+" is not a number or a string: "+i)}}setParentKeyForNodeData(t,e){if(e===null&&(e=void 0),e!==void 0&&!this.isKeyType(e)&&y.si(e,"number or string",Ie,"setParentKeyForNodeData:key"),t===null)return;const i=this.Bn;if(i==="")return;if(e=this.maybeEnsureLinkReference(e),!this.containsNodeData(t)){this.et(t,i,e);return}const s=this.St(t,i);s!==e&&(this.an(s,t),this.et(t,i,e),this.findNodeDataForKey(e)===null&&this.hn(e,t),this.Ft("nodeParentKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}get parentLinkCategoryProperty(){return this.fc}set parentLinkCategoryProperty(t){const e=this.fc;e!==t&&(this.Un(t,Ie,"parentLinkCategoryProperty"),this.fc=t,this.t("parentLinkCategoryProperty",e,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const e=this.fc;if(e==="")return"";const i=this.St(t,e);if(i===void 0)return"";if(typeof i=="string")return i;y.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+i)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,e){if(t===null)return;const i=this.fc;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.St(t,i);s===void 0&&(s=""),s!==e&&(this.et(t,i,e),this.Ft("parentLinkCategory",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}setLinkCategoryForData(t,e){this.setParentLinkCategoryForNodeData(t,e)}copyNodeData(t){const e=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Bn!==""&&this.St(e,this.Bn)!==void 0&&this.et(e,this.Bn,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}else if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}else if(e===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,i);return}else if(e===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,i);return}}const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}dw(t,e){super.dw(t,e);const i=this.be.iterator;for(;i.next();){const s=i.value;this.rL(s,t,e)}}rL(t,e,i){if(this.getParentKeyForNodeData(t)===e){const s=this.Bn;this.et(t,s,i),this.Ft("nodeParentKey",2,s,t,e,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}Tg(t){super.Tg(t);const e=this.getKeyForNodeData(t),i=this.lw(e);if(i!==null){const s=y.nt(),n=i.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)&&this.getParentKeyForNodeData(o)===e){const r=this.Bn;this.Ft("nodeParentKey",2,r,o,e,e),typeof r=="string"&&this.updateTargetBindings(o,r),s.push(o)}}for(let o=0;o<s.length;o++)this.an(e,s[o]);y.Z(s)}}Dg(t){super.Dg(t);let e=this.getParentKeyForNodeData(t);e=this.maybeEnsureLinkReference(e),this.findNodeDataForKey(e)===null&&this.hn(e,t)}gw(t){super.gw(t);const e=this.getParentKeyForNodeData(t);this.an(e,t)}Ag(t,e){super.Ag(t,e),this.setParentLinkCategoryForNodeData(e,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(e,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}Vm(){return!0}Ax(){return!0}}ht.Sl(Ie,"TreeModel");var Ni=(x=>(x[x.ConstantSpacing=0]="ConstantSpacing",x[x.ConstantDistance=1]="ConstantDistance",x[x.ConstantAngle=2]="ConstantAngle",x[x.Packed=3]="Packed",x))(Ni||{}),Ci=(x=>(x[x.Clockwise=10]="Clockwise",x[x.Counterclockwise=11]="Counterclockwise",x[x.BidirectionalLeft=12]="BidirectionalLeft",x[x.BidirectionalRight=13]="BidirectionalRight",x))(Ci||{}),Ti=(x=>(x[x.Forwards=20]="Forwards",x[x.Reverse=21]="Reverse",x[x.Ascending=22]="Ascending",x[x.Descending=23]="Descending",x[x.Optimized=24]="Optimized",x))(Ti||{}),Li=(x=>(x[x.Pythagorean=30]="Pythagorean",x[x.Circular=31]="Circular",x))(Li||{});class en extends Kt{gi;tu;Uk;Rg;Vk;Ya;lL;aL;hL;Es;mw;pw;uc;yw;eF;Og;Ig;Eg;eu;He;P;Si;Mi;En;Ug;constructor(t){super(),this.gi=0,this.tu=0,this.Uk=0,this.Rg=360,this.Vk=0,this.Ya=0,this.lL=new P,this.aL=30,this.hL=0,this.Es=0,this.mw=0,this.pw=new fs,this.uc=0,this.yw=0,this.eF=600,this.Og=NaN,this.Ig=1,this.Eg=0,this.eu=360,this.He=0,this.P=10,this.Si=24,this.Mi=ke.standardComparer,this.En=6,this.Ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Og=this.Og,t.Ig=this.Ig,t.Eg=this.Eg,t.eu=this.eu,t.He=this.He,t.P=this.P,t.Si=this.Si,t.Mi=this.Mi,t.En=this.En,t.Ug=this.Ug}fe(t){t in Ti?this.sorting=t:t in Ci?this.direction=t:t in Ni?this.arrangement=t:t in Li?this.nodeDiameterFormula=t:super.fe(t)}createNetwork(){return new gs(this)}d3(t,e,i){t=this.g3(t);let s=this.Vk,n=this.aL,o=this.gi,r=this.tu,a=this.Uk,l=this.Rg,h=this.Ya,u=this.hL,c=this.Es,d=this.mw;if(s=this.arrangement,n=this.nodeDiameterFormula,o=this.radius,(!isFinite(o)||o<=0)&&(o=NaN),r=this.aspectRatio,(!isFinite(r)||r<=0)&&(r=1),a=this.startAngle,isFinite(a)||(a=0),l=this.sweepAngle,(!isFinite(l)||l>360||l<1)&&(l=360),h=this.spacing,isFinite(h)||(h=NaN),s===3&&n===31?s=0:s===3&&n!==31&&(n=31,s=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let g=0;!(g>=t.length||(e.add(t.elt(g)),g+1>=t.length));g+=2)i.add(t.elt(g+1));this.direction===12?(this.arrangement===3&&e.reverse(),t=new J,t.addAll(e),t.addAll(i)):(this.arrangement===3&&i.reverse(),t=new J,t.addAll(i),t.addAll(e))}const f=t.length;u=0;let m=0;for(let g=0;g<t.length;g++){const p=a+l*m*(this.direction===10?1:-1)/f;let b=t.elt(g).diameter;isNaN(b)&&(b=t.elt(g).Ka(p)),l<360&&(g===0||g===t.length-1)&&(b/=2),u+=b,m++}if(isNaN(o)||s===3){if(isNaN(h)&&(h=6),s!==0&&s!==3){let g=-1/0;for(let p=0;p<f;p++){const b=t.elt(p),v=t.elt(p===f-1?0:p+1);isNaN(b.diameter)&&b.Ka(0),isNaN(v.diameter)&&v.Ka(0),g=Math.max(g,(b.diameter+v.diameter)/2)}if(d=g+h,s===2){const p=2*Math.PI/f,b=(g+h)/p;r>1?(o=b,c=o*r):(c=b,o=c)}else o=this.Bk(d*(l>=360?f:f-1),r,a*Math.PI/180,l*Math.PI/180)}else o=this.Bk(u+(l>=360?f:f-1)*(s!==3?h:h*1.6),r,a*Math.PI/180,l*Math.PI/180);c=o*r}else{c=o*r;const g=this.cL(o,c,a*Math.PI/180,l*Math.PI/180);if(isNaN(h))s===0&&(h=(g-u)/(l>=360?f:f-1));else if(s===0){const p=(g-u)/(l>=360?f:f-1);p<h?(o=this.Bk(u+h*(l>=360?f:f-1),r,a*Math.PI/180,l*Math.PI/180),c=o*r):h=p}else{let p=-1/0;for(let w=0;w<f;w++){const k=t.elt(w),S=t.elt(w===f-1?0:w+1);isNaN(k.diameter)&&k.Ka(0),isNaN(S.diameter)&&S.Ka(0),p=Math.max(p,(k.diameter+S.diameter)/2)}const b=p+h,v=this.Bk(b*(l>=360?f:f-1),r,a*Math.PI/180,l*Math.PI/180);v>o?(o=v,c=o*r,d=b):d=g/(l>=360?f:f-1)}}return this.Vk=s,this.aL=n,this.gi=o,this.tu=r,this.Uk=a,this.Rg=l,this.Ya=h,this.hL=u,this.Es=c,this.mw=d,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.network.vertexes;if(e.count<=1){if(e.count===1){const d=e.first();d.centerX=0,d.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let i=new J;i.addAll(e.iterator);const s=new J,n=new J;i=this.d3(i,s,n);const o=this.Vk,r=this.gi,a=this.Uk,l=this.Rg,h=this.Ya,u=this.Es,c=this.mw;if((this.direction===12||this.direction===13)&&o===3)this.iF(i,l,a-l/2,10);else if(this.direction===12||this.direction===13){let d=0;switch(o){case 1:d=this.zk(r,u,a,c)*180/Math.PI;break;case 0:{let f=0,m=0;const g=s.first();g!==null&&(f=g.Ka(Math.PI/2));const p=n.first();p!==null&&(m=p.Ka(Math.PI/2)),d=this.zk(r,u,a,h+(f+m)/2)*180/Math.PI;break}case 2:d=l/i.length;break}if(this.direction===12){switch(o){case 1:this.ww(s,l/2,a,11);break;case 0:this.xw(s,l/2,a,11);break;case 2:this.bw(s,l/2,a,11);break}switch(o){case 1:this.ww(n,l/2,a+d,10);break;case 0:this.xw(n,l/2,a+d,10);break;case 2:this.bw(n,l/2,a+d,10);break}}else{switch(o){case 1:this.ww(n,l/2,a,11);break;case 0:this.xw(n,l/2,a,11);break;case 2:this.bw(n,l/2,a,11);break}switch(o){case 1:this.ww(s,l/2,a+d,10);break;case 0:this.xw(s,l/2,a+d,10);break;case 2:this.bw(s,l/2,a+d,10);break}}}else switch(o){case 1:this.ww(i,l,a,this.direction);break;case 0:this.xw(i,l,a,this.direction);break;case 2:this.bw(i,l,a,this.direction);break;case 3:this.iF(i,l,a,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}bw(t,e,i,s){const n=this.Rg,o=this.gi,r=this.Es,a=i*Math.PI/180,l=e*Math.PI/180,h=t.length;for(let u=0;u<h;u++){const c=a+(s===10?u*l/(n>=360?h:h-1):-(u*l)/h),d=t.elt(u),f=o*Math.tan(c)/r,m=Math.sqrt((o*o+r*r*f*f)/(1+f*f));d.centerX=m*Math.cos(c),d.centerY=m*Math.sin(c),d.actualAngle=c*180/Math.PI}}xw(t,e,i,s){const n=this.gi,o=this.Es,r=this.Ya;let a=i*Math.PI/180;const l=t.length;for(let h=0;h<l;h++){const u=t.elt(h),c=t.elt(h===l-1?0:h+1),d=n*Math.cos(a),f=o*Math.sin(a);u.centerX=d,u.centerY=f,u.actualAngle=a*180/Math.PI,isNaN(u.diameter)&&u.Ka(0),isNaN(c.diameter)&&c.Ka(0);const m=(u.diameter+c.diameter)/2,g=this.zk(n,o,s===10?a:-a,m+r);a+=s===10?g:-g}}ww(t,e,i,s){const n=this.gi,o=this.Es,r=this.mw;let a=i*Math.PI/180;const l=t.length;for(let h=0;h<l;h++){const u=t.elt(h);u.centerX=n*Math.cos(a),u.centerY=o*Math.sin(a),u.actualAngle=a*180/Math.PI;const c=this.zk(n,o,s===10?a:-a,r);a+=s===10?c:-c}}iF(t,e,i,s){let n=this.yw;const o=this.Rg;if(this.uc=0,this.pw=new fs,e<360){for(n=i+(s===10?o:-o);n<0;)n+=360;n%=360,n>180&&(n-=360),n*=Math.PI/180,this.yw=n,this.sF(t,e,i,s)}else this.nF(t,e,i,s);this.pw.commit(t)}nF(t,e,i,s){const n=this.gi,o=this.Es,r=this.Ya,a=this.tu;let l=n*Math.cos(i*Math.PI/180),h=o*Math.sin(i*Math.PI/180);const u=t.toArray();if(u.length===3){u[0].centerX=n,u[0].centerY=0,u[1].centerX=u[0].centerX-u[0].width/2-u[1].width/2-r,u[1].y=u[0].y,u[2].centerX=(u[0].centerX+u[1].centerX)/2,u[2].y=u[0].y-u[2].height-r;return}else if(u.length===4){u[0].centerX=n,u[0].centerY=0,u[2].centerX=-u[0].centerX,u[2].centerY=u[0].centerY,u[1].centerX=0,u[1].y=Math.min(u[0].y,u[2].y)-u[1].height-r,u[3].centerX=0,u[3].y=Math.max(u[0].y+u[0].height+r,u[2].y+u[2].height+r);return}const c=P.l();for(let k=0;k<u.length&&(u[k].centerX=l,u[k].centerY=h,!(k>=u.length-1));k++)this.oF(l,h,u,k,s,c)||this.rF(l,h,u,k,s,c),l=c.x,h=c.y;if(P.i(c),this.uc++,this.uc>23)return;const d=u[0].centerX,f=u[0].centerY,m=u[u.length-1].centerX,g=u[u.length-1].centerY;let p=Math.abs(d-m)-((u[0].width+u[u.length-1].width)/2+r);const b=Math.abs(f-g)-((u[0].height+u[u.length-1].height)/2+r);let v=0;if(Math.abs(b)<1){const k=Math.abs(d-m),S=(u[0].width+u[u.length-1].width)/2;k<S&&(v=0),p=k-S}else b>0?v=b:Math.abs(p)<1?v=0:v=p;let w=!1;Math.abs(m)>Math.abs(g)?w=m>0!=f>g:w=g>0!=d<m,w=s===10?w:!w,w&&(v=-Math.abs(v),v=Math.min(v,-u[u.length-1].width),v=Math.min(v,-u[u.length-1].height)),this.pw.m3(v,u),Math.abs(v)>1&&(this.uc<8?this.gi-=v/(2*Math.PI):u.length<5&&v>10?this.gi/=2:this.gi-=v>0?1.7:-2.3,this.Es=this.gi*a,this.nF(t,e,i,s))}sF(t,e,i,s){const n=this.gi,o=this.Es,r=this.tu;let a=n*Math.cos(i*Math.PI/180),l=o*Math.sin(i*Math.PI/180);const h=P.l(),u=t.toArray();for(let m=0;m<u.length&&(u[m].centerX=a,u[m].centerY=l,!(m>=u.length-1));m++)this.oF(a,l,u,m,s,h)||this.rF(a,l,u,m,s,h),a=h.x,l=h.y;if(P.i(h),this.uc++,this.uc>23)return;const c=Math.atan2(l,a);let d=s===10?this.yw-c:c-this.yw;d=Math.abs(d)<Math.abs(d-2*Math.PI)?d:d-2*Math.PI;const f=d*(n+o)/2;this.pw.p3(f,u),Math.abs(f)>1&&(this.uc<8?this.gi-=f/(2*Math.PI):this.gi-=f>0?1.7:-2.3,this.Es=this.gi*r,this.sF(t,e,i,s))}oF(t,e,i,s,n,o){const r=this.Ya,a=this.gi,l=this.Es;let h=0,u=0;const c=(i[s].width+i[s+1].width)/2+r;let d=!1;if(e>=0!=(n===10)){if(h=t+c,h>a){if(h=t-c,h<-a)return o.x=h,o.y=u,!1;d=!0}}else if(h=t-c,h<-a){if(h=t+c,h>a)return o.x=h,o.y=u,!1;d=!0}return u=Math.sqrt(1-Math.min(1,h*h/(a*a)))*l,e<0!==d&&(u=-u),Math.abs(e-u)>(i[s].height+i[s+1].height)/2?(o.x=h,o.y=u,!1):(o.x=h,o.y=u,!0)}rF(t,e,i,s,n,o){const r=this.Ya,a=this.gi,l=this.Es;let h=0,u=0;const c=(i[s].height+i[s+1].height)/2+r;let d=!1;if(t>=0!=(n===10)){if(u=e-c,u<-l){if(u=e+c,u>l)return o.x=h,o.y=u,!1;d=!0}}else if(u=e+c,u>l){if(u=e-c,u<-l)return o.x=h,o.y=u,!1;d=!0}return h=Math.sqrt(1-Math.min(1,u*u/(l*l)))*a,t<0!==d&&(h=-h),Math.abs(t-h)>(i[s].width+i[s+1].width)/2?(o.x=h,o.y=u,!1):(o.x=h,o.y=u,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),e=t?this.group.location.copy():null;let i=this.actualCenter;if(t?i=new P(0,0):(i.x=this.arrangementOrigin.x+this.gi,i.y=this.arrangementOrigin.y+this.Es),this.network!==null){const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.x+=i.x,n.y+=i.y,n.commit()}}if(t&&this.group&&e){this.group.ensureBounds();const s=this.group.position.copy(),n=this.group.location.copy(),o=e.subtract(n.subtract(s));this.group.move(o),this.lL=o.subtract(s)}}commitLinks(){if(this.network!==null){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}cL(t,e,i,s){const n=this.eF;if(Math.abs(this.tu-1)<.001)return i!==void 0&&s!==void 0?s*t:2*Math.PI*t;const o=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let r=0,a=0;i!==void 0&&s!==void 0?a=s/(n+1):a=Math.PI/(2*(n+1));let l=0;for(let h=0;h<=n;h++){i!==void 0&&s!==void 0?l=i+h*s/n:l=h*Math.PI/(2*n);const u=Math.sin(l);r+=Math.sqrt(1-o*o*u*u)*a}return i!==void 0&&s!==void 0?(t>e?t:e)*r:4*(t>e?t:e)*r}Bk(t,e,i,s){let n=0;return i!==void 0&&s!==void 0?n=this.cL(1,e,i,s):n=this.cL(1,e),t/n}zk(t,e,i,s){if(Math.abs(this.tu-1)<.001)return s/t;const n=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let o=0;const r=2*Math.PI/(this.network.vertexes.count*700);t>e&&(i+=Math.PI/2);for(let a=0;;a++){const l=i+a*r,h=Math.sin(l);if(o+=(t>e?t:e)*Math.sqrt(1-n*n*h*h)*r,o>=s)return a*r}}g3(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.y3(this.w3(t));default:y.o("Invalid sorting type.")}return t}w3(t){const e=[];for(let s=0;s<t.length;s++)e.push(0);const i=new J;for(let s=0;s<t.length;s++){let n=-1,o=-1;if(s===0)for(let u=0;u<t.length;u++){const c=t.elt(u).edgesCount;c>n&&(n=c,o=u)}else for(let u=0;u<t.length;u++){const c=e[u];c>n&&(n=c,o=u)}i.add(t.elt(o)),e[o]=-1;const r=t.elt(o);let a=0;const l=r.sourceEdges;for(;l.next();){const u=l.value.fromVertex;a=t.indexOf(u),!(a<0)&&e[a]>=0&&e[a]++}const h=r.destinationEdges;for(;h.next();){const u=h.value.toVertex;a=t.indexOf(u),!(a<0)&&e[a]>=0&&e[a]++}}return i}y3(t){const e=[];for(let c=0;c<t.length;c++){const d=t.elt(c);e[c]=[];let f=0;const m=d.destinationEdges;for(;m.next();){const p=m.value.toVertex;f=t.indexOf(p),f!==c&&e[c].indexOf(f)<0&&e[c].push(f)}const g=d.sourceEdges;for(;g.next();){const p=g.value.fromVertex;f=t.indexOf(p),f!==c&&e[c].indexOf(f)<0&&e[c].push(f)}}const i=[];for(let c=0;c<e.length;c++)i[c]=0;const s=[],n=[],o=[],r=[],a=new J;let l=0;for(let c=0;c<e.length;c++){const d=e[c].length;if(d===1){r.push(c);continue}if(d===0){a.add(t.elt(c));continue}if(l===0){s.push(c),l++;continue}let f=1/0,m=1/0,g=-1;const p=[];for(let b=0;b<s.length;b++)e[s[b]].indexOf(s[b===s.length-1?0:b+1])<0&&p.push(b===s.length-1?0:b+1);if(p.length===0)for(let b=0;b<s.length;b++)p.push(b);for(let b=0;b<p.length;b++){const v=p[b],w=this.x3(e[c],n,o,i,v,s);let k=0;for(let S=0;S<e[c].length;S++){const N=e[c][S],D=s.indexOf(N);if(D>=0){const A=Math.abs(v-(D>=v?D+1:D));k+=A<s.length+1-A?A:s.length+1-A}}for(let S=0;S<n.length;S++){let N=i[n[S]],D=i[o[S]];if(N>=v&&N++,D>=v&&D++,N>D){const A=D;D=N,N=A}D-N<(s.length+2)/2==(N<v&&v<=D)&&k++}(w<f||w===f&&k<m)&&(f=w,m=k,g=v)}s.splice(g,0,c);for(let b=0;b<s.length;b++)i[s[b]]=b;for(let b=0;b<e[c].length;b++){const v=e[c][b];s.indexOf(v)>=0&&(n.push(c),o.push(v))}l++}let h=!1;const u=s.length;for(;;){h=!0;for(let c=0;c<r.length;c++){const d=r[c],f=e[d][0],m=s.indexOf(f);if(m>=0){let g=0;for(let p=0;p<e[f].length;p++){const b=e[f][p],v=s.indexOf(b);if(v<0||v===m)continue;const w=v>m?v-m:m-v,k=u-w;g+=v<m!=w>k?1:-1}s.splice(g<0?m:m+1,0,d),r.splice(c,1),c--}else h=!1}if(h)break;s.push(r[0]),r.splice(0,1)}for(let c=0;c<s.length;c++){const d=s[c];a.add(t.elt(d))}return a}x3(t,e,i,s,n,o){let r=0;for(let a=0;a<e.length;a++){const l=e[a],h=i[a],u=s[l],c=s[h];let d=0,f=0;if(u<c?(d=u,f=c):(d=c,f=u),d<n&&n<=f)for(let m=0;m<t.length;m++){const g=t[m];o.indexOf(g)<0||d<s[g]&&s[g]<f||d===s[g]||f===s[g]||r++}else for(let m=0;m<t.length;m++){const g=t[m];o.indexOf(g)<0||!(d<s[g]&&s[g]<f)||d===s[g]||f===s[g]||r++}}return r}get radius(){return this.Og}set radius(t){this.Og!==t&&(t>0||isNaN(t))&&(this.Og=t,this.p())}get aspectRatio(){return this.Ig}set aspectRatio(t){this.Ig!==t&&t>0&&(this.Ig=t,this.p())}get startAngle(){return this.Eg}set startAngle(t){this.Eg!==t&&(this.Eg=t,this.p())}get sweepAngle(){return this.eu}set sweepAngle(t){this.eu!==t&&(t>0&&t<=360?this.eu=t:this.eu=360,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===3||t===0||t===1||t===2)&&(this.He=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(t===10||t===11||t===12||t===13)&&(this.P=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(this.Mi=t,this.p())}get spacing(){return this.En}set spacing(t){this.En!==t&&(this.En=t,this.p())}get nodeDiameterFormula(){return this.Ug}set nodeDiameterFormula(t){this.Ug!==t&&(t===30||t===31)&&(this.Ug=t,this.p())}get actualXRadius(){return this.gi}get actualYRadius(){return this.Es}get actualSpacing(){return this.Ya}get actualCenter(){return this.lL}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}class fs{iu;dc;su;constructor(){this.iu=-1/0,this.dc=null,this.su=null}m3(t,e){if(t>0&&this.iu<0||Math.abs(t)<Math.abs(this.iu)&&!(t<0&&this.iu>0)){this.iu=t,this.dc=[],this.su=[];for(let i=0;i<e.length;i++)this.dc[i]=e[i].bounds.x,this.su[i]=e[i].bounds.y}}p3(t,e){if(Math.abs(t)<Math.abs(this.iu)){this.iu=t,this.dc=[],this.su=[];for(let i=0;i<e.length;i++)this.dc[i]=e[i].bounds.x,this.su[i]=e[i].bounds.y}}commit(t){if(!(this.dc===null||this.su===null))for(let e=0;e<this.dc.length;e++){const i=t.elt(e);i.x=this.dc[e],i.y=this.su[e]}}}class gs extends ve{constructor(t){super(t)}createVertex(){return new ms(this)}createEdge(){return new ps(this)}}class ms extends ke{To;Xk;constructor(t){super(t),this.To=NaN,this.Xk=NaN}Ka(t){const e=this.network;if(e===null)return NaN;const i=e.layout;if(i===null)return NaN;if(i.arrangement===3){if(i.nodeDiameterFormula===31)return this.To=Math.max(this.width,this.height),this.To;{const s=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t));return s===0?this.width:n===0?this.height:(this.To=Math.min(this.height/s,this.width/n),this.To)}}else return i.nodeDiameterFormula===31?(this.To=Math.max(this.width,this.height),this.To):(this.To=Math.sqrt(this.width*this.width+this.height*this.height),this.To)}get diameter(){return this.To}set diameter(t){this.To!==t&&(this.To=t)}get actualAngle(){return this.Xk}set actualAngle(t){this.Xk!==t&&(this.Xk=t)}}class ps extends Re{constructor(t){super(t)}}class sn extends Kt{kw;Ha;Us;Vg;zn;Xi;Bg;zg;Xg;nu;Gg;Yg;ou;ru;lu;au;Kg;Hg;hu;gc;constructor(t){super(),this.kw=0,this.Ha=0,this.Us=new st(100,100).k(),this.Vg=!1,this.zn=!0,this.Xi=!1,this.Bg=100,this.zg=300,this.Xg=1,this.nu=1e3,this.Gg=10,this.Yg=Math,this.ou=.05,this.ru=50,this.lu=150,this.au=0,this.Kg=10,this.Hg=5,this.hu=NaN,this.gc=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Us.h(this.Us),t.Vg=this.Vg,t.zn=this.zn,t.Xi=this.Xi,t.Bg=this.Bg,t.zg=this.zg,t.Xg=this.Xg,t.nu=this.nu,t.Gg=this.Gg,t.Yg=this.Yg,t.ou=this.ou,t.ru=this.ru,t.lu=this.lu,t.au=this.au,t.Kg=this.Kg,t.Hg=this.Hg,t.hu=this.hu,t.gc=this.gc}createNetwork(){return new ys(this)}doLayout(t){this.network=this.makeNetwork(t);let e=this.network.vertexes.iterator;const i=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),e=this.network.vertexes.iterator;e.next();){const n=e.value;n.charge=this.electricalCharge(n),n.mass=this.gravitationalMass(n)}const s=this.network.edges.iterator;for(;s.next();){const n=s.value;n.stiffness=this.springStiffness(n),n.length=this.springLength(n)}if(this.fL(),this.Ha=0,this.needsPrelayout()){const n=this.network,o=n.splitIntoSubNetworks(!1);let r=o.iterator;for(;r.next();){const a=r.value;this.doConnectedSubnetLayout(a)}for(r=o.iterator,this.b3(r,n),r=o.iterator;r.next();){const a=r.value,l=a.vertexes.iterator;for(;l.next();){const u=l.value;n.addVertex(u)}const h=a.edges.iterator;for(;h.next();){const u=h.value;n.addEdge(u)}}}else this.lF(this.network,this.maxIterations);this.updateParts()}this.maxIterations=i,this.isValidLayout=!0}needsPrelayout(){if(this.network===null||this.network.vertexes.count<3)return!1;let t=0,e=0;const i=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;for(;s.next();){const n=s.value,o=n.bounds;if(isNaN(n.x)||isNaN(n.y)||o.intersectsRect(i)&&(t++,t>2))return!0;if(e>10)return!1;e++}return!1}doConnectedSubnetLayout(t){let e=t.vertexes.iterator;for(;e.next();){const a=e.value;a.hierarchicalVertexes.add(a)}let i=t,s=this.hu;if(isNaN(s)&&(s=t.edges.count/t.vertexes.count),s<t.vertexes.count)for(;i.vertexes.count>Math.max(100,Math.sqrt(s*t.vertexes.count));)i=this.coarsenNetwork(i);let n=0;e=i.vertexes.iterator;let o=this.randomNumberGenerator;for(o===null&&(this.randomNumberGenerator=o=new ws(0));e.next();){e.value.idInCluster=n++;const a=10*(o.random()-.5),l=10*(o.random()-.5);this.isFixed(e.value)||(e.value.x=a,e.value.y=l);const h=e.value.hierarchicalVertexes.iterator;for(;h.next();)this.isFixed(h.value)||(h.value.x=a,h.value.y=l)}const r=this.computePairwiseDistances(i);this.k3(i,r,this.maxPrelayoutIterations,t.vertexes.count),this.lF(t,this.maxIterations)}computePairwiseDistances(t){const e=t.vertexes.count,i=new Array(e);for(let r=0;r<e;r++)i[r]=new Array(e).fill(-1),i[r][r]=0;const s=t.vertexes.iterator;let n=new Map,o=[];for(;s.next();){const r=s.value;for(o=[r],n=new Map,n.set(r.idInCluster,0);o.length>0;){const a=o.shift(),l=a.vertexes.iterator;for(;l.next();){const h=l.value;n.has(h.idInCluster)||(n.set(h.idInCluster,n.get(a.idInCluster)+1),o.push(h))}}for(let a=0;a<e;a++){const l=Math.min(i[r.idInCluster][a],i[a][r.idInCluster]),h=n.get(a);(l<0||h<l)&&(i[r.idInCluster][a]=h,i[a][r.idInCluster]=h)}}return i}coarsenNetwork(t){const e=this.createNetwork(),i=new Map;let s=0,n=t.vertexes.iterator;for(;n.next();)n.value.idInCluster=s++;for(n=t.vertexes.iterator;n.next();){const r=n.value;if(i.has(r.idInCluster))continue;let a=Number.MAX_SAFE_INTEGER,l=null;const h=r.vertexes.iterator;for(;h.next();){const c=h.value;i.has(c.idInCluster)||c.hierarchicalVertexes.length<a&&(a=c.hierarchicalVertexes.length,l=c)}const u=e.createVertex();u.hierarchicalVertexes.addAll(r.hierarchicalVertexes),l!=null&&u.hierarchicalVertexes.addAll(l.hierarchicalVertexes),i.set(r.idInCluster,u),l!=null&&i.set(l.idInCluster,u),e.addVertex(u)}const o=t.edges.iterator;for(;o.next();){const r=o.value,a=i.get(r.fromVertex.idInCluster),l=i.get(r.toVertex.idInCluster);if(a===l)continue;const h=e.createEdge();h.fromVertex=a||null,h.toVertex=l||null,e.addEdge(h)}return e}cx(t,e){let i=!0;const s=t.vertexes.iterator;for(;s.next();){const n=s.value;i?(i=!1,e.set(n.bounds)):e.unionRect(n.bounds)}return e}b3(t,e){const i=this.arrangementSpacing,s=t.count;let n=!0,o=0,r=0;const a=y.nt();for(let c=0;c<s+e.vertexes.count+2;c++)a[c]=null;let l=0;t.reset();const h=I.l();let u;for(;t.next();){const c=t.value;if(this.cx(c,h),n)n=!1,o=h.x+h.width/2,r=h.y+h.height/2,a[0]=new P(h.x+h.width+i.width,h.y),a[1]=new P(h.x,h.y+h.height+i.height),l=2;else{const d=this.aF(a,l,o,r,h.width,h.height,i),f=a[d],m=new P(f.x+h.width+i.width,f.y),g=new P(f.x,f.y+h.height+i.height);d+1<l&&a.splice(d+1,0,null),a[d]=m,a[d+1]=g,l++;const p=f.x-h.x,b=f.y-h.y;for(u=c.vertexes.iterator;u.next();){const v=u.value;this.isFixed(v)||(v.centerX+=p,v.centerY+=b)}}}for(I.i(h),u=e.vertexes.iterator;u.next();){const c=u.value,d=c.bounds;if(l<2){o=d.x+d.width/2,r=d.y+d.height/2,a[0]=new P(d.x+d.width+i.width,d.y),a[1]=new P(d.x,d.y+d.height+i.height),l=2;continue}const f=this.aF(a,l,o,r,d.width,d.height,i),m=a[f],g=new P(m.x+d.width+i.width,m.y),p=new P(m.x,m.y+d.height+i.height);f+1<l&&a.splice(f+1,0,null),a[f]=g,a[f+1]=p,l++,this.isFixed(c)||(c.centerX=m.x+c.width/2,c.centerY=m.y+c.height/2)}y.Z(a)}aF(t,e,i,s,n,o,r){let a=9e19,l=-1;t:for(let h=0;h<e;h++){const u=t[h],c=u.x-i,d=u.y-s,f=c*c+d*d;if(f<a){for(let m=h-1;m>=0;m--)if(t[m].y>u.y&&t[m].x-u.x<n+r.width)continue t;for(let m=h+1;m<e;m++)if(t[m].x>u.x&&t[m].y-u.y<o+r.height)continue t;l=h,a=f}}return l}fL(){if(this.network===null||!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;this.addComments(e)}}addComments(t){if(this.network===null)return;const e=t.node;if(e!==null){const i=e.findNodesConnected();for(;i.next();){const s=i.value;if(s.category!=="Comment"||!s.isVisible())continue;let n=this.network.findVertex(s);n===null&&(n=this.network.addNode(s)),n.charge=this.defaultCommentElectricalCharge;let o=null;const r=n.destinationEdges;for(;r.next();){const a=r.value;if(a.toVertex===t){o=a;break}}if(o===null){const a=n.sourceEdges;for(;a.next();){const l=a.value;if(l.fromVertex===t){o=l;break}}}o===null&&(o=this.network.linkVertexes(t,n,null)),o.length=this.defaultCommentSpringLength}}}hF(t,e){const i=t.bounds,s=i.x,n=i.y,o=i.width,r=i.height,a=e.bounds,l=a.x,h=a.y,u=a.width,c=a.height;if(s+o<l)if(n>h+c){const d=s+o-l,f=n-h-c;return L.ix(d*d+f*f)}else if(n+r<h){const d=s+o-l,f=n+r-h;return L.ix(d*d+f*f)}else return l-(s+o);else if(s>l+u)if(n>h+c){const d=s-l-u,f=n-h-c;return L.ix(d*d+f*f)}else if(n+r<h){const d=s-l-u,f=n+r-h;return L.ix(d*d+f*f)}else return s-(l+u);else return n>h+c?n-(h+c):n+r<h?h-(n+r):.1}lF(t,e){const i=this.Ha+e;for(;this.Ha<i&&(this.Ha++,!!this.P3(t)););}P3(t){const e=t.vertexes.toArray();if(e.length<=0)return!1;const i=e[0];i.forceX=0,i.forceY=0;let s=i.centerX,n=s,o=i.centerY,r=o;for(let m=1;m<e.length;m++){const g=e[m];g.forceX=0,g.forceY=0;const p=g.centerX,b=g.centerY;s=Math.min(s,p),n=Math.max(n,p),o=Math.min(o,b),r=Math.max(r,b)}const a=n-s>r-o;a?e.sort((m,g)=>m===null||g===null||m===g?0:m.centerX-g.centerX):e.sort((m,g)=>m===null||g===null||m===g?0:m.centerY-g.centerY);const l=this.nu;let h=0,u=0,c=0;for(let m=0;m<e.length;m++){const g=e[m],p=g.bounds,b=g.focus,v=p.x+b.x,w=p.y+b.y;u=g.charge*this.electricalFieldX(v,w),c=g.charge*this.electricalFieldY(v,w),u+=g.mass*this.gravitationalFieldX(v,w),c+=g.mass*this.gravitationalFieldY(v,w),g.forceX+=u,g.forceY+=c;for(let k=m+1;k<e.length;k++){const S=e[k];if(!this.shouldInteract(g,S)||k===m)continue;const N=S.bounds,D=S.focus,A=N.x+D.x,M=N.y+D.y;if(v-A>l||A-v>l){if(a)break;continue}if(w-M>l||M-w>l){if(!a)break;continue}const C=this.hF(g,S),F=2*g.charge,O=2*S.charge;if(C>1)h=F*O/(C*C),u=h*(v-A)/C,c=h*(w-M)/C;else{let E=this.randomNumberGenerator;E===null&&(this.randomNumberGenerator=E=new ws(0));const B=E.random(),z=E.random();if(v>A)u=Math.abs(S.bounds.right-g.bounds.x),u=F*O*(1+u)*B;else if(v<A)u=Math.abs(S.bounds.x-g.bounds.right),u=-(F*O)*(1+u)*B;else{const V=Math.max(S.width,g.width);u=F*O*((1+V)*B-V/2)}if(w>M)c=Math.abs(S.bounds.bottom-g.bounds.y),c=F*O*(1+c)*z;else if(v<A)c=Math.abs(S.bounds.y-g.bounds.bottom),c=-(F*O)*(1+c)*z;else{const V=Math.max(S.height,g.height);c=F*O*((1+V)*z-V/2)}}g.forceX+=u,g.forceY+=c,S.forceX-=u,S.forceY-=c}}const d=t.edges.iterator;for(;d.next();){const m=d.value,g=m.fromVertex,p=m.toVertex,b=g.bounds,v=g.focus,w=b.x+v.x,k=b.y+v.y,S=p.bounds,N=p.focus,D=S.x+N.x,A=S.y+N.y,M=this.hF(g,p);M>1&&(h=.1*m.stiffness*(M-m.length),u=h*.5*(g.width+p.height)*(w-D)/M,c=h*.5*(g.width+p.height)*(k-A)/M),g.forceX-=u,g.forceY-=c,p.forceX+=u,p.forceY+=c}let f=0;for(let m=0;m<e.length;m++){const g=e[m];this.isFixed(g)?this.moveFixedVertex(g):f=Math.max(f,this.moveVertex(g)||0)}return f>this.epsilonDistance*this.epsilonDistance}k3(t,e,i,s){const n=this.Ha+i,o=Math.sqrt(s);this.kw=this.gc*t.vertexes.count;const r=t.vertexes.toArray();let a=0,l=0,h=0;for(;this.Ha<n;){this.Ha++,l=a,a=0;for(let u=0;u<r.length;u++){r[u].forceX=0,r[u].forceY=0;for(let d=0;d<r.length;d++){if(u===d)continue;const f=Math.sqrt((r[u].centerX-r[d].centerX)**2+(r[u].centerY-r[d].centerY)**2),m=e[r[u].idInCluster][r[d].idInCluster],g=(f-this.gc*o*m)/f;r[u].forceX+=g*(r[d].x-r[u].x),r[u].forceY+=g*(r[d].y-r[u].y)}const c=Math.sqrt(r[u].forceX*r[u].forceX+r[u].forceY*r[u].forceY);if(c>0){r[u].forceX=this.kw*r[u].forceX/c,r[u].forceY=this.kw*r[u].forceY/c,this.isFixed(r[u])||(r[u].x+=r[u].forceX,r[u].y+=r[u].forceY);const d=r[u].hierarchicalVertexes.iterator;for(;d.next();){const f=d.value;this.isFixed(f)||(f.centerX+=r[u].forceX,f.centerY+=r[u].forceY)}}a+=c*c}if(a>=l){if(h++,h>=5)break}else h=0;this.kw*=.95}}moveVertex(t){let e=t.forceX,i=t.forceY;const s=this.moveLimit;return e<-s?e=-s:e>s&&(e=s),i<-s?i=-s:i>s&&(i=s),t.centerX+=e,t.centerY+=i,e*e+i*i}shouldInteract(t,e){return!0}moveFixedVertex(t){}commitLayout(){this.Pw(),this.commitNodes(),this.isRouting&&this.commitLinks()}Pw(){if(this.network===null||!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const e=t.value.link;e!==null&&(e.fromSpot=T.Default,e.toSpot=T.Default)}}commitNodes(){if(!this.network)return;let t=0,e=0;if(this.arrangesToOrigin){const n=I.l();this.cx(this.network,n);const o=this.arrangementOrigin;t=o.x-n.x,e=o.y-n.y,I.i(n)}const i=I.l(),s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;(t!==0||e!==0)&&(i.h(n.bounds),i.x+=t,i.y+=e,n.bounds=i),n.commit()}I.i(i)}commitLinks(){if(!this.network)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const e=t.stiffness;return isNaN(e)?this.ou:e}springLength(t){const e=t.length;return isNaN(e)?this.ru:e}electricalCharge(t){const e=t.charge;return isNaN(e)?this.lu:e}electricalFieldX(t,e){return 0}electricalFieldY(t,e){return 0}gravitationalMass(t){const e=t.mass;return isNaN(e)?this.au:e}gravitationalFieldX(t,e){return 0}gravitationalFieldY(t,e){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Ha}get arrangementSpacing(){return this.Us}set arrangementSpacing(t){this.Us.equals(t)||(this.Us.h(t),this.p())}get arrangesToOrigin(){return this.Vg}set arrangesToOrigin(t){this.Vg!==t&&(this.Vg=t,this.p())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(this.zn=t,this.p())}get comments(){return this.Xi}set comments(t){this.Xi!==t&&(this.Xi=t,this.p())}get maxPrelayoutIterations(){return this.Bg}set maxPrelayoutIterations(t){this.Bg!==t&&t>=0&&(this.Bg=t,this.p())}get maxIterations(){return this.zg}set maxIterations(t){this.zg!==t&&t>=0&&(this.zg=t,this.p())}get epsilonDistance(){return this.Xg}set epsilonDistance(t){this.Xg!==t&&t>0&&(this.Xg=t,this.p())}get infinityDistance(){return this.nu}set infinityDistance(t){this.nu!==t&&t>1&&(this.nu=t,this.p())}get moveLimit(){return this.Gg}set moveLimit(t){this.Gg!==t&&(this.Gg=t,this.p())}get randomNumberGenerator(){return this.Yg}set randomNumberGenerator(t){this.Yg!==t&&(t!==null&&!y.st(t.random)&&y.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Yg=t)}get defaultSpringStiffness(){return this.ou}set defaultSpringStiffness(t){this.ou!==t&&(this.ou=t,this.p())}get defaultSpringLength(){return this.ru}set defaultSpringLength(t){this.ru!==t&&(this.ru=t,this.p())}get defaultElectricalCharge(){return this.lu}set defaultElectricalCharge(t){this.lu!==t&&(this.lu=t,this.p())}get defaultGravitationalMass(){return this.au}set defaultGravitationalMass(t){this.au!==t&&(this.au=t,this.p())}get defaultCommentSpringLength(){return this.Kg}set defaultCommentSpringLength(t){this.Kg!==t&&(this.Kg=t,this.p())}get defaultCommentElectricalCharge(){return this.Hg}set defaultCommentElectricalCharge(t){this.Hg!==t&&(this.Hg=t,this.p())}get prelayoutQuality(){return this.hu}set prelayoutQuality(t){this.hu!==t&&(this.hu=t,this.p())}get prelayoutSpread(){return this.gc}set prelayoutSpread(t){this.gc!==t&&(this.gc=t,this.p())}}class ys extends ve{constructor(t){super(t)}createVertex(){return new xs(this)}createEdge(){return new bs(this)}}class xs extends ke{Gk;Yk;Kk;Hk;jk;hierarchicalVertexes;idInCluster;constructor(t){super(t),this.Gk=!1,this.Yk=NaN,this.Kk=NaN,this.Hk=0,this.jk=0,this.hierarchicalVertexes=new J,this.idInCluster=-1}get isFixed(){return this.Gk}set isFixed(t){this.Gk!==t&&(this.Gk=t)}get charge(){return this.Yk}set charge(t){this.Yk!==t&&(this.Yk=t)}get mass(){return this.Kk}set mass(t){this.Kk!==t&&(this.Kk=t)}get forceX(){return this.Hk}set forceX(t){this.Hk!==t&&(this.Hk=t)}get forceY(){return this.jk}set forceY(t){this.jk!==t&&(this.jk=t)}}class bs extends Re{qk;Wk;constructor(t){super(t),this.qk=NaN,this.Wk=NaN}get stiffness(){return this.qk}set stiffness(t){this.qk!==t&&(this.qk=t)}get length(){return this.Wk}set length(t){this.Wk!==t&&(this.Wk=t)}}class ws{I;R;Q;M;A;seed;constructor(t){t===void 0&&(t=42),this.seed=t,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const t=this.seed/this.Q,e=this.seed%this.Q,i=this.A*e-this.R*t;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var Ai=(x=>(x[x.DepthFirst=0]="DepthFirst",x[x.Greedy=1]="Greedy",x[x.FromLayers=2]="FromLayers",x))(Ai||{}),Di=(x=>(x[x.OptimalLinkLength=10]="OptimalLinkLength",x[x.LongestPathSink=11]="LongestPathSink",x[x.LongestPathSource=12]="LongestPathSource",x))(Di||{}),Fi=(x=>(x[x.DepthFirstOut=20]="DepthFirstOut",x[x.DepthFirstIn=21]="DepthFirstIn",x[x.Naive=22]="Naive",x))(Fi||{}),Oi=(x=>(x[x.None=30]="None",x[x.Less=31]="Less",x[x.More=32]="More",x))(Oi||{}),vs=(x=>(x[x.None=0]="None",x[x.Expand=1]="Expand",x[x.Straighten=2]="Straighten",x[x.Median=4]="Median",x[x.MaybeExpand=8]="MaybeExpand",x[x.All=15]="All",x))(vs||{}),ks=(x=>(x[x.None=0]="None",x[x.UpperLeft=1]="UpperLeft",x[x.UpperRight=2]="UpperRight",x[x.LowerLeft=4]="LowerLeft",x[x.LowerRight=8]="LowerRight",x[x.All=15]="All",x))(ks||{});class nn extends Kt{Vs;ti;P;cu;fu;uu;mc;du;cr;gu;zn;_;Sw;Bt;jg;Bs;ie;zs;ms;ps;Rt;qg;Wg;Jk;fn;mu;fr;Xn;Gn;uL;ja;constructor(t){super(),this.Vs=25,this.ti=25,this.P=0,this.cu=0,this.fu=10,this.uu=20,this.mc=4,this.du=31,this.cr=15,this.gu=10,this.zn=!0,this._=-1,this.Sw=-1,this.Bt=-1,this.jg=0,this.Bs=0,this.ie=new Int16Array(0),this.zs=new Float32Array(0),this.ms=new Float32Array(0),this.ps=new Float32Array(0),this.Rt=new Float32Array(0),this.qg=0,this.Wg=new Int16Array(0),this.Jk=new Int16Array(0),this.fn=0,this.mu=null,this.fr=new P,this.Xn=[],this.Xn.length=100,this.Gn=15,this.uL=0,this.ja=!0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Vs=this.Vs,t.ti=this.ti,t.P=this.P,t.cu=this.cu,t.fu=this.fu,t.uu=this.uu,t.mc=this.mc,t.du=this.du,t.cr=this.cr,t.gu=this.gu,t.zn=this.zn,t.Gn=this.Gn,t.ja=this.ja}fe(t){t in Oi?this.aggressiveOption=t:t in Ai?this.cycleRemoveOption=t:t in Fi?this.initializeOption=t:t in Di?this.layeringOption=t:super.fe(t)}createNetwork(){return new Ps(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.S3(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.M3(),this.cycleRemoveOption===2&&this.removeCycles(),this.N3(),this.C3(),this.L3(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const e=t.fromVertex.node||t.fromVertex.data,i=t.toVertex.node||t.toVertex.data;return e===null&&i===null?8:e===null||i===null?4:1}nodeMinLayerSpace(t,e){return t.node===null&&t.data===null?0:this.P===90||this.P===270?e?t.focus.y+10:t.bounds.height-t.focus.y+10:e?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,e){if(t.node===null&&t.data===null)return 0;const i=e?t.$k:t.Zk;if(i!==null)return i;const s=this.P;return s===90||s===270?e?t.$k=t.focus.x/this.ti+1|0:t.Zk=(t.bounds.width-t.focus.x)/this.ti+1|0:e?t.$k=t.focus.y/this.ti+1|0:t.Zk=(t.bounds.height-t.focus.y)/this.ti+1|0}ei(){const t=this.network.vertexes.count;this.Wg.length<t*2&&(this.Wg=new Int16Array(t*2));let e=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;this.Wg[e]=s.column,e++,this.Wg[e]=s.index,e++}return this.Wg}os(t){let e=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.column=t[e],e++,s.index=t[e],e++}}cF(t,e){const i=this.qa(t),s=this.ie[t];this.Jk.length<s*s&&(this.Jk=new Int16Array(s*s));const n=this.Jk;for(let o=0;o<s;o++){let r=0;const a=i[o],l=a.near;let h=0;l!==null&&l!==a&&l.layer===a.layer&&(r+=Math.max(0,Math.abs(l.index-a.index)-1));let u,c=0,d,f=0,m=0,g=0,p,b=0,v,w=0,k=0,S=0,N;if(e>=0){for(u=i[o].Mo,c=0;c<u.length;c++)if(d=u[c],d.valid&&d.fromVertex.layer!==t)for(f=d.fromVertex.index,m=d.portToPos,g=d.portFromPos,b=c+1;b<u.length;b++)v=u[b],v.valid&&v.fromVertex.layer!==t&&(w=v.fromVertex.index,k=v.portToPos,S=v.portFromPos,m<k&&(f>w||f===w&&g>S)&&r++,k<m&&(w>f||w===f&&S>g)&&r++)}if(e<=0){for(u=i[o].rr,c=0;c<u.length;c++)if(d=u[c],d.valid&&d.toVertex.layer!==t)for(f=d.toVertex.index,m=d.portToPos,g=d.portFromPos,b=c+1;b<u.length;b++)v=u[b],v.valid&&v.toVertex.layer!==t&&(w=v.toVertex.index,k=v.portToPos,S=v.portFromPos,g<S&&(f>w||f===w&&m>k)&&r++,S<g&&(w>f||w===f&&k>m)&&r++)}for(n[o*s+o]=r,h=o+1;h<s;h++){let D=0,A=0;if(e>=0){for(p=i[o].Mo,N=i[h].Mo,c=0;c<p.length;c++)if(d=p[c],d.valid&&d.fromVertex.layer!==t)for(f=d.fromVertex.index,m=d.portToPos,g=d.portFromPos,b=0;b<N.length;b++)v=N[b],v.valid&&v.fromVertex.layer!==t&&(w=v.fromVertex.index,k=v.portToPos,S=v.portFromPos,(f<w||f===w&&g<S)&&A++,(w<f||w===f&&S<g)&&D++)}if(e<=0){for(p=i[o].rr,N=i[h].rr,c=0;c<p.length;c++)if(d=p[c],d.valid&&d.toVertex.layer!==t)for(f=d.toVertex.index,m=d.portToPos,g=d.portFromPos,b=0;b<N.length;b++)v=N[b],v.valid&&v.toVertex.layer!==t&&(w=v.toVertex.index,k=v.portToPos,S=v.portFromPos,(f<w||f===w&&m<k)&&A++,(w<f||w===f&&k<m)&&D++)}n[o*s+h]=D,n[h*s+o]=A}}return this.Wa(t,i),n}countCrossings(){let t=0;for(let e=0;e<=this._;e++){const i=this.cF(e,1),s=this.ie[e];for(let n=0;n<s;n++)for(let o=n;o<s;o++)t+=i[n*s+o]}return t}A3(t,e,i){const s=this.qa(t),n=this.ie[t];let o=0;for(let r=0;r<n;r++){let a=null;e<=0&&(a=s[r].Mo);let l=null;e>=0&&(l=s[r].rr);let h,u=0,c=0;if(a!==null)for(let d=0;d<a.length;d++)h=a[d],h.valid&&h.fromVertex.layer!==t&&(u=h.fromVertex.column+h.portFromColOffset,c=h.toVertex.column+h.portToColOffset,i?o+=Math.abs(u-c)*this.linkStraightenWeight(h):o+=Math.abs(u-c));if(l!==null)for(let d=0;d<l.length;d++)h=l[d],h.valid&&h.toVertex.layer!==t&&(u=h.fromVertex.column+h.portFromColOffset,c=h.toVertex.column+h.portToColOffset,i?o+=(Math.abs(u-c)+1)*this.linkStraightenWeight(h):o+=Math.abs(u-c))}return this.Wa(t,s),o}Qk(t){let e=0;for(let i=0;i<=this._;i++)e+=this.A3(i,1,t);return e}Mw(){let t=1/0;this.Bt=-1;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;t=Math.min(t,i.column-this.nodeMinColumnSpace(i,!0)),this.Bt=Math.max(this.Bt,i.column+this.nodeMinColumnSpace(i,!1))}for(e.reset();e.next();){const i=e.value;i.column-=t}this.Bt-=t}Nw(t,e){const i=this.qa(t),s=this.ie[t],n=new Float32Array(s);for(let o=0;o<s;o++){const r=i[o];let a=null;e<=0&&(a=r.Mo);let l=null;e>=0&&(l=r.rr);let h=0,u=0;const c=r.near;c!==null&&c.layer===r.layer&&(h+=c.column-1,u++);let d;if(a!==null)for(let f=0;f<a.length;f++){d=a[f];const m=d.fromVertex;d.valid&&!d.rev&&m.layer!==t&&(h+=m.column,u++)}if(l!==null)for(let f=0;f<l.length;f++){d=l[f];const m=d.toVertex;d.valid&&!d.rev&&m.layer!==t&&(h+=m.column,u++)}u===0?n[o]=-1:n[o]=h/u}return this.Wa(t,i),n}fF(t,e){const i=this.qa(t),s=this.ie[t],n=new Int16Array(s);for(let o=0;o<s;o++){const r=i[o];let a=null;e<=0&&(a=r.Mo);let l=null;e>=0&&(l=r.rr);let h=0;const u=[],c=r.near;c!==null&&c.layer===r.layer&&(u[h]=c.column-1,h++);let d;if(a!==null)for(let f=0;f<a.length;f++){d=a[f];const m=d.fromVertex;d.valid&&!d.rev&&m.layer!==t&&(u[h]=m.column+d.portFromColOffset,h++)}if(l!==null)for(let f=0;f<l.length;f++){d=l[f];const m=d.toVertex;d.valid&&!d.rev&&m.layer!==t&&(u[h]=m.column+d.portToColOffset,h++)}if(h===0)n[o]=-1;else{u.sort((m,g)=>m-g);const f=h>>1;(h&1)!==0?n[o]=u[f]:n[o]=u[f-1]+u[f]>>1}}return this.Wa(t,i),n}Cw(t,e,i,s,n){if(t.component===i){t.component=e;let o=0,r=0;if(s){const a=t.destinationEdges;for(;a.next();){const l=a.value,h=l.toVertex;o=t.layer-h.layer,r=this.linkMinLength(l),o===r&&this.Cw(h,e,i,s,n)}}if(n){const a=t.sourceEdges;for(;a.next();){const l=a.value,h=l.fromVertex;o=h.layer-t.layer,r=this.linkMinLength(l),o===r&&this.Cw(h,e,i,s,n)}}}}dL(t,e,i,s,n){if(t.component===i){if(t.component=e,s){const o=t.destinationEdges;for(;o.next();){const r=o.value.toVertex;this.dL(r,e,i,s,n)}}if(n){const o=t.sourceEdges;for(;o.next();){const r=o.value.fromVertex;this.dL(r,e,i,s,n)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const e=t.value;e.rev=!1}switch(this.cu){default:case 1:this.T3();break;case 0:this.D3();break;case 2:this.v3();break}}v3(){const t=this.network,e=t.vertexes.iterator;let i=1/0;for(;e.next();){const s=e.value;i=Math.min(i,s.layer)}if(i<1/0){if(i<0)for(e.reset();e.next();){const r=e.value;r.layer-=i}const s=[];for(e.reset();e.next();){const r=e.value,a=s[r.layer];a===void 0?s[r.layer]=[r]:a.push(r)}let n=0;for(let r=0;r<s.length;r++){const a=s[r];if(!a||a.length===0)n++;else if(r>0)for(let l=0;l<a.length;l++){const h=a[l];h.layer-=n}}const o=t.edges.iterator;for(;o.next();){const r=o.value,a=r.fromVertex,l=r.toVertex;a.layer<l.layer&&(t.reverseEdge(r),r.rev=!0)}}}T3(){const t=this.network;let e=0,i=t.vertexes.count-1;const s=[];s.length=i+1;const n=t.vertexes.iterator;for(;n.next();){const r=n.value;r.ii=!0}for(;this.F3(t)!==null;){let r;for(r=this.uF(t);r!==null;)s[i]=r,i--,r.ii=!1,r=this.uF(t);for(r=this.dF(t);r!==null;)s[e]=r,e++,r.ii=!1,r=this.dF(t);r=this.R3(t),r!==null&&(s[e]=r,e++,r.ii=!1)}for(let r=0;r<t.vertexes.count;r++)s[r].index=r;const o=t.edges.iterator;for(;o.next();){const r=o.value,a=r.fromVertex,l=r.toVertex;a.index>l.index&&(t.reverseEdge(r),r.rev=!0)}}F3(t){const e=t.vertexes.iterator;for(;e.next();){const i=e.value;if(i.ii)return i}return null}uF(t){const e=t.vertexes.iterator;for(;e.next();){const i=e.value;if(i.ii){let s=!0;const n=i.destinationEdges;for(;n.next();)if(n.value.toVertex.ii){s=!1;break}if(s)return i}}return null}dF(t){const e=t.vertexes.iterator;for(;e.next();){const i=e.value;if(i.ii){let s=!0;const n=i.sourceEdges;for(;n.next();)if(n.value.fromVertex.ii){s=!1;break}if(s)return i}}return null}R3(t){let e=null,i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;if(n.ii){let o=0;const r=n.destinationEdges;for(;r.next();)r.value.toVertex.ii&&o++;let a=0;const l=n.sourceEdges;for(;l.next();)l.value.fromVertex.ii&&a++;(e===null||i<o-a)&&(e=n,i=o-a)}}return e}D3(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.pu=-1,i.to=-1}const e=this.network.edges.iterator;for(;e.next();){const i=e.value;i.forest=!1}for(this.qg=0,t.reset();t.next();){const i=t.value;i.sourceEdges.count===0&&this.gL(i)}for(t.reset();t.next();){const i=t.value;i.pu===-1&&this.gL(i)}for(e.reset();e.next();){const i=e.value;if(!i.forest){const s=i.fromVertex,n=s.pu,o=s.to,r=i.toVertex,a=r.pu,l=r.to;a<n&&o<l&&(this.network.reverseEdge(i),i.rev=!0)}}}gL(t){t.pu=this.qg,this.qg++;const e=t.destinationEdges;for(;e.next();){const i=e.value,s=i.toVertex;s.pu===-1&&(i.forest=!0,this.gL(s))}t.to=this.qg,this.qg++}M3(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.layer=-1}for(this._=-1,this.assignLayers(),t.reset();t.next();){const s=t.value;this._=Math.max(this._,s.layer)}this._>=9999&&y.o("LayeredDigraphLayout, too many layers: "+this._);const e=this.direction==0||this.direction==180,i=[];for(const s=this.network.vertexes.iterator;s.next();){const n=s.value;if(n.node===null||n.centered)continue;const o=n.layer;let r=i[o];r===void 0&&(r=0);const a=e?n.width:n.height;a>r&&(i[o]=a)}for(const s=this.network.vertexes.iterator;s.next();){const n=s.value;if(n.node===null||n.centered)continue;const o=i[n.layer];e?(n.focusX=o/2,n.focusY=n.focus.y,n.width=o):(n.focusX=n.focus.x,n.focusY=o/2,n.height=o)}}assignLayers(){switch(this.fu){case 11:this.gF();break;case 12:this.O3();break;default:case 10:this.I3();break}}gF(){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value,i=this.mF(e);this._=Math.max(i,this._)}}mF(t){let e=0;if(t.layer===-1){const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex,o=this.linkMinLength(s);e=Math.max(e,this.mF(n)+o)}t.layer=e}else e=t.layer;return e}O3(){let t=0;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;t=this.pF(i),this._=Math.max(t,this._)}for(e.reset();e.next();){const i=e.value;i.layer=this._-i.layer}}pF(t){let e=0;if(t.layer===-1){const i=t.sourceEdges;for(;i.next();){const s=i.value,n=s.fromVertex,o=this.linkMinLength(s);e=Math.max(e,this.pF(n)+o)}t.layer=e}else e=t.layer;return e}I3(){this.gF();const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.ii=!1}for(t.reset();t.next();){const i=t.value;i.sourceEdges.count===0&&this.yF(i)}let e=1/0;for(t.reset();t.next();){const i=t.value;e=Math.min(e,i.layer)}for(this._=-1,t.reset();t.next();){const i=t.value;i.layer-=e,this._=Math.max(this._,i.layer)}}yF(t){if(!t.ii){t.ii=!0;const e=t.destinationEdges;for(;e.next();){const i=e.value.toVertex;this.yF(i)}this.E3(t),this.U3(t)}}E3(t){const e=this.network.vertexes.iterator;for(;e.next();){const r=e.value;r.component=-1}const i=0,s=1,n=t.Mo;let o=n.length;for(let r=0;r<o;r++){const a=n[r],l=a.fromVertex,h=a.toVertex,u=this.linkMinLength(a);l.layer-h.layer>u&&this.Cw(l,i,-1,!0,!1)}for(this.Cw(t,s,-1,!0,!0);t.component!==i;){let r=0,a=1/0,l=0,h=null;const u=this.network.vertexes.iterator;for(;u.next();){const c=u.value;if(c.component===s){let d=0,f=!1;const m=c.Mo;o=m.length;for(let p=0;p<o;p++){const b=m[p],v=b.fromVertex;if(d+=this.linkLengthWeight(b),v.component!==s){r+=this.linkLengthWeight(b);const w=v.layer-c.layer,k=this.linkMinLength(b);a=Math.min(a,w-k)}}const g=c.rr;o=g.length;for(let p=0;p<o;p++){const b=g[p],v=b.toVertex;d-=this.linkLengthWeight(b),v.component!==s?r-=this.linkLengthWeight(b):f=!0}(h===null||d<l)&&!f&&(h=c,l=d)}}if(r>0){for(e.reset();e.next();){const c=e.value;c.component===s&&(c.layer+=a)}t.component=i}else h.component=i}}U3(t){const e=this.network.vertexes.iterator;for(;e.next();){const n=e.value;n.component=-1}const i=0,s=1;for(this.Cw(t,s,-1,!0,!1);t.component!==i;){let n=0,o=1/0,r=0,a=null;const l=this.network.vertexes.iterator;for(;l.next();){const h=l.value;if(h.component===s){let u=0,c=!1;const d=h.Mo;let f=d.length;for(let g=0;g<f;g++){const p=d[g],b=p.fromVertex;u+=this.linkLengthWeight(p),b.component!==s?n+=this.linkLengthWeight(p):c=!0}const m=h.rr;f=m.length;for(let g=0;g<f;g++){const p=m[g],b=p.toVertex;if(u-=this.linkLengthWeight(p),b.component!==s){n-=this.linkLengthWeight(p);const v=h.layer-b.layer,w=this.linkMinLength(p);o=Math.min(o,v-w)}}(a===null||u>r)&&!c&&(a=h,r=u)}}if(n<0){for(e.reset();e.next();){const h=e.value;h.component===s&&(h.layer-=o)}t.component=i}else a.component=i}}N3(){const t=this.network,e=[],i=t.edges.iterator;for(;i.next();){const s=i.value;s.valid=!1,e.push(s)}for(let s=0;s<e.length;s++){const n=e[s];let o=n.fromVertex;const r=n.toVertex;if(n.valid||(o.node===null&&o.data===null||r.node===null&&r.data===null)&&o.layer===r.layer)continue;let a=0,l=0,h=0,u=0;if(n.link!==null){const S=n.link;if(S===null)continue;const N=o.node,D=r.node;if(N===null||D===null)continue;let A=S.fromNode,M=S.toNode,C=S.fromPort;for(;C!==null&&!C.isVisibleObject();)C=C.panel;let F=S.toPort;for(;F!==null&&!F.isVisibleObject();)F=F.panel;if(n.rev){const _=A,nt=C;A=M,C=F,M=_,F=nt}const O=o.focus,E=r.focus,B=n.rev?r.bounds:o.bounds,z=P.l();N!==A?B.isReal()&&A.isVisible()?A.actualBounds.isReal()?(A.getRelativePoint(C,T.Center,z),z.x+=A.actualBounds.x-B.x,z.y+=A.actualBounds.y-B.y):(A.getRelativePoint(C,T.Center,z),z.isReal()||z.h(O)):z.h(O):B.isReal()?(A.getRelativePoint(C,T.Center,z),z.isReal()||z.h(O)):z.h(O);const V=n.rev?o.bounds:r.bounds,Y=P.l();D!==M?V.isReal()&&M.isVisible()?M.actualBounds.isReal()?(M.getRelativePoint(F,T.Center,Y),Y.x+=M.actualBounds.x-V.x,Y.y+=M.actualBounds.y-V.y):(M.getRelativePoint(F,T.Center,Y),Y.isReal()||Y.h(E)):Y.h(E):V.isReal()?(M.getRelativePoint(F,T.Center,Y),Y.isReal()||Y.h(E)):Y.h(E),this.P===90||this.P===270?(a=Math.round((z.x-O.x)/this.ti),h=z.x,l=Math.round((Y.x-E.x)/this.ti),u=Y.x):(a=Math.round((z.y-O.y)/this.ti),h=z.y,l=Math.round((Y.y-E.y)/this.ti),u=Y.y),P.i(z),P.i(Y),n.portFromColOffset=a,n.portFromPos=h,n.portToColOffset=l,n.portToPos=u}else n.portFromColOffset=0,n.portFromPos=0,n.portToColOffset=0,n.portToPos=0;let c=o.layer;const d=r.layer,f=this.V3(n),m=f===1||f===3,g=f===2||f===3;let p,b,v=null,w;g&&(v=this.B3(o,r),w=1,b=t.createVertex(),b.node=null,b._k=1,b.layer=c,b.near=o,t.addVertex(b),p=t.linkVertexes(o,b,n.link),p.valid=!1,p.rev=n.rev,p.portFromColOffset=a,p.portToColOffset=0,p.portFromPos=h,p.portToPos=0,o=b);let k=1;if(m&&k--,c-d>k&&c>0){for(n.valid=!1,b=t.createVertex(),b.node=null,b._k=2,b.layer=c-1,v&&w<v.length&&b.layer===v[w].layer&&(b.near=v[w++]),t.addVertex(b),p=t.linkVertexes(o,b,n.link),p.valid=!0,p.rev=n.rev,p.portFromColOffset=g?0:a,p.portToColOffset=0,p.portFromPos=g?0:h,p.portToPos=0,o=b,c--;c-d>k&&c>0;)b=t.createVertex(),b.node=null,b._k=3,b.layer=c-1,v&&w<v.length&&b.layer===v[w].layer&&(b.near=v[w++]),t.addVertex(b),p=t.linkVertexes(o,b,n.link),p.valid=!0,p.rev=n.rev,p.portFromColOffset=0,p.portToColOffset=0,p.portFromPos=0,p.portToPos=0,o=b,c--;p=t.linkVertexes(b,r,n.link),p.valid=!m,m&&(b.near=r),p.rev=n.rev,p.portFromColOffset=0,p.portToColOffset=l,p.portFromPos=0,p.portToPos=u}else n.valid=!0}}V3(t){let e=0;const i=t.link;if(i!==null){const s=i.fromPort,n=i.toPort;if(s!==null&&n!==null){const o=i.fromNode,r=i.toNode;if(o!==null&&r!==null){const a=this.tP(!0),l=this.tP(!1),h=this.setsPortSpots?a:i.computeSpot(!0,s),u=this.setsPortSpots?l:i.computeSpot(!1,n),c=i.isOrthogonal;if(h.isSide()&&h.includesSide(l)&&u.isSide()&&u.includesSide(a))return 0;const d=i.getLinkPoint(o,s,h,!0,c,r,n,P.l()),f=i.getLinkDirection(o,s,d,h,!0,c,r,n);P.i(d),(!h.isNone()&&f===this.wF(t,!0)||this.setsPortSpots&&o!==null&&o.ports.count===1&&t.rev)&&(e+=1);const m=i.getLinkPoint(r,n,u,!1,c,o,s,P.l()),g=i.getLinkDirection(r,n,m,u,!1,c,o,s);P.i(m),(!u.isNone()&&g===this.wF(t,!1)||this.setsPortSpots&&r!==null&&r.ports.count===1&&t.rev)&&(e+=2)}}}return e}wF(t,e){return this.P===90?e&&!t.rev||!e&&t.rev?270:90:this.P===180?e&&!t.rev||!e&&t.rev?0:180:this.P===270?e&&!t.rev||!e&&t.rev?90:270:e&&!t.rev||!e&&t.rev?180:0}B3(t,e){const i=[];return i.push(e),this.xF(t,i)?i.reverse():[]}xF(t,e){const i=e[e.length-1].sourceEdges.iterator;for(;i.next();){const s=i.value;if(s.rev||!s.valid)continue;const n=s.fromVertex;if(e.push(n),n===t||this.xF(t,e))return!0;e.pop()}return!1}C3(){this.ie.length!==this._+1&&(this.ie=new Int16Array(this._+1));const t=this.ie;for(let i=0;i<=this._;i++)t[i]=0;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;i.index=-1}this.initializeIndices(),this.Sw=-1,this.jg=0,this.Bs=0;for(let i=0;i<=this._;i++)t[i]>t[this.Bs]&&(this.Sw=t[i]-1,this.Bs=i),t[i]<t[this.jg]&&(this.jg=i);this.mu=[];for(let i=0;i<t.length;i++)this.mu[i]=[];for(e.reset();e.next();){const i=e.value,s=i.layer,n=this.mu[s];n[i.index]=i}}initializeIndices(){switch(this.uu){default:case 22:this.z3();break;case 20:this.X3();break;case 21:this.G3();break}}z3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(t===null&&(t=new Map),i.layer===i.near.layer)){const s=t.get(i.near)||[];s.push(i),t.set(i.near,s)}}for(e.reset();e.next();){const i=e.value;if(i.near)continue;const s=i.layer;if(i.index=this.ie[s],this.ie[s]++,!t)continue;const n=t.get(i);Array.isArray(n)&&n.forEach(o=>{o.index=this.ie[s],this.ie[s]++})}}X3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(t===null&&(t=new Map),i.layer===i.near.layer)){const s=t.get(i.near)||[];s.push(i),t.set(i.near,s)}}for(let i=this._;i>=0;i--)for(e.reset();e.next();){const s=e.value;s.layer===i&&s.index===-1&&this.bF(s,t)}}bF(t,e){if(t.near)return;const i=t.layer;if(t.index=this.ie[i],this.ie[i]++,e){const o=e.get(t);Array.isArray(o)&&o.forEach(r=>{r.index=this.ie[i],this.ie[i]++})}const s=t.rr;let n=!0;for(;n;){n=!1;for(let o=0;o<s.length-1;o++){const r=s[o],a=s[o+1];r.portFromColOffset>a.portFromColOffset&&(n=!0,s[o]=a,s[o+1]=r)}}for(let o=0;o<s.length;o++){const r=s[o];if(r.valid){const a=r.toVertex;a.index===-1&&this.bF(a,e)}}}G3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(t===null&&(t=new Map),i.layer===i.near.layer)){const s=t.get(i.near)||[];s.push(i),t.set(i.near,s)}}for(let i=0;i<=this._;i++)for(e.reset();e.next();){const s=e.value;s.layer===i&&s.index===-1&&this.kF(s,t)}}kF(t,e){if(t.near)return;const i=t.layer;if(t.index=this.ie[i],this.ie[i]++,e){const l=e.get(t);Array.isArray(l)&&l.forEach(h=>{h.index=this.ie[i],this.ie[i]++})}const s=t.Mo;let n=!0,o=0;for(;n;)for(n=!1,o=0;o<s.length-1;o++){const l=s[o],h=s[o+1];l.portToColOffset>h.portToColOffset&&(n=!0,s[o]=h,s[o+1]=l)}let r,a;for(o=0;o<s.length;o++)a=s[o],a.valid&&(r=a.fromVertex,r.index===-1&&this.kF(r,e))}L3(){this.Bt=-1;for(let t=0;t<=this._;t++){const e=this.qa(t);let i=0;const s=this.ie[t];for(let n=0;n<s;n++){const o=e[n];i+=this.nodeMinColumnSpace(o,!0),o.column=i,i+=1,i+=this.nodeMinColumnSpace(o,!1)}this.Bt=Math.max(this.Bt,i-1),this.Wa(t,e)}}reduceCrossings(){let t=this.countCrossings(),e=this.ei(),i=0,s=0,n=0;for(i=0;i<this.mc;i++){for(s=0;s<=this._;s++)this.eP(s,1),this.ys(s,1,!1,1);for(n=this.countCrossings(),n<t&&(t=n,e=this.ei()),s=this._;s>=0;s--)this.eP(s,-1),this.ys(s,-1,!1,-1);n=this.countCrossings(),n<t&&(t=n,e=this.ei())}for(this.os(e),i=0;i<this.mc;i++){for(s=0;s<=this._;s++)this.eP(s,0),this.ys(s,0,!1,0);for(n=this.countCrossings(),n<t&&(t=n,e=this.ei()),s=this._;s>=0;s--)this.eP(s,0),this.ys(s,0,!1,0);n=this.countCrossings(),n<t&&(t=n,e=this.ei())}this.os(e);let o=!1,r=0,a=0,l=0,h=0;switch(this.du){case 30:break;case 32:for(l=t+1;(h=this.countCrossings())<l;)for(l=h,r=this._;r>=0;r--)for(a=0;a<=r;a++){for(o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,1,!1,1)||o;for(n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,-1,!1,-1)||o;for(n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,0,!1,0)||o;for(n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,0,!1,0)||o;n>=t?this.os(e):(t=n,e=this.ei())}break;default:case 31:for(r=this._,a=0,l=t+1;(h=this.countCrossings())<l;){for(l=h,o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,1,!1,1)||o;for(n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,-1,!1,-1)||o;for(n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,0,!1,0)||o;for(n>=t?this.os(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,0,!1,0)||o;n>=t?this.os(e):(t=n,e=this.ei())}break}this.os(e)}eP(t,e){let i=0,s=!1;const n=this.qa(t),o=this.ie[t],r=this.fF(t,e),a=this.Nw(t,e);for(i=0;i<o;i++)a[i]===-1&&(a[i]=n[i].column),r[i]===-1&&(r[i]=n[i].column);let l=!0,h;for(;l;)for(l=!1,i=0;i<o-1;i++)if(r[i+1]<r[i]||r[i+1]===r[i]&&a[i+1]<a[i]){s=!0,l=!0;const c=r[i];r[i]=r[i+1],r[i+1]=c;const d=a[i];a[i]=a[i+1],a[i+1]=d,h=n[i],n[i]=n[i+1],n[i+1]=h}let u=0;for(i=0;i<o;i++)h=n[i],h.index=i,u+=this.nodeMinColumnSpace(h,!0),h.column=u,u+=1,u+=this.nodeMinColumnSpace(h,!1);return this.Wa(t,n),s}ys(t,e,i,s){const n=this.qa(t),o=this.ie[t],r=this.cF(t,e);let a=0,l;if(!i||s>0)for(l=new Float32Array(o),a=0;a<o;a++)l[a]=-1;else l=this.Nw(t,-1);let h;if(!i||s<0)for(h=new Float32Array(o),a=0;a<o;a++)h[a]=-1;else h=this.Nw(t,1);let u=!1,c=!0;for(;c;)for(c=!1,a=0;a<o-1;a++){const d=r[n[a].index*o+n[a+1].index],f=r[n[a+1].index*o+n[a].index];let m=0,g=0;const p=n[a].column,b=n[a+1].column,v=this.nodeMinColumnSpace(n[a],!0),w=this.nodeMinColumnSpace(n[a],!1),k=this.nodeMinColumnSpace(n[a+1],!0),S=this.nodeMinColumnSpace(n[a+1],!1),N=p-v+k,D=b-w+S;let A=0,M=0,C=0,F=0,O=0,E=0,B=0,z,V=0,Y,_=0;const nt=n[a].sourceEdges.iterator;if(i&&s<=0)for(;nt.next();){const mt=nt.value;z=mt.fromVertex,mt.valid&&z.layer!==t&&(C=this.linkStraightenWeight(mt),F=mt.portFromColOffset,O=mt.portToColOffset,E=z.column,A+=(Math.abs(p+O-(E+F))+1)*C,M+=(Math.abs(D+O-(E+F))+1)*C)}for(nt.reset();nt.next();){const mt=nt.value;if(z=mt.fromVertex,mt.valid&&z.layer===t){for(V=0;V<n.length&&n[V]!==z;)V++;V<a&&(m+=2*(a-V),g+=2*(a+1-V)),V===a+1&&(m+=1),V>a+1&&(m+=4*(V-a),g+=4*(V-(a+1)))}}const $=n[a].destinationEdges.iterator;if(i&&s>=0)for(;$.next();){const mt=$.value;Y=mt.toVertex,mt.valid&&Y.layer!==t&&(C=this.linkStraightenWeight(mt),F=mt.portFromColOffset,O=mt.portToColOffset,B=Y.column,A+=(Math.abs(p+F-(B+O))+1)*C,M+=(Math.abs(D+F-(B+O))+1)*C)}for($.reset();$.next();){const mt=$.value;if(Y=mt.toVertex,mt.valid&&Y.layer===t){for(_=0;_<n.length&&n[_]!==Y;)_++;_===a+1&&(g+=1)}}const it=n[a+1].sourceEdges.iterator;if(i&&s<=0)for(;it.next();){const mt=it.value;z=mt.fromVertex,mt.valid&&z.layer!==t&&(C=this.linkStraightenWeight(mt),F=mt.portFromColOffset,O=mt.portToColOffset,E=z.column,A+=(Math.abs(b+O-(E+F))+1)*C,M+=(Math.abs(N+O-(E+F))+1)*C)}for(it.reset();it.next();){const mt=it.value;if(z=mt.fromVertex,mt.valid&&z.layer===t){for(V=0;V<n.length&&n[V]!==z;)V++;V<a&&(m+=2*(a+1-V),g+=2*(a-V)),V===a&&(g+=1),V>a+1&&(m+=4*(V-(a+1)),g+=4*(V-a))}}const Q=n[a+1].destinationEdges.iterator;if(i&&s>=0)for(;Q.next();){const mt=Q.value;Y=mt.toVertex,mt.valid&&Y.layer!==t&&(C=this.linkStraightenWeight(mt),F=mt.portFromColOffset,O=mt.portToColOffset,B=Y.column,A+=(Math.abs(b+F-(B+O))+1)*C,M+=(Math.abs(N+F-(B+O))+1)*C)}for(Q.reset();Q.next();){const mt=Q.value;if(Y=mt.toVertex,mt.valid&&Y.layer===t){for(_=0;_<n.length&&n[_]!==Y;)_++;_===a&&(m+=1)}}let rt=0,ut=0;const gt=l[n[a].index],vt=h[n[a].index],Z=l[n[a+1].index],xt=h[n[a+1].index];if(gt!==-1&&(rt+=Math.abs(gt-p),ut+=Math.abs(gt-D)),vt!==-1&&(rt+=Math.abs(vt-p),ut+=Math.abs(vt-D)),Z!==-1&&(rt+=Math.abs(Z-b),ut+=Math.abs(Z-N)),xt!==-1&&(rt+=Math.abs(xt-b),ut+=Math.abs(xt-N)),g<m-.5||g===m&&f<d-.5||g===m&&f===d&&M<A-.5||g===m&&f===d&&M===A&&ut<rt-.5){u=!0,c=!0,n[a].column=D,n[a+1].column=N;const mt=n[a];n[a]=n[a+1],n[a+1]=mt}}for(a=0;a<o;a++)n[a].index=a;return this.Wa(t,n),u}straightenAndPack(){if(this.Gn!==0){this.Y3();return}let t=0,e=!1,i=(this.cr&1)!==0;const s=(this.cr&8)!==0;if(this.network.edges.count>1e3&&s&&(i=!1),i){const n=[];let o=0;for(o=0;o<=this._;o++)n[o]=0;let r=0;const a=this.network.vertexes.iterator;for(;a.next();){const h=a.value;t=h.layer,r=h.column;const u=this.nodeMinColumnSpace(h,!1);n[t]=Math.max(n[t],r+u)}const l=8;for(a.reset();a.next();){const h=a.value;t=h.layer,r=h.column,h.column=((this.Bt-n[t])*l>>1)+r*l}this.Bt*=l}if((this.cr&2)!==0){e=!0;let n=0;for(;e&&n<this.gu;){for(e=!1,t=this.Bs+1;t<=this._;t++)e=this.Jg(t,1)||e;for(t=this.Bs-1;t>=0;t--)e=this.Jg(t,-1)||e;e=this.Jg(this.Bs,0)||e,n++}}if((this.cr&4)!==0){for(t=this.Bs+1;t<=this._;t++)this.mL(t,1);for(t=this.Bs-1;t>=0;t--)this.mL(t,-1);this.mL(this.Bs,0)}if(i&&(this.PF(-1),this.PF(1)),(this.cr&2)!==0){e=!0;let n=0;for(;e&&n<this.gu;){for(e=!1,e=this.Jg(this.Bs,0)||e,t=this.Bs+1;t<=this._;t++)e=this.Jg(t,0)||e;for(t=this.Bs-1;t>=0;t--)e=this.Jg(t,0)||e;n++}}}Jg(t,e){let i=!1;for(;this.K3(t,e);)i=!0;return i}K3(t,e){let i=0;const s=this.qa(t),n=this.ie[t],o=this.Nw(t,-1);if(e>0)for(i=0;i<n;i++)o[i]=-1;const r=this.Nw(t,1);if(e<0)for(i=0;i<n;i++)r[i]=-1;let a=!1,l=!0;for(;l;)for(l=!1,i=0;i<n;i++){const h=s[i].column,u=this.nodeMinColumnSpace(s[i],!0),c=this.nodeMinColumnSpace(s[i],!1);let d=0;i-1<0||h-s[i-1].column-1>u+this.nodeMinColumnSpace(s[i-1],!1)?d=h-1:d=h;let f=0;i+1>=n||s[i+1].column-h-1>c+this.nodeMinColumnSpace(s[i+1],!0)?f=h+1:f=h;let m=0,g=0,p=0,b=0,v=0,w=0;if(e<=0){const M=s[i].sourceEdges.iterator;for(;M.next();){const C=M.value,F=C.fromVertex;if(C.valid&&F.layer!==t){b=this.linkStraightenWeight(C),v=C.portFromColOffset,w=C.portToColOffset;const O=F.column;m+=(Math.abs(h+w-(O+v))+1)*b,g+=(Math.abs(d+w-(O+v))+1)*b,p+=(Math.abs(f+w-(O+v))+1)*b}}}if(e>=0){const M=s[i].destinationEdges.iterator;for(;M.next();){const C=M.value,F=C.toVertex;if(C.valid&&F.layer!==t){b=this.linkStraightenWeight(C),v=C.portFromColOffset,w=C.portToColOffset;const O=F.column;m+=(Math.abs(h+v-(O+w))+1)*b,g+=(Math.abs(d+v-(O+w))+1)*b,p+=(Math.abs(f+v-(O+w))+1)*b}}}let k=0,S=0,N=0;const D=o[s[i].index],A=r[s[i].index];D!==-1&&(k+=Math.abs(D-h),S+=Math.abs(D-d),N+=Math.abs(D-f)),A!==-1&&(k+=Math.abs(A-h),S+=Math.abs(A-d),N+=Math.abs(A-f)),g<m||g===m&&S<k?(a=!0,l=!0,s[i].column=d):(p<m||p===m&&N<k)&&(a=!0,l=!0,s[i].column=f)}return this.Wa(t,s),this.Mw(),a}mL(t,e){let i=0;const s=this.qa(t),n=this.ie[t],o=this.fF(t,e),r=new Int16Array(o);let a=!1,l=!0;for(;l;)for(l=!1,i=0;i<n;i++){const h=s[i].column,u=this.nodeMinColumnSpace(s[i],!0),c=this.nodeMinColumnSpace(s[i],!1);let d=0,f=0,m=0,g=0,p=0;r[i]===-1?i===0&&i===n-1?d=h:i===0?(f=s[i+1].column,f-h===c+this.nodeMinColumnSpace(s[i+1],!0)?d=h-1:d=h):i===n-1?(m=s[i-1].column,h-m===u+this.nodeMinColumnSpace(s[i-1],!1)?d=h+1:d=h):(m=s[i-1].column,p=m+this.nodeMinColumnSpace(s[i-1],!1)+u+1,f=s[i+1].column,g=f-this.nodeMinColumnSpace(s[i+1],!0)-c-1,d=(p+g)/2|0):i===0&&i===n-1?d=r[i]:i===0?(f=s[i+1].column,g=f-this.nodeMinColumnSpace(s[i+1],!0)-c-1,d=Math.min(r[i],g)):i===n-1?(m=s[i-1].column,p=m+this.nodeMinColumnSpace(s[i-1],!1)+u+1,d=Math.max(r[i],p)):(m=s[i-1].column,p=m+this.nodeMinColumnSpace(s[i-1],!1)+u+1,f=s[i+1].column,g=f-this.nodeMinColumnSpace(s[i+1],!0)-c-1,p<r[i]&&r[i]<g?d=r[i]:p>=r[i]?d=p:g<=r[i]&&(d=g)),d!==h&&(a=!0,l=!0,s[i].column=d)}return this.Wa(t,s),this.Mw(),a}H3(){for(let t=0;t<=this.Bt;t++)for(;this.j3(t,1););this.Mw()}j3(t,e){let i=!0;const s=this.network.vertexes.iterator;for(;s.next();){const o=s.value,r=this.nodeMinColumnSpace(o,!0),a=this.nodeMinColumnSpace(o,!1);if(o.column-r<=t&&o.column+a>=t){i=!1;break}}let n=!1;if(i){if(e>0)for(s.reset();s.next();){const o=s.value;o.column>t&&(o.column-=1,n=!0)}if(e<0)for(s.reset();s.next();){const o=s.value;o.column<t&&(o.column+=1,n=!0)}}return n}q3(){this.H3();for(let t=0;t<this.Bt;t++)for(;this.W3(t,1););this.Mw()}W3(t,e){let i=t;e>0&&(i=t+1),e<0&&(i=t-1);let s=0;const n=[],o=[];for(s=0;s<=this._;s++)n[s]=!1,o[s]=!1;const r=this.network.vertexes.iterator;for(;r.next();){const h=r.value,u=h.column-this.nodeMinColumnSpace(h,!0),c=h.column+this.nodeMinColumnSpace(h,!1);u<=t&&c>=t&&(n[h.layer]=!0),u<=i&&c>=i&&(o[h.layer]=!0)}let a=!0,l=!1;for(s=0;s<=this._;s++)a=a&&!(n[s]&&o[s]);if(a){if(e>0)for(r.reset();r.next();){const h=r.value;h.column>t&&(h.column-=1,l=!0)}if(e<0)for(r.reset();r.next();){const h=r.value;h.column<t&&(h.column+=1,l=!0)}}return l}PF(t){this.q3();let e=0,i,s=0,n=0,o=0;if(t>0)for(e=0;e<=this.Bt;e++)for(i=this.ei(),s=this.Qk(!0),n=s+1;s<n;)n=s,this.SF(e,1),o=this.Qk(!0),o>s?this.os(i):o<s&&(s=o,i=this.ei());if(t<0)for(e=this.Bt;e>=0;e--)for(i=this.ei(),s=this.Qk(!0),n=s+1;s<n;)n=s,this.SF(e,-1),o=this.Qk(!0),o>s?this.os(i):o<s&&(s=o,i=this.ei());this.Mw()}SF(t,e){this.fn=0;const i=this.network.vertexes.iterator;for(;i.next();){const u=i.value;u.component=-1}if(e>0)for(i.reset();i.next();){const u=i.value;u.column-this.nodeMinColumnSpace(u,!0)<=t&&(u.component=this.fn)}if(e<0)for(i.reset();i.next();){const u=i.value;u.column+this.nodeMinColumnSpace(u,!1)>=t&&(u.component=this.fn)}for(this.fn++,i.reset();i.next();){const u=i.value;u.component===-1&&(this.dL(u,this.fn,-1,!0,!0),this.fn++)}let s=0;const n=[];for(s=0;s<this.fn*this.fn;s++)n[s]=!1;const o=[];for(s=0;s<(this._+1)*(this.Bt+1);s++)o[s]=-1;for(i.reset();i.next();){const u=i.value,c=u.layer,d=Math.max(0,u.column-this.nodeMinColumnSpace(u,!0)),f=Math.min(this.Bt,u.column+this.nodeMinColumnSpace(u,!1));for(let m=d;m<=f;m++)o[c*(this.Bt+1)+m]=u.component}for(let u=0;u<=this._;u++){if(e>0)for(let c=0;c<this.Bt;c++)o[u*(this.Bt+1)+c]!==-1&&o[u*(this.Bt+1)+c+1]!==-1&&o[u*(this.Bt+1)+c]!==o[u*(this.Bt+1)+c+1]&&(n[o[u*(this.Bt+1)+c]*this.fn+o[u*(this.Bt+1)+c+1]]=!0);if(e<0)for(let c=this.Bt;c>0;c--)o[u*(this.Bt+1)+c]!==-1&&o[u*(this.Bt+1)+c-1]!==-1&&o[u*(this.Bt+1)+c]!==o[u*(this.Bt+1)+c-1]&&(n[o[u*(this.Bt+1)+c]*this.fn+o[u*(this.Bt+1)+c-1]]=!0)}const r=[];for(s=0;s<this.fn;s++)r[s]=!0;const a=[];a.push(0);let l=0;for(;a.length!==0;)if(l=a[a.length-1],a.pop(),r[l])for(r[l]=!1,s=0;s<this.fn;s++)n[l*this.fn+s]&&a.splice(0,0,s);let h=!1;if(e>0)for(i.reset();i.next();){const u=i.value;r[u.component]&&(u.column-=1,h=!0)}if(e<0)for(i.reset();i.next();){const u=i.value;r[u.component]&&(u.column+=1,h=!0)}return h}Y3(){const t=y.nt(),e=this.mu.length;for(let d=0;d<=e;d++)t[d]=[];const i=this.network.vertexes.iterator;for(;i.next();){const d=i.value,f=e-d.layer,m=t[f];m[d.index]=d}const s=new K;this.J3(t,s);let n=null,o=null,r=null,a=null;const l=(this.Gn&1)!==0,h=(this.Gn&2)!==0,u=(this.Gn&4)!==0,c=(this.Gn&8)!==0;l&&(this.hl(t,s,!0),n=this.iP(t,!0,!1)),t.reverse(),u&&(this.hl(t,s,!1),r=this.iP(t,!1,!1));for(const d of t)d.reverse();c&&(this.hl(t,s,!1),a=this.iP(t,!1,!0)),t.reverse(),h&&(this.hl(t,s,!0),o=this.iP(t,!0,!0)),y.Z(t),this.$3(n,o,r,a),this.network.vertexes.each(d=>{const f=d,m=y.nt();l&&m.push(n.get(f)),h&&m.push(o.get(f)),u&&m.push(r.get(f)),c&&m.push(a.get(f)),m.sort((w,k)=>w-k);const g=m.length,p=Math.floor((g-1)/2),b=Math.ceil((g-1)/2),v=(m[p]+m[b])/2;y.Z(m),f.mi=v})}J3(t,e){const i=t.length;for(let s=1;s<i-1;s++){let n=0,o=0;const r=t[s],a=t[s+1];for(let l=0;o<a.length;l++){const h=a[l],u=this.Z3(h);if(l===a.length-1||u){let c=r.length-1;for(u&&(c=h.getProperSourceVertexes()[0].index);o<=l;){const d=a[o].getProperSourceEdges();for(const f of d){const m=f.fromVertex.index;(m<n||m>c)&&e.add(f)}o++}n=c}}}}Z3(t){if(t.node===null){const e=t.getProperSourceVertexes();if(e.length>0)return e[0].node===null}return!1}hl(t,e,i){this.Q3(t);for(const s of t){let n=-1;for(const o of s){const r=i?o.getProperSourceVertexes():o.getProperDestinationVertexes(),a=r.length;if(a>0){r.sort((h,u)=>h.Ja-u.Ja);const l=(a-1)/2;for(let h=Math.floor(l),u=Math.ceil(l);h<=u;h++)if(o.Yn===o){const c=r[h];let d;i?d=c.getDestinationEdge(o):d=o.getDestinationEdge(c),!e.has(d)&&n<c.Ja&&(c.Yn=o,o.pc=c.pc,o.Yn=c.pc,n=c.Ja)}}}}}Q3(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length;s++){const n=i[s];n.pc=n,n.Yn=n,n.MF=e,n.Ja=s}}}iP(t,e,i){const s=this.P===90||this.P===270;for(const o of t)for(const r of o)r.rs=r,r.yu=1/0,r.mi=NaN,r.Kn=0;this._3(t,e,i);for(const o of t)for(const r of o)r.pc===r&&this.NF(r,t);for(let o=0;o<t.length;o++){if(t[o].length<=0)continue;const r=t[o][0];if(r.rs===r){r.rs.yu===1/0&&(r.rs.yu=0);let a=o,l=0,h;do{for(h=t[a][l];h.Yn!==h.pc;)if(h=h.Yn,a++,h.Ja>0){const u=this.CF(h,t),c=s?u.width:u.height,d=h.rs.yu+h.mi+h.Kn-(u.mi+u.Kn+c+this.columnSpacing);u.rs.yu=Math.min(u.rs.yu,d)}l=h.Ja+1}while(a<t.length&&l<t[a].length&&h.rs===t[a][l].rs)}}const n=new bt;for(const o of t)for(const r of o){r.mi=r.mi+r.rs.yu+r.Kn;const a=s?r.width:r.height;n.set(r,i?-r.mi-a:r.mi)}return n}_3(t,e,i){const s=this.P===90||this.P===270;for(const n of t)for(const o of n)if(o.pc===o){let r=0,a=o;for(;a.Yn!==o;){const l=a.Yn,h=s?a.width:a.height,u=s?l.width:l.height;let c,d,f,m;e?(f=a.getDestinationEdge(l),c=f.portFromPos,d=f.portToPos,f.link!==null&&(a.node&&a.node!==f.link.fromNode&&(c=s?a.focusX:a.focusY),l.node&&l.node!==f.link.toNode&&(d=s?l.focusX:l.focusY)),i?m=a.Kn+(h-c)-(u-d):m=a.Kn+c-d):(f=l.getDestinationEdge(a),c=f.portToPos,d=f.portFromPos,f.link!==null&&(a.node&&a.node!==f.link.toNode&&(c=s?a.focusX:a.focusY),l.node&&l.node!==f.link.fromNode&&(d=s?l.focusX:l.focusY)),i?m=a.Kn+(h-c)-(u-d):m=a.Kn+c-d),l.Kn=m,r=Math.min(r,m),a=a.Yn}a=o;do a.Kn=a.Kn-r,a=a.Yn;while(a!==o)}}NF(t,e){if(!isNaN(t.mi))return;t.mi=0;let i=t;do{if(i.Ja>0){const s=this.CF(i,e),n=s.pc;this.NF(n,e),t.rs===t&&(t.rs=n.rs);const o=this.P===90||this.P===270?s.width:s.height;if(t.rs===n.rs){const r=n.mi+s.Kn+o-i.Kn+this.columnSpacing;t.mi=Math.max(t.mi,r)}}i=i.Yn}while(i!==t);for(;i.Yn!==t;)i=i.Yn,i.mi=t.mi,i.rs=t.rs}CF(t,e){const i=t.MF,s=t.Ja;return s<1&&y.o("Could not determine previous vertex in layer"),e[i][s-1]}$3(...t){let e=-1;const i=y.nt(),s=y.nt();let n=1/0;for(let o=0;o<4;o++){if(!t[o])continue;const r=this.tU(t[o],i,s,o);r<n&&(e=o,n=r)}for(let o=0;o<4;o++){const r=t[o];if(!r)continue;const a=o===0||o===2?i[e]-i[o]:s[e]-s[o];a!==0&&r.each(l=>{r.set(l.key,l.value+a)})}y.Z(i),y.Z(s)}tU(t,e,i,s){if(!t||t.count===0)return e[s]=0,i[s]=0,1/0;let n=1/0,o=-1/0;return t.each(r=>{const a=r.key,l=r.value,h=this.P===90||this.P===270?a.width:a.height;l<n&&(n=l),l+h>o&&(o=l+h)}),e[s]=n,i[s]=o,o-n}commitLayout(){this.Pw(),this.commitNodes(),this.pL(),this.isRouting&&this.commitLinks()}Pw(){if(!this.setsPortSpots)return;const t=this.tP(!0),e=this.tP(!1),i=this.network.edges.iterator;for(;i.next();){const s=i.value.link;s!==null&&(s.fromSpot=t,s.toSpot=e)}}tP(t){return this.P===270?t?T.MiddleTop:T.MiddleBottom:this.P===90?t?T.MiddleBottom:T.MiddleTop:this.P===180?t?T.MiddleLeft:T.MiddleRight:t?T.MiddleRight:T.MiddleLeft}commitNodes(){this.zs.length!==this._+1&&(this.zs=new Float32Array(this._+1)),this.ms.length!==this._+1&&(this.ms=new Float32Array(this._+1)),this.ps.length!==this._+1&&(this.ps=new Float32Array(this._+1)),this.Rt.length!==this._+1&&(this.Rt=new Float32Array(this._+1));for(let f=0;f<=this._;f++)this.zs[f]=0,this.ms[f]=0,this.ps[f]=0,this.Rt[f]=0;const t=this.network.vertexes.iterator;for(;t.next();){const f=t.value,m=f.layer;this.zs[m]=Math.max(this.zs[m],this.nodeMinLayerSpace(f,!0)),this.ms[m]=Math.max(this.ms[m],this.nodeMinLayerSpace(f,!1))}let e=0;const i=this.Vs;for(let f=0;f<=this._;f++){let m=i;this.zs[f]+this.ms[f]<=0&&(m=0),f>0&&(e+=m/2),this.P===90||this.P===0?(e+=this.ms[f],this.ps[f]=e,e+=this.zs[f]):(e+=this.zs[f],this.ps[f]=e,e+=this.ms[f]),f<this._&&(e+=m/2),this.Rt[f]=e}const s=e,n=this.arrangementOrigin;for(let f=0;f<=this._;f++)this.P===270?this.ps[f]=n.y+this.ps[f]:this.P===90?(this.ps[f]=n.y+s-this.ps[f],this.Rt[f]=s-this.Rt[f]):this.P===180?this.ps[f]=n.x+this.ps[f]:(this.ps[f]=n.x+s-this.ps[f],this.Rt[f]=s-this.Rt[f]);const o=this.Gn!==0;t.reset();const r=this.P===270||this.P===90;let a=1/0,l=1/0,h=1/0,u=-1/0;for(;t.next();){const f=t.value,m=f.layer,g=f.column|0;let p=0,b=0;r?(p=n.x+this.ti*g,b=this.ps[m]):(p=this.ps[m],b=n.y+this.ti*g),f.centerX=p,f.centerY=b,o&&isFinite(f.mi)&&(r?f.node?f.x=n.x+f.mi:f.centerX=n.x+f.mi:f.node?f.y=n.y+f.mi:f.centerY=n.y+f.mi),a=Math.min(f.x,a),l=Math.min(f.y,l),r?(h=a,u=Math.max(u,f.bounds.right)):(h=l,u=Math.max(u,f.bounds.bottom))}this.uL=u-h;const c=n.x-a,d=n.y-l;for(this.fr=new P(o&&r?0:c,o&&!r?0:d),t.reset();t.next();){const f=t.value;f.x+=c,f.y+=d,f.commit()}}pL(){let t=0;const e=this.Vs;for(let n=0;n<=this._;n++)t+=this.zs[n],t+=this.ms[n];t+=this._*e;const i=[],s=this.Gn!==0?this.uL:this.ti*this.Bt;for(let n=this.maxLayer;n>=0;n--)this.P===270?n===0?i.push(new I(0,0,s,Math.abs(this.Rt[0]))):i.push(new I(0,this.Rt[n-1],s,Math.abs(this.Rt[n-1]-this.Rt[n]))):this.P===90?n===0?i.push(new I(0,this.Rt[0],s,Math.abs(this.Rt[0]-t))):i.push(new I(0,this.Rt[n],s,Math.abs(this.Rt[n-1]-this.Rt[n]))):this.P===180?n===0?i.push(new I(0,0,Math.abs(this.Rt[0]),s)):i.push(new I(this.Rt[n-1],0,Math.abs(this.Rt[n-1]-this.Rt[n]),s)):n===0?i.push(new I(this.Rt[0],0,Math.abs(this.Rt[0]-t),s)):i.push(new I(this.Rt[n],0,Math.abs(this.Rt[n-1]-this.Rt[n]),s));this.commitLayers(i,this.fr)}commitLayers(t,e){}commitLinks(){const t=this.network.edges.iterator;let e=null;for(;t.next();)e=t.value.link,e!==null&&e.pointsCount>0&&(e.startRoute(),e.clearPoints(),e.commitRoute());for(t.reset();t.next();)e=t.value.link,e!==null&&e.updateRoute();for(t.reset();t.next();){const i=t.value;if(e=i.link,e===null||e.pointsCount===0)continue;e.startRoute();const s=e;let n=s.fromNode,o=s.toNode,r=s.fromPort,a=s.toPort;if(n!==null){const C=n.findVisibleNode();C!==null&&C!==n&&(n=C,r=C.port)}if(o!==null){const C=o.findVisibleNode();C!==null&&C!==o&&(o=C,a=C.port)}const l=e.computeSpot(!0,r),h=e.computeSpot(!1,a);let u=i.fromVertex,c=i.toVertex;if(i.valid){if(e.curve===9&&e.pointsCount===4)if(u.column===c.column&&this.alignOption===0){const C=e.getLinkPoint(n,r,l,!0,!1,o,a),F=e.getLinkPoint(o,a,h,!1,!1,n,r);C.isReal()||C.set(n.actualBounds.center),F.isReal()||F.set(o.actualBounds.center),e.clearPoints(),e.addPointAt(C.x,C.y),e.addPointAt((2*C.x+F.x)/3,(2*C.y+F.y)/3),e.addPointAt((C.x+2*F.x)/3,(C.y+2*F.y)/3),e.addPointAt(F.x,F.y)}else{let C=!1,F=!1;if(r!==null&&e.bl(l)&&(C=!0),a!==null&&e.bl(h)&&(F=!0),C||F){let O=null;C&&(O=e.getLinkPointFromPoint(n,r,r.getDocumentPoint(T.Center),e.getPoint(3),!0),O.isReal()||O.set(n.actualBounds.center),e.setPointAt(0,O.x,O.y));let E=null;if(F&&(E=e.getLinkPointFromPoint(o,a,a.getDocumentPoint(T.Center),e.getPoint(0),!1),E.isReal()||E.set(o.actualBounds.center),e.setPointAt(3,E.x,E.y)),O){const B=e.getPoint(2);e.setPointAt(1,(O.x*2+B.x)/3,(O.y*2+B.y)/3)}if(E){const B=e.getPoint(1);e.setPointAt(2,(E.x*2+B.x)/3,(E.y*2+B.y)/3)}}}e.commitRoute();continue}if(u.layer===c.layer){e.commitRoute();continue}let d=!1,f=!1;const m=this.Vs;let g=0,p=e.firstPickIndex+1;if(e.isOrthogonal)f=!0,g=e.pointsCount,g>4&&e.points.removeRange(2,g-3);else if(e.curve===9)d=!0,g=e.pointsCount,g>4&&e.points.removeRange(2,g-3),g===4&&(p=2);else{g=e.pointsCount;const C=l===T.None,F=h===T.None;g>2&&C&&F?e.points.removeRange(1,g-2):g>3&&C&&!F?e.points.removeRange(1,g-3):g>3&&!C&&F?e.points.removeRange(2,g-2):g>4&&!C&&!F&&e.points.removeRange(2,g-3)}let b,v,w=0,k=0,S=0,N=0,D=0,A=0,M=0;if(i.rev){let C=0;for(;c!==null&&u!==c;){b=null,v=null;const F=c.sourceEdges.iterator;for(;F.next();){const O=F.value;if(O.link===i.link&&(b=O.fromVertex,v=O.toVertex,b.node===null))break}if(b===null)break;if(b!==u)if(w=e.getPoint(p-1).x,k=e.getPoint(p-1).y,S=b.centerX,N=b.centerY,f)this.P===180||this.P===0?p===e.firstPickIndex+1?(e.insertPointAt(p++,w,k),e.insertPointAt(p++,w,N)):(v!==null?v.centerY:k)!==N&&(D=this.Rt[b.layer-1]+this.fr.x,e.insertPointAt(p++,D,k),e.insertPointAt(p++,D,N)):p===e.firstPickIndex+1?(e.insertPointAt(p++,w,k),e.insertPointAt(p++,S,k)):(v!==null?v.centerX:w)!==S&&(D=this.Rt[b.layer-1]+this.fr.y,e.insertPointAt(p++,w,D),e.insertPointAt(p++,S,D));else if(p===e.firstPickIndex+1)if(A=Math.max(10,this.zs[c.layer]),M=Math.max(10,this.ms[c.layer]),d)this.P===180?S<=c.bounds.x?(C=c.bounds.x,e.insertPointAt(p++,C-A,N),e.insertPointAt(p++,C,N),e.insertPointAt(p++,C+M,N)):(e.insertPointAt(p++,S-A,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S+M,N)):this.P===90?N>=c.bounds.bottom?(C=c.bounds.y+c.bounds.height,e.insertPointAt(p++,S,C+M),e.insertPointAt(p++,S,C),e.insertPointAt(p++,S,C-A)):(e.insertPointAt(p++,S,N+M),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N-A)):this.P===270?N<=c.bounds.y?(C=c.bounds.y,e.insertPointAt(p++,S,C-A),e.insertPointAt(p++,S,C),e.insertPointAt(p++,S,C+M)):(e.insertPointAt(p++,S,N-A),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N+M)):this.P===0&&(S>=c.bounds.right?(C=c.bounds.x+c.bounds.width,e.insertPointAt(p++,C+M,N),e.insertPointAt(p++,C,N),e.insertPointAt(p++,C-A,N)):(e.insertPointAt(p++,S+M,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S-A,N)));else{e.insertPointAt(p++,w,k);let O=0;this.P===180||this.P===0?((this.P===180?S>=c.bounds.right:S<=c.bounds.x)&&(O=(this.P===0?-A:M)/2),e.insertPointAt(p++,w+O,N)):((this.P===270?N>=c.bounds.bottom:N<=c.bounds.y)&&(O=(this.P===90?-A:M)/2),e.insertPointAt(p++,S,k+O)),e.insertPointAt(p++,S,N)}else A=Math.max(10,this.zs[b.layer]),M=Math.max(10,this.ms[b.layer]),d?this.P===180?(e.insertPointAt(p++,S-A-Math.max(10,m),N),e.insertPointAt(p++,Math.min(S-A+m/2,S),N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,Math.max(S+M-m/2,S),N),e.insertPointAt(p++,S+M+m,N)):this.P===90?(e.insertPointAt(p++,S,N+M+Math.max(10,m)),e.insertPointAt(p++,S,Math.max(N+M-m/2,N)),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,Math.min(N-A+m/2,N)),e.insertPointAt(p++,S,N-A-m)):this.P===270?(e.insertPointAt(p++,S,N-A-Math.max(10,m)),e.insertPointAt(p++,S,Math.min(N-A+m/2,N)),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,Math.max(N+M-m/2,N)),e.insertPointAt(p++,S,N+M+m)):(e.insertPointAt(p++,S+M+Math.max(10,m),N),e.insertPointAt(p++,Math.max(S+M-m/2,S),N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,Math.min(S-A+m/2,S),N),e.insertPointAt(p++,S-A-m,N)):(this.P===180||this.P===90||this.P,e.insertPointAt(p++,S,N));c=b}if(a===null||l!==T.None||f)if(w=e.getPoint(p-1).x,k=e.getPoint(p-1).y,S=e.getPoint(p).x,N=e.getPoint(p).y,f){const F=this.ms[u.layer];let O=0;this.P===180||this.P===0?(O=k,O>=u.bounds.y&&O<=u.bounds.bottom&&(this.P===180?S>=u.bounds.x:S<=u.bounds.right)&&(C=u.centerX+(this.P===180?-F:F),O<u.bounds.y+u.bounds.height/2?O=u.bounds.y-this.ti/2:O=u.bounds.bottom+this.ti/2,e.insertPointAt(p++,C,k),e.insertPointAt(p++,C,O)),e.insertPointAt(p++,S,O),e.insertPointAt(p++,S,N)):(O=w,O>=u.bounds.x&&O<=u.bounds.right&&(this.P===270?N>=u.bounds.y:N<=u.bounds.bottom)&&(C=u.centerY+(this.P===270?-F:F),O<u.bounds.x+u.bounds.width/2?O=u.bounds.x-this.ti/2:O=u.bounds.right+this.ti/2,e.insertPointAt(p++,w,C),e.insertPointAt(p++,O,C)),e.insertPointAt(p++,O,N),e.insertPointAt(p++,S,N))}else if(d)A=Math.max(10,this.zs[u.layer]),M=Math.max(10,this.ms[u.layer]),this.P===180&&S>=u.bounds.x?(C=u.bounds.x+u.bounds.width,e.setPointAt(p-2,C,k),e.setPointAt(p-1,C+M,k)):this.P===90&&N<=u.bounds.bottom?(C=u.bounds.y,e.setPointAt(p-2,w,C),e.setPointAt(p-1,w,C-A)):this.P===270&&N>=u.bounds.y?(C=u.bounds.y+u.bounds.height,e.setPointAt(p-2,w,C),e.setPointAt(p-1,w,C+M)):this.P===0&&S<=u.bounds.right&&(C=u.bounds.x,e.setPointAt(p-2,C,k),e.setPointAt(p-1,C-A,k));else{A=Math.max(10,this.zs[u.layer]),M=Math.max(10,this.ms[u.layer]);let F=0;this.P===180||this.P===0?((this.P===180?S<=u.bounds.x:S>=u.bounds.right)&&(F=(this.P===0?M:-A)/2),e.insertPointAt(p++,S+F,k)):((this.P===270?N<=u.bounds.y:N>=u.bounds.bottom)&&(F=(this.P===90?M:-A)/2),e.insertPointAt(p++,w,N+F)),e.insertPointAt(p++,S,N)}}else{for(;u!==null&&u!==c;){b=null,v=null;const C=u.destinationEdges.iterator;for(;C.next();){const F=C.value;if(F.link===i.link&&(b=F.toVertex,v=F.fromVertex,v.node!==null&&(v=null),b.node===null))break}if(b===null)break;b!==c&&(w=e.getPoint(p-1).x,k=e.getPoint(p-1).y,S=b.centerX,N=b.centerY,f?this.P===180||this.P===0?(v!==null?v.centerY:k)!==N&&(D=this.Rt[b.layer]+this.fr.x,p===e.firstPickIndex+1&&(this.P===0?D=Math.max(D,w):D=Math.min(D,w)),e.insertPointAt(p++,D,k),e.insertPointAt(p++,D,N)):(v!==null?v.centerX:w)!==S&&(D=this.Rt[b.layer]+this.fr.y,p===e.firstPickIndex+1&&(this.P===90?D=Math.max(D,k):D=Math.min(D,k)),e.insertPointAt(p++,w,D),e.insertPointAt(p++,S,D)):(A=Math.max(10,this.zs[b.layer]),M=Math.max(10,this.ms[b.layer]),d?this.P===180?(e.insertPointAt(p++,S+M+Math.max(10,m),N),e.insertPointAt(p++,Math.max(S+M-m/2,S),N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,Math.min(S-A+m/2,S),N),e.insertPointAt(p++,S-A-m,N)):this.P===90?(e.insertPointAt(p++,S,N-A-Math.max(10,m)),e.insertPointAt(p++,S,Math.min(N-A+m/2,N)),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,Math.max(N+M-m/2,N)),e.insertPointAt(p++,S,N+M+m)):this.P===270?(e.insertPointAt(p++,S,N+M+Math.max(10,m)),e.insertPointAt(p++,S,Math.max(N+M-m/2,N)),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,Math.min(N-A+m/2,N)),e.insertPointAt(p++,S,N-A-m)):(e.insertPointAt(p++,S-A-Math.max(10,m),N),e.insertPointAt(p++,Math.min(S-A+m/2,S),N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,S,N),e.insertPointAt(p++,Math.max(S+M-m/2,S),N),e.insertPointAt(p++,S+M+m,N)):this.P===180?(e.insertPointAt(p++,S+M,N),e.insertPointAt(p++,S-A,N)):this.P===90?(e.insertPointAt(p++,S,N-A),e.insertPointAt(p++,S,N+M)):this.P===270?(e.insertPointAt(p++,S,N+M),e.insertPointAt(p++,S,N-A)):(e.insertPointAt(p++,S-A,N),e.insertPointAt(p++,S+M,N)))),u=b}f&&(w=e.getPoint(p-1).x,k=e.getPoint(p-1).y,S=e.getPoint(p).x,N=e.getPoint(p).y,this.P===180||this.P===0?k!==N&&(this.P===0?D=Math.min(Math.max((S+w)/2,this.Rt[c.layer]+this.fr.x),S):D=Math.max(Math.min((S+w)/2,this.Rt[c.layer]+this.fr.x),S),e.insertPointAt(p++,D,k),e.insertPointAt(p++,D,N)):w!==S&&(this.P===90?D=Math.min(Math.max((N+k)/2,this.Rt[c.layer]+this.fr.y),N):D=Math.max(Math.min((N+k)/2,this.Rt[c.layer]+this.fr.y),N),e.insertPointAt(p++,w,D),e.insertPointAt(p++,S,D)))}if(s!==null&&d&&e.pointsCount>=4){if(n!==null&&r!==null&&s.bl(l)){const C=r.getDocumentPoint(T.Center);C.isReal()||C.setTo(n.actualBounds.centerX,n.actualBounds.centerY);const F=e.getPoint(3),O=e.getPoint(2);this.direction===90||this.direction===270?(e.setPointAt(1,F.x,(O.y+F.y)/2),e.setPointAt(2,F.x,(O.y+F.y)/2)):(e.setPointAt(1,(O.x+F.x)/2,F.y),e.setPointAt(2,(O.x+F.x)/2,F.y));const E=e.getLinkPointFromPoint(n,r,C,e.getPoint(1),!0);e.setPointAt(0,E.x,E.y)}if(o!==null&&a!==null&&s.bl(h)){const C=a.getDocumentPoint(T.Center);C.isReal()||C.setTo(o.actualBounds.centerX,o.actualBounds.centerY);const F=e.getPoint(e.pointsCount-4),O=e.getLinkPointFromPoint(o,a,C,F,!1),E=e.getPoint(e.pointsCount-3);this.direction===90||this.direction===270?(e.setPointAt(e.pointsCount-2,F.x,(E.y+O.y)/2),e.setPointAt(e.pointsCount-3,F.x,(E.y+O.y)/2)):(e.setPointAt(e.pointsCount-2,(E.x+O.x)/2,F.y),e.setPointAt(e.pointsCount-3,(E.x+O.x)/2,F.y));const B=e.getLinkPointFromPoint(o,a,C,e.getPoint(e.pointsCount-2),!1);e.setPointAt(e.pointsCount-1,B.x,B.y)}}e.commitRoute(),i.commit()}}S3(){this.Sw=-1,this.jg=0,this.Bs=0,this.mu=null;for(let t=0;t<this.Xn.length;t++)this.Xn[t]=null}qa(t){let e;const i=this.ie[t];if(i>=this.Xn.length){const n=[];for(let o=0;o<this.Xn.length;o++)n[o]=this.Xn[o];this.Xn=n}this.Xn[i]===void 0||this.Xn[i]===null?e=[]:(e=this.Xn[i],this.Xn[i]=null);const s=this.mu[t];for(let n=0;n<s.length;n++){const o=s[n];e[o.index]=o}return e}Wa(t,e){this.Xn[this.ie[t]]=e}get layerSpacing(){return this.Vs}set layerSpacing(t){this.Vs!==t&&t>=0&&(this.Vs=t,this.p())}get columnSpacing(){return this.ti}set columnSpacing(t){this.ti!==t&&t>0&&(this.ti=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(t===0||t===90||t===180||t===270?(this.P=t,this.p()):y.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.cu}set cycleRemoveOption(t){this.cu!==t&&(t===1||t===0||t===2)&&(this.cu=t,this.p())}get layeringOption(){return this.fu}set layeringOption(t){this.fu!==t&&(t===10||t===11||t===12)&&(this.fu=t,this.p())}get initializeOption(){return this.uu}set initializeOption(t){this.uu!==t&&(t===20||t===21||t===22)&&(this.uu=t,this.p())}get iterations(){return this.mc}set iterations(t){this.mc!==t&&t>=0&&(this.mc=t,this.p())}get aggressiveOption(){return this.du}set aggressiveOption(t){this.du!==t&&(t===30||t===31||t===32)&&(this.du=t,this.p())}get packOption(){return this.cr}set packOption(t){this.cr!==t&&t>=0&&t<8&&(this.cr=t,this.p())}get packIterations(){return this.gu}set packIterations(t){this.gu=t}get alignOption(){return this.Gn}set alignOption(t){this.Gn!==t&&t>=0&&t<16&&(this.Gn=t,this.p())}get centered(){return this.ja}set centered(t){this.centered!==t&&(this.ja=t,this.p())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(this.zn=t,this.p())}get maxLayer(){return this._}get maxIndex(){return this.Sw}get maxColumn(){return this.Bt}get minIndexLayer(){return this.jg}get maxIndexLayer(){return this.Bs}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}class Ps extends ve{constructor(t){super(t)}createVertex(){const t=new Ge(this);return t.centered=this.layout.centered,t}createEdge(){return new Ss(this)}}class Ge extends ke{pl;pa;Tt;sP;nP;ja;ii;pu;to;_k;$k;Zk;pc;Yn;MF;Ja;rs;yu;mi;Kn;Lw=null;Aw=null;Tw=null;Dw=null;constructor(t){super(t),this.pl=-1,this.pa=-1,this.Tt=-1,this.sP=NaN,this.nP=null,this.ja=!0,this.ii=!1,this.pu=NaN,this.to=NaN,this._k=0,this.$k=null,this.Zk=null}static LF(t,e){return t.index-e.index}getProperSourceEdges(){if(!this.Tw){const t=[];for(const e of this.Mo){const i=e;i.valid&&t.push(i)}this.Tw=t}return this.Tw}getProperDestinationEdges(){if(!this.Dw){const t=[];for(const e of this.rr){const i=e;i.valid&&t.push(i)}this.Dw=t}return this.Dw}getDestinationEdge(t){const e=this.getProperDestinationEdges();for(const i of e)if(i.toVertex===t)return i;y.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Lw){const t=[];for(const e of this.Mo){const i=e;!i.valid||i.fromVertex.layer<=i.toVertex.layer||t.push(i.fromVertex)}t.sort(Ge.LF),this.Lw=t}return this.Lw}getProperDestinationVertexes(){if(!this.Aw){const t=[];for(const e of this.rr){const i=e;!i.valid||i.fromVertex.layer<=i.toVertex.layer||t.push(i.toVertex)}t.sort(Ge.LF),this.Aw=t}return this.Aw}addSourceEdge(t){super.addSourceEdge(t),this.Lw=null,this.Tw=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Lw=null,this.Tw=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Aw=null,this.Dw=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Aw=null,this.Dw=null}commit(){if(this.centered)super.commit();else{const t=this.node;if(t!==null){const e=this.network.layout;if(!e)return;e.direction===180||e.direction===270?t.moveTo(this.bounds.right-t.actualBounds.width,this.bounds.bottom-t.actualBounds.height):t.moveTo(this.bounds.x,this.bounds.y)}}}get layer(){return this.pl}set layer(t){this.pl=t}get column(){return this.pa}set column(t){this.pa=t}get index(){return this.Tt}set index(t){this.Tt=t}get component(){return this.sP}set component(t){this.sP!==t&&(this.sP=t)}get near(){return this.nP}set near(t){this.nP!==t&&(this.nP=t)}get centered(){return this.ja}set centered(t){this.ja=t}}class Ss extends Re{ii;oP;rP;lP;aP;hP;cP;constructor(t){super(t),this.ii=!1,this.oP=!1,this.rP=!1,this.lP=NaN,this.aP=NaN,this.hP=0,this.cP=0}get fromVertex(){return this.ss}set fromVertex(t){this.ss!==t&&(this.ss=t)}get toVertex(){return this.ns}set toVertex(t){this.ns!==t&&(this.ns=t)}get valid(){return this.ii}set valid(t){this.ii!==t&&(this.ii=t)}get rev(){return this.oP}set rev(t){this.oP!==t&&(this.oP=t)}get forest(){return this.rP}set forest(t){this.rP!==t&&(this.rP=t)}get portFromPos(){return this.lP}set portFromPos(t){this.lP!==t&&(this.lP=t)}get portToPos(){return this.aP}set portToPos(t){this.aP!==t&&(this.aP=t)}get portFromColOffset(){return this.hP}set portFromColOffset(t){this.hP!==t&&(this.hP=t)}get portToColOffset(){return this.cP}set portToColOffset(t){this.cP!==t&&(this.cP=t)}}var Ri=(x=>(x[x.Default=0]="Default",x[x.Destination=1]="Destination",x[x.Source=2]="Source",x))(Ri||{}),Ei=(x=>(x[x.Forwards=10]="Forwards",x[x.Reverse=11]="Reverse",x[x.Ascending=12]="Ascending",x[x.Descending=13]="Descending",x))(Ei||{}),Ii=(x=>(x[x.CenterSubtrees=20]="CenterSubtrees",x[x.CenterChildren=21]="CenterChildren",x[x.Start=22]="Start",x[x.End=23]="End",x[x.Bus=24]="Bus",x[x.BusBranching=25]="BusBranching",x[x.TopLeftBus=26]="TopLeftBus",x[x.BottomRightBus=27]="BottomRightBus",x[x.Custom=28]="Custom",x))(Ii||{}),Bi=(x=>(x[x.None=30]="None",x[x.Block=31]="Block",x))(Bi||{}),Vi=(x=>(x[x.Layered=40]="Layered",x[x.LastParents=41]="LastParents",x[x.Alternating=42]="Alternating",x[x.RootOnly=43]="RootOnly",x))(Vi||{}),zi=(x=>(x[x.Vertical=50]="Vertical",x[x.Horizontal=51]="Horizontal",x[x.FixedRoots=52]="FixedRoots",x))(zi||{}),Ms=(x=>(x[x.Individual=60]="Individual",x[x.Siblings=61]="Siblings",x[x.Uniform=62]="Uniform",x))(Ms||{});class on extends Kt{Ie;Fe;wu;$g;yL;Xi;He;Us;V;B;fP;ws;constructor(t){super(),this.Ie=new K,this.Fe=0,this.ws=1,this.wu=40,this.$g=60,this.yL=[],this.Xi=!0,this.He=50,this.Us=new st(10,10).k();const e=new Xi(this);this.V=new ie(e),this.B=new ie(e),this.fP=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Fe=this.Fe,t.wu=this.wu,t.$g=this.$g,t.Xi=this.Xi,t.He=this.He,t.Us.h(this.Us),t.V.copyInheritedPropertiesFrom(this.V),t.B.copyInheritedPropertiesFrom(this.B)}fe(t){t in Ii?this.alignment=t:t in zi?this.arrangement=t:t in Bi?this.compaction=t:t in Ri?this.path=t:t in Ei?this.sorting=t:t in Vi?this.treeStyle=t:super.fe(t)}createNetwork(){return new Xi(this)}makeNetwork(t){const e=this.createNetwork(),i=s=>{if(s instanceof W)return!s.isLinkLabel&&s.category!=="Comment";if(s instanceof U){const n=s.fromNode;if(n===null||n.isLinkLabel||n.category==="Comment")return!1;const o=s.toNode;return!(o===null||o.isLinkLabel||o.category==="Comment")}return!1};return t instanceof X?(e.addParts(t.nodes,!0,i),e.addParts(t.links,!0,i)):t instanceof at?e.addParts(t.memberParts,!1,i):e.addParts(t.iterator,!1,i),e}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let e=this.diagram;e===null&&t instanceof X&&(e=t),this.path===0&&e!==null?this.ws=e.isTreePathToChildren?1:2:this.ws=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.oU(),this.rU(),this.lU(),this.aU(),this.fL(),this.hU(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Ie=new K,this.isValidLayout=!0}oU(){if(this.network===null)return;this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const n=t.value;n.initialized=!1,n.level=0,n.parent=null,n.children=[]}if(this.Ie.count>0){const n=new K,o=this.Ie.iterator;for(;o.next();){const r=o.value;if(r instanceof W){const a=this.network.findVertex(r);a!==null&&n.add(a)}else r instanceof ie&&n.add(r)}this.Ie=n}this.Ie.count===0&&this.findRoots();const e=this.Ie.copy().iterator;for(;e.next();){const n=e.value;n.initialized||(n.initialized=!0,this.wL(n))}let i=this.network.vertexes,s=null;for(;s=this.cU(i),s.count>0;){const n=this.AF(s);n!==null&&(this.Ie.add(n),n.initialized=!0,this.wL(n)),i=s}}cU(t){const e=new K,i=t.iterator;for(;i.next();){const s=i.value;s.initialized||e.add(s)}return e}findRoots(){if(this.network===null)return;const t=this.network.vertexes,e=t.iterator;for(;e.next();){const i=e.value;switch(this.ws){case 1:i.sourceEdges.count===0&&this.Ie.add(i);break;case 2:i.destinationEdges.count===0&&this.Ie.add(i);break;default:y.o("Unhandled path value "+this.ws.toString())}}if(this.Ie.count===0){const i=this.AF(t);i!==null&&this.Ie.add(i)}}AF(t){let e=999999,i=null;const s=t.iterator;for(;s.next();){const n=s.value;switch(this.ws){case 1:n.sourceEdges.count<e&&(e=n.sourceEdges.count,i=n);break;case 2:n.destinationEdges.count<e&&(e=n.destinationEdges.count,i=n);break;default:y.o("Unhandled path value "+this.ws.toString())}}return i}wL(t){if(t===null)return;switch(this.ws){case 1:if(t.destinationEdges.count>0){const s=new J,n=t.destinationVertexes;for(;n.next();){const o=n.value;this.TF(t,o)&&s.add(o)}s.count>0&&(t.children=s.toArray())}break;case 2:if(t.sourceEdges.count>0){const s=new J,n=t.sourceVertexes;for(;n.next();){const o=n.value;this.TF(t,o)&&s.add(o)}s.count>0&&(t.children=s.toArray())}break;default:y.o("Unhandled path value"+this.ws.toString())}const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];n.initialized=!0,n.level=t.level+1,n.parent=t,this.Ie.delete(n)}for(let s=0;s<i;s++){const n=e[s];this.wL(n)}}TF(t,e){return e.initialized?this.fU(e,t)||e.level>t.level?!1:(this.uU(e.parent,e),!0):!0}fU(t,e){if(e===null)return!1;let i=e.parent;for(;i!==null&&i!==t;)i=i.parent;return i===t}uU(t,e){if(t===null||e===null)return;const i=t.children;let s=0;for(let n=0;n<i.length;n++)i[n]===e&&s++;if(s>0){const n=new Array(i.length-s);let o=0;for(let r=0;r<i.length;r++)i[r]!==e&&(n[o++]=i[r]);t.children=n}}rU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ie&&this.DF(e)}}DF(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let e=0,i=t.childrenCount,s=0;const n=t.children,o=n.length;for(let r=0;r<o;r++){const a=n[r];this.DF(a),e+=a.descendantCount+1,i=Math.max(i,a.maxChildrenCount),s=Math.max(s,a.maxGenerationCount)}t.descendantCount=e,t.maxChildrenCount=i,t.maxGenerationCount=i>0?s+1:0}dU(t){switch(this.wu){default:case 40:return t.parent!==null?t.parent:this.V;case 43:return t.parent===null?this.V:t.parent.parent===null?this.B:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.B:this.V;case 41:{let e=!0;if(t.childrenCount===0)e=!1;else{const i=t.children,s=i.length;for(let n=0;n<s;n++)if(i[n].childrenCount>0){e=!1;break}}return e&&t.parent!==null?this.B:t.parent!==null?t.parent:this.V}}}initializeTreeVertexValues(t){const e=this.dU(t);if(t.copyInheritedPropertiesFrom(e),t.parent!==null&&t.parent.alignment===25){let i=t.angle;const s=t.parent.children;let n=0;for(;n<s.length&&t!==s[n];)n++;n%2===0?n!==s.length-1&&(i===90?i=180:i===180?i=270:i===270?i=180:i=270):i===90?i=0:i===180?i=90:i===270?i=0:i=90,t.angle=i}t.initialized=!0}lU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ie&&this.vF(e)}}vF(t){if(t===null)return;this.assignTreeVertexValues(t);const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.vF(n)}}assignTreeVertexValues(t){}aU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ie&&this.FF(e)}}FF(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.FF(n)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}fL(){if(!this.comments||this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;this.addComments(e)}}addComments(t){const e=t.angle,i=t.parent;let s=0,n=21,o=!1;i!==null&&(s=i.angle,n=i.alignment,o=this.isBusAlignment(n));const r=e===90||e===270,a=s===90||s===270,l=t.childrenCount===0;let h=0,u=0,c=0;const d=t.commentSpacing;if(t.node!==null){const f=t.node.findNodesConnected();for(;f.next();){const m=f.value;if(m.category!=="Comment"||!m.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(m),m.ensureBounds();const g=m.measuredBounds;r&&!l||!o&&!a&&l||o&&a&&l?(h=Math.max(h,g.width),u+=g.height+Math.abs(c)):(h+=g.width+Math.abs(c),u=Math.max(u,g.height)),c=d}}if(t.comments!==null){r&&!l||!o&&!a&&l||o&&a&&l?(h+=Math.abs(t.commentMargin),u=Math.max(0,u-t.height)):(u+=Math.abs(t.commentMargin),h=Math.max(0,h-t.width));const f=I.z(0,0,t.bounds.width+h,t.bounds.height+u);t.bounds=f,I.i(f)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}vw(t){return t===24||t===25}xL(t){const e=t.parent;if(e!==null){const i=e.alignment;if(this.isBusAlignment(i))if(this.vw(i)){const s=e.children;let n=0;for(;n<s.length&&t!==s[n];)n++;return n%2===0}else return i===26}return!1}layoutComments(t){if(t.comments!==null){const e=t.node.measuredBounds,i=t.parent,s=t.angle;let n=0,o=21,r=!1;i!==null&&(n=i.angle,o=i.alignment,r=this.isBusAlignment(o));const a=s===90||s===270,l=n===90||n===270,h=t.childrenCount===0,u=this.xL(t);let c=0;const d=t.comments,f=d.length,m=P.l();for(let p=0;p<f;p++){const b=d[p],v=b.measuredBounds;if(a&&!h||!r&&!l&&h||r&&l&&h){if(n>135&&!r||l&&u)if(t.commentMargin>=0){m.e(t.bounds.x-t.commentMargin-v.width,t.bounds.y+c),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleLeft,k.toSpot=T.MiddleRight}}else{m.e(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+c),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleRight,k.toSpot=T.MiddleLeft}}else if(t.commentMargin>=0){m.e(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+c),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleRight,k.toSpot=T.MiddleLeft}}else{m.e(t.bounds.x+t.commentMargin-v.width,t.bounds.y+c),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleLeft,k.toSpot=T.MiddleRight}}t.commentSpacing>=0?c+=v.height+t.commentSpacing:c+=t.commentSpacing-v.height}else{if(n>135&&!r||!l&&u)if(t.commentMargin>=0){m.e(t.bounds.x+c,t.bounds.y-t.commentMargin-v.height),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleTop,k.toSpot=T.MiddleBottom}}else{m.e(t.bounds.x+c,t.bounds.y+t.focus.y*2-t.commentMargin),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleBottom,k.toSpot=T.MiddleTop}}else if(t.commentMargin>=0){m.e(t.bounds.x+c,t.bounds.y+t.focus.y*2+t.commentMargin),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleBottom,k.toSpot=T.MiddleTop}}else{m.e(t.bounds.x+c,t.bounds.y+t.commentMargin-v.height),b.move(m);const w=b.findLinksInto();for(;w.next();){const k=w.value;k.fromSpot=T.MiddleTop,k.toSpot=T.MiddleBottom}}t.commentSpacing>=0?c+=v.width+t.commentSpacing:c+=t.commentSpacing-v.width}}P.i(m);const g=c-t.commentSpacing-(a?e.height:e.width);if(this.ws===1){const p=t.destinationEdges;for(;p.next();){const b=p.value.link;b!==null&&!b.isAvoiding&&(b.fromEndSegmentLength=g>0?g:NaN)}}else{const p=t.sourceEdges;for(;p.next();){const b=p.value.link;b!==null&&!b.isAvoiding&&(b.toEndSegmentLength=g>0?g:NaN)}}}}hU(){if(this.network===null)return;if(this.layerStyle===62){const e=[];let i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;let n=s.parent;n===null&&(n=s);const o=n.angle===0||n.angle===180;let r=e[s.level];r===void 0&&(r=0),e[s.level]=Math.max(r,o?s.width:s.height)}for(let s=0;s<e.length;s++)e[s]===void 0&&(e[s]=0);for(this.yL=e,i=this.network.vertexes.iterator;i.next();){const s=i.value;let n=s.parent;n===null&&(n=s),n.angle===0||n.angle===180?(n.angle===180&&(s.focusX+=e[s.level]-s.width),s.width=e[s.level]):(n.angle===270&&(s.focusY+=e[s.level]-s.height),s.height=e[s.level])}}else if(this.layerStyle===61){const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value,s=i.angle===0||i.angle===180;let n=-1;for(let o=0;o<i.children.length;o++){const r=i.children[o];n=Math.max(n,s?r.width:r.height)}if(n>=0)for(let o=0;o<i.children.length;o++){const r=i.children[o];s?(i.angle===180&&(r.focusX+=n-r.width),r.width=n):(i.angle===270&&(r.focusY+=n-r.height),r.height=n)}}}const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ie&&this.layoutTree(e)}}layoutTree(t){if(t===null)return;const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.layoutTree(n)}switch(t.compaction){case 30:this.RF(t);break;default:case 31:t.alignment===25?this.RF(t):this.gU(t);break}}RF(t){if(t.childrenCount===0){let z=!1,V=0,Y=21;t.parent!==null&&(V=t.parent.angle,Y=t.parent.alignment,z=this.isBusAlignment(Y));const _=this.xL(t);t.U.e(0,0),t.dt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((V===180||V===270)&&!z||_)?V===180&&!z||(V===90||V===270)&&_?t.at.e(t.width-t.focus.x*2,0):t.at.e(0,t.height-t.focus.y*2):t.at.e(0,0);return}const e=this.orthoAngle(t),i=e===90||e===270;let s=0;const n=t.children,o=n.length;for(let z=0;z<o;z++){const V=n[z];s=Math.max(s,i?V.dt.width:V.dt.height)}const r=t.alignment,a=r===22,l=r===23,h=this.isBusAlignment(r),u=Math.max(0,t.breadthLimit),c=this.computeLayerSpacing(t),d=t.nodeSpacing,f=this.computeNodeIndent(t),m=a||l?0:f/2,g=t.rowSpacing;let p=0;(a||l)&&(p=Math.max(0,t.rowIndent));const b=t.width,v=t.height;let w=0,k=0,S=0,N=0,D=0,A=0,M=0,C=0,F=0,O=0;if(h&&!this.vw(r)&&e>135&&n.reverse(),this.vw(r))if(o>1)for(let z=0;z<o;z++){const V=n[z],Y=V.dt;z%2===0&&z!==o-1?F=Math.max(F,(i?Y.width:Y.height)+this.computeBusNodeSpacing(V)-d):z%2!==0&&(O=Math.max(O,(i?Y.width:Y.height)+this.computeBusNodeSpacing(V)-d))}else o===1&&(F=i?n[0].dt.width:n[0].dt.height);if(h)switch(r){case 24:case 25:const z=I.l();e<135?this.OF(t,n,F,O,w,k,z):this.IF(t,n,F,O,w,k,z),F=z.x,w=z.width,k=z.height,I.i(z);break;case 26:for(let V=0;V<o;V++){const Y=n[V],_=Y.dt,nt=M===0?0:g;i?(Y.U.e(s-_.width,D+nt),w=Math.max(w,_.width),k=Math.max(k,D+nt+_.height),D+=nt+_.height):(Y.U.e(N+nt,s-_.height),w=Math.max(w,N+nt+_.width),k=Math.max(k,_.height),N+=nt+_.width),M++}break;case 27:for(let V=0;V<o;V++){const Y=n[V],_=Y.dt,nt=M===0?0:g;i?(Y.U.e(d/2+t.focus.x,D+nt),w=Math.max(w,_.width),k=Math.max(k,D+nt+_.height),D+=nt+_.height):(Y.U.e(N+nt,d/2+t.focus.y),w=Math.max(w,N+nt+_.width),k=Math.max(k,_.height),N+=nt+_.width),M++}break}else for(let z=0;z<o;z++){const V=n[z],Y=V.dt;if(i){u>0&&M>0&&N+d+Y.width>u&&(N<s&&this.yc(t,r,s-N,0,C,z-1),A++,M=0,C=z,S=k,N=0,D=e>135?-k-g:k+g);const _=M===0?m:d;this.uP(V,0,D),V.U.e(N+_,D),w=Math.max(w,N+_+Y.width),k=Math.max(k,S+(A===0?0:g)+Y.height),N+=_+Y.width}else{u>0&&M>0&&D+d+Y.height>u&&(D<s&&this.yc(t,r,0,s-D,C,z-1),A++,M=0,C=z,S=w,D=0,N=e>135?-w-g:w+g);const _=M===0?m:d;this.uP(V,N,0),V.U.e(N,D+_),k=Math.max(k,D+_+Y.height),w=Math.max(w,S+(A===0?0:g)+Y.width),D+=_+Y.height}M++}A>0&&(i?(k+=Math.max(0,c),N<w&&this.yc(t,r,w-N,0,C,o-1),p>0&&(l||this.xu(t,p,0,0,o-1),w+=p)):(w+=Math.max(0,c),D<k&&this.yc(t,r,0,k-D,C,o-1),p>0&&(l||this.xu(t,0,p,0,o-1),k+=p)));let E=0,B=0;switch(r){case 20:i?E+=w/2-t.focus.x-f/2:B+=k/2-t.focus.y-f/2;break;default:case 21:if(A>0)i?E+=w/2-t.focus.x-f/2:B+=k/2-t.focus.y-f/2;else{const V=o;if(i){const Y=n[0].U.x+n[0].at.x,_=n[V-1].U.x+n[V-1].at.x+n[V-1].focus.x*2;E+=Y+(_-Y)/2-t.focus.x-f/2}else{const Y=n[0].U.y+n[0].at.y,_=n[V-1].U.y+n[V-1].at.y+n[V-1].focus.y*2;B+=Y+(_-Y)/2-t.focus.y-f/2}}break;case 22:i?(E-=f,w+=f):(B-=f,k+=f);break;case 23:i?(E+=w-t.width+f,w+=f):(B+=k-t.height+f,k+=f);break;case 24:case 25:i?o>1?E+=F+d/2-t.focus.x:E+=n[0].focus.x-t.focus.x+n[0].at.x:o>1?B+=F+d/2-t.focus.y:B+=n[0].focus.y-t.focus.y+n[0].at.y;break;case 26:i?E+=w+d/2-t.focus.x:B+=k+d/2-t.focus.y;break;case 27:break;case 28:const z=this.customAlignment(t,E,B,w,k);E=z[0],B=z[1],w=z[2],k=z[3];break}for(let z=0;z<o;z++){const V=n[z];i?V.U.e(V.U.x+V.at.x-E,V.U.y+(e>135?(h?-k:-V.dt.height)+V.at.y-c:v+c+V.at.y)):V.U.e(V.U.x+(e>135?(h?-w:-V.dt.width)+V.at.x-c:b+c+V.at.x),V.U.y+V.at.y-B)}i?(w=this.bL(t,w,E),E<0&&(E=0),e>135&&(B+=k+c),k=Math.max(Math.max(k,v),k+v+c)):(e>135&&(E+=w+c),w=Math.max(Math.max(w,b),w+b+c),k=this.kL(t,k,B),B<0&&(B=0)),t.at.e(E,B),t.dt.e(w,k)}customAlignment(t,e,i,s,n){return[e,i,s,n]}OF(t,e,i,s,n,o,r){const a=e.length;if(a===0)return r.e(i,0,n,o),r;if(a===1){const p=e[0];return n=p.dt.width,o=p.dt.height,r.e(i,0,n,o),r}const l=t.nodeSpacing,h=t.rowSpacing,u=this.orthoAngle(t)===90;let c=0,d=0,f=0;for(let p=0;p<a;p++){if(p%2!==0||a>1&&p===a-1)continue;const b=e[p],v=b.dt,w=c===0?0:h;if(u){const k=this.computeBusNodeSpacing(b)-l;b.U.e(i-(v.width+k),f+w),n=Math.max(n,v.width+k),o=Math.max(o,f+w+v.height),f+=w+v.height}else{const k=this.computeBusNodeSpacing(b)-l;b.U.e(d+w,i-(v.height+k)),o=Math.max(o,v.height+k),n=Math.max(n,d+w+v.width),d+=w+v.width}c++}c=0;const m=d,g=f;u?(d=i+l,f=0):(d=0,f=i+l);for(let p=0;p<a;p++){if(p%2===0)continue;const b=e[p],v=b.dt,w=c===0?0:h;if(u){const k=this.computeBusNodeSpacing(b)-l;b.U.e(d+k,f+w),n=Math.max(n,d+v.width+k),o=Math.max(o,f+w+v.height),f+=w+v.height}else{const k=this.computeBusNodeSpacing(b)-l;b.U.e(d+w,f+k),n=Math.max(n,d+w+v.width),o=Math.max(o,f+v.height+k),d+=w+v.width}c++}if(a>1&&a%2===1){const p=e[a-1],b=p.dt,v=this.computeBusLastRowSpacing(p,u?Math.max(Math.abs(g),Math.abs(f)):Math.max(Math.abs(m),Math.abs(d)));if(u){p.U.e(i+l/2-p.focus.x-p.at.x,o+v);const w=i+l/2-p.focus.x-p.at.x;n=Math.max(n,w+b.width),w<0&&(n-=w),o=Math.max(o,Math.max(g,f)+v+b.height),p.U.x<0&&(i=this.dP(t,p.U.x,!1,i,l))}else{p.U.e(n+v,i+l/2-p.focus.y-p.at.y),n=Math.max(n,Math.max(m,d)+v+b.width);const w=i+l/2-p.focus.y-p.at.y;o=Math.max(o,w+b.height),w<0&&(o-=w),p.U.y<0&&(i=this.dP(t,p.U.y,!0,i,l))}}return r.e(i,0,n,o),r}IF(t,e,i,s,n,o,r){const a=e.length;if(a===0)return r.e(i,0,n,o),r;if(a===1){const p=e[0];return n=p.dt.width,o=p.dt.height,r.e(i,0,n,o),r}const l=t.nodeSpacing,h=t.rowSpacing,u=this.orthoAngle(t)===270;let c=0,d=0,f=0;for(let p=0;p<a;p++){if(p%2!==0||a>1&&p===a-1)continue;const b=e[p],v=b.dt,w=c===0?0:h;if(u){const k=this.computeBusNodeSpacing(b)-l;f-=w+v.height,b.U.e(i-(v.width+k),f),n=Math.max(n,v.width+k),o=Math.max(o,Math.abs(f))}else{const k=this.computeBusNodeSpacing(b)-l;d-=w+v.width,b.U.e(d,i-(v.height+k)),o=Math.max(o,v.height+k),n=Math.max(n,Math.abs(d))}c++}c=0;const m=d,g=f;u?(d=i+l,f=0):(d=0,f=i+l);for(let p=0;p<a;p++){if(p%2===0)continue;const b=e[p],v=b.dt,w=c===0?0:h;if(u){const k=this.computeBusNodeSpacing(b)-l;f-=w+v.height,b.U.e(d+k,f),n=Math.max(n,d+v.width+k),o=Math.max(o,Math.abs(f))}else{const k=this.computeBusNodeSpacing(b)-l;d-=w+v.width,b.U.e(d,f+k),o=Math.max(o,f+v.height+k),n=Math.max(n,Math.abs(d))}c++}if(a>1&&a%2===1){const p=e[a-1],b=p.dt,v=this.computeBusLastRowSpacing(p,u?Math.max(Math.abs(g),Math.abs(f)):Math.max(Math.abs(m),Math.abs(d)));if(u){p.U.e(i+l/2-p.focus.x-p.at.x,-o-b.height-v);const w=i+l/2-p.focus.x-p.at.x;n=Math.max(n,w+b.width),w<0&&(n-=w),o=Math.max(o,Math.abs(Math.min(g,f))+v+b.height),p.U.x<0&&(i=this.dP(t,p.U.x,!1,i,l))}else{p.U.e(-n-b.width-v,i+l/2-p.focus.y-p.at.y),n=Math.max(n,Math.abs(Math.min(m,d))+v+b.width);const w=i+l/2-p.focus.y-p.at.y;o=Math.max(o,w+b.height),w<0&&(o-=w),p.U.y<0&&(i=this.dP(t,p.U.y,!0,i,l))}}for(let p=0;p<a;p++){const b=e[p];u?b.U.e(b.U.x,b.U.y+o):b.U.e(b.U.x+n,b.U.y)}return r.e(i,0,n,o),r}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,e){return t.parent===null?0:t.parent.rowSpacing}dP(t,e,i,s,n){const o=t.children,r=o.length;for(let l=0;l<r;l++)i?o[l].U.e(o[l].U.x,o[l].U.y-e):o[l].U.e(o[l].U.x-e,o[l].U.y);const a=o[r-1];return Math.max(s,i?a.at.y+a.focus.y-n/2:a.at.x+a.focus.x-n/2)}bL(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.width>s&&(s=i+t.width),i<0&&(s-=i),s;case 22:return t.width>e?t.width:e;case 23:return t.focus.x*2>e?t.width:e+t.width-t.focus.x*2;case 24:case 25:const n=Math.min(0,i),o=Math.max(e,i+t.width);return Math.max(t.width,o-n);case 26:return t.width-t.focus.x+t.nodeSpacing/2+e;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+e);default:return e}}kL(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.height>s&&(s=i+t.height),i<0&&(s-=i),s;case 22:return t.height>e?t.height:e;case 23:return t.focus.y*2>e?t.height:e+t.height-t.focus.y*2;case 24:case 25:const n=Math.min(0,i),o=Math.max(e,i+t.height);return Math.max(t.height,o-n);case 26:return t.height-t.focus.y+t.nodeSpacing/2+e;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+e);default:return e}}PL(t,e,i){switch(t){case 20:e/=2,i/=2;break;case 21:e/=2,i/=2;break;case 22:e=0,i=0;break;case 23:break;default:y.o("Unhandled alignment value "+t.toString())}return new P(e,i)}yc(t,e,i,s,n,o){const r=this.PL(e,i,s);this.xu(t,r.x,r.y,n,o)}xu(t,e,i,s,n){if(e===0&&i===0)return;const o=t.children;for(let r=s;r<=n;r++){const a=o[r].U;a.x+=e,a.y+=i}}uP(t,e,i){const s=t.parent;switch(this.ws){case 1:{const n=t.sourceEdges;for(;n.next();){const o=n.value;o.fromVertex===s&&o.relativePoint.e(e,i)}break}case 2:{const n=t.destinationEdges;for(;n.next();){const o=n.value;o.toVertex===s&&o.relativePoint.e(e,i)}break}default:y.o("Unhandled path value "+this.ws.toString())}}gU(t){if(t.childrenCount===0){const Q=t.parent;let rt=!1,ut=0,gt=21;Q!==null&&(ut=Q.angle,gt=Q.alignment,rt=this.isBusAlignment(gt));const vt=this.xL(t);t.U.e(0,0),t.dt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((ut===180||ut===270)&&!rt||vt)?ut===180&&!rt||(ut===90||ut===270)&&vt?t.at.e(t.width-t.focus.x*2,0):t.at.e(0,t.height-t.focus.y*2):t.at.e(0,0),t.Zg=null,t.Qg=null;return}const e=this.orthoAngle(t),i=e===90||e===270;let s=0;const n=t.children,o=n.length;for(let Q=0;Q<o;Q++){const rt=n[Q];s=Math.max(s,i?rt.dt.width:rt.dt.height)}const r=t.alignment,a=r===22,l=r===23,h=this.isBusAlignment(r),u=Math.max(0,t.breadthLimit),c=this.computeLayerSpacing(t),d=t.nodeSpacing,f=this.computeNodeIndent(t),m=t.rowSpacing;let g=0;(a||l)&&(g=Math.max(0,t.rowIndent));const p=t.width,b=t.height;let v=0,w=0,k=0,S=null,N=null,D=0,A=0,M=0,C=0,F=0,O=0,E=0,B=0,z=0;if(h&&!this.vw(r)&&e>135&&n.reverse(),this.vw(r))if(o>1)for(let Q=0;Q<o;Q++)Q%2===0&&Q!==o-1?B=Math.max(B,i?n[Q].dt.width:n[Q].dt.height):Q%2!==0&&(z=Math.max(z,i?n[Q].dt.width:n[Q].dt.height));else o===1&&(B=i?n[0].dt.width:n[0].dt.height);if(h){switch(r){case 24:const Q=I.l();e<135?this.OF(t,n,B,z,v,w,Q):this.IF(t,n,B,z,v,w,Q),B=Q.x,v=Q.width,w=Q.height,I.i(Q);break;case 26:for(let rt=0;rt<o;rt++){const ut=n[rt],gt=ut.dt,vt=O===0?0:m;i?(ut.U.e(s-gt.width,C+vt),v=Math.max(v,gt.width),w=Math.max(w,C+vt+gt.height),C+=vt+gt.height):(ut.U.e(M+vt,s-gt.height),v=Math.max(v,M+vt+gt.width),w=Math.max(w,gt.height),M+=vt+gt.width),O++}break;case 27:for(let rt=0;rt<o;rt++){const ut=n[rt],gt=ut.dt,vt=O===0?0:m;i?(ut.U.e(d/2+t.focus.x,C+vt),v=Math.max(v,gt.width),w=Math.max(w,C+vt+gt.height),C+=vt+gt.height):(ut.U.e(M+vt,d/2+t.focus.y),v=Math.max(v,M+vt+gt.width),w=Math.max(w,gt.height),M+=vt+gt.width),O++}break}S=this.pi(2),N=this.pi(2),i?(S[0].e(0,0),S[1].e(0,w),N[0].e(v,0),N[1].e(v,w)):(S[0].e(0,0),S[1].e(v,0),N[0].e(0,w),N[1].e(v,w))}else for(let Q=0;Q<o;Q++){const rt=n[Q],ut=rt.dt;if(i){u>0&&O>0&&M+d+ut.width>u&&(M<s&&this.yc(t,r,s-M,0,E,Q-1),F++,O=0,E=Q,k=w,M=0,C=e>135?-w-m:w+m),this.uP(rt,0,C);let gt=0;if(O===0)S=rt.Zg,N=rt.Qg,D=ut.width,A=ut.height,(S===null||N===null||e!==this.orthoAngle(rt))&&(S=this.pi(2),N=this.pi(2),S[0].e(0,0),S[1].e(0,A),N[0].e(D,0),N[1].e(D,A));else{const vt=y.nt(),Z=I.l();this.EF(t,rt,S,N,D,A,vt,Z),gt=Z.x,S=vt[0],N=vt[1],D=Z.width,A=Z.height,y.Z(vt),M<ut.width&&gt<0&&(this.xu(t,-gt,0,E,Q-1),this.gP(S,-gt,0),this.gP(N,-gt,0),gt=0),I.i(Z)}rt.U.e(gt,C),v=Math.max(v,D),w=Math.max(w,k+(F===0?0:m)+ut.height),M=D}else{u>0&&O>0&&C+d+ut.height>u&&(C<s&&this.yc(t,r,0,s-C,E,Q-1),F++,O=0,E=Q,k=v,C=0,M=e>135?-v-m:v+m),this.uP(rt,M,0);let gt=0;if(O===0)S=rt.Zg,N=rt.Qg,D=ut.width,A=ut.height,(S===null||N===null||e!==this.orthoAngle(rt))&&(S=this.pi(2),N=this.pi(2),S[0].e(0,0),S[1].e(D,0),N[0].e(0,A),N[1].e(D,A));else{const vt=y.nt(),Z=I.l();this.EF(t,rt,S,N,D,A,vt,Z),gt=Z.x,S=vt[0],N=vt[1],D=Z.width,A=Z.height,y.Z(vt),C<ut.height&&gt<0&&(this.xu(t,0,-gt,E,Q-1),this.gP(S,0,-gt),this.gP(N,0,-gt),gt=0),I.i(Z)}rt.U.e(M,gt),w=Math.max(w,A),v=Math.max(v,k+(F===0?0:m)+ut.width),C=A}O++}F>0&&(i?(w+=Math.max(0,c),M<v&&this.yc(t,r,v-M,0,E,o-1),g>0&&(l||this.xu(t,g,0,0,o-1),v+=g)):(v+=Math.max(0,c),C<w&&this.yc(t,r,0,w-C,E,o-1),g>0&&(l||this.xu(t,0,g,0,o-1),w+=g)));let V=0,Y=0;switch(r){case 20:i?V+=v/2-t.focus.x-f/2:Y+=w/2-t.focus.y-f/2;break;default:case 21:if(F>0)i?V+=v/2-t.focus.x-f/2:Y+=w/2-t.focus.y-f/2;else{const rt=o;if(i){const ut=n[0].U.x+n[0].at.x,gt=n[rt-1].U.x+n[rt-1].at.x+n[rt-1].focus.x*2;V+=ut+(gt-ut)/2-t.focus.x-f/2}else{const ut=n[0].U.y+n[0].at.y,gt=n[rt-1].U.y+n[rt-1].at.y+n[rt-1].focus.y*2;Y+=ut+(gt-ut)/2-t.focus.y-f/2}}break;case 22:i?(V-=f,v+=f):(Y-=f,w+=f);break;case 23:i?(V+=v-t.width+f,v+=f):(Y+=w-t.height+f,w+=f);break;case 24:i?o>1?V+=B+d/2-t.focus.x:V+=n[0].focus.x-t.focus.x+n[0].at.x:o>1?Y+=B+d/2-t.focus.y:Y+=n[0].focus.y-t.focus.y+n[0].at.y;break;case 26:i?V+=v+d/2-t.focus.x:Y+=w+d/2-t.focus.y;break;case 27:break;case 28:const Q=this.customAlignment(t,V,Y,v,w);V=Q[0],Y=Q[1],v=Q[2],w=Q[3];break}for(let Q=0;Q<o;Q++){const rt=n[Q];i?rt.U.e(rt.U.x+rt.at.x-V,rt.U.y+(e>135?(h?-w:-rt.dt.height)+rt.at.y-c:b+c+rt.at.y)):rt.U.e(rt.U.x+(e>135?(h?-v:-rt.dt.width)+rt.at.x-c:p+c+rt.at.x),rt.U.y+rt.at.y-Y)}let _=0,nt=0;if(h)i?(v=this.bL(t,v,V),V<0&&(V=0),e>135&&(Y+=w+c),w+=b+c,r===27&&(_+=d/2+t.focus.x),nt+=b+c):(e>135&&(V+=v+c),v+=p+c,w=this.kL(t,w,Y),Y<0&&(Y=0),r===27&&(nt+=d/2+t.focus.y),_+=p+c);else if(i){if(t.comments===null){if(p>v){const Q=this.PL(r,p-v,0);_=Q.x,nt=Q.y,v=p,V=0}}else v=this.bL(t,v,V);V<0&&(_-=V,V=0),e>135&&(Y+=w+c),w=Math.max(Math.max(w,b),w+b+c),nt+=b+c}else{if(e>135&&(V+=v+c),v=Math.max(Math.max(v,p),v+p+c),t.comments===null){if(b>w){const Q=this.PL(r,0,b-w);_=Q.x,nt=Q.y,w=b,Y=0}}else w=this.kL(t,w,Y);Y<0&&(nt-=Y,Y=0),_+=p+c}let $,it;if(F>0)$=this.pi(4),it=this.pi(4),i?($[2].e(0,b+c),$[3].e($[2].x,w),it[2].e(v,$[2].y),it[3].e(it[2].x,$[3].y)):($[2].e(p+c,0),$[3].e(v,$[2].y),it[2].e($[2].x,w),it[3].e($[3].x,it[2].y));else{$=this.pi(S.length+2),it=this.pi(N.length+2);for(let Q=0;Q<S.length;Q++){const rt=S[Q];$[Q+2].e(rt.x+_,rt.y+nt)}for(let Q=0;Q<N.length;Q++){const rt=N[Q];it[Q+2].e(rt.x+_,rt.y+nt)}}i?($[0].e(V,0),$[1].e($[0].x,b),$[2].y<$[1].y&&($[2].x>$[0].x?$[2].h($[1]):$[1].h($[2])),$[3].y<$[2].y&&($[3].x>$[0].x?$[3].h($[2]):$[2].h($[3])),it[0].e(V+p,0),it[1].e(it[0].x,b),it[2].y<it[1].y&&(it[2].x<it[0].x?it[2].h(it[1]):it[1].h(it[2])),it[3].y<it[2].y&&(it[3].x<it[0].x?it[3].h(it[2]):it[2].h(it[3])),$[2].y-=c/2,it[2].y-=c/2):($[0].e(0,Y),$[1].e(p,$[0].y),$[2].x<$[1].x&&($[2].y>$[0].y?$[2].h($[1]):$[1].h($[2])),$[3].x<$[2].x&&($[3].y>$[0].y?$[3].h($[2]):$[2].h($[3])),it[0].e(0,Y+b),it[1].e(p,it[0].y),it[2].x<it[1].x&&(it[2].y<it[0].y?it[2].h(it[1]):it[1].h(it[2])),it[3].x<it[2].x&&(it[3].y<it[0].y?it[3].h(it[2]):it[2].h(it[3])),$[2].x-=c/2,it[2].x-=c/2),this.un(S),this.un(N),t.Zg=$,t.Qg=it,t.at.e(V,Y),t.dt.e(v,w)}gP(t,e,i){for(let s=0;s<t.length;s++){const n=t[s];n.x+=e,n.y+=i}}EF(t,e,i,s,n,o,r,a){const l=this.orthoAngle(t),h=l===90||l===270,u=t.nodeSpacing,c=i,d=s,f=n,m=o;let g=e.Zg,p=e.Qg;const b=e.dt,v=h?Math.max(m,b.height):Math.max(f,b.width);if((g===null||l!==this.orthoAngle(e))&&(g=this.pi(2),p=this.pi(2),h?(g[0].e(0,0),g[1].e(0,b.height),p[0].e(b.width,0),p[1].e(p[0].x,g[1].y)):(g[0].e(0,0),g[1].e(b.width,0),p[0].e(0,b.height),p[1].e(g[1].x,p[0].y))),h){const w=f;let k=w-this.mU(d,g,w);return k+=u,i=this.pU(c,g,k),s=this.yU(d,p,k),n=Math.max(0,k)+b.width,o=v,this.un(c),this.un(g),this.un(d),this.un(p),r[0]=i,r[1]=s,a.e(k,0,n,o),a}else{const w=m;let k=w-this.wU(d,g,w);return k+=u,i=this.xU(c,g,k),s=this.bU(d,p,k),n=v,o=Math.max(0,k)+b.height,this.un(c),this.un(g),this.un(d),this.un(p),r[0]=i,r[1]=s,a.e(k,0,n,o),a}}xU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;o<e.length&&e[o].x<t[0].x;){const h=e[o++];s[r++].e(h.x,h.y+i)}for(;n<t.length;){const h=t[n++];s[r++].e(h.x,h.y)}const a=t[t.length-1].x;for(;o<e.length&&e[o].x<=a;)o++;for(;o<e.length&&e[o].x>a;){const h=e[o++];s[r++].e(h.x,h.y+i)}const l=this.pi(r);for(n=0;n<r;n++)l[n].h(s[n]);return this.un(s),l}pU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;o<e.length&&e[o].y<t[0].y;){const h=e[o++];s[r++].e(h.x+i,h.y)}for(;n<t.length;){const h=t[n++];s[r++].e(h.x,h.y)}const a=t[t.length-1].y;for(;o<e.length&&e[o].y<=a;)o++;for(;o<e.length&&e[o].y>a;){const h=e[o++];s[r++].e(h.x+i,h.y)}const l=this.pi(r);for(n=0;n<r;n++)l[n].h(s[n]);return this.un(s),l}bU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].x<e[0].x;){const h=t[n++];s[r++].e(h.x,h.y)}for(;o<e.length;){const h=e[o++];s[r++].e(h.x,h.y+i)}const a=e[e.length-1].x;for(;n<t.length&&t[n].x<=a;)n++;for(;n<t.length&&t[n].x>a;){const h=t[n++];s[r++].e(h.x,h.y)}const l=this.pi(r);for(n=0;n<r;n++)l[n].h(s[n]);return this.un(s),l}yU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].y<e[0].y;){const h=t[n++];s[r++].e(h.x,h.y)}for(;o<e.length;){const h=e[o++];s[r++].e(h.x+i,h.y)}const a=e[e.length-1].y;for(;n<t.length&&t[n].y<=a;)n++;for(;n<t.length&&t[n].y>a;){const h=t[n++];s[r++].e(h.x,h.y)}const l=this.pi(r);for(n=0;n<r;n++)l[n].h(s[n]);return this.un(s),l}wU(t,e,i){let s=9999999;if(t===null||t.length<2||e===null||e.length<2)return s;let n=0,o=0;for(;n<t.length&&o<e.length;){const r=t[n],a=e[o],l=a.x;let h=a.y;h+=i;let u=r;n+1<t.length&&(u=t[n+1]);let c=a,d=c.x,f=c.y;o+1<e.length&&(c=e[o+1],d=c.x,f=c.y,f+=i);let m=s;r.x===l?m=h-r.y:r.x>l&&r.x<d?m=h+(r.x-l)/(d-l)*(f-h)-r.y:l>r.x&&l<u.x&&(m=h-(r.y+(l-r.x)/(u.x-r.x)*(u.y-r.y))),m<s&&(s=m),u.x<=r.x?n++:d<=l?o++:(u.x<=d&&n++,d<=u.x&&o++)}return s}mU(t,e,i){let s=9999999;if(t===null||t.length<2||e===null||e.length<2)return s;let n=0,o=0;for(;n<t.length&&o<e.length;){const r=t[n],a=e[o];let l=a.x;const h=a.y;l+=i;let u=r;n+1<t.length&&(u=t[n+1]);let c=a,d=c.x,f=c.y;o+1<e.length&&(c=e[o+1],d=c.x,f=c.y,d+=i);let m=s;r.y===h?m=l-r.x:r.y>h&&r.y<f?m=l+(r.y-h)/(f-h)*(d-l)-r.x:h>r.y&&h<u.y&&(m=l-(r.x+(h-r.y)/(u.y-r.y)*(u.x-r.x))),m<s&&(s=m),u.y<=r.y?n++:f<=h?o++:(u.y<=f&&n++,f<=u.y&&o++)}return s}pi(t){const e=this.fP[t];if(e!==void 0){const s=e.pop();if(s!==void 0)return s}const i=[];for(let s=0;s<t;s++)i[s]=new P;return i}un(t){if(!t)return;const e=t.length;let i=this.fP[e];i===void 0&&(i=[],this.fP[e]=i),i.push(t)}arrangeTrees(){if(this.He===52){const t=this.Ie.iterator;for(;t.next();){const e=t.value;if(!(e instanceof ie))continue;const i=e.node;if(i===null)continue;const s=i.position;let n=s.x,o=s.y;isFinite(n)||(n=0),isFinite(o)||(o=0),this.SL(e,n,o)}}else{const t=[],e=this.Ie.iterator;for(;e.next();){const o=e.value;o instanceof ie&&t.push(o)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const i=this.arrangementOrigin;let s=i.x,n=i.y;for(let o=0;o<t.length;o++){const r=t[o];switch(this.SL(r,s+r.at.x,n+r.at.y),this.He){case 50:n+=r.dt.height+this.Us.height;break;default:case 51:s+=r.dt.width+this.Us.width;break}}}}SL(t,e,i){if(t===null)return;t.x=e,t.y=i;const s=t.children,n=s.length;for(let o=0;o<n;o++){const r=s[o];this.SL(r,e+r.U.x,i+r.U.y)}}commitLayout(){this.Pw(),this.commitNodes(),this.pL(),this.isRouting&&this.commitLinks()}commitNodes(){if(this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const e=t.value;this.layoutComments(e)}}pL(){if(this.network===null||this.layerStyle!==62)return;const t=this.yL,e=[];let i;const s=this.network.vertexes.iterator;for(;s.next();){const l=s.value;i===void 0?i=l.bounds.copy():i.unionRect(l.bounds);let h=e[l.level];h===void 0?h=this.computeLayerSpacing(l):h=Math.max(h,this.computeLayerSpacing(l)),e[l.level]=h}if(!i)return;for(let l=0;l<e.length;l++)e[l]===void 0&&(e[l]=0);let n;this.angle===90||this.angle===270?(i.inflate(this.nodeSpacing/2,this.layerSpacing),n=new P(-this.nodeSpacing/2,-this.layerSpacing/2)):(i.inflate(this.layerSpacing,this.nodeSpacing/2),n=new P(-this.layerSpacing/2,-this.nodeSpacing/2));const o=[],r=this.angle===90||this.angle===270?i.width:i.height;let a=0;if(this.angle===180||this.angle===270)for(let l=0;l<t.length;l++)a+=t[l]+e[l];for(let l=0;l<t.length;l++){const h=t[l]+e[l];this.angle===270?(a-=h,o.push(new I(0,a,r,h))):this.angle===90?(o.push(new I(0,a,r,h)),a+=h):this.angle===180?(a-=h,o.push(new I(a,0,h,r))):(o.push(new I(a,0,h,r)),a+=h)}this.commitLayers(o,n)}commitLayers(t,e){}commitLinks(){if(this.network===null)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Pw(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ie&&this.UF(e)}}UF(t){if(t===null)return;this.setPortSpots(t);const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.UF(n)}}setPortSpots(t){const e=t.alignment;if(this.isBusAlignment(e))this.kU(t,e);else{const i=this.orthoAngle(t);if(this.ws===1){const s=t.destinationEdges;for(;s.next();){const n=s.value.link;if(n!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(i){case 0:n.fromSpot=T.MiddleRight;break;case 90:n.fromSpot=T.MiddleBottom;break;case 180:n.fromSpot=T.MiddleLeft;break;default:n.fromSpot=T.MiddleTop;break}else n.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(i){case 0:n.toSpot=T.MiddleLeft;break;case 90:n.toSpot=T.MiddleTop;break;case 180:n.toSpot=T.MiddleRight;break;default:n.toSpot=T.MiddleBottom;break}else n.toSpot=t.childPortSpot}}}else{const s=t.sourceEdges;for(;s.next();){const n=s.value.link;if(n!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(i){case 0:n.toSpot=T.MiddleRight;break;case 90:n.toSpot=T.MiddleBottom;break;case 180:n.toSpot=T.MiddleLeft;break;default:n.toSpot=T.MiddleTop;break}else n.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(i){case 0:n.fromSpot=T.MiddleLeft;break;case 90:n.fromSpot=T.MiddleTop;break;case 180:n.fromSpot=T.MiddleRight;break;default:n.fromSpot=T.MiddleBottom;break}else n.fromSpot=t.childPortSpot}}}}}kU(t,e){const i=this.ws===1,s=this.orthoAngle(t);let n;switch(s){case 0:n=T.MiddleRight;break;case 90:n=T.MiddleBottom;break;case 180:n=T.MiddleLeft;break;default:n=T.MiddleTop;break}const o=t.children,r=o.length;switch(e){case 24:case 25:{for(let a=0;a<r;a++){const l=o[a],h=(i?l.sourceEdges:l.destinationEdges).first();if(h===null)continue;const u=h.link;if(u!==null){let c=s===90||s===270?T.MiddleLeft:T.MiddleTop;if(r===1||a===r-1&&r%2===1)switch(s){case 0:c=T.MiddleLeft;break;case 90:c=T.MiddleTop;break;case 180:c=T.MiddleRight;break;default:c=T.MiddleBottom;break}else a%2===0&&(c=s===90||s===270?T.MiddleRight:T.MiddleBottom);i?(t.setsPortSpot&&(u.fromSpot=n),t.setsChildPortSpot&&(u.toSpot=c)):(t.setsPortSpot&&(u.fromSpot=c),t.setsChildPortSpot&&(u.toSpot=n))}}break}case 26:{const a=s===90||s===270?T.MiddleRight:T.MiddleBottom,l=i?t.destinationEdges:t.sourceEdges;for(;l.next();){const h=l.value.link;h!==null&&(i?(t.setsPortSpot&&(h.fromSpot=n),t.setsChildPortSpot&&(h.toSpot=a)):(t.setsPortSpot&&(h.fromSpot=a),t.setsChildPortSpot&&(h.toSpot=n)))}break}case 27:{const a=s===90||s===270?T.MiddleLeft:T.MiddleTop,l=i?t.destinationEdges:t.sourceEdges;for(;l.next();){const h=l.value.link;h!==null&&(i?(t.setsPortSpot&&(h.fromSpot=n),t.setsChildPortSpot&&(h.toSpot=a)):(t.setsPortSpot&&(h.fromSpot=a),t.setsChildPortSpot&&(h.toSpot=n)))}break}}}orthoAngle(t){const e=t.angle;return e<=45?0:e<=135?90:e<=225?180:e<=315?270:0}computeLayerSpacing(t){const e=this.orthoAngle(t),i=e===90||e===270;let s=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const n=Math.min(1,t.layerSpacingParentOverlap);s-=i?t.height*n:t.width*n}return s<(i?-t.height:-t.width)&&(s=i?-t.height:-t.width),s}computeNodeIndent(t){const e=this.orthoAngle(t),i=e===90||e===270;let s=t.nodeIndent;if(t.nodeIndentPastParent>0){const n=Math.min(1,t.nodeIndentPastParent);s+=i?t.width*n:t.height*n}return s=Math.max(0,s),s}get roots(){return this.Ie}set roots(t){this.Ie!==t&&(this.Ie=t,this.p())}get path(){return this.Fe}set path(t){this.Fe!==t&&(this.Fe=t,this.p())}get treeStyle(){return this.wu}set treeStyle(t){this.wu!==t&&(t===40||t===42||t===41||t===43)&&(this.wu=t,this.p())}get layerStyle(){return this.$g}set layerStyle(t){this.$g!==t&&(t===60||t===61||t===62)&&(this.$g=t,this.p())}get comments(){return this.Xi}set comments(t){this.Xi!==t&&(this.Xi=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===50||t===51||t===52)&&(this.He=t,this.p())}get arrangementSpacing(){return this.Us}set arrangementSpacing(t){this.Us.equals(t)||(this.Us.h(t),this.p())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.p())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.p())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.p())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(this.V.comparer=t,this.p())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(t===0||t===90||t===180||t===270?(this.V.angle=t,this.p()):y.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.p())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&t>=0&&(this.V.nodeIndent=t,this.p())}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.p())}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(this.V.nodeSpacing=t,this.p())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(this.V.layerSpacing=t,this.p())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.p())}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(t===30||t===31)&&(this.V.compaction=t,this.p())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&t>=0&&(this.V.breadthLimit=t,this.p())}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(this.V.rowSpacing=t,this.p())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&t>=0&&(this.V.rowIndent=t,this.p())}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(this.V.commentSpacing=t,this.p())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(this.V.commentMargin=t,this.p())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(this.V.setsPortSpot=t,this.p())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.p())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(this.V.setsChildPortSpot=t,this.p())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.p())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.p())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(this.B.comparer=t,this.p())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(t===0||t===90||t===180||t===270)&&(this.B.angle=t,this.p())}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.p())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&t>=0&&(this.B.nodeIndent=t,this.p())}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.p())}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(this.B.nodeSpacing=t,this.p())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(this.B.layerSpacing=t,this.p())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.p())}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(t===30||t===31)&&(this.B.compaction=t,this.p())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&t>=0&&(this.B.breadthLimit=t,this.p())}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(this.B.rowSpacing=t,this.p())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&t>=0&&(this.B.rowIndent=t,this.p())}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(this.B.commentSpacing=t,this.p())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(this.B.commentMargin=t,this.p())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(this.B.setsPortSpot=t,this.p())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.p())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(this.B.setsChildPortSpot=t,this.p())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.p())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}class Xi extends ve{constructor(t){super(t)}createVertex(){return new ie(this)}createEdge(){return new Ns(this)}}class ie extends ke{U;dt;at;mP;pP;yP;wP;xP;bP;kP;Xi;Zg;Qg;Si;Mi;Xt;de;Fw;Rw;Ow;Vs;Iw;Ew;Uw;Vw;Bw;zw;Xw;Gw;Yw;Kw;Hw;constructor(t){super(t),this.mP=!1,this.pP=null,this.yP=[],this.wP=0,this.xP=0,this.bP=0,this.kP=0,this.Xi=null,this.U=new P(0,0),this.dt=new st(0,0),this.at=new P(0,0),this.Zg=null,this.Qg=null,this.Si=10,this.Mi=ke.standardComparer,this.Xt=0,this.de=21,this.Fw=0,this.Rw=0,this.Ow=20,this.Vs=50,this.Iw=0,this.Ew=31,this.Uw=0,this.Vw=25,this.Bw=10,this.zw=10,this.Xw=20,this.Gw=!0,this.Yw=T.Default,this.Kw=!0,this.Hw=T.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.Si=t.sorting,this.Mi=t.comparer,this.Xt=t.angle,this.de=t.alignment,this.Fw=t.nodeIndent,this.Rw=t.nodeIndentPastParent,this.Ow=t.nodeSpacing,this.Vs=t.layerSpacing,this.Iw=t.layerSpacingParentOverlap,this.Ew=t.compaction,this.Uw=t.breadthLimit,this.Vw=t.rowSpacing,this.Bw=t.rowIndent,this.zw=t.commentSpacing,this.Xw=t.commentMargin,this.Gw=t.setsPortSpot,this.Yw=t.portSpot,this.Kw=t.setsChildPortSpot,this.Hw=t.childPortSpot)}get initialized(){return this.mP}set initialized(t){this.mP!==t&&(this.mP=t)}get parent(){return this.pP}set parent(t){this.pP!==t&&(this.pP=t)}get children(){return this.yP}set children(t){if(this.yP!==t){if(t!==null){const e=t.length;for(let i=0;i<e;i++)t[i]}this.yP=t}}get level(){return this.wP}set level(t){this.wP!==t&&(this.wP=t)}get descendantCount(){return this.xP}set descendantCount(t){this.xP!==t&&(this.xP=t)}get maxChildrenCount(){return this.bP}set maxChildrenCount(t){this.bP!==t&&(this.bP=t)}get maxGenerationCount(){return this.kP}set maxGenerationCount(t){this.kP!==t&&(this.kP=t)}get comments(){return this.Xi}set comments(t){if(this.Xi!==t){if(t!==null){const e=t.length;for(let i=0;i<e;i++)t[i]}this.Xi=t}}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t)}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(this.Mi=t)}get angle(){return this.Xt}set angle(t){this.Xt!==t&&(this.Xt=t)}get alignment(){return this.de}set alignment(t){this.de!==t&&(this.de=t)}get nodeIndent(){return this.Fw}set nodeIndent(t){this.Fw!==t&&(this.Fw=t)}get nodeIndentPastParent(){return this.Rw}set nodeIndentPastParent(t){this.Rw!==t&&(this.Rw=t)}get nodeSpacing(){return this.Ow}set nodeSpacing(t){this.Ow!==t&&(this.Ow=t)}get layerSpacing(){return this.Vs}set layerSpacing(t){this.Vs!==t&&(this.Vs=t)}get layerSpacingParentOverlap(){return this.Iw}set layerSpacingParentOverlap(t){this.Iw!==t&&(this.Iw=t)}get compaction(){return this.Ew}set compaction(t){this.Ew!==t&&(this.Ew=t)}get breadthLimit(){return this.Uw}set breadthLimit(t){this.Uw!==t&&(this.Uw=t)}get rowSpacing(){return this.Vw}set rowSpacing(t){this.Vw!==t&&(this.Vw=t)}get rowIndent(){return this.Bw}set rowIndent(t){this.Bw!==t&&(this.Bw=t)}get commentSpacing(){return this.zw}set commentSpacing(t){this.zw!==t&&(this.zw=t)}get commentMargin(){return this.Xw}set commentMargin(t){this.Xw!==t&&(this.Xw=t)}get setsPortSpot(){return this.Gw}set setsPortSpot(t){this.Gw!==t&&(this.Gw=t)}get portSpot(){return this.Yw}set portSpot(t){this.Yw.equals(t)||(this.Yw=t)}get setsChildPortSpot(){return this.Kw}set setsChildPortSpot(t){this.Kw!==t&&(this.Kw=t)}get childPortSpot(){return this.Hw}set childPortSpot(t){this.Hw.equals(t)||(this.Hw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.U}set relativePosition(t){this.U.set(t)}get subtreeSize(){return this.dt}set subtreeSize(t){this.dt.set(t)}get subtreeOffset(){return this.at}set subtreeOffset(t){this.at.set(t)}}class Ns extends Re{PP;constructor(t){super(t),this.PP=new P(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const e=this.network.layout;let i=null,s=null;switch(e.ws){case 1:i=this.fromVertex,s=this.toVertex;break;case 2:i=this.toVertex,s=this.fromVertex;break;default:y.o("Unhandled path value "+e.ws.toString())}if(i===null||s===null)return;const n=this.PP;if(n.x===0&&n.y===0){this.PU(i,s);return}const o=i.bounds,r=e.orthoAngle(i),a=e.computeLayerSpacing(i),l=i.rowSpacing;t.updateRoute();const h=t.curve===9,u=t.isOrthogonal;let c=0,d,f;if(t.startRoute(),u||h){for(c=2;t.pointsCount>4;)t.removePoint(2);d=t.getPoint(1),f=t.getPoint(2)}else{for(c=1;t.pointsCount>3;)t.removePoint(1);d=t.getPoint(0),f=t.getPoint(t.pointsCount-1)}const m=t.getPoint(t.pointsCount-1);let g=0;r===0?(i.alignment===23?(g=o.bottom+n.y,n.y===0&&d.y>m.y+i.rowIndent&&(g=Math.min(g,Math.max(d.y,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.top+n.y,n.y===0&&d.y<m.y-i.rowIndent&&(g=Math.max(g,Math.min(d.y,g+e.computeNodeIndent(i))))):g=o.y+o.height/2+n.y,h?(t.insertPointAt(c,d.x,g),c++,t.insertPointAt(c,o.right+a,g),c++,t.insertPointAt(c,o.right+a+(n.x-l)/3,g),c++,t.insertPointAt(c,o.right+a+(n.x-l)*2/3,g),c++,t.insertPointAt(c,o.right+a+(n.x-l),g),c++,t.insertPointAt(c,f.x,g),c++):(u&&(t.insertPointAt(c,o.right+a/2,d.y),c++),t.insertPointAt(c,o.right+a/2,g),c++,t.insertPointAt(c,o.right+a+n.x-(u?l/2:l),g),c++,u&&(t.insertPointAt(c,t.getPoint(c-1).x,f.y),c++))):r===90?(i.alignment===23?(g=o.right+n.x,n.x===0&&d.x>m.x+i.rowIndent&&(g=Math.min(g,Math.max(d.x,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.left+n.x,n.x===0&&d.x<m.x-i.rowIndent&&(g=Math.max(g,Math.min(d.x,g+e.computeNodeIndent(i))))):g=o.x+o.width/2+n.x,h?(t.insertPointAt(c,g,d.y),c++,t.insertPointAt(c,g,o.bottom+a),c++,t.insertPointAt(c,g,o.bottom+a+(n.y-l)/3),c++,t.insertPointAt(c,g,o.bottom+a+(n.y-l)*2/3),c++,t.insertPointAt(c,g,o.bottom+a+(n.y-l)),c++,t.insertPointAt(c,g,f.y),c++):(u&&(t.insertPointAt(c,d.x,o.bottom+a/2),c++),t.insertPointAt(c,g,o.bottom+a/2),c++,t.insertPointAt(c,g,o.bottom+a+n.y-(u?l/2:l)),c++,u&&(t.insertPointAt(c,f.x,t.getPoint(c-1).y),c++))):r===180?(i.alignment===23?(g=o.bottom+n.y,n.y===0&&d.y>m.y+i.rowIndent&&(g=Math.min(g,Math.max(d.y,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.top+n.y,n.y===0&&d.y<m.y-i.rowIndent&&(g=Math.max(g,Math.min(d.y,g+e.computeNodeIndent(i))))):g=o.y+o.height/2+n.y,h?(t.insertPointAt(c,d.x,g),c++,t.insertPointAt(c,o.left-a,g),c++,t.insertPointAt(c,o.left-a+(n.x+l)/3,g),c++,t.insertPointAt(c,o.left-a+(n.x+l)*2/3,g),c++,t.insertPointAt(c,o.left-a+(n.x+l),g),c++,t.insertPointAt(c,f.x,g),c++):(u&&(t.insertPointAt(c,o.left-a/2,d.y),c++),t.insertPointAt(c,o.left-a/2,g),c++,t.insertPointAt(c,o.left-a+n.x+(u?l/2:l),g),c++,u&&(t.insertPointAt(c,t.getPoint(c-1).x,f.y),c++))):r===270?(i.alignment===23?(g=o.right+n.x,n.x===0&&d.x>m.x+i.rowIndent&&(g=Math.min(g,Math.max(d.x,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.left+n.x,n.x===0&&d.x<m.x-i.rowIndent&&(g=Math.max(g,Math.min(d.x,g+e.computeNodeIndent(i))))):g=o.x+o.width/2+n.x,h?(t.insertPointAt(c,g,d.y),c++,t.insertPointAt(c,g,o.top-a),c++,t.insertPointAt(c,g,o.top-a+(n.y+l)/3),c++,t.insertPointAt(c,g,o.top-a+(n.y+l)*2/3),c++,t.insertPointAt(c,g,o.top-a+(n.y+l)),c++,t.insertPointAt(c,g,f.y),c++):(u&&(t.insertPointAt(c,d.x,o.top-a/2),c++),t.insertPointAt(c,g,o.top-a/2),c++,t.insertPointAt(c,g,o.top-a+n.y+(u?l/2:l)),c++,u&&(t.insertPointAt(c,f.x,t.getPoint(c-1).y),c++))):y.o("Invalid angle "+r),t.commitRoute()}PU(t,e){const i=this.link;if(i===null)return;const s=this.network.layout,n=s.orthoAngle(t),o=s.orthoAngle(e);if(n===o)return;const r=s.computeLayerSpacing(t),a=t.bounds,l=e.bounds;if(n===0&&l.left-a.right<r+1||n===90&&l.top-a.bottom<r+1||n===180&&a.left-l.right<r+1||n===270&&a.top-l.bottom<r+1)return;i.updateRoute();const h=i.curve===9,u=i.isOrthogonal,c=this.fromVertex,d=s.isBusAlignment(c.alignment);if(i.startRoute(),n===0){const f=a.right+r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).y;i.setPointAt(1,f-20,i.getPoint(1).y),i.insertPointAt(2,f-20,m),i.insertPointAt(3,f,m),i.insertPointAt(4,f+20,m),i.setPointAt(5,i.getPoint(5).x,m)}}else u?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,f,i.getPoint(2).y),i.setPointAt(3,f,i.getPoint(3).y)):i.pointsCount===4?i.insertPointAt(2,f,i.getPoint(2).y):i.pointsCount===3?i.setPointAt(1,f,i.getPoint(2).y):i.pointsCount===2&&i.insertPointAt(1,f,i.getPoint(1).y)}else if(n===90){const f=a.bottom+r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,f-20),i.insertPointAt(2,m,f-20),i.insertPointAt(3,m,f),i.insertPointAt(4,m,f+20),i.setPointAt(5,m,i.getPoint(5).y)}}else u?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,i.getPoint(2).x,f),i.setPointAt(3,i.getPoint(3).x,f)):i.pointsCount===4?i.insertPointAt(2,i.getPoint(2).x,f):i.pointsCount===3?i.setPointAt(1,i.getPoint(2).x,f):i.pointsCount===2&&i.insertPointAt(1,i.getPoint(1).x,f)}else if(n===180){const f=a.left-r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).y;i.setPointAt(1,f+20,i.getPoint(1).y),i.insertPointAt(2,f+20,m),i.insertPointAt(3,f,m),i.insertPointAt(4,f-20,m),i.setPointAt(5,i.getPoint(5).x,m)}}else u?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,f,i.getPoint(2).y),i.setPointAt(3,f,i.getPoint(3).y)):i.pointsCount===4?i.insertPointAt(2,f,i.getPoint(2).y):i.pointsCount===3?i.setPointAt(1,f,i.getPoint(2).y):i.pointsCount===2&&i.insertPointAt(1,f,i.getPoint(1).y)}else if(n===270){const f=a.top-r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,f+20),i.insertPointAt(2,m,f+20),i.insertPointAt(3,m,f),i.insertPointAt(4,m,f-20),i.setPointAt(5,m,i.getPoint(5).y)}}else u?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,i.getPoint(2).x,f),i.setPointAt(3,i.getPoint(3).x,f)):i.pointsCount===4?i.insertPointAt(2,i.getPoint(2).x,f):i.pointsCount===3?i.setPointAt(1,i.getPoint(2).x,f):i.pointsCount===2&&i.insertPointAt(1,i.getPoint(1).x,f)}i.commitRoute()}get fromVertex(){return this.ss}set fromVertex(t){this.ss!==t&&(this.ss=t)}get toVertex(){return this.ns}set toVertex(t){this.ns!==t&&(this.ns=t)}get relativePoint(){return this.PP}set relativePoint(t){this.PP.set(t)}}class he{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Mt(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Mt(5)},arrowheads:{toArrow:"Standard"}}}class Ae{hs=new Set;bu=new bt;SP="light";MP="light";NP=!1;ML=!0;_g="light";VF=t=>{const e=t.matches?"dark":"light";e!==this._g&&(this._g=e,this.MP==="system"&&this.updateDiagrams())};constructor(t){t&&Object.assign(this,t),t?.themeMap||(this.bu.set("light",{colors:{...he.Light.colors},fonts:{...he.Light.fonts},numbers:{...he.Light.numbers},margins:{...he.Light.margins},arrowheads:{...he.Light.arrowheads}}),this.bu.set("dark",{colors:{...he.Dark.colors},fonts:{...he.Dark.fonts},numbers:{...he.Dark.numbers},margins:{...he.Dark.margins},arrowheads:{...he.Dark.arrowheads}})),H.matchMedia&&(this._g=H.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.bu}set themeMap(t){this.bu!==t&&(this.bu=t,this.updateDiagrams())}get defaultTheme(){return this.SP}set defaultTheme(t){this.SP!==t&&(y.s(t,"string",Ae,"defaultTheme"),this.SP=t,this.updateDiagrams())}get currentTheme(){return this.MP}set currentTheme(t){this.MP!==t&&(y.s(t,"string",Ae,"currentTheme"),this.MP=t,this.updateDiagrams())}get changesDivBackground(){return this.NP}set changesDivBackground(t){if(this.NP!==t&&(this.NP=t,t))for(const e of this.hs)e.setDivBackground(this.findValue("div","","fill")),e.T("ThemeChanged",this)}get readsCssVariables(){return this.ML}set readsCssVariables(t){this.ML!==t&&(this.ML=t,this.updateDiagrams())}get preferredColorScheme(){return this._g}addDiagram(t){return this.hs.add(t),this.NL(t),this}removeDiagram(t){return this.hs.delete(t),this.NL(t),this}tO(){this.hs.size===0&&H.matchMedia&&H.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.VF)}eO(){this.hs.size===0&&H.matchMedia&&H.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.VF)}set(t,e){t===""&&(t=this.SP),t==="system"&&(t=this._g);let i=this.bu.get(t);return i?i=this.BF(i,e):i=e,this.bu.set(t,i),this.updateDiagrams(),this}findValue(t,e,i){return this.getValue(this.findTheme(this.currentTheme),t,e,i)||this.getValue(this.findTheme(this.defaultTheme),t,e,i)}getValue(t,e,i,s){if(!t)return;i==null&&(i="");let n=t;const o=a=>{if(n===void 0||a==="")return;if(typeof a=="number"||!(Array.isArray(a)||a.includes(".")))return n[a];const l=Array.isArray(a)?a:a.split(".");for(let h=0;h<l.length;h++){const u=l[h];if(u!==""&&(n=n[u],n===void 0))return}return n},r=()=>{if(!(i!==""&&(n=o(i),n===void 0)))return Array.isArray(n)&&typeof e=="number"?n=n[e%n.length]:n=o(e),n};if(n=r(),n===void 0&&typeof s=="string"&&s.length>0){let a=t.targetPropertyMap?.get(s);if(a?n=t[a]:(a=Ae.SU.get(s),n=a?t[a]:t.colors),n=r(),n!==void 0)return n}return n}findTheme(t){return this.themeMap.get(t==="system"?this._g:t)}updateDiagrams(){for(const t of this.hs)this.NL(t)}NL(t){const e=t.skipsUndoManager;t.skipsUndoManager=!0,t.updateAllThemeBindings(),this.NP&&t.setDivBackground(this.findValue("div","","fill")),t.skipsUndoManager=e,t.T("ThemeChanged",this)}BF(t,e){for(const i in e)if(y.jw(e,i))try{e[i]?.constructor===Object?t[i]=this.BF(t[i]??{},e[i]):t[i]=e[i]}catch{delete t[i]}return t}static SU=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class Cs{Pt;a;Be;Pl;constructor(){this.a=X.Om(),this.Pt="",this.Be=!0,this.Pl=!0}get name(){return this.Pt}set name(t){this.Pt=t}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get isRealtime(){return this.Pl}set isRealtime(t){this.Pl=t}get diagram(){return this.a}set diagram(t){this.a!==t&&(this.a=t,t.Fl=!0,t.requestUpdate())}invalidateRouter(){this.a!==null&&(this.a.Fl=!0,this.a.requestUpdate())}canRoute(t){if(!this.isEnabled)return!1;const e=this.diagram;return!(e&&(!this.isRealtime&&e.Iu||e.animationManager.isTicking))}isRoutable(t,e){return!0}routeLinks(t,e){}toString(){return this.name!==""?this.name+" Router":y.Hn(this.constructor)}}class rn extends Cs{constructor(t){super(),this.name="AvoidsNodes",t&&Object.assign(this,t)}canRoute(t){return(t instanceof X?t.lp:t.diagram?.lp)?super.canRoute(t):!1}isRoutable(t,e){return!(!t.isAvoiding||t.containingGroup!==(e instanceof at?e:null)||t.toNode===null||t.fromNode===null||t.pointsCount<4)}routeLinks(t,e){const i=e instanceof X?null:e,s=t.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){const o=s.value;if(!this.isRoutable(o,e))continue;o.startRoute();const r=o.pointsCount,a=o.getPoint(1),l=o.getPoint(r-2),h=o.fromNode.actualBounds.copy();h.inflate(U.Fa,U.Fa),h.unionPoint(o.getPoint(0));const u=o.toNode.actualBounds.copy();u.inflate(U.Fa,U.Fa),u.unionPoint(o.getPoint(r-1)),this.MU(o,h,u,n)&&this.NU(o,a,o.PC,l,o.SC,h,u,n),o.commitRoute()}}MU(t,e,i,s){const n=t.diagram,o=t.pointsCount;if(n===null||!t.fromNode||!t.toNode||t.fromNode===t.toNode||!t.layer||t.layer.isTemporary||e.containsPoint(t.getPoint(o-1))&&!t.toNode.isMemberOf(t.fromNode)||i.containsPoint(t.getPoint(0))&&!t.fromNode.isMemberOf(t.toNode)||!t.isOrthogonal)return!1;if(t.segmentIndex===17)return!0;const r=t.getPoint(1),a=t.getPoint(o-2),l=t.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,l.x),Math.min(r.y,l.y),Math.abs(r.x-l.x),Math.abs(r.y-l.y)))return!0;for(let u=2;u<o-3;u++){const c=t.getPoint(u),d=t.getPoint(u+1);if(!s.isUnoccupied(Math.min(c.x,d.x),Math.min(c.y,d.y),Math.abs(c.x-d.x),Math.abs(c.y-d.y)))return!0}const h=t.getPoint(o-3);return!s.isUnoccupied(Math.min(h.x,a.x),Math.min(h.y,a.y),Math.abs(h.x-a.x),Math.abs(h.y-a.y))}NU(t,e,i,s,n,o,r,a){const l=t.diagram;if(l===null)return;const h=e,u=s;let c=P.mn,d=P.mn;if(l.isVirtualized){const g=a.bounds.copy(),p=t.getPoint(2),b=t.getPoint(t.pointsCount-3);g.inflate(-a.cellWidth,-a.cellHeight);const v=P.l();a.ng(e.x,e.y)||(L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,e.x,e.y,p.x,p.y,v)?(c=e=v.copy(),i=v.directionPoint(p)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,p.x,p.y,b.x,b.y,v)?(c=e=v.copy(),i=v.directionPoint(b)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,b.x,b.y,s.x,s.y,v)&&(c=e=v.copy(),i=v.directionPoint(s))),a.ng(s.x,s.y)||(L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,s.x,s.y,b.x,b.y,v)?(d=s=v.copy(),n=b.directionPoint(v)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,b.x,b.y,p.x,p.y,v)?(d=s=v.copy(),n=p.directionPoint(v)):L.Cl(g.x,g.y,g.x+g.width,g.y+g.height,p.x,p.y,e.x,e.y,v)&&(d=s=v.copy(),n=e.directionPoint(v))),P.i(v)}const f=o.copy().unionRect(r);f.inflate(a.cellWidth*a.hf,a.cellHeight*a.hf),a.yv(e,i,s,n,f,!0);let m=a.bo(s.x,s.y);if(!a.tw&&m>=Ct.sg&&(a.TT(),f.inflate(a.cellWidth*a.E2,a.cellHeight*a.U2),a.yv(e,i,s,n,f,!1),m=a.bo(s.x,s.y)),!a.tw&&m<Ct.sg&&!a.GE(s.x,s.y)){t.points.removeRange(2,t.pointsCount-3),this.CL(t,a,s.x,s.y,n,!0);const g=0,p=90,b=180,v=270,w=t.getPoint(2);if(t.pointsCount<4)i===g||i===b?(w.x=e.x,w.y=s.y):(w.x=s.x,w.y=e.y),t.setPointAt(2,w.x,w.y),t.insertPointAt(3,w.x,w.y);else{const k=t.getPoint(3);if(i===g||i===b)if(L.u(w.x,k.x)){const S=i===g?Math.max(w.x,e.x):Math.min(w.x,e.x);t.setPointAt(2,S,e.y),t.setPointAt(3,S,k.y)}else L.u(w.y,k.y)?(Math.abs(e.y-w.y)<=a.cellHeight/2&&(t.setPointAt(2,w.x,e.y),t.setPointAt(3,k.x,e.y)),t.insertPointAt(2,w.x,e.y)):t.setPointAt(2,e.x,w.y);else if(i===p||i===v)if(L.u(w.y,k.y)){const S=i===p?Math.max(w.y,e.y):Math.min(w.y,e.y);t.setPointAt(2,e.x,S),t.setPointAt(3,k.x,S)}else L.u(w.x,k.x)?(Math.abs(e.x-w.x)<=a.cellWidth/2&&(t.setPointAt(2,e.x,w.y),t.setPointAt(3,e.x,k.y)),t.insertPointAt(2,e.x,w.y)):t.setPointAt(2,w.x,e.y)}if(c.isReal()){const k=t.getPoint(1),S=t.getPoint(2);k.x!==S.x&&k.y!==S.y?i===g||i===b?t.insertPointAt(2,k.x,S.y):t.insertPointAt(2,S.x,k.y):i===g||i===b?t.insertPointAt(2,h.x,c.y):t.insertPointAt(2,c.x,h.y)}d.isReal()&&(n===g||n===b?t.insertPointAt(t.pointsCount-2,u.x,d.y):t.insertPointAt(t.pointsCount-2,d.x,u.y))}}CL(t,e,i,s,n,o){const r=e.cellWidth,a=e.cellHeight;let l=e.bo(i,s),h=i,u=s,c=h,d=u;for(n===0?c+=r:n===90?d+=a:n===180?c-=r:d-=a,t.TC&&l>Ct.nc&&e.bo(c,d)!==l-1&&(e.bo(h-r,u)===l-1?(n=180,c=h-r,d=u):e.bo(h+r,u)===l-1?(n=0,c=h+r,d=u):e.bo(h,u-a)===l-1?(n=270,c=h,d=u-a):e.bo(h,u+a)===l-1&&(n=90,c=h,d=u+a));l>Ct.nc&&e.bo(c,d)===l-1;)h=c,u=d,n===0?c+=r:n===90?d+=a:n===180?c-=r:d-=a,l-=1;if(o?l>Ct.nc&&(n===180||n===0?h=Math.floor(h/r)*r+r/2:(n===90||n===270)&&(u=Math.floor(u/a)*a+a/2)):(h=Math.floor(h/r)*r+r/2,u=Math.floor(u/a)*a+a/2),l>Ct.nc){let f=n,m=h,g=u;if(n===0?(f=90,g+=a):n===90?(f=180,m-=r):n===180?(f=270,g-=a):n===270&&(f=0,m+=r),e.bo(m,g)===l-1)this.CL(t,e,m,g,f,!1);else{let p=h,b=u;n===0?(f=270,b-=a):n===90?(f=0,p+=r):n===180?(f=90,b+=a):n===270&&(f=180,p-=r),e.bo(p,b)===l-1&&this.CL(t,e,p,b,f,!1)}}t.insertPointAt(t.pointsCount-2,h,u)}}Ce.prototype.initializeStandardTools=function(){return this.Jt("Action",new $i,this.mouseDownTools),this.Jt("Relinking",new De,this.mouseDownTools),this.Jt("LinkReshaping",new qi,this.mouseDownTools),this.Jt("Rotating",new Wi,this.mouseDownTools),this.Jt("Resizing",new Hi,this.mouseDownTools),this.Jt("Linking",new ze,this.mouseMoveTools),this.Jt("Dragging",new St,this.mouseMoveTools),this.Jt("DragSelecting",new Zi,this.mouseMoveTools),this.Jt("Panning",new Qi,this.mouseMoveTools),this.Jt("ContextMenu",new At,this.mouseUpTools),this.Jt("TextEditing",new oe,this.mouseUpTools),this.Jt("ClickCreating",new $e,this.mouseUpTools),this.Jt("ClickSelecting",new Ji,this.mouseUpTools),this},X.g2("GraphLinksModel",_s),X.g2("TreeModel",tn);const si=H.go,qe={get version(){return X.version},Group:at,List:J,Set:K,Map:bt,Point:P,Size:st,Rect:I,Margin:Mt,Spot:T,Geometry:yt,PathFigure:Lt,PathSegment:dt,InputEvent:te,DiagramEvent:We,ChangedEvent:Ne,Model:ht,GraphLinksModel:Ot,TreeModel:Ie,Binding:Yt,ThemeBinding:Ee,Transaction:Ve,UndoManager:Je,CommandHandler:Et,Tool:qt,DraggingTool:St,DraggingInfo:Te,DraggingOptions:Ze,LinkingBaseTool:ai,LinkingTool:ze,RelinkingTool:De,LinkReshapingTool:qi,ResizingTool:Hi,RotatingTool:Wi,ClickSelectingTool:Ji,ActionTool:$i,ClickCreatingTool:$e,HTMLInfo:ye,ContextMenuTool:At,DragSelectingTool:Zi,PanningTool:Qi,TextEditingTool:oe,ToolManager:Ce,Animation:ae,AnimationManager:re,AnimationTrigger:Xe,Layer:Ht,Diagram:X,Palette:Is,Overview:Ke,Brush:R,GraphObject:tt,Panel:j,RowColumnDefinition:Dt,Shape:et,TextBlock:lt,Picture:Tt,Part:ft,Adornment:pt,Node:W,Link:U,Placeholder:Jt,Layout:Kt,LayoutNetwork:ve,LayoutVertex:ke,LayoutEdge:Re,GridLayout:ei,PanelLayout:Pt,CircularLayout:en,CircularNetwork:gs,CircularVertex:ms,CircularEdge:ps,ForceDirectedLayout:sn,ForceDirectedNetwork:ys,ForceDirectedVertex:xs,ForceDirectedEdge:bs,LayeredDigraphLayout:nn,LayeredDigraphNetwork:Ps,LayeredDigraphVertex:Ge,LayeredDigraphEdge:Ss,TreeLayout:on,TreeNetwork:Xi,TreeVertex:ie,TreeEdge:Ns,Themes:he,ThemeManager:Ae,Router:Cs,AnimationStyle:is,AutoScale:li,CycleMode:ns,Flip:as,TextFormat:gi,ImageStretch:pi,LayoutConditions:cs,LinkAdjusting:bi,Curve:vi,Routing:wi,Orientation:ui,TextOverflow:us,PortSpreading:ds,ScrollMode:os,CollapsePolicy:rs,Sizing:ci,TriggerStart:ss,Stretch:hi,ViewboxStretch:hs,Wrap:fi,BrushType:be,ColorSpace:ls,GeometryStretch:oi,GeometryType:Me,SegmentType:Be,BindingMode:ii,ChangeType:ri,CircularArrangement:Ni,CircularDirection:Ci,CircularNodeDiameterFormula:Li,CircularSorting:Ti,GridAlignment:Pi,GridArrangement:Si,GridSorting:Mi,LayeredDigraphAggressive:Oi,LayeredDigraphAlign:ks,LayeredDigraphCycleRemove:Ai,LayeredDigraphInit:Fi,LayeredDigraphLayering:Di,LayeredDigraphPack:vs,TreeAlignment:Ii,TreeArrangement:zi,TreeCompaction:Bi,TreeLayerStyle:Ms,TreePath:Ri,TreeSorting:Ei,TreeStyle:Vi,GestureMode:Ui,LinkingDirection:ji,ReshapingBehavior:Gi,TextEditingAccept:_i,TextEditingStarting:ts,TextEditingState:es,WheelMode:Yi};for(const x in qe){const t=qe[x];y.st(t)&&t!==gi&&(t.className=x)}y.$(si)&&si.version&&y.ne("WARNING: a `go` object on the root object is already defined.  "+("Debug"in si?"debug ":"")+"version: "+si.version+", replaced with version: "+qe.version),X.prototype.go=qe,H.go=qe})();const an=typeof global<"u"?global.go:self.go,G=typeof global<"u"?global.go:self.go,ln=G.Group,hn=G.List,un=G.Set,cn=G.Map,dn=G.Point,fn=G.Size,gn=G.Rect,mn=G.Margin,pn=G.Spot,yn=G.Geometry,xn=G.PathFigure,bn=G.PathSegment,wn=G.InputEvent,vn=G.DiagramEvent,kn=G.ChangedEvent,Pn=G.Model,Sn=G.GraphLinksModel,Mn=G.TreeModel,Nn=G.Binding,Cn=G.ThemeBinding,Tn=G.Transaction,Ln=G.UndoManager,An=G.CommandHandler,Dn=G.Tool,Fn=G.DraggingTool,On=G.DraggingInfo,Rn=G.DraggingOptions,En=G.LinkingBaseTool,In=G.LinkingTool,Bn=G.RelinkingTool,Vn=G.LinkReshapingTool,zn=G.ResizingTool,Xn=G.RotatingTool,Kn=G.ClickSelectingTool,Yn=G.ActionTool,Un=G.ClickCreatingTool,jn=G.HTMLInfo,Gn=G.ContextMenuTool,qn=G.DragSelectingTool,Hn=G.PanningTool,Wn=G.TextEditingTool,Jn=G.ToolManager,$n=G.Animation,Zn=G.AnimationManager,Qn=G.AnimationTrigger,_n=G.Layer,to=G.Diagram,eo=G.Palette,io=G.Overview,so=G.Brush,no=G.GraphObject,oo=G.Panel,ro=G.RowColumnDefinition,ao=G.Shape,lo=G.TextBlock,ho=G.Picture,uo=G.Part,co=G.Adornment,fo=G.Node,go=G.Link,mo=G.Placeholder,po=G.Layout,yo=G.LayoutNetwork,xo=G.LayoutVertex,bo=G.LayoutEdge,wo=G.GridLayout,vo=G.PanelLayout,ko=G.CircularLayout,Po=G.CircularNetwork,So=G.CircularVertex,Mo=G.CircularEdge,No=G.ForceDirectedLayout,Co=G.ForceDirectedNetwork,To=G.ForceDirectedVertex,Lo=G.ForceDirectedEdge,Ao=G.LayeredDigraphLayout,Do=G.LayeredDigraphNetwork,Fo=G.LayeredDigraphVertex,Oo=G.LayeredDigraphEdge,Ro=G.TreeLayout,Eo=G.TreeNetwork,Io=G.TreeVertex,Bo=G.TreeEdge,Vo=G.Themes,zo=G.ThemeManager,Xo=G.Router,Ko=G.version,Yo=G.AnimationStyle,Uo=G.AutoScale,jo=G.Curve,Go=G.CycleMode,qo=G.Flip,Ho=G.ImageStretch,Wo=G.LayoutConditions,Jo=G.LinkAdjusting,$o=G.Orientation,Zo=G.PortSpreading,Qo=G.Routing,_o=G.ScrollMode,tr=G.CollapsePolicy,er=G.Sizing,ir=G.TriggerStart,sr=G.Stretch,nr=G.TextFormat,or=G.TextOverflow,rr=G.ViewboxStretch,ar=G.Wrap,lr=G.BrushType,hr=G.ColorSpace,ur=G.GeometryStretch,cr=G.GeometryType,dr=G.SegmentType,fr=G.BindingMode,gr=G.ChangeType,mr=G.CircularArrangement,pr=G.CircularDirection,yr=G.CircularNodeDiameterFormula,xr=G.CircularSorting,br=G.GridAlignment,wr=G.GridArrangement,vr=G.GridSorting,kr=G.LayeredDigraphAggressive,Pr=G.LayeredDigraphAlign,Sr=G.LayeredDigraphCycleRemove,Mr=G.LayeredDigraphInit,Nr=G.LayeredDigraphLayering,Cr=G.LayeredDigraphPack,Tr=G.TreeAlignment,Lr=G.TreeArrangement,Ar=G.TreeCompaction,Dr=G.TreeLayerStyle,Fr=G.TreePath,Or=G.TreeSorting,Rr=G.TreeStyle,Er=G.GestureMode,Ir=G.LinkingDirection,Br=G.ReshapingBehavior,Vr=G.TextEditingAccept,zr=G.TextEditingStarting,Xr=G.TextEditingState,Kr=G.WheelMode;export{Yn as ActionTool,co as Adornment,$n as Animation,Zn as AnimationManager,Yo as AnimationStyle,Qn as AnimationTrigger,Uo as AutoScale,Nn as Binding,fr as BindingMode,so as Brush,lr as BrushType,gr as ChangeType,kn as ChangedEvent,mr as CircularArrangement,pr as CircularDirection,Mo as CircularEdge,ko as CircularLayout,Po as CircularNetwork,yr as CircularNodeDiameterFormula,xr as CircularSorting,So as CircularVertex,Un as ClickCreatingTool,Kn as ClickSelectingTool,tr as CollapsePolicy,hr as ColorSpace,An as CommandHandler,Gn as ContextMenuTool,jo as Curve,Go as CycleMode,to as Diagram,vn as DiagramEvent,qn as DragSelectingTool,On as DraggingInfo,Rn as DraggingOptions,Fn as DraggingTool,qo as Flip,Lo as ForceDirectedEdge,No as ForceDirectedLayout,Co as ForceDirectedNetwork,To as ForceDirectedVertex,yn as Geometry,ur as GeometryStretch,cr as GeometryType,Er as GestureMode,Sn as GraphLinksModel,no as GraphObject,br as GridAlignment,wr as GridArrangement,wo as GridLayout,vr as GridSorting,ln as Group,jn as HTMLInfo,Ho as ImageStretch,wn as InputEvent,_n as Layer,kr as LayeredDigraphAggressive,Pr as LayeredDigraphAlign,Sr as LayeredDigraphCycleRemove,Oo as LayeredDigraphEdge,Mr as LayeredDigraphInit,Nr as LayeredDigraphLayering,Ao as LayeredDigraphLayout,Do as LayeredDigraphNetwork,Cr as LayeredDigraphPack,Fo as LayeredDigraphVertex,po as Layout,Wo as LayoutConditions,bo as LayoutEdge,yo as LayoutNetwork,xo as LayoutVertex,go as Link,Jo as LinkAdjusting,Vn as LinkReshapingTool,En as LinkingBaseTool,Ir as LinkingDirection,In as LinkingTool,hn as List,cn as Map,mn as Margin,Pn as Model,fo as Node,$o as Orientation,io as Overview,eo as Palette,oo as Panel,vo as PanelLayout,Hn as PanningTool,uo as Part,xn as PathFigure,bn as PathSegment,ho as Picture,mo as Placeholder,dn as Point,Zo as PortSpreading,gn as Rect,Bn as RelinkingTool,Br as ReshapingBehavior,zn as ResizingTool,Xn as RotatingTool,Xo as Router,Qo as Routing,ro as RowColumnDefinition,_o as ScrollMode,dr as SegmentType,un as Set,ao as Shape,fn as Size,er as Sizing,pn as Spot,sr as Stretch,lo as TextBlock,Vr as TextEditingAccept,zr as TextEditingStarting,Xr as TextEditingState,Wn as TextEditingTool,nr as TextFormat,or as TextOverflow,Cn as ThemeBinding,zo as ThemeManager,Vo as Themes,Dn as Tool,Jn as ToolManager,Tn as Transaction,Tr as TreeAlignment,Lr as TreeArrangement,Ar as TreeCompaction,Bo as TreeEdge,Dr as TreeLayerStyle,Ro as TreeLayout,Mn as TreeModel,Eo as TreeNetwork,Fr as TreePath,Or as TreeSorting,Rr as TreeStyle,Io as TreeVertex,ir as TriggerStart,Ln as UndoManager,rr as ViewboxStretch,Kr as WheelMode,ar as Wrap,an as default,G as go,Ko as version};
