import{a as x}from"./Button-CI_-soaG.js";import{d as I,h as f,a as N,j as y,b as d,f as g,w as P,u as w,m as _,t as A,l as h,o as j}from"./app-CyjtdGoI.js";import{g as V}from"./ColorModeButton-Bf7Nr8w3.js";import{A as F}from"./admin-BzR6vrex.js";import{_ as J}from"./ProductForm.vue_vue_type_script_setup_true_lang-D8Dmg0Wv.js";import"./Tooltip-BrTR-Vq7.js";import"./Switch-sBWkdoVy.js";import"./Label-yeknIWsP.js";import"./useFormControl-D_pV87FU.js";import"./VisuallyHiddenInput-BGOu5NlX.js";import"./Textarea-CZyY9J1c.js";import"./SelectMenu-DKAhKU-v.js";import"./index-v4g8wp86.js";import"./FormField-qFQ_28ZO.js";const C={class:"space-y-6"},D={class:"flex items-center gap-4"},T={class:"text-sm text-slate-500 dark:text-slate-400 mt-1"},Y=I({layout:F,__name:"edit",props:{product:{},categories:{default:()=>[]},admin:{default:()=>({id:0,storeName:"",slug:"",status:""})}},setup(u){const a=u,c=V(),r=f({name:a.product.name,slug:a.product.slug,sku:a.product.sku,categoryId:a.product.categoryId,description:a.product.description||"",specifications:O(a.product.specifications),price:Number(a.product.price)||0,discountPrice:a.product.discountPrice?Number(a.product.discountPrice):null,stock:a.product.stock,minOrder:a.product.minOrder,maxOrder:a.product.maxOrder,weight:Number(a.product.weight)||0,brand:a.product.brand||"",condition:a.product.condition,status:a.product.status,isFeatured:a.product.isFeatured,images:(a.product.images||[]).map((e,i)=>({...e,_uid:`existing-${e.id}`,isPrimary:e.isPrimary??!1,sortOrder:e.sortOrder??i})),variants:a.product.variants||[]});function O(e){if(!e)return[];if(Array.isArray(e))return e;if(typeof e=="string")try{const i=JSON.parse(e);if(typeof i=="object"&&!Array.isArray(i))return Object.entries(i).map(([s,o])=>({key:s,value:String(o)}))}catch{return[]}return typeof e=="object"&&!Array.isArray(e)?Object.entries(e).map(([i,s])=>({key:i,value:String(s)})):[]}const p=f({}),l=f(!1),S=()=>{if(typeof document>"u")return"";const e=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return e?decodeURIComponent(e[1]):""},k=async()=>{l.value=!0,p.value={};try{const e=new FormData;e.append("name",r.value.name),e.append("slug",r.value.slug),e.append("sku",r.value.sku),r.value.categoryId&&e.append("categoryId",String(r.value.categoryId)),e.append("description",r.value.description||""),e.append("specifications",JSON.stringify(r.value.specifications)),e.append("price",String(r.value.price)),r.value.discountPrice&&e.append("discountPrice",String(r.value.discountPrice)),e.append("stock",String(r.value.stock)),e.append("minOrder",String(r.value.minOrder||1)),r.value.maxOrder&&e.append("maxOrder",String(r.value.maxOrder)),e.append("weight",String(r.value.weight)),e.append("brand",r.value.brand||""),e.append("condition",r.value.condition),e.append("status",r.value.status),e.append("isFeatured",String(r.value.isFeatured));const i=[],s=[],o=[];console.info("Processing images:",r.value.images);for(const t of r.value.images)t.isDeleted&&t.id?s.push(t.id):t.file&&!t.isDeleted?(e.append("newImages",t.file),o.push({isPrimary:t.isPrimary??!1,sortOrder:t.sortOrder??0})):t.id&&!t.isDeleted&&i.push({id:t.id,url:t.url,isPrimary:t.isPrimary,sortOrder:t.sortOrder});console.info("existingImages:",i),console.info("newImagesMeta:",o),console.info("deletedImageIds:",s),e.append("existingImages",JSON.stringify(i)),e.append("newImagesMeta",JSON.stringify(o)),s.length>0&&e.append("deletedImages",JSON.stringify(s));const v=[],m=[];for(const t of r.value.variants)t.isActive===!1&&t.id?m.push(t.id):v.push({id:t.id,name:t.name,value:t.value,sku:t.sku,priceAdjustment:t.priceAdjustment,stock:t.stock,isActive:t.isActive});e.append("variants",JSON.stringify(v)),m.length>0&&e.append("deletedVariantIds",JSON.stringify(m));const n=await(await fetch(`/admin/products/${a.product.id}`,{method:"PUT",headers:{"X-Requested-With":"XMLHttpRequest","X-XSRF-TOKEN":S()},body:e})).json();n.success?(c.success("Berhasil",n.message),h.visit("/admin/products")):(p.value=n.errors||{},c.error("Gagal",n.message))}catch(e){console.error("Submit error:",e),c.error("Error","Terjadi kesalahan saat memperbarui produk")}finally{l.value=!1}},b=()=>{h.visit("/admin/products")};return(e,i)=>{const s=x;return j(),N("div",C,[y(" Page Header "),d("div",D,[g(w(_),{href:"/admin/products"},{default:P(()=>[g(s,{icon:"i-heroicons-arrow-left",color:"neutral",variant:"ghost",size:"sm"})]),_:1}),d("div",null,[i[1]||(i[1]=d("h1",{class:"text-2xl font-bold text-slate-900 dark:text-white"},"Edit Produk",-1)),d("p",T,A(u.product.name),1)])]),y(" Form "),g(J,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=o=>r.value=o),categories:u.categories,errors:p.value,"is-submitting":l.value,onSubmit:k,onCancel:b},null,8,["modelValue","categories","errors","is-submitting"])])}}});export{Y as default};
