import{_ as A}from"./Separator-CLms6trA.js";import{_ as E}from"./Checkbox-9qpvU9Db.js";import{_ as H,a as L}from"./Button-CI_-soaG.js";import{d as M,h as v,c as I,a as g,f as i,b as t,u as x,i as G,j as n,w as h,k as y,m as j,e as J,t as d,F as q,r as Q,l as W,o as m}from"./app-CyjtdGoI.js";import{_ as Y,u as Z}from"./default.vue_vue_type_script_setup_true_lang-CxtMHnvj.js";import{g as ee}from"./ColorModeButton-Bf7Nr8w3.js";import"./useFormControl-D_pV87FU.js";import"./VisuallyHiddenInput-BGOu5NlX.js";import"./Label-yeknIWsP.js";import"./Modal-Bgd8PL5Y.js";import"./Badge-DfumusWV.js";import"./DropdownMenu-DxuVXSbh.js";const te={class:"container mx-auto px-4 py-8"},se={class:"mb-6"},ae={class:"flex items-center gap-2 text-sm"},oe={key:0,class:"text-center py-16"},ne={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},le={class:"lg:col-span-2 space-y-4"},re={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4"},ie={class:"flex items-center justify-between"},de={class:"flex items-center gap-3"},ce={class:"font-medium text-gray-900 dark:text-white"},ue={class:"flex gap-4"},me={class:"flex items-start pt-2"},pe=["src","alt"],ge={class:"flex-1 min-w-0"},he={key:0,class:"text-sm text-gray-500 mt-1"},ye={class:"mt-2"},fe={class:"font-semibold text-primary-600"},ve={key:0,class:"text-sm text-gray-400 line-through ml-2"},xe={class:"flex items-center justify-between mt-4"},ke={class:"flex items-center gap-3"},_e={class:"flex items-center border border-gray-300 dark:border-gray-600 rounded-lg"},be=["disabled","onClick"],we={class:"px-4 py-2 min-w-12 text-center font-medium"},Se=["disabled","onClick"],Ce={class:"text-xs text-gray-500"},Ie={class:"lg:col-span-1"},je={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 sticky top-24"},Te={class:"space-y-3 text-sm"},Pe={class:"flex justify-between text-gray-600 dark:text-gray-400"},$e={class:"flex justify-between text-gray-600 dark:text-gray-400"},qe={class:"flex justify-between text-lg font-semibold text-gray-900 dark:text-white"},Be={class:"text-primary-600"},He=M({layout:Y,__name:"index",props:{cartItems:{},summary:{}},setup(B){const T=B,{updateCartItem:R,removeFromCart:X,fetchCartItems:N}=Z(),u=ee(),r=v([...T.cartItems]),f=v(null),k=v(null),l=v(new Set(T.cartItems.filter(s=>s.checked).map(s=>s.id))),P=I(()=>r.value.length>0&&l.value.size===r.value.length),U=I(()=>r.value.filter(s=>l.value.has(s.id))),_=I(()=>{const s=U.value;return{totalItems:r.value.length,checkedItems:s.length,subtotal:s.reduce((e,o)=>e+o.itemPrice*o.quantity,0),totalQuantity:s.reduce((e,o)=>e+o.quantity,0)}}),b=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),w=()=>{if(typeof document>"u")return null;const s=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return s?decodeURIComponent(s[1]):null},z=()=>{P.value?l.value=new Set:l.value=new Set(r.value.map(s=>s.id)),K()},F=async s=>{const e=new Set(l.value);e.has(s)?e.delete(s):e.add(s),l.value=e;try{const o=w();await fetch(`/api/cart/${s}/checked`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",...o&&{"X-XSRF-TOKEN":o}},credentials:"include",body:JSON.stringify({checked:e.has(s)})})}catch{}},K=async()=>{try{const s=w();for(const e of r.value)await fetch(`/api/cart/${e.id}/checked`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",...s&&{"X-XSRF-TOKEN":s}},credentials:"include",body:JSON.stringify({checked:l.value.has(e.id)})})}catch{}},$=async(s,e)=>{if(e<1)return;const o=s.variant?.stock??s.product.stock;if(e>o){u.error(`Stok tidak mencukupi. Tersedia: ${o}`);return}f.value=s.id;const c=await R(s.id,e);if(c.success){const p=r.value.findIndex(S=>S.id===s.id);p!==-1&&(r.value[p].quantity=e)}else u.error(c.message||"Gagal mengupdate quantity");f.value=null},O=async s=>{k.value=s;const e=await X(s);e.success?(r.value=r.value.filter(o=>o.id!==s),l.value.delete(s),u.success("Item dihapus dari keranjang")):u.error(e.message||"Gagal menghapus item"),k.value=null},D=async()=>{if(l.value.size===0){u.warning("Pilih item yang ingin dihapus");return}const s=Array.from(l.value);try{const e=w(),c=await(await fetch("/api/cart/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",...e&&{"X-XSRF-TOKEN":e}},credentials:"include",body:JSON.stringify({ids:s})})).json();c.success?(r.value=r.value.filter(p=>!s.includes(p.id)),l.value=new Set,u.success(`${c.data.deletedCount} item dihapus`),await N()):u.error(c.message||"Gagal menghapus item")}catch{u.error("Terjadi kesalahan")}},V=()=>{if(l.value.size===0){u.warning("Pilih item untuk checkout");return}W.visit("/checkout")};return(s,e)=>{const o=H,c=L,p=E,S=A;return m(),g(q,null,[i(x(G),{title:"Keranjang Belanja"}),t("div",te,[n(" Breadcrumb "),t("nav",se,[t("ol",ae,[t("li",null,[i(x(j),{href:"/",class:"text-gray-500 hover:text-primary-600"},{default:h(()=>[...e[0]||(e[0]=[y("Beranda",-1)])]),_:1})]),e[1]||(e[1]=t("li",{class:"text-gray-400"},"/",-1)),e[2]||(e[2]=t("li",{class:"text-gray-900 dark:text-white font-medium"},"Keranjang",-1))])]),e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-6"},"Keranjang Belanja",-1)),r.value.length===0?(m(),g("div",oe,[i(o,{name:"i-heroicons-shopping-cart",class:"w-20 h-20 text-gray-300 mx-auto mb-4"}),e[4]||(e[4]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},"Keranjang Kosong",-1)),e[5]||(e[5]=t("p",{class:"text-gray-500 mb-6"},"Belum ada produk di keranjang Anda",-1)),i(c,{to:"/",color:"primary"},{default:h(()=>[...e[3]||(e[3]=[y("Mulai Belanja",-1)])]),_:1})])):(m(),g("div",ne,[n(" Cart Items "),t("div",le,[n(" Select All Header "),t("div",re,[t("div",ie,[t("div",de,[i(p,{"model-value":P.value,"onUpdate:modelValue":z},null,8,["model-value"]),t("span",ce," Pilih Semua ("+d(r.value.length)+" produk) ",1)]),l.value.size>0?(m(),J(c,{key:0,color:"red",variant:"ghost",size:"sm",onClick:D},{default:h(()=>[y(" Hapus ("+d(l.value.size)+") ",1)]),_:1})):n("v-if",!0)])]),n(" Cart Items List "),(m(!0),g(q,null,Q(r.value,a=>(m(),g("div",{key:a.id,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4"},[t("div",ue,[n(" Checkbox "),t("div",me,[i(p,{"model-value":l.value.has(a.id),"onUpdate:modelValue":C=>F(a.id)},null,8,["model-value","onUpdate:modelValue"])]),n(" Product Image "),i(x(j),{href:`/products/${a.product.slug}`,class:"shrink-0"},{default:h(()=>[t("img",{src:a.product.image,alt:a.product.name,class:"w-24 h-24 object-cover rounded-lg"},null,8,pe)]),_:2},1032,["href"]),n(" Product Info "),t("div",ge,[n(" Product Name "),i(x(j),{href:`/products/${a.product.slug}`,class:"font-medium text-gray-900 dark:text-white hover:text-primary-600 line-clamp-2"},{default:h(()=>[y(d(a.product.name),1)]),_:2},1032,["href"]),n(" Variant "),a.variant?(m(),g("p",he,d(a.variant.name)+": "+d(a.variant.value),1)):n("v-if",!0),n(" Price "),t("div",ye,[t("span",fe,d(b(a.itemPrice)),1),a.product.discountPrice?(m(),g("span",ve,d(b(a.product.price)),1)):n("v-if",!0)]),n(" Quantity & Delete "),t("div",xe,[t("div",ke,[n(" Quantity Controls "),t("div",_e,[t("button",{type:"button",class:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-l-lg disabled:opacity-50",disabled:f.value===a.id||a.quantity<=1,onClick:C=>$(a,a.quantity-1)},[i(o,{name:"i-heroicons-minus",class:"w-4 h-4"})],8,be),t("span",we,d(a.quantity),1),t("button",{type:"button",class:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-r-lg disabled:opacity-50",disabled:f.value===a.id,onClick:C=>$(a,a.quantity+1)},[i(o,{name:"i-heroicons-plus",class:"w-4 h-4"})],8,Se)]),n(" Stock info "),t("span",Ce," Stok: "+d(a.variant?.stock??a.product.stock),1)]),n(" Delete Button "),i(c,{color:"red",variant:"ghost",size:"sm",loading:k.value===a.id,onClick:C=>O(a.id)},{default:h(()=>[i(o,{name:"i-heroicons-trash",class:"w-4 h-4"})]),_:1},8,["loading","onClick"])])])])]))),128))]),n(" Summary Sidebar "),t("div",Ie,[t("div",je,[e[9]||(e[9]=t("h2",{class:"font-semibold text-lg text-gray-900 dark:text-white mb-4"},"Ringkasan Belanja",-1)),t("div",Te,[t("div",Pe,[e[6]||(e[6]=t("span",null,"Total Produk",-1)),t("span",null,d(_.value.checkedItems)+" item",1)]),t("div",$e,[e[7]||(e[7]=t("span",null,"Total Quantity",-1)),t("span",null,d(_.value.totalQuantity),1)]),i(S),t("div",qe,[e[8]||(e[8]=t("span",null,"Subtotal",-1)),t("span",Be,d(b(_.value.subtotal)),1)])]),i(c,{color:"primary",block:"",size:"lg",class:"mt-6",disabled:l.value.size===0,onClick:V},{default:h(()=>[y(" Checkout ("+d(l.value.size)+") ",1)]),_:1},8,["disabled"]),e[10]||(e[10]=t("p",{class:"text-xs text-gray-500 text-center mt-3"}," Ongkos kirim dihitung saat checkout ",-1))])])]))])],64)}}});export{He as default};
